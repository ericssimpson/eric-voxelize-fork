/*! For license information please see 1df93b7f.82bee947.js.LICENSE.txt */
"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3237],{7024:(t,e,i)=>{i.d(e,{E:()=>l});var o=i(7378),n=i(7853),s=i(6173),r=i(4246);const l=()=>{const t=(0,o.useRef)(null);return(0,o.useEffect)((()=>{if(!t.current)return;const e=t.current,i=new s.CP7({canvas:e,antialias:!0,alpha:!0});i.setPixelRatio(window.devicePixelRatio),i.setSize(e.clientWidth,e.clientHeight),i.outputColorSpace=s.KI_;const o=new s.xsS,r=new s.cPb(75,e.clientWidth/e.clientHeight,.1,1e3);r.position.set(0,.5,2.5),r.lookAt(0,-.5,0);const l=new n.zk;o.add(l);const a=new s.Pa4;let d=0,c=0;function h(t){const i=e.getBoundingClientRect();d=t.clientX-(i.x+e.clientWidth/2),c=t.clientY-(i.y+e.clientHeight/2)}document.addEventListener("mousemove",h,!1);const u=()=>{requestAnimationFrame(u),a.x=.02*d,a.y=.02*-c,a.z=r.position.z,l.set([0,0,0],[a.x,a.y-1,a.z]),l.update(),i.render(o,r)};u();const p=e.parentElement;return window.addEventListener("resize",(()=>{e.width=p.clientWidth,e.height=p.clientHeight,r.aspect=p.clientWidth/p.clientHeight,r.updateProjectionMatrix(),i.setSize(p.clientWidth,p.clientHeight)})),()=>{document.removeEventListener("mousemove",h,!1)}}),[t]),(0,r.jsx)("canvas",{className:"w-full h-full",ref:t})}},3253:(t,e,i)=>{i.r(e),i.d(e,{default:()=>u});i(7378);var o=i(5594),n=i(1191),s=i(9939),r=i(2577),l=i(6156),a=i(5404),d=i(4246);const c=()=>{const{siteConfig:t}=(0,s.Z)();return(0,d.jsxs)("div",{className:"flex flex-col-reverse justify-end items-center min-h-[100vh] lg:flex-row md:min-h-[80vh]",children:[(0,d.jsxs)("div",{className:"flex flex-col justify-start items-center lg:items-start",children:[(0,d.jsxs)("div",{className:"my-10 flex flex-col items-center lg:items-start",children:[(0,d.jsx)("h1",{className:"font-display font-black text-6xl mb-3 md:text-8xl",children:t.title}),(0,d.jsx)(l.e,{sequence:["A multiplayer voxel game engine",1e3,"An immersive 3D web experience",1e3,"A 3D web framework",1e3,"A full-stack game framework",1e3,"A 3D voxel editor",1e3],wrapper:"div",cursor:!1,speed:50,repeat:1/0,className:"font-body text-2xl text-center lg:text-start"})]}),(0,d.jsx)(n.Z,{to:"/tutorials/intro/what-is-voxelize",children:(0,d.jsx)("button",{className:"button button--secondary button--lg",style:{verticalAlign:"middle"},children:"Get Started \u2192"})})]}),(0,d.jsx)("div",{className:"w-[400px] h-[400px] lg:h-[600px]",children:(0,d.jsx)(o.Z,{children:()=>{const t=i(7024).E;return(0,d.jsx)(t,{})}})})]})},h=a.ZP.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  width: 60%;
  margin: 0 auto;
  min-width: 300px;
`,u=()=>(0,d.jsx)(r.Z,{title:"Welcome",description:"\ud83c\udf44 A well-optimized, highly extensible full-stack library to create immersive multiplayer voxel experiences.",children:(0,d.jsx)(h,{children:(0,d.jsx)(c,{})})})},7853:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{zk:()=>Character});var three__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6173),three_examples_jsm_libs_stats_module_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(9597),postprocessing__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(9249),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{};function commonjsRequire(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function iota$1(t){for(var e=new Array(t),i=0;i<t;++i)e[i]=i;return e}var iota_1=iota$1,isBuffer_1=function(t){return null!=t&&(isBuffer$1(t)||isSlowBuffer(t)||!!t._isBuffer)};function isBuffer$1(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function isSlowBuffer(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&isBuffer$1(t.slice(0,0))}var iota=iota_1,isBuffer=isBuffer_1,hasTypedArrays="undefined"!=typeof Float64Array;function compare1st(t,e){return t[0]-e[0]}function order(){var t,e=this.stride,i=new Array(e.length);for(t=0;t<i.length;++t)i[t]=[Math.abs(e[t]),t];i.sort(compare1st);var o=new Array(i.length);for(t=0;t<o.length;++t)o[t]=i[t][1];return o}function compileConstructor(t,e){var i=["View",e,"d",t].join("");e<0&&(i="View_Nil"+t);var o="generic"===t;if(-1===e){var n="function "+i+"(a){this.data=a;};var proto="+i+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+i+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+i+"(a){return new "+i+"(a);}";return new Function(n)()}if(0===e)return n="function "+i+"(a,d) {this.data = a;this.offset = d};var proto="+i+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+i+"_copy() {return new "+i+"(this.data,this.offset)};proto.pick=function "+i+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+i+"_get(){return "+(o?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+i+"_set(v){return "+(o?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+i+"(a,b,c,d){return new "+i+"(a,d)}",new Function("TrivialArray",n)(CACHED_CONSTRUCTORS[t][0]);n=["'use strict'"];var s=iota(e),r=s.map((function(t){return"i"+t})),l="this.offset+"+s.map((function(t){return"this.stride["+t+"]*i"+t})).join("+"),a=s.map((function(t){return"b"+t})).join(","),d=s.map((function(t){return"c"+t})).join(",");n.push("function "+i+"(a,"+a+","+d+",d){this.data=a","this.shape=["+a+"]","this.stride=["+d+"]","this.offset=d|0}","var proto="+i+".prototype","proto.dtype='"+t+"'","proto.dimension="+e),n.push("Object.defineProperty(proto,'size',{get:function "+i+"_size(){return "+s.map((function(t){return"this.shape["+t+"]"})).join("*"),"}})"),1===e?n.push("proto.order=[0]"):(n.push("Object.defineProperty(proto,'order',{get:"),e<4?(n.push("function "+i+"_order(){"),2===e?n.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&n.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):n.push("ORDER})")),n.push("proto.set=function "+i+"_set("+r.join(",")+",v){"),o?n.push("return this.data.set("+l+",v)}"):n.push("return this.data["+l+"]=v}"),n.push("proto.get=function "+i+"_get("+r.join(",")+"){"),o?n.push("return this.data.get("+l+")}"):n.push("return this.data["+l+"]}"),n.push("proto.index=function "+i+"_index(",r.join(),"){return "+l+"}"),n.push("proto.hi=function "+i+"_hi("+r.join(",")+"){return new "+i+"(this.data,"+s.map((function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")})).join(",")+","+s.map((function(t){return"this.stride["+t+"]"})).join(",")+",this.offset)}");var c=s.map((function(t){return"a"+t+"=this.shape["+t+"]"})),h=s.map((function(t){return"c"+t+"=this.stride["+t+"]"}));n.push("proto.lo=function "+i+"_lo("+r.join(",")+"){var b=this.offset,d=0,"+c.join(",")+","+h.join(","));for(var u=0;u<e;++u)n.push("if(typeof i"+u+"==='number'&&i"+u+">=0){d=i"+u+"|0;b+=c"+u+"*d;a"+u+"-=d}");for(n.push("return new "+i+"(this.data,"+s.map((function(t){return"a"+t})).join(",")+","+s.map((function(t){return"c"+t})).join(",")+",b)}"),n.push("proto.step=function "+i+"_step("+r.join(",")+"){var "+s.map((function(t){return"a"+t+"=this.shape["+t+"]"})).join(",")+","+s.map((function(t){return"b"+t+"=this.stride["+t+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),u=0;u<e;++u)n.push("if(typeof i"+u+"==='number'){d=i"+u+"|0;if(d<0){c+=b"+u+"*(a"+u+"-1);a"+u+"=ceil(-a"+u+"/d)}else{a"+u+"=ceil(a"+u+"/d)}b"+u+"*=d}");n.push("return new "+i+"(this.data,"+s.map((function(t){return"a"+t})).join(",")+","+s.map((function(t){return"b"+t})).join(",")+",c)}");var p=new Array(e),m=new Array(e);for(u=0;u<e;++u)p[u]="a[i"+u+"]",m[u]="b[i"+u+"]";for(n.push("proto.transpose=function "+i+"_transpose("+r+"){"+r.map((function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+i+"(this.data,"+p.join(",")+","+m.join(",")+",this.offset)}"),n.push("proto.pick=function "+i+"_pick("+r+"){var a=[],b=[],c=this.offset"),u=0;u<e;++u)n.push("if(typeof i"+u+"==='number'&&i"+u+">=0){c=(c+this.stride["+u+"]*i"+u+")|0}else{a.push(this.shape["+u+"]);b.push(this.stride["+u+"])}");return n.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),n.push("return function construct_"+i+"(data,shape,stride,offset){return new "+i+"(data,"+s.map((function(t){return"shape["+t+"]"})).join(",")+","+s.map((function(t){return"stride["+t+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",n.join("\n"))(CACHED_CONSTRUCTORS[t],order)}function arrayDType(t){if(isBuffer(t))return"buffer";if(hasTypedArrays)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}var CACHED_CONSTRUCTORS={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};function wrappedNDArrayCtor(t,e,i,o){if(void 0===t)return(0,CACHED_CONSTRUCTORS.array[0])([]);"number"==typeof t&&(t=[t]),void 0===e&&(e=[t.length]);var n=e.length;if(void 0===i){i=new Array(n);for(var s=n-1,r=1;s>=0;--s)i[s]=r,r*=e[s]}if(void 0===o)for(o=0,s=0;s<n;++s)i[s]<0&&(o-=(e[s]-1)*i[s]);for(var l=arrayDType(t),a=CACHED_CONSTRUCTORS[l];a.length<=n+1;)a.push(compileConstructor(l,a.length-1));return(0,a[n+1])(t,e,i,o)}var ndarray=wrappedNDArrayCtor;function decodeBase64(t,e){var i=atob(t);if(e){for(var o=new Uint8Array(i.length),n=0,s=i.length;n<s;++n)o[n]=i.charCodeAt(n);return String.fromCharCode.apply(null,new Uint16Array(o.buffer))}return i}function createURL(t,e,i){var o=void 0===e?null:e,n=decodeBase64(t,void 0!==i&&i),s=n.indexOf("\n",10)+1,r=n.substring(s)+(o?"//# sourceMappingURL="+o:""),l=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(l)}function createBase64WorkerFactory(t,e,i){var o;return function(n){return o=o||createURL(t,e,i),new Worker(o,n)}}var WorkerFactory$4=createBase64WorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gZShlLHQscyxuLG8saSl7ZVt0Km9bMF0rcypvWzFdK24qb1syXV09aX1pbXBvcnRTY3JpcHRzKCJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL25vaXNlanNAMi4xLjAvaW5kZXgubWluLmpzIik7Y29uc3QgdD1uZXcgTm9pc2U7ZnVuY3Rpb24gcyhlLHMsbixvLGksZj0uOCl7bGV0IGM9MCxyPTEsbD0xLGE9MDtmb3IobGV0IGQ9MDtkPG87ZCsrKWMrPXQuc2ltcGxleDMoZSpyLHMqcixuKnIpKmwsYSs9bCxsKj1pLHIqPWY7cmV0dXJuIGMvYX1vbm1lc3NhZ2U9ZnVuY3Rpb24obil7Y29uc3R7ZGF0YTpvLGNvbmZpZ3M6e21pbjppLG1heDpmLG5vaXNlU2NhbGU6Yyx0aHJlc2hvbGQ6cixzdHJpZGU6bCxvY3RhdmVzOmEsZmFsbG9mZjpkLHNlZWQ6bX19PW4uZGF0YTt0LnNlZWQobSk7Y29uc3RbdSxwLGddPWksW2gsaix4XT1mO2ZvcihsZXQgdD11LG49MDt0PGg7Kyt0LCsrbilmb3IobGV0IGk9ZyxmPTA7aTx4OysraSwrK2YpZm9yKGxldCBtPXAsdT0wO208ajsrK20sKyt1KXtlKG8sbix1LGYsbCxzKHQqYyxtKmMsaSpjLGEsZCk+cj8xOjApfXBvc3RNZXNzYWdlKG8sW28uYnVmZmVyXSl9fSgpOwoK",null,!1),WorkerFactory$3=createBase64WorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y29uc3Qgcj1be2RpcjpbLTEsMCwwXSxjb3JuZXJzOltbMCwxLDBdLFswLDAsMF0sWzAsMSwxXSxbMCwwLDFdXX0se2RpcjpbMSwwLDBdLGNvcm5lcnM6W1sxLDEsMV0sWzEsMCwxXSxbMSwxLDBdLFsxLDAsMF1dfSx7ZGlyOlswLC0xLDBdLGNvcm5lcnM6W1sxLDAsMV0sWzAsMCwxXSxbMSwwLDBdLFswLDAsMF1dfSx7ZGlyOlswLDEsMF0sY29ybmVyczpbWzAsMSwxXSxbMSwxLDFdLFswLDEsMF0sWzEsMSwwXV19LHtkaXI6WzAsMCwtMV0sY29ybmVyczpbWzEsMCwwXSxbMCwwLDBdLFsxLDEsMF0sWzAsMSwwXV19LHtkaXI6WzAsMCwxXSxjb3JuZXJzOltbMCwwLDFdLFsxLDAsMV0sWzAsMSwxXSxbMSwxLDFdXX1dO2Z1bmN0aW9uIG4ocixuLG8scyx0KXtjb25zdCBlPW4qdFswXStvKnRbMV0rcyp0WzJdO3JldHVybiBlPnIubGVuZ3RofHxlPDA/MDpyW2VdfWZ1bmN0aW9uIG8ocixuLG8pe2NvbnN0W3MsdCxlXT1uLFtjLGksZl09byxbYSx1LGRdPXI7cmV0dXJuIGE8YyYmYT49cyYmdTxpJiZ1Pj10JiZkPGYmJmQ+PWV9b25tZXNzYWdlPWZ1bmN0aW9uKHMpe2NvbnN0e2RhdGE6dCxjb25maWdzOntkaW1lbnNpb25zOmUsbWluOmMsbWF4OmkscmVhbE1pbjpmLHJlYWxNYXg6YSxzdHJpZGU6dX19PXMuZGF0YSxkPVtdLGw9W10sZz1bXSxbaCxtLHBdPWMsW2Isdyx5XT1pLFtBLEYsTV09ZTtmb3IobGV0IHM9aCxlPTA7czxiOysrcywrK2UpZm9yKGxldCBjPXAsaT0wO2M8eTsrK2MsKytpKWZvcihsZXQgaD1tLHA9MDtoPHc7KytoLCsrcCl7aWYobih0LHMsaCxjLHUpKWZvcihjb25zdHtkaXI6bSxjb3JuZXJzOmJ9b2Ygcil7Y29uc3Qgcj1zK21bMF0sdz1oK21bMV0seT1jK21bMl0seD1bcix3LHldO2lmKCFuKHQscix3LHksdSl8fCFvKHgsZixhKSl7Y29uc3Qgcj1kLmxlbmd0aC8zO2Zvcihjb25zdCByIG9mIGIpe2NvbnN0IG49clswXStlLG89clsxXStwLHM9clsyXStpO2QucHVzaChuKkEsbypGLHMqTSksbC5wdXNoKC4uLm0pfWcucHVzaChyLHIrMSxyKzIscisyLHIrMSxyKzMpfX19Y29uc3QgeD1uZXcgRmxvYXQzMkFycmF5KGQpLGo9bmV3IEZsb2F0MzJBcnJheShsKSxrPW5ldyBGbG9hdDMyQXJyYXkoZyk7cG9zdE1lc3NhZ2Uoe3Bvc2l0aW9uczp4LG5vcm1hbHM6aixpbmRpY2VzOmt9LFt4LmJ1ZmZlcixqLmJ1ZmZlcixrLmJ1ZmZlcl0pfX0oKTsKCg==",null,!1);function _defineProperty$D(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const defaultOptions$h={maxWorker:8};class WorkerPool{get isBusy(){return this.available.length<=0}get workingCount(){return this.workers.length-this.available.length}constructor(t,e){void 0===e&&(e=defaultOptions$h),_defineProperty$D(this,"Proto",void 0),_defineProperty$D(this,"options",void 0),_defineProperty$D(this,"queue",void 0),_defineProperty$D(this,"workers",void 0),_defineProperty$D(this,"available",void 0),_defineProperty$D(this,"addJob",void 0),_defineProperty$D(this,"postMessage",void 0),_defineProperty$D(this,"process",void 0),this.Proto=t,this.options=e,this.queue=[],this.workers=[],this.available=[],this.addJob=t=>{this.queue.push(t),this.process()},this.postMessage=(t,e)=>{for(const i of this.workers)i.postMessage(t,e)},this.process=()=>{if(0!==this.queue.length&&this.available.length>0){const t=this.available.pop(),e=this.workers[t],{message:i,buffers:o,resolve:n}=this.queue.shift();e.postMessage(i,o),WorkerPool.WORKING_COUNT++;const s=i=>{let{data:o}=i;WorkerPool.WORKING_COUNT--,e.removeEventListener("message",s),this.available.unshift(t),n(o),this.queue.length>0&&setTimeout(this.process,0)};e.addEventListener("message",s)}};const{maxWorker:i}=e;for(let o=0;o<i;o++){const e=new t;this.workers.push(e),this.available.push(o)}}}_defineProperty$D(WorkerPool,"WORKING_COUNT",0);const cullPool=new WorkerPool(WorkerFactory$3,{maxWorker:2});async function cull(t,e){const{stride:i,data:o}=t,{dimensions:n,min:s,max:r,realMin:l,realMax:a}=e;return new Promise((t=>{cullPool.addJob({message:{data:o,configs:{min:s,max:r,dimensions:n,stride:i,realMin:l,realMax:a}},resolve:t,buffers:[o.buffer.slice(0)]})}))}var CloudsFragmentShader="#define GLSLIFY 1\nuniform vec3 uFogColor;uniform vec3 uCloudColor;uniform float uFogNear;uniform float uFogFar;uniform float uCloudAlpha;varying vec4 vWorldPosition;void main(){gl_FragColor=vec4(uCloudColor,uCloudAlpha);vec3 fogOrigin=cameraPosition;float depth=sqrt(pow(vWorldPosition.x-fogOrigin.x,2.0)+pow(vWorldPosition.z-fogOrigin.z,2.0))/8.0;float fogFactor=smoothstep(uFogNear,uFogFar,depth);gl_FragColor.rgb=mix(gl_FragColor.rgb,uFogColor,fogFactor);}",CloudsVertexShader="#define GLSLIFY 1\nvarying vec4 vWorldPosition;void main(){vWorldPosition=modelMatrix*vec4(position,1.0);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}";function _defineProperty$C(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$h(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$C(t,e,i[e])}))}return t}const defaultOptions$g={alpha:.8,color:"#fff",count:16,noiseScale:.08,width:8,height:3,dimensions:[20,20,20],speedFactor:8,lerpFactor:.3,threshold:.05,octaves:5,falloff:.9,seed:-1,cloudHeight:256};class Clouds extends three__WEBPACK_IMPORTED_MODULE_0__.ZAu{constructor(t){var e;void 0===t&&(t={}),super(),e=this,_defineProperty$C(this,"options",void 0),_defineProperty$C(this,"isInitialized",!1),_defineProperty$C(this,"material",void 0),_defineProperty$C(this,"meshes",[]),_defineProperty$C(this,"xOffset",0),_defineProperty$C(this,"zOffset",0),_defineProperty$C(this,"locatedCell",[0,0]),_defineProperty$C(this,"newPosition",new three__WEBPACK_IMPORTED_MODULE_0__.Pa4),_defineProperty$C(this,"pool",new WorkerPool(WorkerFactory$4,{maxWorker:2})),_defineProperty$C(this,"clock",new three__WEBPACK_IMPORTED_MODULE_0__.SUY),_defineProperty$C(this,"reset",(async()=>{this.children.forEach((t=>{var e;t.parent&&(t.parent.remove(t),null===(e=t.geometry)||void 0===e||e.dispose())})),this.meshes.length=0,await this.initialize()})),_defineProperty$C(this,"update",(t=>{if(!this.isInitialized)return;const e=Math.min(.1,this.clock.getDelta()),{speedFactor:i,count:o,dimensions:n}=this.options;this.newPosition=this.position.clone(),this.newPosition.z-=i*e;const s=[Math.floor((t.x-this.position.x)/(o*n[0])),Math.floor((t.z-this.position.z)/(o*n[2]))];if(this.locatedCell[0]!==s[0]||this.locatedCell[1]!==s[1]){const t=s[0]-this.locatedCell[0],e=s[1]-this.locatedCell[1];this.locatedCell=s,Math.abs(t)>1||Math.abs(e)>1?this.reset():(t&&this.shiftX(t),e&&this.shiftZ(e))}this.position.lerp(this.newPosition,this.options.lerpFactor)})),_defineProperty$C(this,"initialize",(async()=>{const{width:t}=this.options,[e,i]=this.locatedCell;for(let o=0;o<t;o++){const n=[];for(let s=0;s<t;s++){const t=await this.makeCell(o+e,s+i);this.add(t),n.push(t)}this.meshes.push(n)}this.isInitialized=!0})),_defineProperty$C(this,"shiftX",(async function(t){void 0===t&&(t=1);const{width:i}=e.options,o=t>0?e.meshes.shift():e.meshes.pop();for(let n=0;n<i;n++)await e.makeCell(e.xOffset+(t>0?i:0),n+e.zOffset,o[n]);t>0?e.meshes.push(o):e.meshes.unshift(o),e.xOffset+=t})),_defineProperty$C(this,"shiftZ",(async function(t){void 0===t&&(t=1);const{width:i}=e.options;for(let o=0;o<i;o++){const n=e.meshes[o],s=t>0?n.shift():n.pop();await e.makeCell(o+e.xOffset,e.zOffset+(t>0?i:0),s),t>0?n.push(s):n.unshift(s)}e.zOffset+=t})),_defineProperty$C(this,"makeCell",(async(t,e,i)=>{const{width:o,height:n,count:s,noiseScale:r,seed:l,threshold:a,dimensions:d,cloudHeight:c,octaves:h,falloff:u}=this.options,p=i?i.userData.data:ndarray(new Uint8Array((s+2)*n*(s+2)),[s+2,n,s+2]),m=[t*s-1,0,e*s-1],b=[(t+1)*s+1,n,(e+1)*s+1],y=await new Promise((t=>this.pool.addJob({message:{data:p.data,configs:{min:m,max:b,noiseScale:r,threshold:a,stride:p.stride,octaves:h,falloff:u,seed:l}},resolve:t,buffers:[p.data.buffer.slice(0)]})));p.data=y;const{positions:Z,indices:f,normals:W}=await cull(p,{dimensions:d,min:[1,0,1],max:[s+1,n,s+1],realMin:[0,0,0],realMax:[s+2,n,s+2]}),g=i?i.geometry:new three__WEBPACK_IMPORTED_MODULE_0__.u9r;return g.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(Z,3)),g.setAttribute("normal",new three__WEBPACK_IMPORTED_MODULE_0__.RNb(W,3)),g.setIndex(Array.from(f)),g.computeBoundingBox(),(i=i||new three__WEBPACK_IMPORTED_MODULE_0__.Kj0(g,this.material)).position.setX((-o/2+t)*s*d[0]),i.position.setY(c),i.position.setZ((-o/2+e)*s*d[2]),i.userData.data=p,i.renderOrder=-1,i})),this.options=_objectSpread$h({},defaultOptions$g,t);const{seed:i,color:o,alpha:n,uFogNear:s,uFogFar:r,uFogColor:l}=this.options;-1===i&&(this.options.seed=Math.floor(10230123*Math.random())),this.material=new three__WEBPACK_IMPORTED_MODULE_0__.jyz({transparent:!0,vertexShader:CloudsVertexShader,fragmentShader:CloudsFragmentShader,side:three__WEBPACK_IMPORTED_MODULE_0__.Wl3,uniforms:{uFogNear:s||{value:500},uFogFar:r||{value:1e3},uFogColor:l||{value:new three__WEBPACK_IMPORTED_MODULE_0__.Ilk("#fff")},uCloudColor:{value:new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(o)},uCloudAlpha:{value:n}}}),this.material.toneMapped=!1,this.initialize()}}function _defineProperty$B(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class DOMUtils{constructor(){}}_defineProperty$B(DOMUtils,"applyStyles",((t,e)=>{if(t)return Object.keys(e).forEach((i=>{const o=e[i];Array.isArray(t)?t.forEach((t=>t.style[i]=o)):t.style[i]=o})),t})),_defineProperty$B(DOMUtils,"rgba",((t,e,i,o)=>`rgba(${255*t}, ${255*e}, ${255*i}, ${o})`));var _AABB=class{get width(){return this.maxX-this.minX}get height(){return this.maxY-this.minY}get depth(){return this.maxZ-this.minZ}get mag(){return Math.sqrt((this.maxX-this.minX)**2+(this.maxY-this.minY)**2+(this.maxZ-this.minZ)**2)}computeOffsetX(t,e){const i=this.intersection(t);return i.height<=0||i.depth<=0?e:i.width>=0?0:e>0&&t.minX>=this.maxX?Math.min(t.minX-this.maxX,e):e<0&&t.maxX<=this.minX?Math.max(t.maxX-this.minX,e):e}computeOffsetY(t,e){const i=this.intersection(t);return i.width<=0||i.depth<=0?e:i.height>=0?0:e>0&&t.minY>=this.maxY?Math.min(t.minY-this.maxY,e):e<0&&t.maxY<=this.minY?Math.max(t.maxY-this.minY,e):e}computeOffsetZ(t,e){const i=this.intersection(t);return i.width<=0||i.height<=0?e:i.depth>=0?0:e>0&&t.minZ>=this.maxZ?Math.min(t.minZ-this.maxZ,e):e<0&&t.maxZ<=this.minZ?Math.max(t.maxZ-this.minZ,e):e}constructor(t,e,i,o,n,s){this.minX=t,this.minY=e,this.minZ=i,this.maxX=o,this.maxY=n,this.maxZ=s,this.getMin=t=>{if(0===t)return this.minX;if(1===t)return this.minY;if(2===t)return this.minZ;throw new Error("GetMinError: Unknown axis.")},this.setMin=(t,e)=>{if(0===t)this.minX=e;else if(1===t)this.minY=e;else{if(2!==t)throw new Error("SetMinError: Unknown axis.");this.minZ=e}},this.getMax=t=>{if(0===t)return this.maxX;if(1===t)return this.maxY;if(2===t)return this.maxZ;throw new Error("GetMaxError: Unknown axis.")},this.setMax=(t,e)=>{if(0===t)this.maxX=e;else if(1===t)this.maxY=e;else{if(2!==t)throw new Error("SetMaxError: Unknown axis.");this.maxZ=e}},this.translate=t=>{let[e,i,o]=t;return this.minX+=e,this.minY+=i,this.minZ+=o,this.maxX+=e,this.maxY+=i,this.maxZ+=o,this},this.translateAxis=(t,e)=>{if(0===t)this.minX+=e,this.maxX+=e;else if(1===t)this.minY+=e,this.maxY+=e;else{if(2!==t)throw new Error("TranslateAxisError: Unknown axis.");this.minZ+=e,this.maxZ+=e}return this},this.setPosition=t=>{let[e,i,o]=t;return this.maxX=e+this.width,this.maxY=i+this.height,this.maxZ=o+this.depth,this.minX=e,this.minY=i,this.minZ=o,this},this.intersects=t=>!(t.minX>=this.maxX||t.minY>=this.maxY||t.minZ>=this.maxZ||t.maxX<=this.minX||t.maxY<=this.minY||t.maxZ<=this.minZ),this.touches=t=>{const e=this.intersection(t);return null!==e&&(0===e.width||0===e.height||0===e.depth)},this.union=t=>new _AABB(Math.min(this.minX,t.minX),Math.min(this.minY,t.minY),Math.min(this.minZ,t.minZ),Math.max(this.maxX,t.maxX),Math.max(this.maxY,t.maxY),Math.max(this.maxZ,t.maxZ)),this.intersection=t=>new _AABB(Math.max(this.minX,t.minX),Math.max(this.minY,t.minY),Math.max(this.minZ,t.minZ),Math.min(this.maxX,t.maxX),Math.min(this.maxY,t.maxY),Math.min(this.maxZ,t.maxZ)),this.clone=()=>new _AABB(this.minX,this.minY,this.minZ,this.maxX,this.maxY,this.maxZ)}},AABB=_AABB;function _defineProperty$A(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}AABB.union=t=>{let e=t[0].minX,i=t[0].minY,o=t[0].minZ,n=t[0].maxX,s=t[0].maxY,r=t[0].maxZ;for(const l of t)e=Math.min(e,l.minX),i=Math.min(i,l.minY),o=Math.min(o,l.minZ),n=Math.max(n,l.maxX),s=Math.max(s,l.maxY),r=Math.max(r,l.maxZ);return new _AABB(e,i,o,n,s,r)};const PY_ROTATION=0,NY_ROTATION=1,PX_ROTATION=2,NX_ROTATION=3,PZ_ROTATION=4,NZ_ROTATION=5,Y_ROT_SEGMENTS=16,Y_ROT_MAP=[];for(let o=0;o<Y_ROT_SEGMENTS;o++)Y_ROT_MAP.push([o/Y_ROT_SEGMENTS*Math.PI*2,o]),Y_ROT_MAP.push([o/Y_ROT_SEGMENTS*Math.PI*2-2*Math.PI,o]);const PI=Math.PI,PI_2$1=Math.PI/2;class BlockRotation{rotateTransparency(t){let[e,i,o,n,s,r]=t;const l=this.value;if(Math.abs(l)<Number.EPSILON)return[e,i,o,n,s,r];const a=[1,2,3],d=[4,5,6];this.rotateNode(a,!0,!1),this.rotateNode(d,!0,!1);const c=a.map((t=>1===t?e:2===t?i:3===t?o:4===t?n:5===t?s:r)),h=d.map((t=>1===t?e:2===t?i:3===t?o:4===t?n:5===t?s:r));return[c[0],c[1],c[2],h[0],h[1],h[2]]}constructor(t,e){var i=this;void 0===t&&(t=PY_ROTATION),void 0===e&&(e=0),_defineProperty$A(this,"value",void 0),_defineProperty$A(this,"yRotation",void 0),_defineProperty$A(this,"rotateNode",(function(t,e,o){switch(void 0===e&&(e=!0),void 0===o&&(o=!0),e&&0!==i.yRotation&&(t[0]-=.5,t[2]-=.5,BlockRotation.rotateY(t,i.yRotation),t[0]+=.5,t[2]+=.5),i.value){case PX_ROTATION:BlockRotation.rotateZ(t,-PI_2$1),o&&(t[1]+=1);break;case NX_ROTATION:BlockRotation.rotateZ(t,PI_2$1),o&&(t[0]+=1);break;case PY_ROTATION:break;case NY_ROTATION:BlockRotation.rotateX(t,PI),o&&(t[1]+=1,t[2]+=1);break;case PZ_ROTATION:BlockRotation.rotateX(t,PI_2$1),o&&(t[1]+=1);break;case NZ_ROTATION:BlockRotation.rotateX(t,-PI_2$1),o&&(t[2]+=1)}})),_defineProperty$A(this,"rotateAABB",(function(t,e,o){void 0===e&&(e=!0),void 0===o&&(o=!0);const n=[t.minX,t.minY,t.minZ],s=[t.maxX,t.maxY,t.maxZ];let r=null,l=null,a=null,d=null;e&&0!==i.yRotation&&([[t.minX,t.minY,t.minZ],[t.minX,t.minY,t.maxZ],[t.maxX,t.minY,t.minZ],[t.maxX,t.minY,t.maxZ]].forEach((t=>{i.rotateNode(t,!0,!0),r=null===r?t[0]:Math.min(r,t[0]),l=null===l?t[2]:Math.min(l,t[2])})),[[t.minX,t.maxY,t.minZ],[t.minX,t.maxY,t.maxZ],[t.maxX,t.maxY,t.minZ],[t.maxX,t.maxY,t.maxZ]].forEach((t=>{i.rotateNode(t,!0,!0),a=null===a?t[0]:Math.max(a,t[0]),d=null===d?t[2]:Math.max(d,t[2])}))),i.rotateNode(n,e,o),i.rotateNode(s,e,o);const c=t=>t<1e-4?0:t;n[0]=c(n[0]),n[1]=c(n[1]),n[2]=c(n[2]),s[0]=c(s[0]),s[1]=c(s[1]),s[2]=c(s[2]);const h=[null!==r?c(r):Math.min(n[0],s[0]),Math.min(n[1],s[1]),null!==l?c(l):Math.min(n[2],s[2])],u=[null!==a?c(a):Math.max(n[0],s[0]),Math.max(n[1],s[1]),null!==d?c(d):Math.max(n[2],s[2])];return new AABB(h[0],h[1],h[2],u[0],u[1],u[2])})),this.value=t,this.yRotation=e}}function _defineProperty$z(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}_defineProperty$A(BlockRotation,"encode",(function(t,e){void 0===e&&(e=0);const i=e*Math.PI*2/Y_ROT_SEGMENTS;return new BlockRotation(t,i)})),_defineProperty$A(BlockRotation,"decode",(t=>[t.value,Math.round(t.yRotation*Y_ROT_SEGMENTS/(2*Math.PI))%Y_ROT_SEGMENTS])),_defineProperty$A(BlockRotation,"rotateX",((t,e)=>{const i=Math.sin(e),o=Math.cos(e),[,n,s]=t;t[1]=n*o-s*i,t[2]=s*o+n*i})),_defineProperty$A(BlockRotation,"rotateY",((t,e)=>{const i=Math.sin(e),o=Math.cos(e),[n,,s]=t;t[0]=n*o+s*i,t[2]=s*o-n*i})),_defineProperty$A(BlockRotation,"rotateZ",((t,e)=>{const i=Math.sin(e),o=Math.cos(e),[n,s]=t;t[0]=n*o-s*i,t[1]=s*o+n*i}));const ROTATION_MASK=4293984255,Y_ROTATION_MASK=4279238655,STAGE_MASK=4043309055;class BlockUtils{static getBlockRotatedTransparency(t,e){return e.rotateTransparency(t.isTransparent)}constructor(){}}_defineProperty$z(BlockUtils,"extractID",(t=>65535&t)),_defineProperty$z(BlockUtils,"insertID",((t,e)=>4294901760&t|65535&e)),_defineProperty$z(BlockUtils,"extractRotation",(t=>{const e=t>>16&15,i=t>>20&15;return BlockRotation.encode(e,i)})),_defineProperty$z(BlockUtils,"insertRotation",((t,e)=>{const[i,o]=BlockRotation.decode(e);return(t&ROTATION_MASK|(15&i)<<16)&Y_ROTATION_MASK|(15&o)<<20})),_defineProperty$z(BlockUtils,"extractStage",(t=>t>>24&15)),_defineProperty$z(BlockUtils,"insertStage",((t,e)=>t&STAGE_MASK|e<<24)),_defineProperty$z(BlockUtils,"insertAll",((t,e,i)=>{let o=0;return o=BlockUtils.insertID(o,t),e&&(o=BlockUtils.insertRotation(o,e)),void 0!==i&&(o=BlockUtils.insertStage(o,i)),o})),_defineProperty$z(BlockUtils,"getBlockTorchLightLevel",((t,e)=>{switch(e){case"RED":return t.redLightLevel;case"GREEN":return t.greenLightLevel;case"BLUE":return t.blueLightLevel}return 0}));var epsilon=1e-6,create_1=create$2;function create$2(){var t=new Float32Array(3);return t[0]=0,t[1]=0,t[2]=0,t}var clone_1=clone;function clone(t){var e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}var fromValues_1=fromValues$1;function fromValues$1(t,e,i){var o=new Float32Array(3);return o[0]=t,o[1]=e,o[2]=i,o}var normalize_1=normalize$1;function normalize$1(t,e){var i=e[0],o=e[1],n=e[2],s=i*i+o*o+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}var dot_1=dot$1;function dot$1(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}var angle_1=angle,fromValues=fromValues_1,normalize=normalize_1,dot=dot_1;function angle(t,e){var i=fromValues(t[0],t[1],t[2]),o=fromValues(e[0],e[1],e[2]);normalize(i,i),normalize(o,o);var n=dot(i,o);return n>1?0:Math.acos(n)}var copy_1=copy;function copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}var set_1=set;function set(t,e,i,o){return t[0]=e,t[1]=i,t[2]=o,t}var equals_1=equals,EPSILON=epsilon;function equals(t,e){var i=t[0],o=t[1],n=t[2],s=e[0],r=e[1],l=e[2];return Math.abs(i-s)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-r)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(r))&&Math.abs(n-l)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(l))}var exactEquals_1=exactEquals;function exactEquals(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}var add_1=add;function add(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}var subtract_1=subtract;function subtract(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}var sub=subtract_1,multiply_1=multiply;function multiply(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}var mul=multiply_1,divide_1=divide;function divide(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}var div=divide_1,min_1=min;function min(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}var max_1=max;function max(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}var floor_1=floor;function floor(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}var ceil_1=ceil;function ceil(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}var round_1=round;function round(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}var scale_1=scale;function scale(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}var scaleAndAdd_1=scaleAndAdd;function scaleAndAdd(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t}var distance_1=distance;function distance(t,e){var i=e[0]-t[0],o=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+o*o+n*n)}var dist=distance_1,squaredDistance_1=squaredDistance;function squaredDistance(t,e){var i=e[0]-t[0],o=e[1]-t[1],n=e[2]-t[2];return i*i+o*o+n*n}var sqrDist=squaredDistance_1,length_1=length;function length(t){var e=t[0],i=t[1],o=t[2];return Math.sqrt(e*e+i*i+o*o)}var len=length_1,squaredLength_1=squaredLength;function squaredLength(t){var e=t[0],i=t[1],o=t[2];return e*e+i*i+o*o}var sqrLen=squaredLength_1,negate_1=negate;function negate(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}var inverse_1=inverse;function inverse(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}var cross_1=cross;function cross(t,e,i){var o=e[0],n=e[1],s=e[2],r=i[0],l=i[1],a=i[2];return t[0]=n*a-s*l,t[1]=s*r-o*a,t[2]=o*l-n*r,t}var lerp_1=lerp;function lerp(t,e,i,o){var n=e[0],s=e[1],r=e[2];return t[0]=n+o*(i[0]-n),t[1]=s+o*(i[1]-s),t[2]=r+o*(i[2]-r),t}var random_1=random;function random(t,e){e=e||1;var i=2*Math.random()*Math.PI,o=2*Math.random()-1,n=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(i)*n,t[1]=Math.sin(i)*n,t[2]=o*e,t}var transformMat4_1=transformMat4;function transformMat4(t,e,i){var o=e[0],n=e[1],s=e[2],r=i[3]*o+i[7]*n+i[11]*s+i[15];return r=r||1,t[0]=(i[0]*o+i[4]*n+i[8]*s+i[12])/r,t[1]=(i[1]*o+i[5]*n+i[9]*s+i[13])/r,t[2]=(i[2]*o+i[6]*n+i[10]*s+i[14])/r,t}var transformMat3_1=transformMat3;function transformMat3(t,e,i){var o=e[0],n=e[1],s=e[2];return t[0]=o*i[0]+n*i[3]+s*i[6],t[1]=o*i[1]+n*i[4]+s*i[7],t[2]=o*i[2]+n*i[5]+s*i[8],t}var transformQuat_1=transformQuat;function transformQuat(t,e,i){var o=e[0],n=e[1],s=e[2],r=i[0],l=i[1],a=i[2],d=i[3],c=d*o+l*s-a*n,h=d*n+a*o-r*s,u=d*s+r*n-l*o,p=-r*o-l*n-a*s;return t[0]=c*d+p*-r+h*-a-u*-l,t[1]=h*d+p*-l+u*-r-c*-a,t[2]=u*d+p*-a+c*-l-h*-r,t}var rotateX_1=rotateX;function rotateX(t,e,i,o){var n=i[1],s=i[2],r=e[1]-n,l=e[2]-s,a=Math.sin(o),d=Math.cos(o);return t[0]=e[0],t[1]=n+r*d-l*a,t[2]=s+r*a+l*d,t}var rotateY_1=rotateY$1;function rotateY$1(t,e,i,o){var n=i[0],s=i[2],r=e[0]-n,l=e[2]-s,a=Math.sin(o),d=Math.cos(o);return t[0]=n+l*a+r*d,t[1]=e[1],t[2]=s+l*d-r*a,t}var rotateZ_1=rotateZ;function rotateZ(t,e,i,o){var n=i[0],s=i[1],r=e[0]-n,l=e[1]-s,a=Math.sin(o),d=Math.cos(o);return t[0]=n+r*d-l*a,t[1]=s+r*a+l*d,t[2]=e[2],t}var forEach_1=forEach,vec=create_1();function forEach(t,e,i,o,n,s){var r,l;for(e||(e=3),i||(i=0),l=o?Math.min(o*e+i,t.length):t.length,r=i;r<l;r+=e)vec[0]=t[r],vec[1]=t[r+1],vec[2]=t[r+2],n(vec,vec,s),t[r]=vec[0],t[r+1]=vec[1],t[r+2]=vec[2];return t}var glVec3={EPSILON:epsilon,create:create_1,clone:clone_1,angle:angle_1,fromValues:fromValues_1,copy:copy_1,set:set_1,equals:equals_1,exactEquals:exactEquals_1,add:add_1,subtract:subtract_1,sub:sub,multiply:multiply_1,mul:mul,divide:divide_1,div:div,min:min_1,max:max_1,floor:floor_1,ceil:ceil_1,round:round_1,scale:scale_1,scaleAndAdd:scaleAndAdd_1,distance:distance_1,dist:dist,squaredDistance:squaredDistance_1,sqrDist:sqrDist,length:length_1,len:len,squaredLength:squaredLength_1,sqrLen:sqrLen,negate:negate_1,inverse:inverse_1,normalize:normalize_1,dot:dot_1,cross:cross_1,lerp:lerp_1,random:random_1,transformMat4:transformMat4_1,transformMat3:transformMat3_1,transformQuat:transformQuat_1,rotateX:rotateX_1,rotateY:rotateY_1,rotateZ:rotateZ_1,forEach:forEach_1};function _defineProperty$y(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class ChunkUtils{constructor(){}}function _defineProperty$x(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}_defineProperty$y(ChunkUtils,"getChunkName",(function(t,e){return void 0===e&&(e="|"),t[0]+e+t[1]})),_defineProperty$y(ChunkUtils,"getVoxelName",(function(t,e){return void 0===e&&(e="|"),(0|t[0])+e+(0|t[1])+e+(0|t[2])})),_defineProperty$y(ChunkUtils,"parseChunkName",(function(t,e){return void 0===e&&(e="|"),t.split(e).map((t=>parseInt(t,10)))})),_defineProperty$y(ChunkUtils,"scaleCoordsF",((t,e)=>{const i=glVec3.scale([0,0,0],t,e);return glVec3.floor(i,i)})),_defineProperty$y(ChunkUtils,"mapVoxelToChunkLocal",((t,e)=>{const[i,o]=ChunkUtils.mapVoxelToChunk(t,e),[n,s,r]=t;return[n-i*e,s,r-o*e]})),_defineProperty$y(ChunkUtils,"mapVoxelToChunk",((t,e)=>{const i=ChunkUtils.scaleCoordsF(t,1/e);return[i[0],i[2]]})),_defineProperty$y(ChunkUtils,"mapChunkToVoxel",((t,e)=>{const i=[0,0,0];return glVec3.copy(i,[t[0],0,t[1]]),glVec3.scale(i,i,e),i})),_defineProperty$y(ChunkUtils,"mapWorldToVoxel",(t=>ChunkUtils.scaleCoordsF(t,1)));class LightUtils{constructor(){}}_defineProperty$x(LightUtils,"extractSunlight",(t=>t>>12&15)),_defineProperty$x(LightUtils,"insertSunlight",((t,e)=>4095&t|e<<12)),_defineProperty$x(LightUtils,"extractRedLight",(t=>t>>8&15)),_defineProperty$x(LightUtils,"insertRedLight",((t,e)=>61695&t|e<<8)),_defineProperty$x(LightUtils,"extractGreenLight",(t=>t>>4&15)),_defineProperty$x(LightUtils,"insertGreenLight",((t,e)=>65295&t|e<<4)),_defineProperty$x(LightUtils,"extractBlueLight",(t=>15&t)),_defineProperty$x(LightUtils,"insertBlueLight",((t,e)=>65520&t|e)),_defineProperty$x(LightUtils,"canEnterInto",((t,e,i,o)=>{if(1!==Math.abs(e+i+o))throw new Error("This isn't supposed to happen. Light neighboring direction should be on 1 axis only.");const[n,s,r,l,a,d]=t;return 1===e?l:-1===e?n:1===i?a:-1===i?s:1===o?d:r})),_defineProperty$x(LightUtils,"canEnter",((t,e,i,o,n)=>{if(1!==Math.abs(i+o+n))throw new Error("This isn't supposed to happen. Light neighboring direction should be on 1 axis only.");const[s,r,l,a,d,c]=t,[h,u,p,m,b,y]=e;return 1===i?s&&m:-1===i?a&&h:1===o?r&&b:-1===o?d&&u:1===n?l&&y:c&&p}));const RED_LIGHT="RED",GREEN_LIGHT="GREEN",BLUE_LIGHT="BLUE",SUNLIGHT="SUNLIGHT";function _defineProperty$w(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const TWO_PI=2*Math.PI;class MathUtils{constructor(){}}function _defineProperty$v(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$g(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$v(t,e,i[e])}))}return t}_defineProperty$w(MathUtils,"round",((t,e)=>Math.round(t*10**e)/10**e)),_defineProperty$w(MathUtils,"normalizeAngle",(t=>t-TWO_PI*Math.floor((t+Math.PI)/TWO_PI))),_defineProperty$w(MathUtils,"directionToQuaternion",((t,e,i)=>(()=>{const o=new three__WEBPACK_IMPORTED_MODULE_0__.yGw,n=new three__WEBPACK_IMPORTED_MODULE_0__._fP,s=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,0,0),r=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,1,0);return()=>n.setFromRotationMatrix(o.lookAt(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(-t,-e,-i),s,r))})()()));const defaultOptions$f={gap:0,layers:1,width:1,widthSegments:8,side:three__WEBPACK_IMPORTED_MODULE_0__.Wl3,transparent:!1},BOX_SIDES=["back","front","top","bottom","left","right"];class BoxLayer extends three__WEBPACK_IMPORTED_MODULE_0__.Kj0{constructor(t,e,i,o,n,s,r,l){super(new three__WEBPACK_IMPORTED_MODULE_0__.DvJ(t,e,i)),_defineProperty$v(this,"materials",new Map),_defineProperty$v(this,"width",void 0),_defineProperty$v(this,"height",void 0),_defineProperty$v(this,"depth",void 0),_defineProperty$v(this,"widthSegments",void 0),_defineProperty$v(this,"heightSegments",void 0),_defineProperty$v(this,"depthSegments",void 0),_defineProperty$v(this,"side",void 0),_defineProperty$v(this,"transparent",void 0),_defineProperty$v(this,"paint",((t,e)=>{const i="all"===t?BOX_SIDES:"sides"===t?["front","back","left","right"]:Array.isArray(t)?t:[t];for(const n of i){var o;const t=this.materials.get(n);if(!t)continue;const i=null===(o=t.map)||void 0===o?void 0:o.image;if(!i)continue;const s=i.getContext("2d");if(!s)continue;s.imageSmoothingEnabled=!1;const{width:r,height:l}=this.getDimensionFromSide(n);e instanceof three__WEBPACK_IMPORTED_MODULE_0__.xEZ?s.drawImage(e.image,0,0,r,l):e instanceof three__WEBPACK_IMPORTED_MODULE_0__.Ilk?(s.save(),s.fillStyle=`rgb(${255*e.r},${255*e.g},${255*e.b})`,s.fillRect(0,0,r,l),s.restore()):"function"==typeof e?e(s,i):console.warn("Invalid art type: ",e),t.needsUpdate=!0,t.map.needsUpdate=!0}})),_defineProperty$v(this,"createCanvasMaterial",(t=>{const e=document.createElement("canvas"),{width:i,height:o}=this.getDimensionFromSide(t);e.width=i,e.height=o;const n=new three__WEBPACK_IMPORTED_MODULE_0__.vBJ({side:this.side,map:new three__WEBPACK_IMPORTED_MODULE_0__.xEZ(e),transparent:this.transparent,name:t});return n.toneMapped=!1,n.map&&(n.map.magFilter=three__WEBPACK_IMPORTED_MODULE_0__.TyD,n.map.minFilter=three__WEBPACK_IMPORTED_MODULE_0__.FDw,n.map.wrapS=three__WEBPACK_IMPORTED_MODULE_0__.rpg,n.map.wrapT=three__WEBPACK_IMPORTED_MODULE_0__.rpg,n.map.needsUpdate=!0),n})),_defineProperty$v(this,"getDimensionFromSide",(t=>{switch(t){case"front":case"back":case"top":case"bottom":return{width:this.widthSegments,height:this.heightSegments};case"left":case"right":return{width:this.depthSegments,height:this.heightSegments};default:throw new Error("Cannot derive width/height from unknown side.")}})),this.width=t,this.height=e,this.depth=i,this.widthSegments=o,this.heightSegments=n,this.depthSegments=s,this.side=r,this.transparent=l;for(const c of BOX_SIDES)this.materials.set(c,this.createCanvasMaterial(c));const a=Array.from(this.materials.values()),d=a[0];a[0]=a[1],a[1]=d,this.material=a,this.rotation.y=Math.PI/2}}class CanvasBox extends three__WEBPACK_IMPORTED_MODULE_0__.ZAu{get boxMaterials(){return this.boxLayers[0].materials}constructor(t){var e;void 0===t&&(t={}),super(),e=this,_defineProperty$v(this,"options",void 0),_defineProperty$v(this,"boxLayers",[]),_defineProperty$v(this,"width",void 0),_defineProperty$v(this,"height",void 0),_defineProperty$v(this,"depth",void 0),_defineProperty$v(this,"paint",(function(t,i,o){if(void 0===o&&(o=0),o>=e.boxLayers.length)throw new Error("Canvas box layer does not exist.");e.boxLayers[o].paint(t,i)})),_defineProperty$v(this,"makeBoxes",(()=>{const{layers:t,gap:e,side:i,width:o,height:n,depth:s,widthSegments:r,heightSegments:l,depthSegments:a,transparent:d}=this.options;if(!o)throw new Error("CanvasBox width must be specified.");this.width=o,this.height=n||o,this.depth=s||o;for(let c=0;c<t;c++){const t=new BoxLayer(o+c*e*2,(n||o)+c*e*2,(s||o)+c*e*2,r,l||r,a||r,i,d);this.boxLayers.push(t),this.add(t)}})),this.options=_objectSpread$g({},defaultOptions$f,t),this.makeBoxes()}}const drawSun=function(t,e){return void 0===t&&(t=50),void 0===e&&(e="#f8ffb5"),(i,o)=>{const n=new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(e);i.save(),i.beginPath();let s=o.width/2,r=o.height/2;const l=i.createRadialGradient(s,r,1,s,r,2*t);l.addColorStop(0,DOMUtils.rgba(1,1,1,.3)),l.addColorStop(1,DOMUtils.rgba(1,1,1,0)),i.arc(s,r,3*t,0,2*Math.PI,!1),i.fillStyle=l,i.fill(),i.closePath(),i.beginPath(),s=o.width/2-t/2,r=o.height/2-t/2,i.rect(s,r,t,t),i.fillStyle=DOMUtils.rgba(n.r,n.g,n.b,1),i.fill(),i.closePath(),i.beginPath();const a=t/1.6;s=o.width/2-a/2,r=o.height/2-a/2,i.rect(s,r,a,a),i.fillStyle=DOMUtils.rgba(1,1,1,.5),i.fill(),i.closePath(),i.restore()}},drawMoon=function(t,e,i){return void 0===t&&(t=20),void 0===e&&(e="#e6e2d1"),void 0===i&&(i=1),(o,n)=>{const s=new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(e),r=n.width/2,l=n.height/2;o.beginPath();const a=o.createRadialGradient(r+t/2,l+t/2,1,r+t/2,l+t/2,2*t);a.addColorStop(0,DOMUtils.rgba(1,1,1,.3)),a.addColorStop(1,DOMUtils.rgba(1,1,1,0)),o.arc(r+t/2,l+t/2,2*t,0,2*Math.PI,!1),o.fillStyle=a,o.fill(),o.closePath(),o.save(),o.beginPath(),o.rect(r,l,t,t),o.clip(),o.beginPath(),o.rect(r,l,t,t),o.fillStyle=DOMUtils.rgba(s.r,s.g,s.b,1),o.fill(),o.translate(r,l),o.beginPath(),o.rect(4,4,t-8,t-8),o.fillStyle=DOMUtils.rgba(1,1,1,.8),o.fill();const d=i*t*2-t;o.beginPath(),o.rect(d,0,t,t),o.fillStyle=DOMUtils.rgba(0,0,0,.8),o.fill(),o.beginPath(),o.rect(2+d,2,t-4,t-4),o.fillStyle=DOMUtils.rgba(0,0,0,.9),o.fill(),o.restore()}},drawStars=function(t,e){return void 0===t&&(t=100),void 0===e&&(e=["#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#FFFFFF","#8589FF","#FF8585"]),(i,o)=>{const n=i.globalAlpha;for(let s=0;s<t;s++)i.globalAlpha=1*Math.random()+.5,i.beginPath(),i.arc(Math.random()*o.width,Math.random()*o.height,.5*Math.random(),0,2*Math.PI,!1),i.fillStyle=e[Math.floor(Math.random()*e.length)],i.fill();i.globalAlpha=n}},drawCrown=t=>{t.fillStyle="#f7ea00",[[0,0],[0,1],[0,2],[1,2],[2,2],[2,1],[3,0],[3,2],[4,0],[4,2],[5,1],[5,2],[6,2],[7,0],[7,1],[7,2]].forEach((e=>{let[i,o]=e;return t.fillRect(i,o,1,1)})),t.fillStyle="#51c2d5",[[1,1],[6,1]].forEach((e=>{let[i,o]=e;return t.fillRect(i,o,1,1)})),t.fillStyle="#ff005c",t.fillRect(3,1,1,1),t.fillRect(4,1,1,1)},artFunctions={drawCrown:drawCrown,drawSun:drawSun,drawMoon:drawMoon,drawStars:drawStars};var SkyFragmentShader="#define GLSLIFY 1\nuniform vec3 uTopColor;uniform vec3 uMiddleColor;uniform vec3 uBottomColor;uniform float uSkyOffset;uniform float uVoidOffset;uniform float uExponent;uniform float uExponent2;varying vec3 vWorldPosition;void main(){float h=normalize(vWorldPosition+uSkyOffset).y;float h2=normalize(vWorldPosition+uVoidOffset).y;vec3 color=mix(uMiddleColor,uTopColor,max(pow(max(h,0.0),uExponent),0.0));gl_FragColor=vec4(mix(color,uBottomColor,max(pow(max(-h2,0.0),uExponent2),0.0)),1.0);}",SkyVertexShader="#define GLSLIFY 1\nvarying vec3 vWorldPosition;void main(){vec4 worldPosition=modelMatrix*vec4(position,1.0);vWorldPosition=worldPosition.xyz;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}";function _defineProperty$u(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$f(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$u(t,e,i[e])}))}return t}const defaultOptions$e={dimension:2e3,lerpFactor:.1,transitionSpan:.05};class Sky extends CanvasBox{constructor(t){void 0===t&&(t={}),super({width:.8*(t.dimension?t.dimension:defaultOptions$e.dimension),side:three__WEBPACK_IMPORTED_MODULE_0__._Li,transparent:!0,widthSegments:512,heightSegments:512,depthSegments:512}),_defineProperty$u(this,"options",void 0),_defineProperty$u(this,"uTopColor",void 0),_defineProperty$u(this,"uMiddleColor",void 0),_defineProperty$u(this,"uBottomColor",void 0),_defineProperty$u(this,"uSkyOffset",void 0),_defineProperty$u(this,"uVoidOffset",void 0),_defineProperty$u(this,"shadingData",[]),_defineProperty$u(this,"setShadingPhases",(t=>{if(0!==t.length){if(1===t.length){const{top:e,middle:i,bottom:o}=t[0].color,n=new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(e).convertLinearToSRGB(),s=new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(i).convertLinearToSRGB(),r=new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(o).convertLinearToSRGB();this.uTopColor.value.copy(n),this.uMiddleColor.value.copy(s),this.uBottomColor.value.copy(r),this.uSkyOffset.value=t[0].skyOffset,this.uVoidOffset.value=t[0].voidOffset}this.shadingData=t,this.shadingData.sort(((t,e)=>t.start-e.start))}})),_defineProperty$u(this,"getTopColor",(()=>this.uTopColor.value)),_defineProperty$u(this,"getMiddleColor",(()=>this.uMiddleColor.value)),_defineProperty$u(this,"getBottomColor",(()=>this.uBottomColor.value)),_defineProperty$u(this,"update",((t,e,i)=>{if(this.rotation.z=2*Math.PI*(e/i),["top","right","left","front","back"].forEach((t=>{this.boxMaterials.get(t)})),this.position.copy(t),this.shadingData.length<=1)return;const o=[],n=this.options.transitionSpan*i;for(let h=0;h<this.shadingData.length;h++){const t=this.shadingData[h],s=this.shadingData[(h+1)%this.shadingData.length],{start:r}=t,l=r*i,a=s.start*i;if(l<a?e>=l&&e<a:e<a||e>=l){const s=Math.max(Math.min(e>=l?(e-l)/n:(e+i-l)/n,1),0);if(o.push([s,t]),e>=l?e<l+n:e+i<l+n){const t=this.shadingData[(h-1<0?h-1+this.shadingData.length:h-1)%this.shadingData.length];o.push([1-s,t])}break}}const s=[0,0,0],r=[0,0,0],l=[0,0,0];let a=0,d=0;const c={r:0,g:0,b:0};o.forEach((t=>{let[e,i]=t;const{skyOffset:o,voidOffset:n,color:{top:h,middle:u,bottom:p}}=i,m=new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(h).convertLinearToSRGB(),b=new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(u).convertLinearToSRGB(),y=new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(p).convertLinearToSRGB();m.getRGB(c),s[0]+=c.r*e,s[1]+=c.g*e,s[2]+=c.b*e,b.getRGB(c),r[0]+=c.r*e,r[1]+=c.g*e,r[2]+=c.b*e,y.getRGB(c),l[0]+=c.r*e,l[1]+=c.g*e,l[2]+=c.b*e,a+=e*o,d+=e*n})),this.uTopColor.value.setRGB(s[0],s[1],s[2]),this.uMiddleColor.value.setRGB(r[0],r[1],r[2]),this.uBottomColor.value.setRGB(l[0],l[1],l[2]),this.uSkyOffset.value=a,this.uVoidOffset.value=d})),_defineProperty$u(this,"createSkyShading",(()=>{const{color:{top:t,middle:e,bottom:i},skyOffset:o,voidOffset:n}={color:{top:"#222",middle:"#222",bottom:"#222"},skyOffset:0,voidOffset:1200};this.uTopColor={value:new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(t)},this.uMiddleColor={value:new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(e)},this.uBottomColor={value:new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(i)},this.uSkyOffset={value:o},this.uVoidOffset={value:n};const s=new three__WEBPACK_IMPORTED_MODULE_0__.Kgo(this.options.dimension,2),r=new three__WEBPACK_IMPORTED_MODULE_0__.jyz({uniforms:{uTopColor:this.uTopColor,uMiddleColor:this.uMiddleColor,uBottomColor:this.uBottomColor,uSkyOffset:this.uSkyOffset,uVoidOffset:this.uVoidOffset,uExponent:{value:.6},uExponent2:{value:1.2}},vertexShader:SkyVertexShader,fragmentShader:SkyFragmentShader,depthWrite:!1,side:three__WEBPACK_IMPORTED_MODULE_0__._Li}),l=new three__WEBPACK_IMPORTED_MODULE_0__.Kj0(s,r);this.attach(l)})),this.options=_objectSpread$f({},this.options,defaultOptions$e,t),this.boxMaterials.forEach((t=>t.depthWrite=!1)),this.frustumCulled=!1,this.renderOrder=-1,this.createSkyShading()}}function _defineProperty$t(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$e(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$t(t,e,i[e])}))}return t}const defaultOptions$d={radius:.1,height:.8,coneRadius:.2,coneHeight:.2,color:"red"};class Arrow extends three__WEBPACK_IMPORTED_MODULE_0__.tGC{constructor(t){void 0===t&&(t={}),super(),_defineProperty$t(this,"options",void 0);const{radius:e,height:i,coneRadius:o,coneHeight:n}=this.options=_objectSpread$e({},defaultOptions$d,t),s="string"==typeof this.options.color?new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(this.options.color):this.options.color;[...this.children].forEach((t=>this.remove(t))),this.add(new three__WEBPACK_IMPORTED_MODULE_0__.Kj0(new three__WEBPACK_IMPORTED_MODULE_0__.fHI(e,e,i),new three__WEBPACK_IMPORTED_MODULE_0__.vBJ({color:s})));const r=new three__WEBPACK_IMPORTED_MODULE_0__.Kj0(new three__WEBPACK_IMPORTED_MODULE_0__.fHI(0,o,n),new three__WEBPACK_IMPORTED_MODULE_0__.vBJ({color:s}));r.position.y=(n+i)/2,this.add(r)}}function _defineProperty$s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class ColorText{static split(t,e){void 0===e&&(e="black");const i=t.split(new RegExp(`(\\${ColorText.SPLITTER}[^\\${ColorText.SPLITTER}]*\\${ColorText.SPLITTER})`)).filter(Boolean);i.length&&(i[0].includes(ColorText.SPLITTER)||i.unshift(`${ColorText.SPLITTER}${e}${ColorText.SPLITTER}`),i[i.length-1].includes(ColorText.SPLITTER)&&i.push(""));const o=[];for(let n=0;n<i.length;n+=2){const t=i[n].substring(1,i[n].length-1),e=i[n+1];o.push({color:t,text:e})}return o}}function _defineProperty$r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}_defineProperty$s(ColorText,"SPLITTER","\u2206");class SpriteText extends three__WEBPACK_IMPORTED_MODULE_0__.jyi{get text(){return this._text}set text(t){this._text=t,this.generate()}get textHeight(){return this._textHeight}set textHeight(t){this._textHeight=t,this.generate()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){this._backgroundColor=t,this.generate()}get padding(){return this._padding}set padding(t){this._padding=t,this.generate()}get borderWidth(){return this._borderWidth}set borderWidth(t){this._borderWidth=t,this.generate()}get borderRadius(){return this._borderRadius}set borderRadius(t){this._borderRadius=t,this.generate()}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t,this.generate()}get fontFace(){return this._fontFace}set fontFace(t){this._fontFace=t,this.generate()}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t,this.generate()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.generate()}get strokeWidth(){return this._strokeWidth}set strokeWidth(t){this._strokeWidth=t,this.generate()}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t,this.generate()}constructor(t,e){void 0===t&&(t=""),void 0===e&&(e=10),super(new three__WEBPACK_IMPORTED_MODULE_0__.xeV),_defineProperty$r(this,"_text",void 0),_defineProperty$r(this,"_textHeight",void 0),_defineProperty$r(this,"_backgroundColor",void 0),_defineProperty$r(this,"_padding",0),_defineProperty$r(this,"_borderWidth",0),_defineProperty$r(this,"_borderRadius",0),_defineProperty$r(this,"_borderColor","white"),_defineProperty$r(this,"_strokeWidth",0),_defineProperty$r(this,"_strokeColor","white"),_defineProperty$r(this,"_fontFace","Arial"),_defineProperty$r(this,"_fontSize",90),_defineProperty$r(this,"_fontWeight","normal"),_defineProperty$r(this,"_canvas",document.createElement("canvas")),_defineProperty$r(this,"generate",(()=>{const t=this._canvas,e=t.getContext("2d"),i=Array.isArray(this.borderWidth)?this.borderWidth:[this.borderWidth,this.borderWidth],o=i.map((t=>t*this.fontSize*.1)),n=(Array.isArray(this.borderRadius)?this.borderRadius:[this.borderRadius,this.borderRadius,this.borderRadius,this.borderRadius]).map((t=>t*this.fontSize*.1)),s=Array.isArray(this.padding)?this.padding:[this.padding,this.padding],r=s.map((t=>t*this.fontSize*.1)),l=this.text.split("\n"),a=`${this.fontWeight} ${this.fontSize}px ${this.fontFace}`;e.font=a;const d=Math.max(...l.map((t=>{const i=ColorText.split(t);let o=0;return i.forEach((t=>{let{text:i}=t;return o+=e.measureText(i).width})),o}))),c=this.fontSize*l.length;if(t.width=d+2*o[0]+2*r[0],t.height=c+2*o[1]+2*r[1],this.borderWidth){if(e.strokeStyle=this.borderColor,o[0]){const i=o[0]/2;e.lineWidth=o[0],e.beginPath(),e.moveTo(i,n[0]),e.lineTo(i,t.height-n[3]),e.moveTo(t.width-i,n[1]),e.lineTo(t.width-i,t.height-n[2]),e.stroke()}if(o[1]){const i=o[1]/2;e.lineWidth=o[1],e.beginPath(),e.moveTo(Math.max(o[0],n[0]),i),e.lineTo(t.width-Math.max(o[0],n[1]),i),e.moveTo(Math.max(o[0],n[3]),t.height-i),e.lineTo(t.width-Math.max(o[0],n[2]),t.height-i),e.stroke()}if(this.borderRadius){const i=Math.max(...o),s=i/2;e.lineWidth=i,e.beginPath(),[!!n[0]&&[n[0],s,s,n[0]],!!n[1]&&[t.width-n[1],t.width-s,s,n[1]],!!n[2]&&[t.width-n[2],t.width-s,t.height-s,t.height-n[2]],!!n[3]&&[n[3],s,t.height-s,t.height-n[3]]].filter((t=>t)).forEach((t=>{let[i,o,n,s]=t;e.moveTo(i,n),e.quadraticCurveTo(o,n,o,s)})),e.stroke()}}this.backgroundColor&&(e.fillStyle=this.backgroundColor,this.borderRadius?(e.beginPath(),e.moveTo(o[0],n[0]),[[o[0],n[0],t.width-n[1],o[1],o[1],o[1]],[t.width-o[0],t.width-o[0],t.width-o[0],o[1],n[1],t.height-n[2]],[t.width-o[0],t.width-n[2],n[3],t.height-o[1],t.height-o[1],t.height-o[1]],[o[0],o[0],o[0],t.height-o[1],t.height-n[3],n[0]]].forEach((t=>{let[i,o,n,s,r,l]=t;e.quadraticCurveTo(i,s,o,r),e.lineTo(n,l)})),e.closePath(),e.fill()):e.fillRect(o[0],o[1],t.width-2*o[0],t.height-2*o[1])),e.translate(...o),e.translate(...r),e.font=a,e.textBaseline="bottom";const h=this.strokeWidth>0;h&&(e.lineWidth=this.strokeWidth*this.fontSize/10,e.strokeStyle=this.strokeColor),l.forEach(((t,i)=>{const o=ColorText.split(t,this.strokeColor);let n=0;o.forEach((t=>{let{text:i}=t;return n+=e.measureText(i).width}));let s=(d-n)/2;const r=(i+1)*this.fontSize;o.forEach((t=>{let{color:i,text:o}=t;e.fillStyle=i,e.fillText(o,s,r),h&&e.strokeText(o,s,r),e.fillText(o,s,r),s+=e.measureText(o).width}))})),this.material.map&&this.material.map.dispose();const u=this.material.map=new three__WEBPACK_IMPORTED_MODULE_0__.xEZ(t);u.minFilter=three__WEBPACK_IMPORTED_MODULE_0__.wem,u.needsUpdate=!0;const p=this.textHeight*l.length+2*i[1]+2*s[1];this.scale.set(p*t.width/t.height,p,0)})),this._text=`${t}`,this._textHeight=e,this._backgroundColor=!1,this.generate()}}function _defineProperty$q(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$d(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$q(t,e,i[e])}))}return t}const defaultOptions$c={fontFace:"monospace",fontSize:.1,yOffset:0,color:"#ffffff",backgroundColor:"#00000077"};class NameTag extends SpriteText{constructor(t,e){var i;void 0===e&&(e={}),super(t,null!==(i=e.fontSize)&&void 0!==i?i:defaultOptions$c.fontSize);const{fontFace:o,yOffset:n,backgroundColor:s,color:r}=_objectSpread$d({},defaultOptions$c,e);this.fontFace=o,this.position.y+=n,this.backgroundColor=s,this.material.depthTest=!1,this.renderOrder=1e12,this.strokeColor=r;const l=this.material.map;l&&(l.minFilter=three__WEBPACK_IMPORTED_MODULE_0__.TyD,l.magFilter=three__WEBPACK_IMPORTED_MODULE_0__.TyD)}}function _defineProperty$p(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$c(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$p(t,e,i[e])}))}return t}function ownKeys$2(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function _objectSpreadProps$2(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):ownKeys$2(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))})),t}const CHARACTER_SCALE=.9,defaultCharacterOptions={swingLerp:.8,walkingSpeed:1.4,positionLerp:.7,rotationLerp:.2,idleArmSwing:.06},defaultHeadOptions={gap:.1*CHARACTER_SCALE,layers:1,side:three__WEBPACK_IMPORTED_MODULE_0__.ehD,width:.5*CHARACTER_SCALE,widthSegments:16,height:.25*CHARACTER_SCALE,heightSegments:8,depth:.5*CHARACTER_SCALE,depthSegments:16,neckGap:.05*CHARACTER_SCALE},defaultBodyOptions={gap:.1*CHARACTER_SCALE,layers:1,side:three__WEBPACK_IMPORTED_MODULE_0__.ehD,width:1*CHARACTER_SCALE,widthSegments:16},defaultArmsOptions={gap:.1*CHARACTER_SCALE,layers:1,side:three__WEBPACK_IMPORTED_MODULE_0__.ehD,width:.25*CHARACTER_SCALE,height:.5*CHARACTER_SCALE,depth:.25*CHARACTER_SCALE,widthSegments:8,heightSegments:16,depthSegments:8,shoulderGap:.05*CHARACTER_SCALE,shoulderDrop:.25*CHARACTER_SCALE},defaultLegsOptions={gap:.1*CHARACTER_SCALE,layers:1,side:three__WEBPACK_IMPORTED_MODULE_0__.ehD,width:.25*CHARACTER_SCALE,height:.25*CHARACTER_SCALE,depth:.25*CHARACTER_SCALE,widthSegments:3,heightSegments:3,depthSegments:3,betweenLegsGap:.2*CHARACTER_SCALE};class Character extends three__WEBPACK_IMPORTED_MODULE_0__.ZAu{update(){this.calculateDelta(),this.playArmSwingAnimation(),this.playWalkingAnimation(),this.lerpAll()}set(t,e){t&&e&&(this.newPosition.set(t[0],t[1],t[2]),this.newDirection.copy(MathUtils.directionToQuaternion(e[0],e[1],e[2])),this.newBodyDirection.copy(MathUtils.directionToQuaternion(e[0],0,e[2])))}set username(t){var e;this.nametag||(this.nametag=new NameTag(t,_objectSpread$c({yOffset:this.head.height/2+.2,fontSize:.2},null!==(e=this.options.nameTagOptions)&&void 0!==e?e:{})),this.add(this.nametag)),t?this.nametag.text=t:this.nametag.visible=!1}get username(){return this.nametag?this.nametag.text:""}get eyeHeight(){return this.options.legs.height+this.options.body.height+this.options.head.neckGap+this.options.head.height/2}get totalHeight(){return this.options.legs.height+this.options.body.height+this.options.head.neckGap+this.options.head.height}constructor(t){var e,i,o,n,s,r,l,a,d;void 0===t&&(t={}),super(),_defineProperty$p(this,"options",void 0),_defineProperty$p(this,"headGroup",void 0),_defineProperty$p(this,"bodyGroup",void 0),_defineProperty$p(this,"leftArmGroup",void 0),_defineProperty$p(this,"rightArmGroup",void 0),_defineProperty$p(this,"leftLegGroup",void 0),_defineProperty$p(this,"rightLegGroup",void 0),_defineProperty$p(this,"head",void 0),_defineProperty$p(this,"body",void 0),_defineProperty$p(this,"leftArm",void 0),_defineProperty$p(this,"rightArm",void 0),_defineProperty$p(this,"leftLeg",void 0),_defineProperty$p(this,"rightLeg",void 0),_defineProperty$p(this,"nametag",void 0),_defineProperty$p(this,"speed",0),_defineProperty$p(this,"newPosition",new three__WEBPACK_IMPORTED_MODULE_0__.Pa4),_defineProperty$p(this,"newBodyDirection",new three__WEBPACK_IMPORTED_MODULE_0__._fP),_defineProperty$p(this,"newDirection",new three__WEBPACK_IMPORTED_MODULE_0__._fP),_defineProperty$p(this,"onMove",void 0),_defineProperty$p(this,"onIdle",void 0),_defineProperty$p(this,"createModel",(()=>{const t=new CanvasBox(_objectSpread$c({},defaultHeadOptions,this.options.head?this.options.head:{})),e=new CanvasBox(_objectSpread$c({},defaultBodyOptions,this.options.body?this.options.body:{})),i=new CanvasBox(_objectSpread$c({},defaultArmsOptions,this.options.arms?this.options.arms:{})),o=new CanvasBox(_objectSpread$c({},defaultArmsOptions,this.options.arms?this.options.arms:{})),n=new CanvasBox(_objectSpread$c({},defaultLegsOptions,this.options.legs?this.options.legs:{})),s=new CanvasBox(_objectSpread$c({},defaultLegsOptions,this.options.legs?this.options.legs:{}));this.headGroup=new three__WEBPACK_IMPORTED_MODULE_0__.ZAu,this.bodyGroup=new three__WEBPACK_IMPORTED_MODULE_0__.ZAu,this.leftArmGroup=new three__WEBPACK_IMPORTED_MODULE_0__.ZAu,this.rightArmGroup=new three__WEBPACK_IMPORTED_MODULE_0__.ZAu,this.leftLegGroup=new three__WEBPACK_IMPORTED_MODULE_0__.ZAu,this.rightLegGroup=new three__WEBPACK_IMPORTED_MODULE_0__.ZAu,this.headGroup.add(t),t.position.y+=t.height/2,this.headGroup.position.y+=e.height+n.height,this.options.head&&this.options.head.neckGap&&(this.headGroup.position.y+=this.options.head.neckGap),this.bodyGroup.add(e),e.position.y+=e.height/2,this.bodyGroup.position.y+=n.height,this.leftArmGroup.add(i),i.position.y-=i.height/2,i.position.x-=i.width/2,this.leftArmGroup.position.y+=e.height,this.leftArmGroup.position.x-=e.width/2,this.rightArmGroup.add(o),o.position.y-=o.height/2,o.position.x+=o.width/2,this.rightArmGroup.position.y+=e.height,this.rightArmGroup.position.x+=e.width/2,this.options.arms&&(this.options.arms.shoulderDrop&&(this.leftArmGroup.position.y-=this.options.arms.shoulderDrop,this.rightArmGroup.position.y-=this.options.arms.shoulderDrop),this.options.arms.shoulderGap&&(this.leftArmGroup.position.x-=this.options.arms.shoulderGap,this.rightArmGroup.position.x+=this.options.arms.shoulderGap)),this.leftLegGroup.add(n),n.position.y-=n.height/2,n.position.x-=n.width/2,this.rightLegGroup.add(s),s.position.y-=s.height/2,s.position.x+=s.width/2,this.options.legs&&this.options.legs.betweenLegsGap&&(this.leftLegGroup.position.x-=this.options.legs.betweenLegsGap/2,this.rightLegGroup.position.x+=this.options.legs.betweenLegsGap/2),t.paint("all",new three__WEBPACK_IMPORTED_MODULE_0__.Ilk("#96baff")),t.paint("front",new three__WEBPACK_IMPORTED_MODULE_0__.Ilk("#f99999")),e.paint("all",new three__WEBPACK_IMPORTED_MODULE_0__.Ilk("#2b2e42")),i.paint("all",new three__WEBPACK_IMPORTED_MODULE_0__.Ilk("#548ca8")),o.paint("all",new three__WEBPACK_IMPORTED_MODULE_0__.Ilk("#548ca8")),n.paint("all",new three__WEBPACK_IMPORTED_MODULE_0__.Ilk("#96baff")),s.paint("all",new three__WEBPACK_IMPORTED_MODULE_0__.Ilk("#96baff")),this.add(this.headGroup,this.bodyGroup),this.bodyGroup.add(this.leftArmGroup,this.rightArmGroup,this.leftLegGroup,this.rightLegGroup),this.headGroup.position.y-=this.eyeHeight,this.bodyGroup.position.y-=this.eyeHeight,this.head=t,this.body=e,this.leftArm=i,this.rightArm=o,this.leftLeg=n,this.rightLeg=s})),_defineProperty$p(this,"calculateDelta",(()=>{const t=this.position.clone(),e=this.newPosition.clone();var i,o;t.y=e.y=0,t.distanceTo(e)>1e-5?(0===this.speed&&(null===(i=this.onMove)||void 0===i||i.call(this)),this.speed=this.options.walkingSpeed):(this.speed>0&&(null===(o=this.onIdle)||void 0===o||o.call(this)),this.speed=0)})),_defineProperty$p(this,"lerpAll",(()=>{0!==this.newPosition.length()&&this.position.lerp(this.newPosition,this.options.positionLerp),0!==this.newDirection.length()&&this.headGroup.rotation.setFromQuaternion(this.newDirection),0!==this.newBodyDirection.length()&&this.bodyGroup.quaternion.slerp(this.newBodyDirection,this.options.rotationLerp)})),_defineProperty$p(this,"playArmSwingAnimation",(()=>{const t=100,e=Math.max(this.speed,this.options.idleArmSwing),i=1*e;this.leftArmGroup.rotation.x=three__WEBPACK_IMPORTED_MODULE_0__.M8C.lerp(this.leftArmGroup.rotation.x,Math.sin(performance.now()*e/t)*i,this.options.swingLerp),this.leftArmGroup.rotation.z=three__WEBPACK_IMPORTED_MODULE_0__.M8C.lerp(this.leftArmGroup.rotation.z,Math.cos(performance.now()*e/t)**2*i*.1,this.options.swingLerp),this.rightArmGroup.rotation.x=three__WEBPACK_IMPORTED_MODULE_0__.M8C.lerp(this.rightArmGroup.rotation.x,Math.sin(performance.now()*e/t+Math.PI)*i,this.options.swingLerp),this.rightArmGroup.rotation.z=three__WEBPACK_IMPORTED_MODULE_0__.M8C.lerp(this.rightArmGroup.rotation.z,-(Math.sin(performance.now()*e/t)**2)*i*.1,this.options.swingLerp)})),_defineProperty$p(this,"playWalkingAnimation",(()=>{const t=1*this.speed;this.leftLegGroup.rotation.x=-Math.sin(performance.now()*this.speed/100)*t,this.rightLegGroup.rotation.x=Math.sin(performance.now()*this.speed/100)*t})),this.options=_objectSpreadProps$2(_objectSpread$c({},defaultCharacterOptions,t),{head:_objectSpreadProps$2(_objectSpread$c({},defaultHeadOptions,t.head||{}),{depth:(null===(e=t.head)||void 0===e?void 0:e.depth)||(null===(i=t.head)||void 0===i?void 0:i.width)||defaultHeadOptions.width,height:(null===(o=t.head)||void 0===o?void 0:o.height)||defaultHeadOptions.height||defaultHeadOptions.width}),body:_objectSpreadProps$2(_objectSpread$c({},defaultBodyOptions,t.body||{}),{depth:(null===(n=t.body)||void 0===n?void 0:n.depth)||defaultBodyOptions.depth||defaultBodyOptions.width,height:(null===(s=t.body)||void 0===s?void 0:s.height)||defaultBodyOptions.height||defaultBodyOptions.width}),arms:_objectSpreadProps$2(_objectSpread$c({},defaultArmsOptions,t.arms||{}),{depth:(null===(r=t.arms)||void 0===r?void 0:r.depth)||defaultArmsOptions.width,height:(null===(l=t.arms)||void 0===l?void 0:l.height)||defaultArmsOptions.height}),legs:_objectSpreadProps$2(_objectSpread$c({},defaultLegsOptions,t.legs||{}),{depth:(null===(a=t.legs)||void 0===a?void 0:a.depth)||defaultLegsOptions.width,height:(null===(d=t.legs)||void 0===d?void 0:d.height)||defaultLegsOptions.height})}),this.createModel()}}function _defineProperty$o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$b(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$o(t,e,i[e])}))}return t}const defaultOptions$b={stats:!0,onByDefault:!0,entryStyles:{},entriesClass:"debug-entries",lineStyles:{},lineClass:"debug-line",dataStyles:{},dataClass:"debug-data",showVoxelize:!0,asyncPeriod:1e3};class Debug extends three__WEBPACK_IMPORTED_MODULE_0__.ZAu{constructor(t,e){var i;void 0===t&&(t=document.body),void 0===e&&(e={}),super(),i=this,_defineProperty$o(this,"options",void 0),_defineProperty$o(this,"stats",void 0),_defineProperty$o(this,"dataWrapper",void 0),_defineProperty$o(this,"entriesWrapper",void 0),_defineProperty$o(this,"domElement",void 0),_defineProperty$o(this,"dataEntries",[]),_defineProperty$o(this,"registerDisplay",(function(t,e,o,n){void 0===n&&(n=t=>t);const s=i.makeDataEntry(),r={title:t,element:s,object:e,formatter:n,attribute:o};return i.dataEntries.push(r),i.entriesWrapper.insertBefore(s,i.entriesWrapper.firstChild),"AsyncFunction"===e.constructor.name&&setInterval((()=>{e().then((e=>{s.textContent=`${t?`${t}: `:""}${n(e)}`}))}),i.options.asyncPeriod),i})),_defineProperty$o(this,"removeDisplay",(t=>{const e=this.dataEntries.findIndex((e=>e.title===t)),i=this.dataEntries.splice(e,1)[0];i&&this.entriesWrapper.removeChild(i.element)})),_defineProperty$o(this,"displayTitle",(t=>{const e=this.makeDataEntry(!0);return e.textContent=t,this.entriesWrapper.insertBefore(e,this.entriesWrapper.firstChild),this})),_defineProperty$o(this,"displayNewline",(()=>{const t=this.makeDataEntry(!0);return this.entriesWrapper.insertBefore(t,this.entriesWrapper.firstChild),this})),_defineProperty$o(this,"toggle",(function(t){void 0===t&&(t=null),i.visible=null!==t?t:!i.visible;const e=i.entriesWrapper.style.visibility,o=t?"visible":"visible"===e?"hidden":"visible";i.entriesWrapper.style.visibility=o,i.dataWrapper.style.visibility=o,i.stats&&(i.stats.dom.style.visibility=o)})),_defineProperty$o(this,"update",(()=>{var t;for(const{element:e,title:i,attribute:o,object:n,formatter:s}of this.dataEntries){if("AsyncFunction"===n.constructor.name)continue;const t=n?"function"==typeof n?n():o?n[o]:"":"";e.textContent=`${i?`${i}: `:""}${s(t)}`}null===(t=this.stats)||void 0===t||t.update()})),_defineProperty$o(this,"makeDataEntry",(function(t){void 0===t&&(t=!1);const e=document.createElement("p");return e.classList.add(i.options.lineClass),DOMUtils.applyStyles(e,_objectSpread$b({},t?{height:"16px"}:{},i.options.lineStyles||{})),e})),_defineProperty$o(this,"makeDOM",(()=>{var t;this.dataWrapper=document.createElement("div"),this.dataWrapper.id="data-wrapper",this.dataWrapper.classList.add(this.options.dataClass),this.entriesWrapper=document.createElement("div"),this.entriesWrapper.classList.add(this.options.entriesClass),DOMUtils.applyStyles(this.dataWrapper,this.options.dataStyles),DOMUtils.applyStyles(this.entriesWrapper,this.options.entryStyles),this.options.stats&&(this.stats=new three_examples_jsm_libs_stats_module_js__WEBPACK_IMPORTED_MODULE_1__.Z,null===(t=this.stats.dom.parentNode)||void 0===t||t.removeChild(this.stats.dom),DOMUtils.applyStyles(this.stats.dom,{position:"relative",top:"unset",bottom:"unset",left:"unset",zIndex:"1000000000000",marginTop:"13.333px"}))})),_defineProperty$o(this,"setup",(()=>{this.options.showVoxelize&&(this.displayTitle("Voxelize 0.1.154"),this.displayNewline())})),_defineProperty$o(this,"mount",(()=>{var t;this.dataWrapper.appendChild(this.entriesWrapper),this.stats&&this.dataWrapper.appendChild(null===(t=this.stats)||void 0===t?void 0:t.dom),this.domElement.appendChild(this.dataWrapper)})),this.domElement=t;const{onByDefault:o}=this.options=_objectSpread$b({},defaultOptions$b,e);this.makeDOM(),this.setup(),this.mount(),this.toggle(o)}}var OverlayFragmentShader="#define GLSLIFY 1\nuniform vec3 overlay;uniform float opacity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(mix(inputColor.rgb,overlay,opacity),inputColor.a);}";function _defineProperty$n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class BlockOverlayEffect extends postprocessing__WEBPACK_IMPORTED_MODULE_2__.Qm{get opacity(){return this.uniforms.get("opacity").value}set opacity(t){this.uniforms.get("opacity").value=t}get overlay(){return this.uniforms.get("overlay").value}set overlay(t){const e=this.uniforms.get("overlay").value;e.x=t.r,e.y=t.g,e.z=t.b}constructor(t,e){super("BlockOverlayEffect",OverlayFragmentShader,{uniforms:new Map([["overlay",new three__WEBPACK_IMPORTED_MODULE_0__.xWb(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,0,1))],["opacity",new three__WEBPACK_IMPORTED_MODULE_0__.xWb(0)]])}),_defineProperty$n(this,"world",void 0),_defineProperty$n(this,"camera",void 0),_defineProperty$n(this,"overlays",void 0),_defineProperty$n(this,"oldId",void 0),_defineProperty$n(this,"addOverlay",void 0),_defineProperty$n(this,"update",void 0),this.world=t,this.camera=e,this.overlays=new Map,this.addOverlay=(t,e,i)=>{this.overlays.set("number"==typeof t?t:t.toLowerCase(),[e,i])},this.update=()=>{if(!this.world.isInitialized)return;const t=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;this.camera.getWorldPosition(t);const e=this.world.getVoxelAt(t.x,t.y,t.z);if(this.oldId===e)return;this.oldId=e;const i=this.world.getBlockById(e),o=this.overlays.get(e)||this.overlays.get(i.name.toLowerCase());o?(this.overlay=o[0],this.opacity=o[1]):this.opacity=0}}}function _defineProperty$m(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$a(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$m(t,e,i[e])}))}return t}const defaultOptions$a={maxDistance:10,maxRadius:.5};class Shadow extends three__WEBPACK_IMPORTED_MODULE_0__.Kj0{constructor(t,e){void 0===e&&(e={}),super(Shadow.GEOMETRY,Shadow.MATERIAL),_defineProperty$m(this,"world",void 0),_defineProperty$m(this,"options",void 0),_defineProperty$m(this,"update",void 0),this.world=t,this.update=()=>{if(!this.parent)return;const t=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;this.parent.getWorldPosition(t);const{maxDistance:e}=this.options,i=this.world.raycastVoxels(t.toArray(),[0,-1,0],e);if(this.visible=!!i,!i)return;const{point:o}=i;if(isNaN(o[0]))return;const n=Math.sqrt((o[0]-t.x)**2+(o[1]-t.y)**2+(o[2]-t.z)**2),s=Math.max(1-n/e,0)**2,r=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(o[0],o[1]+Shadow.Y_OFFSET,o[2]);r.sub(t),this.position.copy(r),this.scale.set(s,s,1)},this.options=_objectSpread$a({},defaultOptions$a,e),this.rotateX(Math.PI/2),this.renderOrder=-1}}_defineProperty$m(Shadow,"MATERIAL",new three__WEBPACK_IMPORTED_MODULE_0__.vBJ({side:three__WEBPACK_IMPORTED_MODULE_0__.ehD,color:"rgb(0,0,0)",opacity:.3,depthWrite:!1,transparent:!0})),_defineProperty$m(Shadow,"GEOMETRY",new three__WEBPACK_IMPORTED_MODULE_0__.zf8(defaultOptions$a.maxRadius,30)),_defineProperty$m(Shadow,"Y_OFFSET",.01);class Shadows extends Array{constructor(t){var e;if(super(),e=this,_defineProperty$m(this,"world",void 0),_defineProperty$m(this,"update",(()=>{this.forEach(((t,e)=>{t.parent||this.splice(e,1)})),this.forEach((t=>{t.update()}))})),_defineProperty$m(this,"add",(function(t,i){void 0===i&&(i={});const o=new Shadow(e.world,i);t.add(o),e.push(o)})),!t)throw new Error("Shadows: world is required.");this.world=t}}function _defineProperty$l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$9(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$l(t,e,i[e])}))}return t}const position=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,defaultOptions$9={lerpFactor:.1};class LightShined{constructor(t,e){var i=this;void 0===e&&(e={}),_defineProperty$l(this,"world",void 0),_defineProperty$l(this,"options",void 0),_defineProperty$l(this,"list",void 0),_defineProperty$l(this,"ignored",void 0),_defineProperty$l(this,"add",void 0),_defineProperty$l(this,"remove",void 0),_defineProperty$l(this,"update",void 0),_defineProperty$l(this,"ignore",void 0),_defineProperty$l(this,"updateObject",void 0),_defineProperty$l(this,"recursiveUpdate",void 0),this.world=t,this.list=new Set,this.ignored=new Set,this.add=t=>{this.list.add(t)},this.remove=t=>{this.list.delete(t)},this.update=()=>{this.list.forEach((t=>{this.recursiveUpdate(t)}))},this.ignore=function(){for(var t=arguments.length,e=new Array(t),o=0;o<t;o++)e[o]=arguments[o];e.forEach((t=>{i.ignored.add(t)}))},this.updateObject=(t,e)=>{for(const i of this.ignored)if(t instanceof i)return;t instanceof three__WEBPACK_IMPORTED_MODULE_0__.Kj0&&(Array.isArray(t.material)?t.material:[t.material]).forEach((t=>{t&&t.color&&t.color.copy(e)}))},this.recursiveUpdate=function(t,e){if(void 0===e&&(e=null),t.parent){for(const e of i.ignored)if(t instanceof e)return;if(null===e){t.getWorldPosition(position);const o=ChunkUtils.mapWorldToVoxel(position.toArray());if(!i.world.getChunkByPosition(...o))return;e=i.world.getLightColorAt(...o)}if(t.userData.voxelizeLightShined){const i=t.userData.voxelizeLightShined.sub(e);if(i.r**2+i.g**2+i.b**2<.01)return}i.updateObject(t,e),t.traverse((t=>{i.updateObject(t,e)}))}},this.options=_objectSpread$9({},defaultOptions$9,e),this.ignore(Shadow),this.ignore(NameTag)}}var isMergeableObject=function(t){return isNonNullObject(t)&&!isSpecial(t)};function isNonNullObject(t){return!!t&&"object"==typeof t}function isSpecial(t){var e=Object.prototype.toString.call(t);return"[object RegExp]"===e||"[object Date]"===e||isReactElement(t)}var canUseSymbol="function"==typeof Symbol&&Symbol.for,REACT_ELEMENT_TYPE=canUseSymbol?Symbol.for("react.element"):60103;function isReactElement(t){return t.$$typeof===REACT_ELEMENT_TYPE}function emptyTarget(t){return Array.isArray(t)?[]:{}}function cloneUnlessOtherwiseSpecified(t,e){return!1!==e.clone&&e.isMergeableObject(t)?deepmerge(emptyTarget(t),t,e):t}function defaultArrayMerge(t,e,i){return t.concat(e).map((function(t){return cloneUnlessOtherwiseSpecified(t,i)}))}function getMergeFunction(t,e){if(!e.customMerge)return deepmerge;var i=e.customMerge(t);return"function"==typeof i?i:deepmerge}function getEnumerableOwnPropertySymbols(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return Object.propertyIsEnumerable.call(t,e)})):[]}function getKeys(t){return Object.keys(t).concat(getEnumerableOwnPropertySymbols(t))}function propertyIsOnObject(t,e){try{return e in t}catch(t){return!1}}function propertyIsUnsafe(t,e){return propertyIsOnObject(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))}function mergeObject(t,e,i){var o={};return i.isMergeableObject(t)&&getKeys(t).forEach((function(e){o[e]=cloneUnlessOtherwiseSpecified(t[e],i)})),getKeys(e).forEach((function(n){propertyIsUnsafe(t,n)||(propertyIsOnObject(t,n)&&i.isMergeableObject(e[n])?o[n]=getMergeFunction(n,i)(t[n],e[n],i):o[n]=cloneUnlessOtherwiseSpecified(e[n],i))})),o}function deepmerge(t,e,i){(i=i||{}).arrayMerge=i.arrayMerge||defaultArrayMerge,i.isMergeableObject=i.isMergeableObject||isMergeableObject,i.cloneUnlessOtherwiseSpecified=cloneUnlessOtherwiseSpecified;var o=Array.isArray(e);return o===Array.isArray(t)?o?i.arrayMerge(t,e,i):mergeObject(t,e,i):cloneUnlessOtherwiseSpecified(e,i)}deepmerge.all=function(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce((function(t,i){return deepmerge(t,i,e)}),{})};var deepmerge_1=deepmerge,cjs=deepmerge_1;const TRANSPARENT_RENDER_ORDER=1e5,OPAQUE_RENDER_ORDER=100,empty=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,TRANSPARENT_SORT=t=>(e,i)=>{if(e.object&&e.object.isMesh&&e.object.userData.isChunk&&i.object&&i.object.isMesh&&i.object.userData.isChunk){const o=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,n=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,{object:s}=e,{object:r}=i,{geometry:l}=s,{geometry:a}=r;return l.boundingBox||l.computeBoundingBox(),a.boundingBox||a.computeBoundingBox(),l&&l.boundingBox?(l.boundingBox.getCenter(o),o.add(s.getWorldPosition(empty))):s.getWorldPosition(o),a&&a.boundingBox?(a.boundingBox.getCenter(n),n.add(r.getWorldPosition(empty))):r.getWorldPosition(n),n.distanceToSquared(t.position)-o.distanceToSquared(t.position)>0?1:-1}return e.groupOrder!==i.groupOrder?e.groupOrder-i.groupOrder:e.renderOrder!==i.renderOrder?e.renderOrder-i.renderOrder:e.z!==i.z?i.z-e.z:e.id-i.id},noop$1=()=>{};function _defineProperty$k(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$8(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$k(t,e,i[e])}))}return t}function ownKeys$1(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function _objectSpreadProps$1(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):ownKeys$1(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))})),t}const defaultOptions$8={wrapperClass:"item-slots",wrapperStyles:{},slotClass:"item-slots-slot",slotHoverClass:"item-slots-slot-hover",slotFocusClass:"item-slots-slot-focus",slotSubscriptClass:"item-slots-slot-subscript",slotMargin:2,slotPadding:2,slotWidth:50,slotHeight:50,slotStyles:{},slotSubscriptStyles:{},horizontalCount:5,verticalCount:1,focusFirstByDefault:!0,activatedByDefault:!0,zoom:1,perspective:"pxyz",scrollable:!0};class ItemSlot{constructor(t,e){_defineProperty$k(this,"row",void 0),_defineProperty$k(this,"col",void 0),_defineProperty$k(this,"scene",void 0),_defineProperty$k(this,"object",void 0),_defineProperty$k(this,"light",void 0),_defineProperty$k(this,"camera",new three__WEBPACK_IMPORTED_MODULE_0__.iKG(-1,1,1,-1,0,10)),_defineProperty$k(this,"element",void 0),_defineProperty$k(this,"subscriptElement",void 0),_defineProperty$k(this,"subscript",void 0),_defineProperty$k(this,"content",void 0),_defineProperty$k(this,"zoom",1),_defineProperty$k(this,"lightRotationOffset",-Math.PI/8),_defineProperty$k(this,"offset",new three__WEBPACK_IMPORTED_MODULE_0__.Pa4),_defineProperty$k(this,"getObject",(()=>this.object)),_defineProperty$k(this,"setObject",(t=>{this.object&&this.scene.remove(this.object),this.object=t,this.scene.add(t)})),_defineProperty$k(this,"getContent",(()=>this.content)),_defineProperty$k(this,"setContent",(t=>{this.content=t})),_defineProperty$k(this,"getSubscript",(()=>this.subscript)),_defineProperty$k(this,"setSubscript",(t=>{this.subscript=t,this.subscriptElement.innerText=t})),_defineProperty$k(this,"setZoom",(t=>{this.zoom=t,this.camera.far=3*t+1,this.updateCamera()})),_defineProperty$k(this,"setPerspective",(t=>{const e=t.startsWith("n")?-1:1,i=t.includes("x")?1:0,o=t.includes("y")?1:0,n=t.includes("z")?1:0;this.offset.set(i,o,n).multiplyScalar(e),this.updateCamera()})),_defineProperty$k(this,"applyClass",(t=>{this.element.classList.add(t)})),_defineProperty$k(this,"removeClass",(t=>{this.element.classList.remove(t)})),_defineProperty$k(this,"applySubscriptClass",(t=>{this.subscriptElement.classList.add(t)})),_defineProperty$k(this,"removeSubscriptClass",(t=>{this.subscriptElement.classList.remove(t)})),_defineProperty$k(this,"applyStyles",(t=>{DOMUtils.applyStyles(this.element,t)})),_defineProperty$k(this,"applySubscriptStyles",(t=>{DOMUtils.applyStyles(this.subscriptElement,t)})),_defineProperty$k(this,"updateCamera",(()=>{this.camera.position.copy(this.offset.clone().multiplyScalar(3.5*(this.zoom||1))),this.camera.lookAt(0,0,0);const t=this.camera.position.clone();t.applyAxisAngle(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,1,0),this.lightRotationOffset),this.light.position.copy(t)})),this.row=t,this.col=e,this.scene=new three__WEBPACK_IMPORTED_MODULE_0__.xsS,this.camera=new three__WEBPACK_IMPORTED_MODULE_0__.iKG(-1,1,1,-1,0,10),this.element=document.createElement("div"),this.subscriptElement=document.createElement("div"),this.element.appendChild(this.subscriptElement),this.offset=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,this.light=new three__WEBPACK_IMPORTED_MODULE_0__.Ox3(16777215,3),this.scene.add(this.light),this.updateCamera()}}class ItemSlots{get element(){return this.wrapper}constructor(t){var e=this;void 0===t&&(t={}),_defineProperty$k(this,"options",void 0),_defineProperty$k(this,"wrapper",void 0),_defineProperty$k(this,"canvas",void 0),_defineProperty$k(this,"renderer",void 0),_defineProperty$k(this,"focusedRow",-1),_defineProperty$k(this,"focusedCol",-1),_defineProperty$k(this,"activated",!1),_defineProperty$k(this,"slotTotalWidth",void 0),_defineProperty$k(this,"slotTotalHeight",void 0),_defineProperty$k(this,"onSlotClick",noop$1),_defineProperty$k(this,"onSlotUpdate",noop$1),_defineProperty$k(this,"onFocusChange",noop$1),_defineProperty$k(this,"slots",void 0),_defineProperty$k(this,"animationFrame",-1),_defineProperty$k(this,"activate",(()=>{this.activated||(this.activated=!0,DOMUtils.applyStyles(this.wrapper,{display:"flex"}),this.render())})),_defineProperty$k(this,"deactivate",(()=>{this.activated&&(this.activated=!1,DOMUtils.applyStyles(this.wrapper,{display:"none"}),cancelAnimationFrame(this.animationFrame))})),_defineProperty$k(this,"setObject",((t,e,i)=>{var o;if(!this.slots[t]||!this.slots[t][e])return;const n=this.slots[t][e];n.setObject(i),null===(o=this.onSlotUpdate)||void 0===o||o.call(this,n)})),_defineProperty$k(this,"setContent",((t,e,i)=>{var o;if(!this.slots[t]||!this.slots[t][e])return;const n=this.slots[t][e];n.setContent(i),null===(o=this.onSlotUpdate)||void 0===o||o.call(this,n)})),_defineProperty$k(this,"setSubscript",((t,e,i)=>{var o;if(!this.slots[t]||!this.slots[t][e])return;const n=this.slots[t][e];n.setSubscript(i),null===(o=this.onSlotUpdate)||void 0===o||o.call(this,n)})),_defineProperty$k(this,"setFocused",((t,e)=>{if(t===this.focusedRow&&e===this.focusedCol)return;const i=-1!==this.focusedRow&&-1!==this.focusedCol&&(this.focusedRow!==t||this.focusedCol!==e);i&&this.slots[this.focusedRow][this.focusedCol].element.classList.remove(this.options.slotFocusClass),this.focusedRow=t,this.focusedCol=e;const o=this.slots[this.focusedRow][this.focusedCol];this.onFocusChange(i?this.slots[this.focusedRow][this.focusedCol]:null,o),o.element.classList.add(this.options.slotFocusClass),this.onSlotClick(o)})),_defineProperty$k(this,"getObject",((t,e)=>this.slots[t]&&this.slots[t][e]?this.slots[t][e].object:null)),_defineProperty$k(this,"getContent",((t,e)=>this.slots[t]&&this.slots[t][e]?this.slots[t][e].content:null)),_defineProperty$k(this,"getSubscript",((t,e)=>this.slots[t]&&this.slots[t][e]?this.slots[t][e].subscript:null)),_defineProperty$k(this,"getFocused",(()=>-1===this.focusedRow||-1===this.focusedCol?null:this.slots[this.focusedRow][this.focusedCol])),_defineProperty$k(this,"getRowColFromEvent",(t=>{const e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,o=(t.clientY-e.top)/this.slotTotalHeight,n=i/this.slotTotalWidth,{slotMargin:s,slotWidth:r,slotHeight:l}=this.options,{verticalCount:a,horizontalCount:d}=this.options;return o<0||o>=a||n<0||n>=d||o%1<s/l||o%1>1-s/l||n%1<s/r||n%1>1-s/r?{row:-1,col:-1}:{row:Math.floor(o),col:Math.floor(n)}})),_defineProperty$k(this,"getSlot",((t,e)=>t<0||t>=this.options.verticalCount||e<0||e>=this.options.horizontalCount?null:this.slots[t][e])),_defineProperty$k(this,"connect",(function(t,i){void 0===i&&(i="*");const{slotHoverClass:o,scrollable:n}=e.options;let s=null,r=null;e.canvas.onmouseenter=()=>{e.activated&&(e.canvas.onmousemove=t=>{const{row:i,col:n}=e.getRowColFromEvent(t);-1!==i&&-1!==n?(null===s||null===r||i===s&&n===r||e.slots[s][r].element.classList.remove(o),e.slots[i][n].element.classList.add(o),DOMUtils.applyStyles(e.canvas,{cursor:"pointer"}),s=i,r=n):null!==s&&null!==r&&(e.slots[s][r].element.classList.remove(o),DOMUtils.applyStyles(e.canvas,{cursor:"default"}))})},e.canvas.onmouseleave=()=>{e.activated&&(null!==s&&null!==r&&(e.slots[s][r].element.classList.remove(o),DOMUtils.applyStyles(e.canvas,{cursor:"default"})),e.canvas.onmousemove=null)},e.canvas.onmousedown=t=>{if(!e.activated)return;const{row:i,col:o}=e.getRowColFromEvent(t);-1!==i&&-1!==o&&e.setFocused(i,o)};const l=n?t.scroll((()=>{if(!e.activated)return;if(-1===e.focusedRow||-1===e.focusedCol)return;const{horizontalCount:t,verticalCount:i}=e.options,o=e.focusedRow,n=e.focusedCol;0===n?e.setFocused(0===o?i-1:o-1,t-1):e.setFocused(o,n-1)}),(()=>{if(!e.activated)return;if(-1===e.focusedRow||-1===e.focusedCol)return;const{horizontalCount:t,verticalCount:i}=e.options,o=e.focusedRow,n=e.focusedCol;n===t-1?e.setFocused(o===i-1?0:o+1,0):e.setFocused(o,n+1)}),i):noop$1;return()=>{try{l(),e.canvas.onmousedown=null,e.canvas.onmouseenter=null,e.canvas.onmouseleave=null}catch(t){}}})),_defineProperty$k(this,"render",(()=>{if(this.animationFrame=requestAnimationFrame(this.render),!this.activated)return;const{horizontalCount:t,verticalCount:e,slotMargin:i,slotPadding:o}=this.options,n=this.canvas.clientWidth,s=this.canvas.clientHeight;this.canvas.width===n&&this.canvas.height===s||this.renderer.setSize(n,s,!1),this.renderer.setScissorTest(!1),this.renderer.clear(),this.renderer.setScissorTest(!0);const r=this.renderer.domElement.getBoundingClientRect();let l=!1;for(let a=0;a<e;a++)for(let e=0;e<t;e++){const{scene:t,camera:n,element:s,object:d}=this.slots[a][e];if(!d)continue;const c=s.getBoundingClientRect();if(c.top+c.height<r.top||c.top>r.top+r.height||c.left+c.width<r.left||c.left>r.left+r.width)continue;l=!0;const h=c.right-c.left-2*i-2*o,u=c.bottom-c.top-2*i-2*o;if(h<=0||u<=0)continue;const p=c.left-r.left+i+o,m=r.height-(c.bottom-r.top)+i+o;this.renderer.setViewport(p,m,h,u),this.renderer.setScissor(p,m,h,u),this.renderer.render(t,n)}l||(this.renderer.setViewport(0,0,n,s),this.renderer.setScissor(0,0,n,s),this.renderer.render(this.slots[0][0].scene,this.slots[0][0].camera))})),_defineProperty$k(this,"generate",(()=>{const{wrapperClass:t,wrapperStyles:e,slotClass:i,slotStyles:o,slotSubscriptClass:n,slotSubscriptStyles:s,horizontalCount:r,verticalCount:l,zoom:a,perspective:d}=this.options,{slotWidth:c,slotHeight:h,slotMargin:u,slotPadding:p}=this.options,m=(c+2*u+2*p)*r,b=(h+2*u+2*p)*l;this.wrapper=document.createElement("div"),this.wrapper.classList.add(t),DOMUtils.applyStyles(this.wrapper,_objectSpreadProps$1(_objectSpread$8({},e),{width:`${m}px`,height:`${b}px`,display:"none"})),this.slots=[];for(let y=0;y<l;y++){this.slots[y]=[];for(let t=0;t<r;t++){const e=new ItemSlot(y,t);e.applyClass(i),e.applyStyles(_objectSpread$8({width:`${c}px`,height:`${h}px`,borderRadius:.1*c+"px",borderWidth:.08*c+"px",boxShadow:`inset 0 0 ${.05*c}px var(--item-slots-slot-color)`},o)),e.applySubscriptClass(n),e.applySubscriptStyles(s),e.applyStyles({position:"absolute",top:`${(h+2*u+2*p)*y+u}px`,left:`${(c+2*u+2*p)*t+u}px`}),e.setZoom(a),e.setPerspective(d),this.slots[y][t]=e,this.wrapper.appendChild(e.element)}}this.canvas=document.createElement("canvas"),this.canvas.width=m,this.canvas.height=b,DOMUtils.applyStyles(this.canvas,{position:"absolute",background:"transparent",top:"0",left:"0",zIndex:"-1"}),this.wrapper.appendChild(this.canvas),this.renderer=new three__WEBPACK_IMPORTED_MODULE_0__.CP7({canvas:this.canvas,antialias:!1,alpha:!0}),this.renderer.outputColorSpace=three__WEBPACK_IMPORTED_MODULE_0__.KI_,this.renderer.setSize(m,b)}));const{focusFirstByDefault:i,activatedByDefault:o,slotHeight:n,slotMargin:s,slotWidth:r,slotPadding:l}=this.options=cjs(defaultOptions$8,t);this.slotTotalWidth=r+2*s+2*l,this.slotTotalHeight=n+2*s+2*l,this.generate(),i&&this.setFocused(0,0),o&&this.activate()}}function _defineProperty$j(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$7(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$j(t,e,i[e])}))}return t}const defaultOptions$7={maxDistance:5,blockMargin:.3,lerpFactor:.5,ignoreSeeThrough:!0,ignoreFluids:!0};class Perspective{set state(t){const{camera:e}=this.controls;var i;"first"===t?e.position.copy(this.firstPersonPosition):e.position.set(0,0,0),e.quaternion.set(0,0,0,0),t!==this._state&&(null===(i=this.onChangeState)||void 0===i||i.call(this,t),this._state=t)}get state(){return this._state}constructor(t,e,i){var o=this;if(void 0===i&&(i={}),_defineProperty$j(this,"options",void 0),_defineProperty$j(this,"controls",void 0),_defineProperty$j(this,"world",void 0),_defineProperty$j(this,"inputs",void 0),_defineProperty$j(this,"_state","first"),_defineProperty$j(this,"firstPersonPosition",new three__WEBPACK_IMPORTED_MODULE_0__.Pa4),_defineProperty$j(this,"onChangeState",void 0),_defineProperty$j(this,"connect",(function(t,e){void 0===e&&(e="*");const i=t.bind("c",o.toggle,e,{identifier:Perspective.INPUT_IDENTIFIER});return o.inputs=t,()=>{try{i()}catch(t){}}})),_defineProperty$j(this,"toggle",(()=>{switch(this.state){case"first":this.state="third";break;case"second":this.state="first";break;case"third":this.state="second"}})),_defineProperty$j(this,"update",(()=>{const{object:t,camera:e}=this.controls;this.controls.character&&("first"===this.state&&this.controls.character.visible?this.controls.character.visible=!1:"first"===this.state||this.controls.character.visible||(this.controls.character.visible=!0));const i=()=>{const i=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;("second"===this.state?t:e).getWorldDirection(i),i.normalize(),i.multiplyScalar(-1);const o=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;t.getWorldPosition(o),o.add(i.clone().multiplyScalar(this.options.blockMargin));const n=this.world.raycastVoxels(o.toArray(),i.toArray(),this.options.maxDistance,{ignoreFluids:this.options.ignoreFluids,ignoreSeeThrough:this.options.ignoreSeeThrough});return n?o.distanceTo(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...n.point)):this.options.maxDistance};switch(this.state){case"first":break;case"second":{const o=e.position.clone();o.z=-i(),e.position.lerp(o,this.options.lerpFactor),e.lookAt(t.position);break}case"third":{const t=e.position.clone();t.z=i(),e.position.lerp(t,this.options.lerpFactor);break}}})),!t)throw new Error("Perspective: invalid rigid controls.");if(!e)throw new Error("Perspective: invalid world.");this.controls=t,this.world=e,this.options=_objectSpread$7({},defaultOptions$7,i),this.firstPersonPosition.copy(this.controls.camera.position),this.state="first"}}function _defineProperty$i(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$6(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$i(t,e,i[e])}))}return t}_defineProperty$j(Perspective,"INPUT_IDENTIFIER","voxelize-perspective");const defaultOptions$6={zoom:1,perspective:"pxyz",width:100,height:100,renderOnce:!1,lightRotationOffset:-Math.PI/8};class Portrait{constructor(t,e){if(void 0===e&&(e={}),_defineProperty$i(this,"options",void 0),_defineProperty$i(this,"camera",void 0),_defineProperty$i(this,"scene",void 0),_defineProperty$i(this,"canvas",void 0),_defineProperty$i(this,"object",void 0),_defineProperty$i(this,"animationFrameId",-1),_defineProperty$i(this,"setObject",(t=>{this.object&&this.scene.remove(this.object),this.scene.add(t),this.object=t})),_defineProperty$i(this,"dispose",(()=>{cancelAnimationFrame(this.animationFrameId),this.scene.remove(this.object),this.object=null})),_defineProperty$i(this,"render",(()=>{this.animationFrameId=requestAnimationFrame(this.render);const t=Portrait.renderer,{renderOnce:e}=this.options,{width:i,height:o}=t.getSize(new three__WEBPACK_IMPORTED_MODULE_0__.FM8(0,0));i===this.canvas.width&&o===this.canvas.height||t.setSize(this.canvas.width,this.canvas.height),t.render(this.scene,this.camera);const n=t.domElement,s=this.canvas.getContext("2d");s.globalCompositeOperation="copy",s.drawImage(n,0,n.height-o,i,o,0,0,i,o),e&&this.dispose()})),!t)throw new Error("A target object is required for portraits.");Portrait.renderer.outputColorSpace=three__WEBPACK_IMPORTED_MODULE_0__.KI_;const{width:i,height:o,zoom:n,perspective:s,lightRotationOffset:r}=this.options=_objectSpread$6({},defaultOptions$6,e);this.canvas=document.createElement("canvas"),this.canvas.width=i,this.canvas.height=o,this.scene=new three__WEBPACK_IMPORTED_MODULE_0__.xsS;const l=s.includes("n")?-1:1,a=s.includes("x")?1:0,d=s.includes("y")?1:0,c=s.includes("z")?1:0;this.camera=new three__WEBPACK_IMPORTED_MODULE_0__.iKG(-n,n,n,-n),this.camera.far=10*n+1,this.camera.near=.1,this.camera.position.set(l*a*n*3.5,l*d*n*3.5,l*c*n*3.5),this.camera.lookAt(0,0,0);const h=this.camera.position.clone();h.applyAxisAngle(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,1,0),r);const u=new three__WEBPACK_IMPORTED_MODULE_0__.Ox3(16777215,3);u.position.copy(h),this.scene.add(u),this.setObject(t),this.render()}}function _defineProperty$h(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}_defineProperty$i(Portrait,"renderer",new three__WEBPACK_IMPORTED_MODULE_0__.CP7({antialias:!1}));const defaultOptions$5={maxWorker:8};class SharedWorkerPool{get isBusy(){return this.available.length<=0}get workingCount(){return this.workers.length-this.available.length}constructor(t,e){void 0===e&&(e=defaultOptions$5),_defineProperty$h(this,"Proto",void 0),_defineProperty$h(this,"options",void 0),_defineProperty$h(this,"queue",void 0),_defineProperty$h(this,"workers",void 0),_defineProperty$h(this,"available",void 0),_defineProperty$h(this,"addJob",void 0),_defineProperty$h(this,"process",void 0),this.Proto=t,this.options=e,this.queue=[],this.workers=[],this.available=[],this.addJob=t=>{this.queue.push(t),this.process()},this.process=()=>{if(0!==this.queue.length&&this.available.length>0){const t=this.available.shift(),e=this.workers[t],{message:i,buffers:o,resolve:n}=this.queue.shift();e.port.postMessage(i,o||[]),SharedWorkerPool.WORKING_COUNT++;const s=i=>{let{data:o}=i;SharedWorkerPool.WORKING_COUNT--,e.port.removeEventListener("message",s),this.available.push(t),n(o),0!==this.queue.length&&this.available.length>0&&setTimeout(this.process,0)};e.port.addEventListener("message",s)}};const{maxWorker:i}=e;for(let o=0;o<i;o++){const e=new t;e.port.start(),this.workers.push(e),this.available.push(o)}}}function _defineProperty$g(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$5(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$g(t,e,i[e])}))}return t}_defineProperty$h(SharedWorkerPool,"WORKING_COUNT",0);const defaultOptions$4={reachDistance:32,ignoreFluids:!0,highlightType:"box",highlightScale:1.002,highlightLerp:1,inverseDirection:!1,highlightColor:new three__WEBPACK_IMPORTED_MODULE_0__.Ilk("white"),highlightOpacity:.1,potentialVisuals:!1};class VoxelInteract extends three__WEBPACK_IMPORTED_MODULE_0__.ZAu{get lookingAt(){return this.target?this.world.getBlockAt(this.target[0],this.target[1],this.target[2]):null}constructor(t,e,i){var o;if(void 0===i&&(i={}),super(),o=this,_defineProperty$g(this,"object",void 0),_defineProperty$g(this,"world",void 0),_defineProperty$g(this,"options",void 0),_defineProperty$g(this,"active",void 0),_defineProperty$g(this,"potential",void 0),_defineProperty$g(this,"target",void 0),_defineProperty$g(this,"newTargetScale",void 0),_defineProperty$g(this,"newTargetPosition",void 0),_defineProperty$g(this,"targetGroup",void 0),_defineProperty$g(this,"potentialGroup",void 0),_defineProperty$g(this,"potentialArrow",void 0),_defineProperty$g(this,"yRotArrow",void 0),_defineProperty$g(this,"toggle",void 0),_defineProperty$g(this,"update",void 0),_defineProperty$g(this,"setup",void 0),this.object=t,this.world=e,this.active=!0,this.potential={voxel:[0,0,0],rotation:PY_ROTATION,yRotation:0},this.target=[0,0,0],this.newTargetScale=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,this.newTargetPosition=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,this.targetGroup=new three__WEBPACK_IMPORTED_MODULE_0__.ZAu,this.potentialGroup=new three__WEBPACK_IMPORTED_MODULE_0__.ZAu,this.toggle=function(t){void 0===t&&(t=null),o.active=null===t?!o.active:t,o.potential=null,o.target=null,o.visible=o.active},this.update=()=>{if(!this.active)return;const{reachDistance:t,highlightScale:e}=this.options;this.targetGroup.scale.lerp(this.newTargetScale,this.options.highlightLerp),this.targetGroup.position.lerp(this.newTargetPosition,this.options.highlightLerp);const i=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,o=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;this.object.getWorldPosition(i),this.object.getWorldDirection(o),o.normalize(),this.options.inverseDirection&&o.multiplyScalar(-1);const n=this.world.raycastVoxels(i.toArray(),o.toArray(),t,{ignoreFluids:this.options.ignoreFluids});if(!n)return this.visible=!1,this.target=null,void(this.potential=null);const{voxel:s,normal:r}=n,[l,a,d]=r,c=ChunkUtils.mapWorldToVoxel(s);if(0===this.world.getVoxelAt(...c))return this.visible=!1,this.target=null,void(this.potential=null);this.visible=!0,this.target=c;const{lookingAt:h}=this;if(h&&this.target){const{isDynamic:t,dynamicFn:i}=h,o=t?i(s).aabbs:h.aabbs;if(!o.length)return;const n=this.world.getVoxelRotationAt(...this.target);let r=n.rotateAABB(o[0]);for(let e=1;e<o.length;e++){const t=n.rotateAABB(o[e]);r=r.union(t)}r.translate(this.target);let{width:l,height:a,depth:d}=r;l*=e,a*=e,d*=e,this.newTargetScale.set(l,a,d),this.newTargetPosition.set(r.minX,r.minY,r.minZ)}const u=[this.target[0]+l,this.target[1]+a,this.target[2]+d],p=0!==l?l>0?PX_ROTATION:NX_ROTATION:0!==a?a>0?PY_ROTATION:NY_ROTATION:0!==d?d>0?PZ_ROTATION:NZ_ROTATION:0,m=(()=>{if(0!==Math.abs(a)){this.yRotArrow.visible=!0;const[t,e,o]=[i.x,i.y,i.z],[n,s,r]=[u[0]+.5,u[1]+.5,u[2]+.5];let l=a>0?Math.atan2(t-n,o-r):Math.atan2(o-r,t-n);a<0&&(l+=Math.PI/2);const d=MathUtils.normalizeAngle(l);let c,h,p=1/0;Y_ROT_MAP.forEach((t=>{let[e,i]=t;Math.abs(d-e)<p&&(p=Math.abs(d-e),c=i,h=e)}));const m=a<0?Math.cos(h-Math.PI/2):Math.sin(h),b=a<0?Math.sin(h-Math.PI/2):Math.cos(h);return this.yRotArrow.setDirection(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(m,0,b).normalize()),c}return this.yRotArrow.visible=!1,0})();this.potential={voxel:u,rotation:p,yRotation:m},this.potential&&(this.potentialGroup.position.set(this.potential.voxel[0]+.5,this.potential.voxel[1]+.5,this.potential.voxel[2]+.5),this.potentialArrow.setDirection(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(l,a,d)))},this.setup=()=>{const{highlightType:t,highlightScale:e,highlightColor:i,highlightOpacity:o}=this.options,n=new three__WEBPACK_IMPORTED_MODULE_0__.vBJ({color:new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(i),opacity:o,transparent:!0});if("outline"===t){const t=.01,i=e,o=new three__WEBPACK_IMPORTED_MODULE_0__.Kj0(new three__WEBPACK_IMPORTED_MODULE_0__.DvJ(i,t,t),n);for(let e=-1;e<=1;e+=2)for(let n=-1;n<=1;n+=2){const s=o.clone();s.position.y=(i-t)/2*e,s.position.z=(i-t)/2*n,this.targetGroup.add(s)}for(let e=-1;e<=1;e+=2)for(let n=-1;n<=1;n+=2){const s=o.clone();s.position.z=(i-t)/2*e,s.position.x=(i-t)/2*n,s.rotation.z=Math.PI/2,this.targetGroup.add(s)}for(let e=-1;e<=1;e+=2)for(let n=-1;n<=1;n+=2){const s=o.clone();s.position.x=(i-t)/2*e,s.position.y=(i-t)/2*n,s.rotation.y=Math.PI/2,this.targetGroup.add(s)}const s=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(.5,.5,.5);this.targetGroup.children.forEach((t=>{t.position.add(s)}))}else{if("box"!==t)throw new Error("Invalid highlight type");{const t=new three__WEBPACK_IMPORTED_MODULE_0__.Kj0(new three__WEBPACK_IMPORTED_MODULE_0__.DvJ(e,e,e),n);t.position.x+=.5,t.position.y+=.5,t.position.z+=.5,this.targetGroup.add(t)}}this.potentialArrow=new Arrow({color:"red"}),this.yRotArrow=new Arrow({color:"green"}),this.potentialGroup.add(this.potentialArrow,this.yRotArrow),this.targetGroup.frustumCulled=!1,this.targetGroup.renderOrder=1e6},!t)throw new Error("VoxelInteract: object is required.");if(!e)throw new Error("VoxelInteract: a world is required to be operated on");const{potentialVisuals:n}=this.options=_objectSpread$5({},defaultOptions$4,i);this.setup(),this.add(this.targetGroup,this.potentialGroup),this.potentialGroup.visible=n}}function _defineProperty$f(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$4(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$f(t,e,i[e])}))}return t}const emptyQ$1=new three__WEBPACK_IMPORTED_MODULE_0__._fP,emptyP=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4,defaultOptions$3={countSelf:!1,updateChildren:!0};class Peers extends three__WEBPACK_IMPORTED_MODULE_0__.ZAu{setOwnPeer(t){this.ownPeer=t,this.add(t)}setOwnUsername(t){this.ownUsername=t}packInfo(){const{x:t,y:e,z:i}=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,0,-1).applyQuaternion(this.object.getWorldQuaternion(emptyQ$1)).normalize(),{x:o,y:n,z:s}=this.object.getWorldPosition(emptyP);return{id:this.ownID,username:this.ownUsername,metadata:{position:[o,n,s],direction:[t,e,i]}}}update(){if(!this.object)return;const t=this.packInfo();if(this.ownPeer&&t&&this.onPeerUpdate(this.ownPeer,t.metadata,{id:t.id,username:t.username}),t){const e={type:"PEER",peers:[t]};this.packets.push(e)}this.options.updateChildren&&this.children.forEach((t=>{t!==this.ownPeer&&t instanceof Character&&t.update()}))}constructor(t,e){void 0===e&&(e={}),super(),_defineProperty$f(this,"object",void 0),_defineProperty$f(this,"options",void 0),_defineProperty$f(this,"ownID",void 0),_defineProperty$f(this,"ownUsername",void 0),_defineProperty$f(this,"ownPeer",void 0),_defineProperty$f(this,"packets",void 0),_defineProperty$f(this,"createPeer",void 0),_defineProperty$f(this,"onPeerJoin",void 0),_defineProperty$f(this,"onPeerUpdate",void 0),_defineProperty$f(this,"onPeerLeave",void 0),_defineProperty$f(this,"onMessage",void 0),_defineProperty$f(this,"getPeerById",void 0),this.object=t,this.ownID="",this.ownUsername="",this.packets=[],this.onMessage=(t,e)=>{let{username:i}=e;this.ownUsername=i;const o=t=>{const e=this.createPeer(t);return e.name=t,this.add(e),e};switch(t.type){case"INIT":{const{id:e}=t.json;this.ownID=e;break}case"JOIN":{var n;const{text:e}=t;if(!(this.options.countSelf||this.ownID&&this.ownID!==e))return;if(!this.createPeer)return void console.warn("Peers.createPeer is not defined, skipping peer join.");if(this.getObjectByName(e))break;o(e),null===(n=this.onPeerJoin)||void 0===n||n.call(this,e);break}case"LEAVE":{var s;const{text:e}=t,i=this.getObjectByName(e);i&&this.remove(i),null===(s=this.onPeerLeave)||void 0===s||s.call(this,e);break}}const{peers:r}=t;r&&r.forEach((e=>{var i;if(!(this.options.countSelf||this.ownID&&e.id!==this.ownID))return;"INIT"===t.type&&(null===(i=this.onPeerJoin)||void 0===i||i.call(this,e.id));let n=this.getObjectByName(e.id);n||(n=o(e.id)),this.onPeerUpdate?this.onPeerUpdate(n,e.metadata,{id:e.id,username:e.username}):console.warn("Peers.onPeerUpdate is not defined, skipping peer update.")}))},this.getPeerById=t=>this.getObjectByName(t),this.options=_objectSpread$4({},defaultOptions$3,e)}}var indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(t,e){for(var i=new Array(arguments.length-1),o=0,n=2,s=!0;n<arguments.length;)i[o++]=arguments[n++];return new Promise((function(n,r){i[o]=function(t){if(s)if(s=!1,t)r(t);else{for(var e=new Array(arguments.length-1),i=0;i<e.length;)e[i++]=arguments[i];n.apply(null,e)}};try{t.apply(e||null,i)}catch(t){s&&(s=!1,r(t))}}))}var base64$1={};!function(t){var e=base64$1;e.length=function(t){var e=t.length;if(!e)return 0;for(var i=0;--e%4>1&&"="===t.charAt(e);)++i;return Math.ceil(3*t.length)/4-i};for(var i=new Array(64),o=new Array(123),n=0;n<64;)o[i[n]=n<26?n+65:n<52?n+71:n<62?n-4:n-59|43]=n++;e.encode=function(t,e,o){for(var n,s=null,r=[],l=0,a=0;e<o;){var d=t[e++];switch(a){case 0:r[l++]=i[d>>2],n=(3&d)<<4,a=1;break;case 1:r[l++]=i[n|d>>4],n=(15&d)<<2,a=2;break;case 2:r[l++]=i[n|d>>6],r[l++]=i[63&d],a=0}l>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,r)),l=0)}return a&&(r[l++]=i[n],r[l++]=61,1===a&&(r[l++]=61)),s?(l&&s.push(String.fromCharCode.apply(String,r.slice(0,l))),s.join("")):String.fromCharCode.apply(String,r.slice(0,l))};var s="invalid encoding";e.decode=function(t,e,i){for(var n,r=i,l=0,a=0;a<t.length;){var d=t.charCodeAt(a++);if(61===d&&l>1)break;if(void 0===(d=o[d]))throw Error(s);switch(l){case 0:n=d,l=1;break;case 1:e[i++]=n<<2|(48&d)>>4,n=d,l=2;break;case 2:e[i++]=(15&n)<<4|(60&d)>>2,n=d,l=3;break;case 3:e[i++]=(3&n)<<6|d,l=0}}if(1===l)throw Error(s);return i-r},e.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}}();var eventemitter=EventEmitter$1;function EventEmitter$1(){this._listeners={}}EventEmitter$1.prototype.on=function(t,e,i){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:i||this}),this},EventEmitter$1.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var i=this._listeners[t],o=0;o<i.length;)i[o].fn===e?i.splice(o,1):++o;return this},EventEmitter$1.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var i=[],o=1;o<arguments.length;)i.push(arguments[o++]);for(o=0;o<e.length;)e[o].fn.apply(e[o++].ctx,i)}return this};var float=factory(factory);function factory(t){return"undefined"!=typeof Float32Array?function(){var e=new Float32Array([-0]),i=new Uint8Array(e.buffer),o=128===i[3];function n(t,o,n){e[0]=t,o[n]=i[0],o[n+1]=i[1],o[n+2]=i[2],o[n+3]=i[3]}function s(t,o,n){e[0]=t,o[n]=i[3],o[n+1]=i[2],o[n+2]=i[1],o[n+3]=i[0]}function r(t,o){return i[0]=t[o],i[1]=t[o+1],i[2]=t[o+2],i[3]=t[o+3],e[0]}function l(t,o){return i[3]=t[o],i[2]=t[o+1],i[1]=t[o+2],i[0]=t[o+3],e[0]}t.writeFloatLE=o?n:s,t.writeFloatBE=o?s:n,t.readFloatLE=o?r:l,t.readFloatBE=o?l:r}():function(){function e(t,e,i,o){var n=e<0?1:0;if(n&&(e=-e),0===e)t(1/e>0?0:2147483648,i,o);else if(isNaN(e))t(2143289344,i,o);else if(e>34028234663852886e22)t((n<<31|2139095040)>>>0,i,o);else if(e<11754943508222875e-54)t((n<<31|Math.round(e/1401298464324817e-60))>>>0,i,o);else{var s=Math.floor(Math.log(e)/Math.LN2);t((n<<31|s+127<<23|8388607&Math.round(e*Math.pow(2,-s)*8388608))>>>0,i,o)}}function i(t,e,i){var o=t(e,i),n=2*(o>>31)+1,s=o>>>23&255,r=8388607&o;return 255===s?r?NaN:n*(1/0):0===s?1401298464324817e-60*n*r:n*Math.pow(2,s-150)*(r+8388608)}t.writeFloatLE=e.bind(null,writeUintLE),t.writeFloatBE=e.bind(null,writeUintBE),t.readFloatLE=i.bind(null,readUintLE),t.readFloatBE=i.bind(null,readUintBE)}(),"undefined"!=typeof Float64Array?function(){var e=new Float64Array([-0]),i=new Uint8Array(e.buffer),o=128===i[7];function n(t,o,n){e[0]=t,o[n]=i[0],o[n+1]=i[1],o[n+2]=i[2],o[n+3]=i[3],o[n+4]=i[4],o[n+5]=i[5],o[n+6]=i[6],o[n+7]=i[7]}function s(t,o,n){e[0]=t,o[n]=i[7],o[n+1]=i[6],o[n+2]=i[5],o[n+3]=i[4],o[n+4]=i[3],o[n+5]=i[2],o[n+6]=i[1],o[n+7]=i[0]}function r(t,o){return i[0]=t[o],i[1]=t[o+1],i[2]=t[o+2],i[3]=t[o+3],i[4]=t[o+4],i[5]=t[o+5],i[6]=t[o+6],i[7]=t[o+7],e[0]}function l(t,o){return i[7]=t[o],i[6]=t[o+1],i[5]=t[o+2],i[4]=t[o+3],i[3]=t[o+4],i[2]=t[o+5],i[1]=t[o+6],i[0]=t[o+7],e[0]}t.writeDoubleLE=o?n:s,t.writeDoubleBE=o?s:n,t.readDoubleLE=o?r:l,t.readDoubleBE=o?l:r}():function(){function e(t,e,i,o,n,s){var r=o<0?1:0;if(r&&(o=-o),0===o)t(0,n,s+e),t(1/o>0?0:2147483648,n,s+i);else if(isNaN(o))t(0,n,s+e),t(2146959360,n,s+i);else if(o>17976931348623157e292)t(0,n,s+e),t((r<<31|2146435072)>>>0,n,s+i);else{var l;if(o<22250738585072014e-324)t((l=o/5e-324)>>>0,n,s+e),t((r<<31|l/4294967296)>>>0,n,s+i);else{var a=Math.floor(Math.log(o)/Math.LN2);1024===a&&(a=1023),t(4503599627370496*(l=o*Math.pow(2,-a))>>>0,n,s+e),t((r<<31|a+1023<<20|1048576*l&1048575)>>>0,n,s+i)}}}function i(t,e,i,o,n){var s=t(o,n+e),r=t(o,n+i),l=2*(r>>31)+1,a=r>>>20&2047,d=4294967296*(1048575&r)+s;return 2047===a?d?NaN:l*(1/0):0===a?5e-324*l*d:l*Math.pow(2,a-1075)*(d+4503599627370496)}t.writeDoubleLE=e.bind(null,writeUintLE,0,4),t.writeDoubleBE=e.bind(null,writeUintBE,4,0),t.readDoubleLE=i.bind(null,readUintLE,0,4),t.readDoubleBE=i.bind(null,readUintBE,4,0)}(),t}function writeUintLE(t,e,i){e[i]=255&t,e[i+1]=t>>>8&255,e[i+2]=t>>>16&255,e[i+3]=t>>>24}function writeUintBE(t,e,i){e[i]=t>>>24,e[i+1]=t>>>16&255,e[i+2]=t>>>8&255,e[i+3]=255&t}function readUintLE(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function readUintBE(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}var utf8$2={},e;e=utf8$2,e.length=function(t){for(var e=0,i=0,o=0;o<t.length;++o)(i=t.charCodeAt(o))<128?e+=1:i<2048?e+=2:55296==(64512&i)&&56320==(64512&t.charCodeAt(o+1))?(++o,e+=4):e+=3;return e},e.read=function(t,e,i){if(i-e<1)return"";for(var o,n=null,s=[],r=0;e<i;)(o=t[e++])<128?s[r++]=o:o>191&&o<224?s[r++]=(31&o)<<6|63&t[e++]:o>239&&o<365?(o=((7&o)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,s[r++]=55296+(o>>10),s[r++]=56320+(1023&o)):s[r++]=(15&o)<<12|(63&t[e++])<<6|63&t[e++],r>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,s)),r=0);return n?(r&&n.push(String.fromCharCode.apply(String,s.slice(0,r))),n.join("")):String.fromCharCode.apply(String,s.slice(0,r))},e.write=function(t,e,i){for(var o,n,s=i,r=0;r<t.length;++r)(o=t.charCodeAt(r))<128?e[i++]=o:o<2048?(e[i++]=o>>6|192,e[i++]=63&o|128):55296==(64512&o)&&56320==(64512&(n=t.charCodeAt(r+1)))?(o=65536+((1023&o)<<10)+(1023&n),++r,e[i++]=o>>18|240,e[i++]=o>>12&63|128,e[i++]=o>>6&63|128,e[i++]=63&o|128):(e[i++]=o>>12|224,e[i++]=o>>6&63|128,e[i++]=63&o|128);return i-s};var pool_1=pool;function pool(t,e,i){var o=i||8192,n=o>>>1,s=null,r=o;return function(i){if(i<1||i>n)return t(i);r+i>o&&(s=t(o),r=0);var l=e.call(s,r,r+=i);return 7&r&&(r=1+(7|r)),l}}var longbits=LongBits$2,util$5=minimal$1;function LongBits$2(t,e){this.lo=t>>>0,this.hi=e>>>0}var zero=LongBits$2.zero=new LongBits$2(0,0);zero.toNumber=function(){return 0},zero.zzEncode=zero.zzDecode=function(){return this},zero.length=function(){return 1};var zeroHash=LongBits$2.zeroHash="\0\0\0\0\0\0\0\0";LongBits$2.fromNumber=function(t){if(0===t)return zero;var e=t<0;e&&(t=-t);var i=t>>>0,o=(t-i)/4294967296>>>0;return e&&(o=~o>>>0,i=~i>>>0,++i>4294967295&&(i=0,++o>4294967295&&(o=0))),new LongBits$2(i,o)},LongBits$2.from=function(t){if("number"==typeof t)return LongBits$2.fromNumber(t);if(util$5.isString(t)){if(!util$5.Long)return LongBits$2.fromNumber(parseInt(t,10));t=util$5.Long.fromString(t)}return t.low||t.high?new LongBits$2(t.low>>>0,t.high>>>0):zero},LongBits$2.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,i=~this.hi>>>0;return e||(i=i+1>>>0),-(e+4294967296*i)}return this.lo+4294967296*this.hi},LongBits$2.prototype.toLong=function(t){return util$5.Long?new util$5.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var charCodeAt=String.prototype.charCodeAt;LongBits$2.fromHash=function(t){return t===zeroHash?zero:new LongBits$2((charCodeAt.call(t,0)|charCodeAt.call(t,1)<<8|charCodeAt.call(t,2)<<16|charCodeAt.call(t,3)<<24)>>>0,(charCodeAt.call(t,4)|charCodeAt.call(t,5)<<8|charCodeAt.call(t,6)<<16|charCodeAt.call(t,7)<<24)>>>0)},LongBits$2.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},LongBits$2.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},LongBits$2.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},LongBits$2.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return 0===i?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:i<128?9:10},function(t){var e=minimal$1;function i(t,e,i){for(var o=Object.keys(e),n=0;n<o.length;++n)void 0!==t[o[n]]&&i||(t[o[n]]=e[o[n]]);return t}function o(t){function e(t,o){if(!(this instanceof e))return new e(t,o);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),o&&i(this,o)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return t},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}e.asPromise=aspromise,e.base64=base64$1,e.EventEmitter=eventemitter,e.float=float,e.inquire=inquire_1,e.utf8=utf8$2,e.pool=pool_1,e.LongBits=longbits,e.isNode=Boolean(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),e.global=e.isNode&&commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||commonjsGlobal,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},e.isString=function(t){return"string"==typeof t||t instanceof String},e.isObject=function(t){return t&&"object"==typeof t},e.isset=e.isSet=function(t,e){var i=t[e];return!(null==i||!t.hasOwnProperty(e))&&("object"!=typeof i||(Array.isArray(i)?i.length:Object.keys(i).length)>0)},e.Buffer=function(){try{var t=e.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(t){return"number"==typeof t?e.Buffer?e._Buffer_allocUnsafe(t):new e.Array(t):e.Buffer?e._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},e.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(t){return t?e.LongBits.from(t).toHash():e.LongBits.zeroHash},e.longFromHash=function(t,i){var o=e.LongBits.fromHash(t);return e.Long?e.Long.fromBits(o.lo,o.hi,i):o.toNumber(Boolean(i))},e.merge=i,e.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},e.newError=o,e.ProtocolError=o("ProtocolError"),e.oneOfGetter=function(t){for(var e={},i=0;i<t.length;++i)e[t[i]]=1;return function(){for(var t=Object.keys(this),i=t.length-1;i>-1;--i)if(1===e[t[i]]&&void 0!==this[t[i]]&&null!==this[t[i]])return t[i]}},e.oneOfSetter=function(t){return function(e){for(var i=0;i<t.length;++i)t[i]!==e&&delete this[t[i]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var t=e.Buffer;t?(e._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,i){return new t(e,i)},e._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):e._Buffer_from=e._Buffer_allocUnsafe=null}}();var writer=Writer$1,util$4=minimal$1,BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(t,e,i){this.fn=t,this.len=e,this.next=void 0,this.val=i}function noop(){}function State(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};function writeByte(t,e,i){e[i]=255&t}function writeVarint32(t,e,i){for(;t>127;)e[i++]=127&t|128,t>>>=7;e[i]=t}function VarintOp(t,e){this.len=t,this.next=void 0,this.val=e}function writeVarint64(t,e,i){for(;t.hi;)e[i++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[i++]=127&t.lo|128,t.lo=t.lo>>>7;e[i++]=t.lo}function writeFixed32(t,e,i){e[i]=255&t,e[i+1]=t>>>8&255,e[i+2]=t>>>16&255,e[i+3]=t>>>24}Writer$1.create=create$1(),Writer$1.alloc=function(t){return new util$4.Array(t)},util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray)),Writer$1.prototype._push=function(t,e,i){return this.tail=this.tail.next=new Op(t,e,i),this.len+=e,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new VarintOp((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},Writer$1.prototype.int32=function(t){return t<0?this._push(writeVarint64,10,LongBits$1.fromNumber(t)):this.uint32(t)},Writer$1.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},Writer$1.prototype.uint64=function(t){var e=LongBits$1.from(t);return this._push(writeVarint64,e.length(),e)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function(t){var e=LongBits$1.from(t).zzEncode();return this._push(writeVarint64,e.length(),e)},Writer$1.prototype.bool=function(t){return this._push(writeByte,1,t?1:0)},Writer$1.prototype.fixed32=function(t){return this._push(writeFixed32,4,t>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function(t){var e=LongBits$1.from(t);return this._push(writeFixed32,4,e.lo)._push(writeFixed32,4,e.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function(t){return this._push(util$4.float.writeFloatLE,4,t)},Writer$1.prototype.double=function(t){return this._push(util$4.float.writeDoubleLE,8,t)};var writeBytes=util$4.Array.prototype.set?function(t,e,i){e.set(t,i)}:function(t,e,i){for(var o=0;o<t.length;++o)e[i+o]=t[o]};Writer$1.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(writeByte,1,0);if(util$4.isString(t)){var i=Writer$1.alloc(e=base64.length(t));base64.decode(t,i,0),t=i}return this.uint32(e)._push(writeBytes,e,t)},Writer$1.prototype.string=function(t){var e=utf8$1.length(t);return e?this.uint32(e)._push(utf8$1.write,e,t):this._push(writeByte,1,0)},Writer$1.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function(){var t=this.head,e=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=t.next,this.tail=e,this.len+=i),this},Writer$1.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),i=0;t;)t.fn(t.val,e,i),i+=t.len,t=t.next;return e},Writer$1._configure=function(t){BufferWriter$1=t,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=minimal$1;function BufferWriter(){Writer.call(this)}function writeStringBuffer(t,e,i){t.length<40?util$3.utf8.write(t,e,i):e.utf8Write?e.utf8Write(t,i):e.write(t,i)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&"set"===util$3.Buffer.prototype.set.name?function(t,e,i){e.set(t,i)}:function(t,e,i){if(t.copy)t.copy(e,i,0,t.length);else for(var o=0;o<t.length;)e[i++]=t[o++]}},BufferWriter.prototype.bytes=function(t){util$3.isString(t)&&(t=util$3._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(BufferWriter.writeBytesBuffer,e,t),this},BufferWriter.prototype.string=function(t){var e=util$3.Buffer.byteLength(t);return this.uint32(e),e&&this._push(writeStringBuffer,e,t),this},BufferWriter._configure();var reader=Reader$1,util$2=minimal$1,BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function Reader$1(t){this.buf=t,this.pos=0,this.len=t.length}var create_array="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")},create=function(){return util$2.Buffer?function(t){return(Reader$1.create=function(t){return util$2.Buffer.isBuffer(t)?new BufferReader$1(t):create_array(t)})(t)}:create_array},value;function readLongVarint(){var t=new LongBits(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw indexOutOfRange(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw indexOutOfRange(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function readFixed32_end(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.create=create(),Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice,Reader$1.prototype.uint32=(value=4294967295,function(){if(value=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return value;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return value}),Reader$1.prototype.int32=function(){return 0|this.uint32()},Reader$1.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},Reader$1.prototype.bool=function(){return 0!==this.uint32()},Reader$1.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},Reader$1.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},Reader$1.prototype.bytes=function(){var t=this.uint32(),e=this.pos,i=this.pos+t;if(i>this.len)throw indexOutOfRange(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,i):e===i?new this.buf.constructor(0):this._slice.call(this.buf,e,i)},Reader$1.prototype.string=function(){var t=this.bytes();return utf8.read(t,0,t.length)},Reader$1.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw indexOutOfRange(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader$1.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},Reader$1._configure=function(t){BufferReader$1=t,Reader$1.create=create(),BufferReader$1._configure();var e=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[e](!1)},uint64:function(){return readLongVarint.call(this)[e](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[e](!1)},fixed64:function(){return readFixed64.call(this)[e](!0)},sfixed64:function(){return readFixed64.call(this)[e](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=minimal$1;function BufferReader(t){Reader.call(this,t)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)},BufferReader.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},BufferReader._configure();var rpc={},service=Service,util=minimal$1,exports;function Service(t,e,i){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(i)}(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function t(e,i,o,n,s){if(!n)throw TypeError("request must be specified");var r=this;if(!s)return util.asPromise(t,r,e,i,o,n);if(r.rpcImpl)try{return r.rpcImpl(e,i[r.requestDelimited?"encodeDelimited":"encode"](n).finish(),(function(t,i){if(t)return r.emit("error",t,e),s(t);if(null!==i){if(!(i instanceof o))try{i=o[r.responseDelimited?"decodeDelimited":"decode"](i)}catch(t){return r.emit("error",t,e),s(t)}return r.emit("data",i,e),s(null,i)}r.end(!0)}))}catch(t){return r.emit("error",t,e),void setTimeout((function(){s(t)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},Service.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},exports=rpc,exports.Service=service;var roots={};!function(t){var e=indexMinimal;function i(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}e.build="minimal",e.Writer=writer,e.BufferWriter=writer_buffer,e.Reader=reader,e.BufferReader=reader_buffer,e.util=minimal$1,e.rpc=rpc,e.roots=roots,e.configure=i,i()}();var minimal=indexMinimal,$protobuf=minimal,$Reader=$protobuf.Reader,$Writer=$protobuf.Writer,$util=$protobuf.util,$root=$protobuf.roots.default||($protobuf.roots.default={}),t;$root.protocol=(t={},t.Geometry=function(){function t(t){if(this.positions=[],this.uvs=[],this.indices=[],this.lights=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}var e;return t.prototype.voxel=0,t.prototype.faceName=null,t.prototype.positions=$util.emptyArray,t.prototype.uvs=$util.emptyArray,t.prototype.indices=$util.emptyArray,t.prototype.lights=$util.emptyArray,Object.defineProperty(t.prototype,"_faceName",{get:$util.oneOfGetter(e=["faceName"]),set:$util.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=$Writer.create()),null!=t.voxel&&Object.hasOwnProperty.call(t,"voxel")&&e.uint32(8).uint32(t.voxel),null!=t.faceName&&Object.hasOwnProperty.call(t,"faceName")&&e.uint32(18).string(t.faceName),null!=t.positions&&t.positions.length){e.uint32(26).fork();for(var i=0;i<t.positions.length;++i)e.float(t.positions[i]);e.ldelim()}if(null!=t.uvs&&t.uvs.length){for(e.uint32(34).fork(),i=0;i<t.uvs.length;++i)e.float(t.uvs[i]);e.ldelim()}if(null!=t.indices&&t.indices.length){for(e.uint32(42).fork(),i=0;i<t.indices.length;++i)e.int32(t.indices[i]);e.ldelim()}if(null!=t.lights&&t.lights.length){for(e.uint32(50).fork(),i=0;i<t.lights.length;++i)e.int32(t.lights[i]);e.ldelim()}return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof $Reader||(t=$Reader.create(t));for(var i=void 0===e?t.len:t.pos+e,o=new $root.protocol.Geometry;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:o.voxel=t.uint32();break;case 2:o.faceName=t.string();break;case 3:if(o.positions&&o.positions.length||(o.positions=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)o.positions.push(t.float());else o.positions.push(t.float());break;case 4:if(o.uvs&&o.uvs.length||(o.uvs=[]),2==(7&n))for(s=t.uint32()+t.pos;t.pos<s;)o.uvs.push(t.float());else o.uvs.push(t.float());break;case 5:if(o.indices&&o.indices.length||(o.indices=[]),2==(7&n))for(s=t.uint32()+t.pos;t.pos<s;)o.indices.push(t.int32());else o.indices.push(t.int32());break;case 6:if(o.lights&&o.lights.length||(o.lights=[]),2==(7&n))for(s=t.uint32()+t.pos;t.pos<s;)o.lights.push(t.int32());else o.lights.push(t.int32());break;default:t.skipType(7&n)}}return o},t.decodeDelimited=function(t){return t instanceof $Reader||(t=new $Reader(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.voxel&&t.hasOwnProperty("voxel")&&!$util.isInteger(t.voxel))return"voxel: integer expected";if(null!=t.faceName&&t.hasOwnProperty("faceName")&&!$util.isString(t.faceName))return"faceName: string expected";if(null!=t.positions&&t.hasOwnProperty("positions")){if(!Array.isArray(t.positions))return"positions: array expected";for(var e=0;e<t.positions.length;++e)if("number"!=typeof t.positions[e])return"positions: number[] expected"}if(null!=t.uvs&&t.hasOwnProperty("uvs")){if(!Array.isArray(t.uvs))return"uvs: array expected";for(e=0;e<t.uvs.length;++e)if("number"!=typeof t.uvs[e])return"uvs: number[] expected"}if(null!=t.indices&&t.hasOwnProperty("indices")){if(!Array.isArray(t.indices))return"indices: array expected";for(e=0;e<t.indices.length;++e)if(!$util.isInteger(t.indices[e]))return"indices: integer[] expected"}if(null!=t.lights&&t.hasOwnProperty("lights")){if(!Array.isArray(t.lights))return"lights: array expected";for(e=0;e<t.lights.length;++e)if(!$util.isInteger(t.lights[e]))return"lights: integer[] expected"}return null},t.fromObject=function(t){if(t instanceof $root.protocol.Geometry)return t;var e=new $root.protocol.Geometry;if(null!=t.voxel&&(e.voxel=t.voxel>>>0),null!=t.faceName&&(e.faceName=String(t.faceName)),t.positions){if(!Array.isArray(t.positions))throw TypeError(".protocol.Geometry.positions: array expected");e.positions=[];for(var i=0;i<t.positions.length;++i)e.positions[i]=Number(t.positions[i])}if(t.uvs){if(!Array.isArray(t.uvs))throw TypeError(".protocol.Geometry.uvs: array expected");for(e.uvs=[],i=0;i<t.uvs.length;++i)e.uvs[i]=Number(t.uvs[i])}if(t.indices){if(!Array.isArray(t.indices))throw TypeError(".protocol.Geometry.indices: array expected");for(e.indices=[],i=0;i<t.indices.length;++i)e.indices[i]=0|t.indices[i]}if(t.lights){if(!Array.isArray(t.lights))throw TypeError(".protocol.Geometry.lights: array expected");for(e.lights=[],i=0;i<t.lights.length;++i)e.lights[i]=0|t.lights[i]}return e},t.toObject=function(t,e){e||(e={});var i={};if((e.arrays||e.defaults)&&(i.positions=[],i.uvs=[],i.indices=[],i.lights=[]),e.defaults&&(i.voxel=0),null!=t.voxel&&t.hasOwnProperty("voxel")&&(i.voxel=t.voxel),null!=t.faceName&&t.hasOwnProperty("faceName")&&(i.faceName=t.faceName,e.oneofs&&(i._faceName="faceName")),t.positions&&t.positions.length){i.positions=[];for(var o=0;o<t.positions.length;++o)i.positions[o]=e.json&&!isFinite(t.positions[o])?String(t.positions[o]):t.positions[o]}if(t.uvs&&t.uvs.length)for(i.uvs=[],o=0;o<t.uvs.length;++o)i.uvs[o]=e.json&&!isFinite(t.uvs[o])?String(t.uvs[o]):t.uvs[o];if(t.indices&&t.indices.length)for(i.indices=[],o=0;o<t.indices.length;++o)i.indices[o]=t.indices[o];if(t.lights&&t.lights.length)for(i.lights=[],o=0;o<t.lights.length;++o)i.lights[o]=t.lights[o];return i},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/protocol.Geometry"},t}(),t.Mesh=function(){function t(t){if(this.geometries=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.level=0,t.prototype.geometries=$util.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=$Writer.create()),null!=t.level&&Object.hasOwnProperty.call(t,"level")&&e.uint32(8).int32(t.level),null!=t.geometries&&t.geometries.length)for(var i=0;i<t.geometries.length;++i)$root.protocol.Geometry.encode(t.geometries[i],e.uint32(18).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof $Reader||(t=$Reader.create(t));for(var i=void 0===e?t.len:t.pos+e,o=new $root.protocol.Mesh;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:o.level=t.int32();break;case 2:o.geometries&&o.geometries.length||(o.geometries=[]),o.geometries.push($root.protocol.Geometry.decode(t,t.uint32()));break;default:t.skipType(7&n)}}return o},t.decodeDelimited=function(t){return t instanceof $Reader||(t=new $Reader(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.level&&t.hasOwnProperty("level")&&!$util.isInteger(t.level))return"level: integer expected";if(null!=t.geometries&&t.hasOwnProperty("geometries")){if(!Array.isArray(t.geometries))return"geometries: array expected";for(var e=0;e<t.geometries.length;++e){var i=$root.protocol.Geometry.verify(t.geometries[e]);if(i)return"geometries."+i}}return null},t.fromObject=function(t){if(t instanceof $root.protocol.Mesh)return t;var e=new $root.protocol.Mesh;if(null!=t.level&&(e.level=0|t.level),t.geometries){if(!Array.isArray(t.geometries))throw TypeError(".protocol.Mesh.geometries: array expected");e.geometries=[];for(var i=0;i<t.geometries.length;++i){if("object"!=typeof t.geometries[i])throw TypeError(".protocol.Mesh.geometries: object expected");e.geometries[i]=$root.protocol.Geometry.fromObject(t.geometries[i])}}return e},t.toObject=function(t,e){e||(e={});var i={};if((e.arrays||e.defaults)&&(i.geometries=[]),e.defaults&&(i.level=0),null!=t.level&&t.hasOwnProperty("level")&&(i.level=t.level),t.geometries&&t.geometries.length){i.geometries=[];for(var o=0;o<t.geometries.length;++o)i.geometries[o]=$root.protocol.Geometry.toObject(t.geometries[o],e)}return i},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/protocol.Mesh"},t}(),t.Chunk=function(){function t(t){if(this.meshes=[],this.voxels=[],this.lights=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.x=0,t.prototype.z=0,t.prototype.id="",t.prototype.meshes=$util.emptyArray,t.prototype.voxels=$util.emptyArray,t.prototype.lights=$util.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=$Writer.create()),null!=t.x&&Object.hasOwnProperty.call(t,"x")&&e.uint32(8).int32(t.x),null!=t.z&&Object.hasOwnProperty.call(t,"z")&&e.uint32(16).int32(t.z),null!=t.id&&Object.hasOwnProperty.call(t,"id")&&e.uint32(26).string(t.id),null!=t.meshes&&t.meshes.length)for(var i=0;i<t.meshes.length;++i)$root.protocol.Mesh.encode(t.meshes[i],e.uint32(34).fork()).ldelim();if(null!=t.voxels&&t.voxels.length){for(e.uint32(42).fork(),i=0;i<t.voxels.length;++i)e.uint32(t.voxels[i]);e.ldelim()}if(null!=t.lights&&t.lights.length){for(e.uint32(50).fork(),i=0;i<t.lights.length;++i)e.uint32(t.lights[i]);e.ldelim()}return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof $Reader||(t=$Reader.create(t));for(var i=void 0===e?t.len:t.pos+e,o=new $root.protocol.Chunk;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:o.x=t.int32();break;case 2:o.z=t.int32();break;case 3:o.id=t.string();break;case 4:o.meshes&&o.meshes.length||(o.meshes=[]),o.meshes.push($root.protocol.Mesh.decode(t,t.uint32()));break;case 5:if(o.voxels&&o.voxels.length||(o.voxels=[]),2==(7&n))for(var s=t.uint32()+t.pos;t.pos<s;)o.voxels.push(t.uint32());else o.voxels.push(t.uint32());break;case 6:if(o.lights&&o.lights.length||(o.lights=[]),2==(7&n))for(s=t.uint32()+t.pos;t.pos<s;)o.lights.push(t.uint32());else o.lights.push(t.uint32());break;default:t.skipType(7&n)}}return o},t.decodeDelimited=function(t){return t instanceof $Reader||(t=new $Reader(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.x&&t.hasOwnProperty("x")&&!$util.isInteger(t.x))return"x: integer expected";if(null!=t.z&&t.hasOwnProperty("z")&&!$util.isInteger(t.z))return"z: integer expected";if(null!=t.id&&t.hasOwnProperty("id")&&!$util.isString(t.id))return"id: string expected";if(null!=t.meshes&&t.hasOwnProperty("meshes")){if(!Array.isArray(t.meshes))return"meshes: array expected";for(var e=0;e<t.meshes.length;++e){var i=$root.protocol.Mesh.verify(t.meshes[e]);if(i)return"meshes."+i}}if(null!=t.voxels&&t.hasOwnProperty("voxels")){if(!Array.isArray(t.voxels))return"voxels: array expected";for(e=0;e<t.voxels.length;++e)if(!$util.isInteger(t.voxels[e]))return"voxels: integer[] expected"}if(null!=t.lights&&t.hasOwnProperty("lights")){if(!Array.isArray(t.lights))return"lights: array expected";for(e=0;e<t.lights.length;++e)if(!$util.isInteger(t.lights[e]))return"lights: integer[] expected"}return null},t.fromObject=function(t){if(t instanceof $root.protocol.Chunk)return t;var e=new $root.protocol.Chunk;if(null!=t.x&&(e.x=0|t.x),null!=t.z&&(e.z=0|t.z),null!=t.id&&(e.id=String(t.id)),t.meshes){if(!Array.isArray(t.meshes))throw TypeError(".protocol.Chunk.meshes: array expected");e.meshes=[];for(var i=0;i<t.meshes.length;++i){if("object"!=typeof t.meshes[i])throw TypeError(".protocol.Chunk.meshes: object expected");e.meshes[i]=$root.protocol.Mesh.fromObject(t.meshes[i])}}if(t.voxels){if(!Array.isArray(t.voxels))throw TypeError(".protocol.Chunk.voxels: array expected");for(e.voxels=[],i=0;i<t.voxels.length;++i)e.voxels[i]=t.voxels[i]>>>0}if(t.lights){if(!Array.isArray(t.lights))throw TypeError(".protocol.Chunk.lights: array expected");for(e.lights=[],i=0;i<t.lights.length;++i)e.lights[i]=t.lights[i]>>>0}return e},t.toObject=function(t,e){e||(e={});var i={};if((e.arrays||e.defaults)&&(i.meshes=[],i.voxels=[],i.lights=[]),e.defaults&&(i.x=0,i.z=0,i.id=""),null!=t.x&&t.hasOwnProperty("x")&&(i.x=t.x),null!=t.z&&t.hasOwnProperty("z")&&(i.z=t.z),null!=t.id&&t.hasOwnProperty("id")&&(i.id=t.id),t.meshes&&t.meshes.length){i.meshes=[];for(var o=0;o<t.meshes.length;++o)i.meshes[o]=$root.protocol.Mesh.toObject(t.meshes[o],e)}if(t.voxels&&t.voxels.length)for(i.voxels=[],o=0;o<t.voxels.length;++o)i.voxels[o]=t.voxels[o];if(t.lights&&t.lights.length)for(i.lights=[],o=0;o<t.lights.length;++o)i.lights[o]=t.lights[o];return i},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/protocol.Chunk"},t}(),t.Peer=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.id="",t.prototype.username="",t.prototype.metadata="",t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=$Writer.create()),null!=t.id&&Object.hasOwnProperty.call(t,"id")&&e.uint32(10).string(t.id),null!=t.username&&Object.hasOwnProperty.call(t,"username")&&e.uint32(18).string(t.username),null!=t.metadata&&Object.hasOwnProperty.call(t,"metadata")&&e.uint32(26).string(t.metadata),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof $Reader||(t=$Reader.create(t));for(var i=void 0===e?t.len:t.pos+e,o=new $root.protocol.Peer;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:o.id=t.string();break;case 2:o.username=t.string();break;case 3:o.metadata=t.string();break;default:t.skipType(7&n)}}return o},t.decodeDelimited=function(t){return t instanceof $Reader||(t=new $Reader(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.id&&t.hasOwnProperty("id")&&!$util.isString(t.id)?"id: string expected":null!=t.username&&t.hasOwnProperty("username")&&!$util.isString(t.username)?"username: string expected":null!=t.metadata&&t.hasOwnProperty("metadata")&&!$util.isString(t.metadata)?"metadata: string expected":null},t.fromObject=function(t){if(t instanceof $root.protocol.Peer)return t;var e=new $root.protocol.Peer;return null!=t.id&&(e.id=String(t.id)),null!=t.username&&(e.username=String(t.username)),null!=t.metadata&&(e.metadata=String(t.metadata)),e},t.toObject=function(t,e){e||(e={});var i={};return e.defaults&&(i.id="",i.username="",i.metadata=""),null!=t.id&&t.hasOwnProperty("id")&&(i.id=t.id),null!=t.username&&t.hasOwnProperty("username")&&(i.username=t.username),null!=t.metadata&&t.hasOwnProperty("metadata")&&(i.metadata=t.metadata),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/protocol.Peer"},t}(),t.Entity=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}var e,i;return t.prototype.operation=0,t.prototype.id="",t.prototype.type="",t.prototype.metadata="",t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=$Writer.create()),null!=t.operation&&Object.hasOwnProperty.call(t,"operation")&&e.uint32(8).int32(t.operation),null!=t.id&&Object.hasOwnProperty.call(t,"id")&&e.uint32(18).string(t.id),null!=t.type&&Object.hasOwnProperty.call(t,"type")&&e.uint32(26).string(t.type),null!=t.metadata&&Object.hasOwnProperty.call(t,"metadata")&&e.uint32(34).string(t.metadata),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof $Reader||(t=$Reader.create(t));for(var i=void 0===e?t.len:t.pos+e,o=new $root.protocol.Entity;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:o.operation=t.int32();break;case 2:o.id=t.string();break;case 3:o.type=t.string();break;case 4:o.metadata=t.string();break;default:t.skipType(7&n)}}return o},t.decodeDelimited=function(t){return t instanceof $Reader||(t=new $Reader(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.operation&&t.hasOwnProperty("operation"))switch(t.operation){default:return"operation: enum value expected";case 0:case 1:case 2:}return null!=t.id&&t.hasOwnProperty("id")&&!$util.isString(t.id)?"id: string expected":null!=t.type&&t.hasOwnProperty("type")&&!$util.isString(t.type)?"type: string expected":null!=t.metadata&&t.hasOwnProperty("metadata")&&!$util.isString(t.metadata)?"metadata: string expected":null},t.fromObject=function(t){if(t instanceof $root.protocol.Entity)return t;var e=new $root.protocol.Entity;switch(t.operation){default:if("number"==typeof t.operation){e.operation=t.operation;break}break;case"CREATE":case 0:e.operation=0;break;case"DELETE":case 1:e.operation=1;break;case"UPDATE":case 2:e.operation=2}return null!=t.id&&(e.id=String(t.id)),null!=t.type&&(e.type=String(t.type)),null!=t.metadata&&(e.metadata=String(t.metadata)),e},t.toObject=function(t,e){e||(e={});var i={};return e.defaults&&(i.operation=e.enums===String?"CREATE":0,i.id="",i.type="",i.metadata=""),null!=t.operation&&t.hasOwnProperty("operation")&&(i.operation=e.enums===String?void 0===$root.protocol.Entity.Operation[t.operation]?t.operation:$root.protocol.Entity.Operation[t.operation]:t.operation),null!=t.id&&t.hasOwnProperty("id")&&(i.id=t.id),null!=t.type&&t.hasOwnProperty("type")&&(i.type=t.type),null!=t.metadata&&t.hasOwnProperty("metadata")&&(i.metadata=t.metadata),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/protocol.Entity"},t.Operation=(e={},(i=Object.create(e))[e[0]="CREATE"]=0,i[e[1]="DELETE"]=1,i[e[2]="UPDATE"]=2,i),t}(),t.Event=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.name="",t.prototype.payload=null,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=$Writer.create()),null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(10).string(t.name),null!=t.payload&&Object.hasOwnProperty.call(t,"payload")&&$root.google.protobuf.Struct.encode(t.payload,e.uint32(18).fork()).ldelim(),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof $Reader||(t=$Reader.create(t));for(var i=void 0===e?t.len:t.pos+e,o=new $root.protocol.Event;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:o.name=t.string();break;case 2:o.payload=$root.google.protobuf.Struct.decode(t,t.uint32());break;default:t.skipType(7&n)}}return o},t.decodeDelimited=function(t){return t instanceof $Reader||(t=new $Reader(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.name&&t.hasOwnProperty("name")&&!$util.isString(t.name))return"name: string expected";if(null!=t.payload&&t.hasOwnProperty("payload")){var e=$root.google.protobuf.Struct.verify(t.payload);if(e)return"payload."+e}return null},t.fromObject=function(t){if(t instanceof $root.protocol.Event)return t;var e=new $root.protocol.Event;if(null!=t.name&&(e.name=String(t.name)),null!=t.payload){if("object"!=typeof t.payload)throw TypeError(".protocol.Event.payload: object expected");e.payload=$root.google.protobuf.Struct.fromObject(t.payload)}return e},t.toObject=function(t,e){e||(e={});var i={};return e.defaults&&(i.name="",i.payload=null),null!=t.name&&t.hasOwnProperty("name")&&(i.name=t.name),null!=t.payload&&t.hasOwnProperty("payload")&&(i.payload=$root.google.protobuf.Struct.toObject(t.payload,e)),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/protocol.Event"},t}(),t.Method=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.name="",t.prototype.payload="",t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=$Writer.create()),null!=t.name&&Object.hasOwnProperty.call(t,"name")&&e.uint32(10).string(t.name),null!=t.payload&&Object.hasOwnProperty.call(t,"payload")&&e.uint32(18).string(t.payload),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof $Reader||(t=$Reader.create(t));for(var i=void 0===e?t.len:t.pos+e,o=new $root.protocol.Method;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:o.name=t.string();break;case 2:o.payload=t.string();break;default:t.skipType(7&n)}}return o},t.decodeDelimited=function(t){return t instanceof $Reader||(t=new $Reader(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.name&&t.hasOwnProperty("name")&&!$util.isString(t.name)?"name: string expected":null!=t.payload&&t.hasOwnProperty("payload")&&!$util.isString(t.payload)?"payload: string expected":null},t.fromObject=function(t){if(t instanceof $root.protocol.Method)return t;var e=new $root.protocol.Method;return null!=t.name&&(e.name=String(t.name)),null!=t.payload&&(e.payload=String(t.payload)),e},t.toObject=function(t,e){e||(e={});var i={};return e.defaults&&(i.name="",i.payload=""),null!=t.name&&t.hasOwnProperty("name")&&(i.name=t.name),null!=t.payload&&t.hasOwnProperty("payload")&&(i.payload=t.payload),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/protocol.Method"},t}(),t.Update=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.vx=0,t.prototype.vy=0,t.prototype.vz=0,t.prototype.voxel=0,t.prototype.light=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=$Writer.create()),null!=t.vx&&Object.hasOwnProperty.call(t,"vx")&&e.uint32(8).int32(t.vx),null!=t.vy&&Object.hasOwnProperty.call(t,"vy")&&e.uint32(16).int32(t.vy),null!=t.vz&&Object.hasOwnProperty.call(t,"vz")&&e.uint32(24).int32(t.vz),null!=t.voxel&&Object.hasOwnProperty.call(t,"voxel")&&e.uint32(32).uint32(t.voxel),null!=t.light&&Object.hasOwnProperty.call(t,"light")&&e.uint32(40).uint32(t.light),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof $Reader||(t=$Reader.create(t));for(var i=void 0===e?t.len:t.pos+e,o=new $root.protocol.Update;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:o.vx=t.int32();break;case 2:o.vy=t.int32();break;case 3:o.vz=t.int32();break;case 4:o.voxel=t.uint32();break;case 5:o.light=t.uint32();break;default:t.skipType(7&n)}}return o},t.decodeDelimited=function(t){return t instanceof $Reader||(t=new $Reader(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.vx&&t.hasOwnProperty("vx")&&!$util.isInteger(t.vx)?"vx: integer expected":null!=t.vy&&t.hasOwnProperty("vy")&&!$util.isInteger(t.vy)?"vy: integer expected":null!=t.vz&&t.hasOwnProperty("vz")&&!$util.isInteger(t.vz)?"vz: integer expected":null!=t.voxel&&t.hasOwnProperty("voxel")&&!$util.isInteger(t.voxel)?"voxel: integer expected":null!=t.light&&t.hasOwnProperty("light")&&!$util.isInteger(t.light)?"light: integer expected":null},t.fromObject=function(t){if(t instanceof $root.protocol.Update)return t;var e=new $root.protocol.Update;return null!=t.vx&&(e.vx=0|t.vx),null!=t.vy&&(e.vy=0|t.vy),null!=t.vz&&(e.vz=0|t.vz),null!=t.voxel&&(e.voxel=t.voxel>>>0),null!=t.light&&(e.light=t.light>>>0),e},t.toObject=function(t,e){e||(e={});var i={};return e.defaults&&(i.vx=0,i.vy=0,i.vz=0,i.voxel=0,i.light=0),null!=t.vx&&t.hasOwnProperty("vx")&&(i.vx=t.vx),null!=t.vy&&t.hasOwnProperty("vy")&&(i.vy=t.vy),null!=t.vz&&t.hasOwnProperty("vz")&&(i.vz=t.vz),null!=t.voxel&&t.hasOwnProperty("voxel")&&(i.voxel=t.voxel),null!=t.light&&t.hasOwnProperty("light")&&(i.light=t.light),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/protocol.Update"},t}(),t.ChatMessage=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.type="",t.prototype.sender="",t.prototype.body="",t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=$Writer.create()),null!=t.type&&Object.hasOwnProperty.call(t,"type")&&e.uint32(10).string(t.type),null!=t.sender&&Object.hasOwnProperty.call(t,"sender")&&e.uint32(18).string(t.sender),null!=t.body&&Object.hasOwnProperty.call(t,"body")&&e.uint32(26).string(t.body),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof $Reader||(t=$Reader.create(t));for(var i=void 0===e?t.len:t.pos+e,o=new $root.protocol.ChatMessage;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:o.type=t.string();break;case 2:o.sender=t.string();break;case 3:o.body=t.string();break;default:t.skipType(7&n)}}return o},t.decodeDelimited=function(t){return t instanceof $Reader||(t=new $Reader(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.type&&t.hasOwnProperty("type")&&!$util.isString(t.type)?"type: string expected":null!=t.sender&&t.hasOwnProperty("sender")&&!$util.isString(t.sender)?"sender: string expected":null!=t.body&&t.hasOwnProperty("body")&&!$util.isString(t.body)?"body: string expected":null},t.fromObject=function(t){if(t instanceof $root.protocol.ChatMessage)return t;var e=new $root.protocol.ChatMessage;return null!=t.type&&(e.type=String(t.type)),null!=t.sender&&(e.sender=String(t.sender)),null!=t.body&&(e.body=String(t.body)),e},t.toObject=function(t,e){e||(e={});var i={};return e.defaults&&(i.type="",i.sender="",i.body=""),null!=t.type&&t.hasOwnProperty("type")&&(i.type=t.type),null!=t.sender&&t.hasOwnProperty("sender")&&(i.sender=t.sender),null!=t.body&&t.hasOwnProperty("body")&&(i.body=t.body),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/protocol.ChatMessage"},t}(),t.Message=function(){function t(t){if(this.peers=[],this.entities=[],this.chunks=[],this.events=[],this.updates=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}var e,i;return t.prototype.type=0,t.prototype.json="",t.prototype.text="",t.prototype.method=null,t.prototype.chat=null,t.prototype.peers=$util.emptyArray,t.prototype.entities=$util.emptyArray,t.prototype.chunks=$util.emptyArray,t.prototype.events=$util.emptyArray,t.prototype.updates=$util.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=$Writer.create()),null!=t.type&&Object.hasOwnProperty.call(t,"type")&&e.uint32(8).int32(t.type),null!=t.json&&Object.hasOwnProperty.call(t,"json")&&e.uint32(18).string(t.json),null!=t.text&&Object.hasOwnProperty.call(t,"text")&&e.uint32(26).string(t.text),null!=t.method&&Object.hasOwnProperty.call(t,"method")&&$root.protocol.Method.encode(t.method,e.uint32(34).fork()).ldelim(),null!=t.chat&&Object.hasOwnProperty.call(t,"chat")&&$root.protocol.ChatMessage.encode(t.chat,e.uint32(42).fork()).ldelim(),null!=t.peers&&t.peers.length)for(var i=0;i<t.peers.length;++i)$root.protocol.Peer.encode(t.peers[i],e.uint32(50).fork()).ldelim();if(null!=t.entities&&t.entities.length)for(i=0;i<t.entities.length;++i)$root.protocol.Entity.encode(t.entities[i],e.uint32(58).fork()).ldelim();if(null!=t.chunks&&t.chunks.length)for(i=0;i<t.chunks.length;++i)$root.protocol.Chunk.encode(t.chunks[i],e.uint32(66).fork()).ldelim();if(null!=t.events&&t.events.length)for(i=0;i<t.events.length;++i)$root.protocol.Event.encode(t.events[i],e.uint32(74).fork()).ldelim();if(null!=t.updates&&t.updates.length)for(i=0;i<t.updates.length;++i)$root.protocol.Update.encode(t.updates[i],e.uint32(82).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof $Reader||(t=$Reader.create(t));for(var i=void 0===e?t.len:t.pos+e,o=new $root.protocol.Message;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:o.type=t.int32();break;case 2:o.json=t.string();break;case 3:o.text=t.string();break;case 4:o.method=$root.protocol.Method.decode(t,t.uint32());break;case 5:o.chat=$root.protocol.ChatMessage.decode(t,t.uint32());break;case 6:o.peers&&o.peers.length||(o.peers=[]),o.peers.push($root.protocol.Peer.decode(t,t.uint32()));break;case 7:o.entities&&o.entities.length||(o.entities=[]),o.entities.push($root.protocol.Entity.decode(t,t.uint32()));break;case 8:o.chunks&&o.chunks.length||(o.chunks=[]),o.chunks.push($root.protocol.Chunk.decode(t,t.uint32()));break;case 9:o.events&&o.events.length||(o.events=[]),o.events.push($root.protocol.Event.decode(t,t.uint32()));break;case 10:o.updates&&o.updates.length||(o.updates=[]),o.updates.push($root.protocol.Update.decode(t,t.uint32()));break;default:t.skipType(7&n)}}return o},t.decodeDelimited=function(t){return t instanceof $Reader||(t=new $Reader(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.type&&t.hasOwnProperty("type"))switch(t.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:}if(null!=t.json&&t.hasOwnProperty("json")&&!$util.isString(t.json))return"json: string expected";if(null!=t.text&&t.hasOwnProperty("text")&&!$util.isString(t.text))return"text: string expected";if(null!=t.method&&t.hasOwnProperty("method")&&(i=$root.protocol.Method.verify(t.method)))return"method."+i;if(null!=t.chat&&t.hasOwnProperty("chat")&&(i=$root.protocol.ChatMessage.verify(t.chat)))return"chat."+i;if(null!=t.peers&&t.hasOwnProperty("peers")){if(!Array.isArray(t.peers))return"peers: array expected";for(var e=0;e<t.peers.length;++e)if(i=$root.protocol.Peer.verify(t.peers[e]))return"peers."+i}if(null!=t.entities&&t.hasOwnProperty("entities")){if(!Array.isArray(t.entities))return"entities: array expected";for(e=0;e<t.entities.length;++e)if(i=$root.protocol.Entity.verify(t.entities[e]))return"entities."+i}if(null!=t.chunks&&t.hasOwnProperty("chunks")){if(!Array.isArray(t.chunks))return"chunks: array expected";for(e=0;e<t.chunks.length;++e)if(i=$root.protocol.Chunk.verify(t.chunks[e]))return"chunks."+i}if(null!=t.events&&t.hasOwnProperty("events")){if(!Array.isArray(t.events))return"events: array expected";for(e=0;e<t.events.length;++e)if(i=$root.protocol.Event.verify(t.events[e]))return"events."+i}if(null!=t.updates&&t.hasOwnProperty("updates")){if(!Array.isArray(t.updates))return"updates: array expected";for(e=0;e<t.updates.length;++e){var i;if(i=$root.protocol.Update.verify(t.updates[e]))return"updates."+i}}return null},t.fromObject=function(t){if(t instanceof $root.protocol.Message)return t;var e=new $root.protocol.Message;switch(t.type){default:if("number"==typeof t.type){e.type=t.type;break}break;case"INIT":case 0:e.type=0;break;case"JOIN":case 1:e.type=1;break;case"LEAVE":case 2:e.type=2;break;case"ERROR":case 3:e.type=3;break;case"PEER":case 4:e.type=4;break;case"ENTITY":case 5:e.type=5;break;case"LOAD":case 6:e.type=6;break;case"UNLOAD":case 7:e.type=7;break;case"UPDATE":case 8:e.type=8;break;case"METHOD":case 9:e.type=9;break;case"CHAT":case 10:e.type=10;break;case"TRANSPORT":case 11:e.type=11;break;case"EVENT":case 12:e.type=12;break;case"ACTION":case 13:e.type=13;break;case"STATS":case 14:e.type=14}if(null!=t.json&&(e.json=String(t.json)),null!=t.text&&(e.text=String(t.text)),null!=t.method){if("object"!=typeof t.method)throw TypeError(".protocol.Message.method: object expected");e.method=$root.protocol.Method.fromObject(t.method)}if(null!=t.chat){if("object"!=typeof t.chat)throw TypeError(".protocol.Message.chat: object expected");e.chat=$root.protocol.ChatMessage.fromObject(t.chat)}if(t.peers){if(!Array.isArray(t.peers))throw TypeError(".protocol.Message.peers: array expected");e.peers=[];for(var i=0;i<t.peers.length;++i){if("object"!=typeof t.peers[i])throw TypeError(".protocol.Message.peers: object expected");e.peers[i]=$root.protocol.Peer.fromObject(t.peers[i])}}if(t.entities){if(!Array.isArray(t.entities))throw TypeError(".protocol.Message.entities: array expected");for(e.entities=[],i=0;i<t.entities.length;++i){if("object"!=typeof t.entities[i])throw TypeError(".protocol.Message.entities: object expected");e.entities[i]=$root.protocol.Entity.fromObject(t.entities[i])}}if(t.chunks){if(!Array.isArray(t.chunks))throw TypeError(".protocol.Message.chunks: array expected");for(e.chunks=[],i=0;i<t.chunks.length;++i){if("object"!=typeof t.chunks[i])throw TypeError(".protocol.Message.chunks: object expected");e.chunks[i]=$root.protocol.Chunk.fromObject(t.chunks[i])}}if(t.events){if(!Array.isArray(t.events))throw TypeError(".protocol.Message.events: array expected");for(e.events=[],i=0;i<t.events.length;++i){if("object"!=typeof t.events[i])throw TypeError(".protocol.Message.events: object expected");e.events[i]=$root.protocol.Event.fromObject(t.events[i])}}if(t.updates){if(!Array.isArray(t.updates))throw TypeError(".protocol.Message.updates: array expected");for(e.updates=[],i=0;i<t.updates.length;++i){if("object"!=typeof t.updates[i])throw TypeError(".protocol.Message.updates: object expected");e.updates[i]=$root.protocol.Update.fromObject(t.updates[i])}}return e},t.toObject=function(t,e){e||(e={});var i={};if((e.arrays||e.defaults)&&(i.peers=[],i.entities=[],i.chunks=[],i.events=[],i.updates=[]),e.defaults&&(i.type=e.enums===String?"INIT":0,i.json="",i.text="",i.method=null,i.chat=null),null!=t.type&&t.hasOwnProperty("type")&&(i.type=e.enums===String?void 0===$root.protocol.Message.Type[t.type]?t.type:$root.protocol.Message.Type[t.type]:t.type),null!=t.json&&t.hasOwnProperty("json")&&(i.json=t.json),null!=t.text&&t.hasOwnProperty("text")&&(i.text=t.text),null!=t.method&&t.hasOwnProperty("method")&&(i.method=$root.protocol.Method.toObject(t.method,e)),null!=t.chat&&t.hasOwnProperty("chat")&&(i.chat=$root.protocol.ChatMessage.toObject(t.chat,e)),t.peers&&t.peers.length){i.peers=[];for(var o=0;o<t.peers.length;++o)i.peers[o]=$root.protocol.Peer.toObject(t.peers[o],e)}if(t.entities&&t.entities.length)for(i.entities=[],o=0;o<t.entities.length;++o)i.entities[o]=$root.protocol.Entity.toObject(t.entities[o],e);if(t.chunks&&t.chunks.length)for(i.chunks=[],o=0;o<t.chunks.length;++o)i.chunks[o]=$root.protocol.Chunk.toObject(t.chunks[o],e);if(t.events&&t.events.length)for(i.events=[],o=0;o<t.events.length;++o)i.events[o]=$root.protocol.Event.toObject(t.events[o],e);if(t.updates&&t.updates.length)for(i.updates=[],o=0;o<t.updates.length;++o)i.updates[o]=$root.protocol.Update.toObject(t.updates[o],e);return i},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/protocol.Message"},t.Type=(e={},(i=Object.create(e))[e[0]="INIT"]=0,i[e[1]="JOIN"]=1,i[e[2]="LEAVE"]=2,i[e[3]="ERROR"]=3,i[e[4]="PEER"]=4,i[e[5]="ENTITY"]=5,i[e[6]="LOAD"]=6,i[e[7]="UNLOAD"]=7,i[e[8]="UPDATE"]=8,i[e[9]="METHOD"]=9,i[e[10]="CHAT"]=10,i[e[11]="TRANSPORT"]=11,i[e[12]="EVENT"]=12,i[e[13]="ACTION"]=13,i[e[14]="STATS"]=14,i),t}(),t),$root.google=function(){var t,e,i,o={};return o.protobuf=((i={}).Struct=function(){function t(t){if(this.fields={},t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.fields=$util.emptyObject,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=$Writer.create()),null!=t.fields&&Object.hasOwnProperty.call(t,"fields"))for(var i=Object.keys(t.fields),o=0;o<i.length;++o)e.uint32(10).fork().uint32(10).string(i[o]),$root.google.protobuf.Value.encode(t.fields[i[o]],e.uint32(18).fork()).ldelim().ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof $Reader||(t=$Reader.create(t));for(var i,o,n=void 0===e?t.len:t.pos+e,s=new $root.google.protobuf.Struct;t.pos<n;){var r=t.uint32();if(r>>>3==1){s.fields===$util.emptyObject&&(s.fields={});var l=t.uint32()+t.pos;for(i="",o=null;t.pos<l;){var a=t.uint32();switch(a>>>3){case 1:i=t.string();break;case 2:o=$root.google.protobuf.Value.decode(t,t.uint32());break;default:t.skipType(7&a)}}s.fields[i]=o}else t.skipType(7&r)}return s},t.decodeDelimited=function(t){return t instanceof $Reader||(t=new $Reader(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.fields&&t.hasOwnProperty("fields")){if(!$util.isObject(t.fields))return"fields: object expected";for(var e=Object.keys(t.fields),i=0;i<e.length;++i){var o=$root.google.protobuf.Value.verify(t.fields[e[i]]);if(o)return"fields."+o}}return null},t.fromObject=function(t){if(t instanceof $root.google.protobuf.Struct)return t;var e=new $root.google.protobuf.Struct;if(t.fields){if("object"!=typeof t.fields)throw TypeError(".google.protobuf.Struct.fields: object expected");e.fields={};for(var i=Object.keys(t.fields),o=0;o<i.length;++o){if("object"!=typeof t.fields[i[o]])throw TypeError(".google.protobuf.Struct.fields: object expected");e.fields[i[o]]=$root.google.protobuf.Value.fromObject(t.fields[i[o]])}}return e},t.toObject=function(t,e){e||(e={});var i,o={};if((e.objects||e.defaults)&&(o.fields={}),t.fields&&(i=Object.keys(t.fields)).length){o.fields={};for(var n=0;n<i.length;++n)o.fields[i[n]]=$root.google.protobuf.Value.toObject(t.fields[i[n]],e)}return o},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/google.protobuf.Struct"},t}(),i.Value=function(){function t(t){if(t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}var e;return t.prototype.nullValue=null,t.prototype.numberValue=null,t.prototype.stringValue=null,t.prototype.boolValue=null,t.prototype.structValue=null,t.prototype.listValue=null,Object.defineProperty(t.prototype,"kind",{get:$util.oneOfGetter(e=["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]),set:$util.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=$Writer.create()),null!=t.nullValue&&Object.hasOwnProperty.call(t,"nullValue")&&e.uint32(8).int32(t.nullValue),null!=t.numberValue&&Object.hasOwnProperty.call(t,"numberValue")&&e.uint32(17).double(t.numberValue),null!=t.stringValue&&Object.hasOwnProperty.call(t,"stringValue")&&e.uint32(26).string(t.stringValue),null!=t.boolValue&&Object.hasOwnProperty.call(t,"boolValue")&&e.uint32(32).bool(t.boolValue),null!=t.structValue&&Object.hasOwnProperty.call(t,"structValue")&&$root.google.protobuf.Struct.encode(t.structValue,e.uint32(42).fork()).ldelim(),null!=t.listValue&&Object.hasOwnProperty.call(t,"listValue")&&$root.google.protobuf.ListValue.encode(t.listValue,e.uint32(50).fork()).ldelim(),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof $Reader||(t=$Reader.create(t));for(var i=void 0===e?t.len:t.pos+e,o=new $root.google.protobuf.Value;t.pos<i;){var n=t.uint32();switch(n>>>3){case 1:o.nullValue=t.int32();break;case 2:o.numberValue=t.double();break;case 3:o.stringValue=t.string();break;case 4:o.boolValue=t.bool();break;case 5:o.structValue=$root.google.protobuf.Struct.decode(t,t.uint32());break;case 6:o.listValue=$root.google.protobuf.ListValue.decode(t,t.uint32());break;default:t.skipType(7&n)}}return o},t.decodeDelimited=function(t){return t instanceof $Reader||(t=new $Reader(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";var e={};if(null!=t.nullValue&&t.hasOwnProperty("nullValue")&&(e.kind=1,0!==t.nullValue))return"nullValue: enum value expected";if(null!=t.numberValue&&t.hasOwnProperty("numberValue")){if(1===e.kind)return"kind: multiple values";if(e.kind=1,"number"!=typeof t.numberValue)return"numberValue: number expected"}if(null!=t.stringValue&&t.hasOwnProperty("stringValue")){if(1===e.kind)return"kind: multiple values";if(e.kind=1,!$util.isString(t.stringValue))return"stringValue: string expected"}if(null!=t.boolValue&&t.hasOwnProperty("boolValue")){if(1===e.kind)return"kind: multiple values";if(e.kind=1,"boolean"!=typeof t.boolValue)return"boolValue: boolean expected"}if(null!=t.structValue&&t.hasOwnProperty("structValue")){if(1===e.kind)return"kind: multiple values";if(e.kind=1,i=$root.google.protobuf.Struct.verify(t.structValue))return"structValue."+i}if(null!=t.listValue&&t.hasOwnProperty("listValue")){if(1===e.kind)return"kind: multiple values";var i;if(e.kind=1,i=$root.google.protobuf.ListValue.verify(t.listValue))return"listValue."+i}return null},t.fromObject=function(t){if(t instanceof $root.google.protobuf.Value)return t;var e=new $root.google.protobuf.Value;switch(t.nullValue){default:if("number"==typeof t.nullValue){e.nullValue=t.nullValue;break}break;case"NULL_VALUE":case 0:e.nullValue=0}if(null!=t.numberValue&&(e.numberValue=Number(t.numberValue)),null!=t.stringValue&&(e.stringValue=String(t.stringValue)),null!=t.boolValue&&(e.boolValue=Boolean(t.boolValue)),null!=t.structValue){if("object"!=typeof t.structValue)throw TypeError(".google.protobuf.Value.structValue: object expected");e.structValue=$root.google.protobuf.Struct.fromObject(t.structValue)}if(null!=t.listValue){if("object"!=typeof t.listValue)throw TypeError(".google.protobuf.Value.listValue: object expected");e.listValue=$root.google.protobuf.ListValue.fromObject(t.listValue)}return e},t.toObject=function(t,e){e||(e={});var i={};return null!=t.nullValue&&t.hasOwnProperty("nullValue")&&(i.nullValue=e.enums===String?void 0===$root.google.protobuf.NullValue[t.nullValue]?t.nullValue:$root.google.protobuf.NullValue[t.nullValue]:t.nullValue,e.oneofs&&(i.kind="nullValue")),null!=t.numberValue&&t.hasOwnProperty("numberValue")&&(i.numberValue=e.json&&!isFinite(t.numberValue)?String(t.numberValue):t.numberValue,e.oneofs&&(i.kind="numberValue")),null!=t.stringValue&&t.hasOwnProperty("stringValue")&&(i.stringValue=t.stringValue,e.oneofs&&(i.kind="stringValue")),null!=t.boolValue&&t.hasOwnProperty("boolValue")&&(i.boolValue=t.boolValue,e.oneofs&&(i.kind="boolValue")),null!=t.structValue&&t.hasOwnProperty("structValue")&&(i.structValue=$root.google.protobuf.Struct.toObject(t.structValue,e),e.oneofs&&(i.kind="structValue")),null!=t.listValue&&t.hasOwnProperty("listValue")&&(i.listValue=$root.google.protobuf.ListValue.toObject(t.listValue,e),e.oneofs&&(i.kind="listValue")),i},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/google.protobuf.Value"},t}(),i.NullValue=(t={},(e=Object.create(t))[t[0]="NULL_VALUE"]=0,e),i.ListValue=function(){function t(t){if(this.values=[],t)for(var e=Object.keys(t),i=0;i<e.length;++i)null!=t[e[i]]&&(this[e[i]]=t[e[i]])}return t.prototype.values=$util.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=$Writer.create()),null!=t.values&&t.values.length)for(var i=0;i<t.values.length;++i)$root.google.protobuf.Value.encode(t.values[i],e.uint32(10).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof $Reader||(t=$Reader.create(t));for(var i=void 0===e?t.len:t.pos+e,o=new $root.google.protobuf.ListValue;t.pos<i;){var n=t.uint32();n>>>3==1?(o.values&&o.values.length||(o.values=[]),o.values.push($root.google.protobuf.Value.decode(t,t.uint32()))):t.skipType(7&n)}return o},t.decodeDelimited=function(t){return t instanceof $Reader||(t=new $Reader(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.values&&t.hasOwnProperty("values")){if(!Array.isArray(t.values))return"values: array expected";for(var e=0;e<t.values.length;++e){var i=$root.google.protobuf.Value.verify(t.values[e]);if(i)return"values."+i}}return null},t.fromObject=function(t){if(t instanceof $root.google.protobuf.ListValue)return t;var e=new $root.google.protobuf.ListValue;if(t.values){if(!Array.isArray(t.values))throw TypeError(".google.protobuf.ListValue.values: array expected");e.values=[];for(var i=0;i<t.values.length;++i){if("object"!=typeof t.values[i])throw TypeError(".google.protobuf.ListValue.values: object expected");e.values[i]=$root.google.protobuf.Value.fromObject(t.values[i])}}return e},t.toObject=function(t,e){e||(e={});var i={};if((e.arrays||e.defaults)&&(i.values=[]),t.values&&t.values.length){i.values=[];for(var o=0;o<t.values.length;++o)i.values[o]=$root.google.protobuf.Value.toObject(t.values[o],e)}return i},t.prototype.toJSON=function(){return this.constructor.toObject(this,$protobuf.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/google.protobuf.ListValue"},t}(),i),o}();var protocol=$root;function encodeObjectToStruct(t,e){if(void 0===e&&(e=new Set),"object"!=typeof t||null===t)return encodeStructValue(t,e);const i={fields:{}};e.add(t);for(const o in t)if(t.hasOwnProperty(o)){const n=t[o];if(void 0===n)continue;i.fields[o]=encodeStructValue(n,e)}return e.delete(t),i}function encodeStructValue(t,e){if(null==t)return{nullValue:0};if("number"==typeof t)return{numberValue:t};if("string"==typeof t)return{stringValue:t};if("boolean"==typeof t)return{boolValue:t};if(Array.isArray(t))return{listValue:{values:t.map((t=>encodeStructValue(t,e)))}};if("object"==typeof t)return e.has(t)?(console.warn("Circular object detected"),{stringValue:"[Circular]"}):{structValue:encodeObjectToStruct(t,e)};throw new Error("Unknown type: "+typeof t)}function _defineProperty$e(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const{google:google}=protocol;class Events extends Map{constructor(){var t;super(),t=this,_defineProperty$e(this,"packets",[]),_defineProperty$e(this,"onMessage",(t=>{if("EVENT"!==t.type);else{const{events:e}=t;e.forEach((t=>{this.handle(t.name,t.payload)}))}})),_defineProperty$e(this,"addEventListener",((t,e)=>{this.on(t,e)})),_defineProperty$e(this,"on",((t,e)=>{this.has(t)?console.warn(`Registering handler for ${t} canceled: handler already exists.`):this.set(t,e)})),_defineProperty$e(this,"emit",(function(e,i){void 0===i&&(i={}),t.packets.push({type:"EVENT",events:[{name:e,payload:encodeObjectToStruct(i)}]})})),_defineProperty$e(this,"emitMany",(t=>{this.packets.push({type:"EVENT",events:t.map((t=>({name:t.name,payload:google.protobuf.Struct.fromObject(t.payload||{})})))})})),_defineProperty$e(this,"handle",((t,e)=>{const i=this.get(t);i&&i(e)}))}}function _defineProperty$d(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Entity extends three__WEBPACK_IMPORTED_MODULE_0__.ZAu{constructor(t){super(),_defineProperty$d(this,"entId",void 0),_defineProperty$d(this,"onCreate",void 0),_defineProperty$d(this,"onUpdate",void 0),_defineProperty$d(this,"onDelete",void 0),this.entId=t}}class Entities extends three__WEBPACK_IMPORTED_MODULE_0__.ZAu{constructor(){super(...arguments),_defineProperty$d(this,"map",new Map),_defineProperty$d(this,"types",new Map),_defineProperty$d(this,"setClass",((t,e)=>{this.types.set(t.toLowerCase(),e)})),_defineProperty$d(this,"onMessage",(t=>{const{entities:e}=t;e&&e.length&&e.forEach((t=>{const{id:e,type:i,metadata:o,operation:n}=t;let s=this.map.get(e);switch(n){case"CREATE":var r;if(s)return;s=this.createEntityOfType(i,e),null===(r=s.onCreate)||void 0===r||r.call(s,o);break;case"UPDATE":var l,a;s||(s=this.createEntityOfType(i,e),null===(a=s.onCreate)||void 0===a||a.call(s,o)),null===(l=s.onUpdate)||void 0===l||l.call(s,o);break;case"DELETE":var d,c;if(!s)return void console.warn(`Entity ${e} does not exist.`);this.map.delete(e),null===(d=s.parent)||void 0===d||d.remove(s),null===(c=s.onDelete)||void 0===c||c.call(s,o)}}))})),_defineProperty$d(this,"createEntityOfType",((t,e)=>{if(!this.types.has(t))return void console.warn(`Entity type ${t} is not registered.`);const i=new(this.types.get(t.toLowerCase()))(e);return this.map.set(e,i),this.add(i),i}))}}var events={exports:{}},R="object"==typeof Reflect?Reflect:null,ReflectApply=R&&"function"==typeof R.apply?R.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)},ReflectOwnKeys;function ProcessEmitWarning(t){console&&console.warn&&console.warn(t)}ReflectOwnKeys=R&&"function"==typeof R.ownKeys?R.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var NumberIsNaN=Number.isNaN||function(t){return t!=t};function EventEmitter(){EventEmitter.init.call(this)}events.exports=EventEmitter,events.exports.once=once,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function _getMaxListeners(t){return void 0===t._maxListeners?EventEmitter.defaultMaxListeners:t._maxListeners}function _addListener(t,e,i,o){var n,s,r;if(checkListener(i),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),s=t._events),r=s[e]),void 0===r)r=s[e]=i,++t._eventsCount;else if("function"==typeof r?r=s[e]=o?[i,r]:[r,i]:o?r.unshift(i):r.push(i),(n=_getMaxListeners(t))>0&&r.length>n&&!r.warned){r.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=r.length,ProcessEmitWarning(l)}return t}function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(t,e,i){var o={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},n=onceWrapper.bind(o);return n.listener=i,o.wrapFn=n,n}function _listeners(t,e,i){var o=t._events;if(void 0===o)return[];var n=o[e];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?unwrapListeners(n):arrayClone(n,n.length)}function listenerCount(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function arrayClone(t,e){for(var i=new Array(e),o=0;o<e;++o)i[o]=t[o];return i}function spliceOne(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function unwrapListeners(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}function once(t,e){return new Promise((function(i,o){function n(i){t.removeListener(e,s),o(i)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",n),i([].slice.call(arguments))}eventTargetAgnosticAddListener(t,e,s,{once:!0}),"error"!==e&&addErrorHandlerIfEventEmitter(t,n,{once:!0})}))}function addErrorHandlerIfEventEmitter(t,e,i){"function"==typeof t.on&&eventTargetAgnosticAddListener(t,"error",e,i)}function eventTargetAgnosticAddListener(t,e,i,o){if("function"==typeof t.on)o.once?t.once(e,i):t.on(e,i);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function n(s){o.once&&t.removeEventListener(e,n),i(s)}))}}function _defineProperty$c(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$3(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$c(t,e,i[e])}))}return t}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(t){if("number"!=typeof t||t<0||NumberIsNaN(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");defaultMaxListeners=t}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||NumberIsNaN(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},EventEmitter.prototype.getMaxListeners=function(){return _getMaxListeners(this)},EventEmitter.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var o="error"===t,n=this._events;if(void 0!==n)o=o&&void 0===n.error;else if(!o)return!1;if(o){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var r=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw r.context=s,r}var l=n[t];if(void 0===l)return!1;if("function"==typeof l)ReflectApply(l,this,e);else{var a=l.length,d=arrayClone(l,a);for(i=0;i<a;++i)ReflectApply(d[i],this,e)}return!0},EventEmitter.prototype.addListener=function(t,e){return _addListener(this,t,e,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(t,e){return _addListener(this,t,e,!0)},EventEmitter.prototype.once=function(t,e){return checkListener(e),this.on(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.prependOnceListener=function(t,e){return checkListener(e),this.prependListener(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.removeListener=function(t,e){var i,o,n,s,r;if(checkListener(e),void 0===(o=this._events))return this;if(void 0===(i=o[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(n=-1,s=i.length-1;s>=0;s--)if(i[s]===e||i[s].listener===e){r=i[s].listener,n=s;break}if(n<0)return this;0===n?i.shift():spliceOne(i,n),1===i.length&&(o[t]=i[0]),void 0!==o.removeListener&&this.emit("removeListener",t,r||e)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function(t){var e,i,o;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var n,s=Object.keys(i);for(o=0;o<s.length;++o)"removeListener"!==(n=s[o])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(o=e.length-1;o>=0;o--)this.removeListener(t,e[o]);return this},EventEmitter.prototype.listeners=function(t){return _listeners(this,t,!0)},EventEmitter.prototype.rawListeners=function(t){return _listeners(this,t,!1)},EventEmitter.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):listenerCount.call(t,e)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};const PI_2=Math.PI/2,emptyQ=new three__WEBPACK_IMPORTED_MODULE_0__._fP;function rotateY(t,e,i){const o=e[0],n=e[2],s=t[0]-o,r=t[2]-n,l=Math.sin(i),a=Math.cos(i),d=[0,0,0];return d[0]=o+r*l+s*a,d[1]=t[1],d[2]=n+r*a-s*l,d}const defaultControlState={heading:0,running:!1,jumping:!1,sprinting:!1,crouching:!1,jumpCount:0,isJumping:!1,currentJumpTime:0},defaultOptions$2={sensitivity:100,minPolarAngle:.01*Math.PI,maxPolarAngle:.99*Math.PI,initialPosition:[0,80,10],rotationLerp:.9,positionLerp:1,stepLerp:.6,bodyWidth:.8,bodyHeight:1.55,bodyDepth:.8,eyeHeight:.9193548387096774,maxSpeed:6,moveForce:30,responsiveness:240,runningFriction:.1,standingFriction:4,flySpeed:40,flyForce:80,flyImpulse:2.5,flyInertia:6,sprintFactor:1.4,crouchFactor:.6,alwaysSprint:!1,airMoveMult:.7,fluidPushForce:.3,jumpImpulse:8,jumpForce:1,jumpTime:50,airJumps:0,stepHeight:.5};class RigidControls extends events.exports.EventEmitter{on(t,e){return super.on(t,e)}get ghostMode(){return this.body.aabb.width<=0}get flyMode(){return 0===this.body.gravityMultiplier&&!this.ghostMode}get voxel(){const[t,e,i]=this.body.getPosition();return ChunkUtils.mapWorldToVoxel([t,e-.5*this.options.bodyHeight,i])}get position(){const t=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(...this.body.getPosition());return t.y-=.5*this.options.bodyHeight,t}get chunk(){return ChunkUtils.mapVoxelToChunk(this.voxel,this.world.options.chunkSize)}constructor(t,e,i,o){var n;if(void 0===o&&(o={}),super(),n=this,_defineProperty$c(this,"options",void 0),_defineProperty$c(this,"camera",void 0),_defineProperty$c(this,"inputs",void 0),_defineProperty$c(this,"world",void 0),_defineProperty$c(this,"character",void 0),_defineProperty$c(this,"domElement",void 0),_defineProperty$c(this,"object",new three__WEBPACK_IMPORTED_MODULE_0__.ZAu),_defineProperty$c(this,"state",void 0),_defineProperty$c(this,"isLocked",!1),_defineProperty$c(this,"body",void 0),_defineProperty$c(this,"movements",{up:!1,down:!1,left:!1,right:!1,front:!1,back:!1,sprint:!1}),_defineProperty$c(this,"lockCallback",void 0),_defineProperty$c(this,"unlockCallback",void 0),_defineProperty$c(this,"euler",new three__WEBPACK_IMPORTED_MODULE_0__.USm(0,0,0,"YXZ")),_defineProperty$c(this,"quaternion",new three__WEBPACK_IMPORTED_MODULE_0__._fP),_defineProperty$c(this,"vector",new three__WEBPACK_IMPORTED_MODULE_0__.Pa4),_defineProperty$c(this,"newPosition",new three__WEBPACK_IMPORTED_MODULE_0__.Pa4),_defineProperty$c(this,"justUnlocked",!1),_defineProperty$c(this,"clock",new three__WEBPACK_IMPORTED_MODULE_0__.SUY),_defineProperty$c(this,"onMessage",(t=>{switch(t.type){case"EVENT":{const{events:e}=t;for(const t of e)"position"===t.name.toLowerCase()&&this.body.setPosition(t.payload);break}}})),_defineProperty$c(this,"update",(()=>{const t=Math.min(.1,this.clock.getDelta());if(this.object.quaternion.slerp(this.quaternion,this.options.rotationLerp),this.object.position.lerp(this.newPosition,this.options.positionLerp),this.character){const{x:t,y:e,z:i}=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,0,-1).applyQuaternion(this.object.getWorldQuaternion(emptyQ)).normalize(),o=this.object.position.toArray();this.character.set(o,[t,e,i]),this.character.update()}this.moveRigidBody(),this.updateRigidBody(t)})),_defineProperty$c(this,"connect",(function(t,e){void 0===e&&(e="*");const i=[];return n.domElement.addEventListener("mousemove",(t=>{n.onMouseMove(t)})),n.domElement.ownerDocument.addEventListener("pointerlockchange",(()=>{n.onPointerlockChange()})),n.domElement.ownerDocument.addEventListener("pointerlockerror",n.onPointerlockError),n.domElement.addEventListener("click",n.onDocumentClick),i.push((()=>{n.domElement.removeEventListener("mousemove",(t=>{n.onMouseMove(t)})),n.domElement.ownerDocument.removeEventListener("pointerlockchange",(()=>{n.onPointerlockChange()})),n.domElement.ownerDocument.removeEventListener("pointerlockerror",n.onPointerlockError),n.domElement.removeEventListener("click",n.onDocumentClick)})),[["r","sprint"],["w","front"],["a","left"],["s","back"],["d","right"],[" ","up"],["shift","down"]].forEach((o=>{let[s,r]=o;i.push(t.bind(s,(()=>{n.isLocked&&(n.movements[r]=!0)}),e,{identifier:RigidControls.INPUT_IDENTIFIER})),i.push(t.bind(s,(()=>{n.isLocked&&(n.movements[r]=!1)}),e,{occasion:"keyup",identifier:RigidControls.INPUT_IDENTIFIER}))})),n.inputs=t,()=>{i.forEach((t=>{try{t()}catch(t){}}))}})),_defineProperty$c(this,"getDirection",(()=>new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(0,0,-1).applyQuaternion(this.object.quaternion).normalize())),_defineProperty$c(this,"lock",(t=>{this.domElement.requestPointerLock(),t&&(this.lockCallback=t)})),_defineProperty$c(this,"unlock",(t=>{this.domElement.ownerDocument.exitPointerLock(),t&&(this.unlockCallback=t)})),_defineProperty$c(this,"teleport",((t,e,i)=>{const{bodyHeight:o,eyeHeight:n}=this.options;this.newPosition.set(t+.5,e+o*n+1,i+.5),this.body&&this.body.setPosition([t+.5,e+o/2+1,i+.5])})),_defineProperty$c(this,"teleportToTop",((t,e)=>{if(void 0===t||void 0===e){const{x:t,z:e}=this.object.position,i=this.world.getMaxHeightAt(t,e);return void this.teleport(Math.floor(t),i,Math.floor(e))}const[i,o]=ChunkUtils.mapVoxelToChunk([t,0,e],this.world.options.chunkSize);this.teleport(t,0,e),this.world.addChunkInitListener([i,o],(()=>{const i=this.world.getMaxHeightAt(t,e);this.teleport(Math.floor(t),i,Math.floor(e))}))})),_defineProperty$c(this,"lookAt",((t,e,i)=>{const o=this.object.position.clone().add(this.object.position.clone().sub(new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(t,e,i)));this.object.lookAt(o)})),_defineProperty$c(this,"resetMovements",(()=>{this.movements={sprint:!1,front:!1,back:!1,left:!1,right:!1,down:!1,up:!1}})),_defineProperty$c(this,"toggleGhostMode",(()=>{const{aabb:t}=this.body,[e,i,o]=this.body.getPosition(),{bodyWidth:n,bodyHeight:s,bodyDepth:r}=this.options;if(this.ghostMode)t.minX=e-n/2,t.minY=i-s/2,t.minZ=o-r/2,t.maxX=t.minX+n,t.maxY=t.minY+s,t.maxZ=t.minZ+r,this.body.gravityMultiplier=1;else{const e=(t.minX+t.maxX)/2,i=(t.minY+t.maxY)/2,o=(t.minZ+t.maxZ)/2;t.minX=e+1,t.maxX=e-1,t.minY=i+1,t.maxY=i-1,t.minZ=o+1,t.maxZ=o-1,this.body.gravityMultiplier=0}})),_defineProperty$c(this,"toggleFly",(()=>{if(!this.ghostMode){const t=0===this.body.gravityMultiplier;t||this.body.applyImpulse([0,8,0]),setTimeout((()=>{this.body.gravityMultiplier=t?1:0}),100)}})),_defineProperty$c(this,"reset",(()=>{this.teleport(...this.options.initialPosition),this.object.rotation.set(0,0,0),this.resetMovements()})),_defineProperty$c(this,"moveForward",(t=>{this.vector.setFromMatrixColumn(this.object.matrix,0),this.vector.crossVectors(this.object.up,this.vector),this.object.position.addScaledVector(this.vector,t)})),_defineProperty$c(this,"moveRight",(t=>{this.vector.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(this.vector,t)})),_defineProperty$c(this,"attachCharacter",(function(t,e){void 0===e&&(e=1),t instanceof Character?(t.options.positionLerp=e,n.options.bodyHeight=t.totalHeight,n.options.bodyWidth=t.body.width,n.options.bodyDepth=t.body.depth,n.options.eyeHeight=t.eyeHeight/t.totalHeight,n.body.aabb.maxX=n.body.aabb.minX+n.options.bodyWidth,n.body.aabb.maxY=n.body.aabb.minY+n.options.bodyHeight,n.body.aabb.maxZ=n.body.aabb.minZ+n.options.bodyDepth,n.character=t):console.warn("Character not attached: not a default character.")})),_defineProperty$c(this,"moveRigidBody",(()=>{const{object:t,state:e}=this,{sprint:i,right:o,left:n,up:s,down:r,front:l,back:a}=this.movements,d=l?a?0:1:a?-1:0,c=n?o?0:1:o?-1:0,h=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4;h.setFromMatrixColumn(t.matrix,0),h.crossVectors(t.up,h);const{x:u,z:p}=h;h.setFromMatrixColumn(t.matrix,0);const{x:m,z:b}=h,y=u+m,Z=p+b;let f=Math.atan2(y,Z);0==(d|c)?(e.running=!1,e.sprinting&&(this.movements.sprint=!1,e.sprinting=!1)):(e.running=!0,d?(-1===d&&(f+=Math.PI),c&&(f+=Math.PI/4*d*c)):f+=c*Math.PI/2,e.heading=f+Math.PI/4),e.jumping=s,e.crouching=r,e.sprinting=!!this.options.alwaysSprint||i,this.ghostMode||0===this.body.gravityMultiplier&&-1===this.body.atRestY&&(this.body.gravityMultiplier=1)})),_defineProperty$c(this,"updateRigidBody",(t=>{const{airJumps:e,jumpForce:i,jumpTime:o,jumpImpulse:n,maxSpeed:s,sprintFactor:r,crouchFactor:l,moveForce:a,airMoveMult:d,responsiveness:c,runningFriction:h,standingFriction:u,flyInertia:p,flyImpulse:m,flyForce:b,flySpeed:y,fluidPushForce:Z}=this.options;if(this.body.gravityMultiplier){const p=this.body.atRestY<0,m=p||this.state.jumpCount<e;if(p&&(this.state.isJumping=!1,this.state.jumpCount=0),this.state.jumping)if(this.state.isJumping){if(this.state.currentJumpTime>0){let e=i;this.state.currentJumpTime<t&&(e*=this.state.currentJumpTime/t),this.body.applyForce([0,e,0]),this.state.currentJumpTime-=t}}else m?(this.state.isJumping=!0,p||this.state.jumpCount++,this.state.currentJumpTime=o,this.body.applyImpulse([0,n,0]),!p&&this.body.velocity[1]<0&&(this.body.velocity[1]=0)):this.body.ratioInFluid>0&&this.body.applyImpulse([0,Z,0]);else this.state.isJumping=!1;let b=[0,0,0],y=[0,0,0];if(this.state.running){let t=s;this.state.sprinting&&(t*=r),this.state.crouching&&(t*=l),b[2]=t,b=rotateY(b,[0,0,0],this.state.heading),y=[b[0]-this.body.velocity[0],b[1]-this.body.velocity[1],b[2]-this.body.velocity[2]],y[1]=0;const e=Math.sqrt(y[0]**2+y[1]**2+y[2]**2);if(y[0]/=e,y[1]/=e,y[2]/=e,e>0){let t=a;p||(t*=d);const i=c*e;t>i&&(t=i),y[0]*=t,y[1]*=t,y[2]*=t,this.body.applyForce(y)}this.body.friction=h}else this.body.friction=u}else{this.body.velocity[0]-=this.body.velocity[0]*p*t,this.body.velocity[1]-=this.body.velocity[1]*p*t,this.body.velocity[2]-=this.body.velocity[2]*p*t,this.state.jumping&&this.body.applyImpulse([0,m,0]),this.state.crouching&&this.body.applyImpulse([0,-m,0]);let e=[0,0,0],i=[0,0,0];if(this.state.running){let t=y;this.state.sprinting&&(t*=r),this.state.crouching&&(t*=l),e[2]=t,e=rotateY(e,[0,0,0],this.state.heading),i=[e[0]-this.body.velocity[0],e[1]-this.body.velocity[1],e[2]-this.body.velocity[2]],i[1]=0;const o=Math.sqrt(i[0]**2+i[1]**2+i[2]**2);if(i[0]/=o,i[1]/=o,i[2]/=o,o>0){let t=b;const e=c*o;t>e&&(t=e),i[0]*=t,i[1]*=t,i[2]*=t,this.body.applyForce(i)}this.body.friction=h}else this.body.friction=u}const[f,W,g]=this.body.getPosition(),{eyeHeight:G,bodyHeight:v}=this.options;this.newPosition.set(f,W+v*(G-.5),g)})),_defineProperty$c(this,"onMouseMove",(t=>{if(!1===this.isLocked)return;if(this.justUnlocked)return void(this.justUnlocked=!1);const e=t.movementX||0,i=t.movementY||0;this.euler.setFromQuaternion(this.quaternion),this.euler.y-=e*this.options.sensitivity*.002/100,this.euler.x-=i*this.options.sensitivity*.002/100,this.euler.x=Math.max(PI_2-this.options.maxPolarAngle,Math.min(PI_2-this.options.minPolarAngle,this.euler.x)),this.quaternion.setFromEuler(this.euler)})),_defineProperty$c(this,"onPointerlockChange",(()=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.onLock(),this.lockCallback&&(this.lockCallback(),this.lockCallback=void 0),this.isLocked=!0):(this.onUnlock(),this.unlockCallback&&(this.unlockCallback(),this.unlockCallback=void 0),this.isLocked=!1)})),_defineProperty$c(this,"onPointerlockError",(()=>{console.error("VOXELIZE.RigidControls: Unable to use Pointer Lock API")})),_defineProperty$c(this,"onDocumentClick",(()=>{this.isLocked||this.lock()})),_defineProperty$c(this,"onLock",(()=>{this.emit("lock")})),_defineProperty$c(this,"onUnlock",(()=>{this.emit("unlock"),this.justUnlocked=!0})),!t)throw new Error("RigidControls: Camera is required.");if(!e)throw new Error("RigidControls: DOM Element is required.");if(!i)throw new Error("RigidControls: World is required.");this.camera=t,this.world=i,this.domElement=e,this.state=defaultControlState;const{bodyWidth:s,bodyHeight:r,bodyDepth:l}=this.options=_objectSpread$3({},defaultOptions$2,o);this.object.add(this.camera),this.world.add(this.object),this.body=i.physics.addBody({aabb:new AABB(0,0,0,s,r,l),onStep:t=>{const{positionLerp:e,stepLerp:i}=this.options;this.options.positionLerp=i,this.body.aabb=t.clone();const o=setTimeout((()=>{this.options.positionLerp=e,clearTimeout(o)}),500)},stepHeight:this.options.stepHeight}),this.teleport(...this.options.initialPosition)}}_defineProperty$c(RigidControls,"INPUT_IDENTIFIER","voxelize-rigid-controls");var RigidBody=class{get atRestX(){return this.resting[0]}get atRestY(){return this.resting[1]}get atRestZ(){return this.resting[2]}constructor(t,e,i,o,n,s,r,l){this.aabb=t,this.mass=e,this.friction=i,this.restitution=o,this.gravityMultiplier=n,this.stepHeight=s,this.onStep=r,this.onCollide=l,this.resting=[0,0,0],this.velocity=[0,0,0],this.inFluid=!1,this.ratioInFluid=0,this.forces=[0,0,0],this.impulses=[0,0,0],this.sleepFrameCount=10,this.setPosition=t=>{this.aabb.setPosition([t[0]-this.aabb.width/2,t[1]-this.aabb.height/2,t[2]-this.aabb.depth/2]),this.markActive()},this.getPosition=()=>[this.aabb.minX+this.aabb.width/2,this.aabb.minY+this.aabb.height/2,this.aabb.minZ+this.aabb.depth/2],this.applyForce=t=>{this.forces[0]+=t[0],this.forces[1]+=t[1],this.forces[2]+=t[2],this.markActive()},this.applyImpulse=t=>{this.impulses[0]+=t[0],this.impulses[1]+=t[1],this.impulses[2]+=t[2],this.markActive()},this.markActive=()=>{this.sleepFrameCount=10},this.airDrag=-1,this.fluidDrag=-1}};function lineToPlane(t,e,i){const[o,n,s]=t,[r,l,a]=e,[d,c,h]=i,u=d*o+c*n+h*s;return 0===u?1/0:(d*r+c*l+h*a)/u}function between(t,e,i){return t>=e&&t<=i}function sweepAABB(t,e,i){const o=e.minX-t.maxX,n=e.minY-t.maxY,s=e.minZ-t.maxZ,r=t.width+e.width,l=t.height+e.height,a=t.depth+e.depth,[d,c,h]=i;let u=1,p=0,m=0,b=0,y=0;return p=lineToPlane(i,[o,n,s],[-1,0,0]),p>=0&&d>0&&p<u&&between(p*c,n,n+l)&&between(p*h,s,s+a)&&(u=p,m=-1,b=0,y=0),p=lineToPlane(i,[o+r,n,s],[1,0,0]),p>=0&&d<0&&p<u&&between(p*c,n,n+l)&&between(p*h,s,s+a)&&(u=p,m=1,b=0,y=0),p=lineToPlane(i,[o,n,s],[0,-1,0]),p>=0&&c>0&&p<u&&between(p*d,o,o+r)&&between(p*h,s,s+a)&&(u=p,m=0,b=-1,y=0),p=lineToPlane(i,[o,n+l,s],[0,1,0]),p>=0&&c<0&&p<u&&between(p*d,o,o+r)&&between(p*h,s,s+a)&&(u=p,m=0,b=1,y=0),p=lineToPlane(i,[o,n,s],[0,0,-1]),p>=0&&h>0&&p<u&&between(p*d,o,o+r)&&between(p*c,n,n+l)&&(u=p,m=0,b=0,y=-1),p=lineToPlane(i,[o,n,s+a],[0,0,1]),p>=0&&h<0&&p<u&&between(p*d,o,o+r)&&between(p*c,n,n+l)&&(u=p,m=0,b=0,y=1),{h:u,nx:m,ny:b,nz:y}}function sweep(t,e,i,o,n,s){if(void 0===n&&(n=!0),void 0===s&&(s=100),s<=0)return;const[r,l,a]=i,d=Math.sqrt(r*r+l*l+a*a),c=Math.floor(r>0?e.minX:e.minX+r)-1,h=Math.floor(l>0?e.minY:e.minY+l)-1,u=Math.floor(a>0?e.minZ:e.minZ+a)-1,p=Math.floor(r>0?e.maxX+r:e.maxX)+1,m=Math.floor(l>0?e.maxY+l:e.maxY)+1,b=Math.floor(a>0?e.maxZ+a:e.maxZ)+1;let y=[],Z={h:1,nx:0,ny:0,nz:0};for(let V=c;V<=p;V++)for(let o=u;o<=b;o++)for(let n=h;n<=m;n++){const s=t(V,n,o);for(const t of s){const s=sweepAABB(e,t,i);s.h<Z.h&&(Z=s,y=[V,n,o])}}const f=Z.h*r+Engine.EPSILON*Z.nx,W=Z.h*l+Engine.EPSILON*Z.ny,g=Z.h*a+Engine.EPSILON*Z.nz;if(n&&e.translate([f,W,g]),1===Z.h)return;const G=0!==Z.nx?0:0!==Z.ny?1:2,v=-(Z.nx+Z.ny+Z.nz),X=[(1-Z.h)*r,(1-Z.h)*l,(1-Z.h)*a];0!==v&&o(d*Z.h,G,v,X,y)||X[0]**2+X[1]**2+X[2]**2!=0&&sweep(t,e,X,o,n,s-1)}function approxEquals(t,e){return Math.abs(t-e)<1e-5}var _Engine=class{constructor(t,e,i){this.getVoxel=t,this.testFluid=e,this.options=i,this.bodies=[],this.addBody=t=>{const e={aabb:new AABB(0,0,0,1,1,1),mass:1,friction:1,restitution:0,gravityMultiplier:1,stepHeight:0},{aabb:i,mass:o,friction:n,restitution:s,gravityMultiplier:r,stepHeight:l,onStep:a,onCollide:d}={...e,...t},c=new RigidBody(i,o,n,s,r,l,a,d);return this.bodies.push(c),c},this.removeBody=t=>{const e=this.bodies.indexOf(t);e<0||this.bodies.splice(e,1)},this.update=t=>{const e=approxEquals(0,this.options.gravity[0]**2+this.options.gravity[1]**2+this.options.gravity[2]**2);this.bodies.forEach((i=>this.iterateBody(i,t,e)))},this.iterateBody=(t,e,i)=>{const o=[...t.resting];if(t.mass<=0)return t.velocity=[0,0,0],t.forces=[0,0,0],void(t.impulses=[0,0,0]);const n=i||0===t.gravityMultiplier;if(this.isBodyAsleep(t,e,n))return;t.sleepFrameCount--,this.applyFluidForces(t);const s=[t.forces[0]/t.mass+this.options.gravity[0]*t.gravityMultiplier,t.forces[1]/t.mass+this.options.gravity[1]*t.gravityMultiplier,t.forces[2]/t.mass+this.options.gravity[2]*t.gravityMultiplier],r=[t.impulses[0]/t.mass+s[0]*e,t.impulses[1]/t.mass+s[1]*e,t.impulses[2]/t.mass+s[2]*e];t.velocity=[t.velocity[0]+r[0],t.velocity[1]+r[1],t.velocity[2]+r[2]],t.friction&&(this.applyFrictionByAxis(0,t,r),this.applyFrictionByAxis(1,t,r),this.applyFrictionByAxis(2,t,r));let l=t.airDrag>=0?t.airDrag:this.options.airDrag;t.inFluid&&(l=t.fluidDrag>=0?t.fluidDrag:this.options.fluidDrag,l*=1-(1-t.ratioInFluid)**2);const a=Math.max(1-l*e/t.mass,0);t.velocity=[t.velocity[0]*a,t.velocity[1]*a,t.velocity[2]*a];const d=[t.velocity[0]*e,t.velocity[1]*e,t.velocity[2]*e];t.forces=[0,0,0],t.impulses=[0,0,0];const c=t.aabb.clone();this.processCollisions(t.aabb,d,t.resting),t.stepHeight>0&&this.tryAutoStepping(t,c,d);const h=[0,0,0];for(let p=0;p<3;++p)t.resting[p]&&(o[p]||(h[p]=-t.velocity[p]),t.velocity[p]=0);const u=Math.sqrt(h[0]**2+h[1]**2+h[2]**2);u>.001&&(h[0]=h[0]*t.mass,h[1]=h[1]*t.mass,h[2]=h[2]*t.mass,t.onCollide&&t.onCollide(h),t.restitution>0&&u>this.options.minBounceImpulse&&(h[0]=h[0]*t.restitution,h[1]=h[1]*t.restitution,h[2]=h[2]*t.restitution,t.applyImpulse(h))),t.velocity[0]**2+t.velocity[1]**2+t.velocity[2]**2>1e-5&&t.markActive()},this.applyFluidForces=t=>{const e=t.aabb,i=Math.floor(e.minX),o=Math.floor(e.minZ),n=Math.floor(e.minY),s=Math.floor(e.maxY);if(!this.testFluid(i,n,o))return t.inFluid=!1,void(t.ratioInFluid=0);let r=1,l=n+1;for(;l<=s&&this.testFluid(i,l,o);)r++,l++;let a=(n+r-e.minY)/(e.maxY-e.minY);a>1&&(a=1);const d=(e.maxX-e.minX)*(e.maxY-e.minY)*(e.maxZ-e.minZ)*a,c=-this.options.fluidDensity*d,h=[this.options.gravity[0]*c,this.options.gravity[1]*c,this.options.gravity[2]*c];t.applyForce(h),t.inFluid=!0,t.ratioInFluid=a},this.applyFrictionByAxis=(t,e,i)=>{const o=e.resting[t],n=i[t];if(0===o)return;if(o*n<=0)return;const s=[...e.velocity];s[t]=0;const r=Math.sqrt(s[0]**2+s[1]**2+s[2]**2);if(approxEquals(r,0))return;const l=Math.abs(e.friction*n),a=r>l?(r-l)/r:0;e.velocity[(t+1)%3]*=a,e.velocity[(t+2)%3]*=a},this.processCollisions=(t,e,i)=>{i[0]=0,i[1]=0,i[2]=0,sweep(this.getVoxel,t,e,(function(t,e,o,n){return i[e]=o,n[e]=0,!1}))},this.tryAutoStepping=(t,e,i)=>{if(t.resting[1]>=0&&!t.inFluid)return;const o=0!==t.resting[0],n=0!==t.resting[2];if(!o&&!n)return;const s=[e.minX+i[0],e.minY+i[1],e.minZ+i[2]];let r=[];sweep(this.getVoxel,e,i,(function(t,e,i,o,n){return 1===e?(o[e]=0,!1):(r=n||[],!0)}));const l=t.aabb.minY;let a=0;r&&this.getVoxel(r[0],r[1],r[2]).forEach((t=>{t.maxY>a&&(a=t.maxY)}));const d=Math.floor(l)+a-l+_Engine.EPSILON,c=[0,Math.min(d,t.stepHeight+.001),0];let h=!1;if(sweep(this.getVoxel,e,c,(function(){return h=!0,!0})),h)return;const u=[s[0]-e.minX,s[1]-e.minY,s[2]-e.minZ];u[1]=0;const p=[0,0,0];if(this.processCollisions(e,u,p),o&&!approxEquals(e.minX,s[0]))return;if(n&&!approxEquals(e.minZ,s[2]))return;const m=e.clone();sweep(this.getVoxel,m,[0,-d,0],(t=>(t>_Engine.EPSILON&&e.translate([0,-t+_Engine.EPSILON,0]),!0))),t.resting[0]=p[0],t.resting[2]=p[2],t.onStep?t.onStep(e,p):t.aabb=e.clone()},this.isBodyAsleep=(t,e,i)=>{if(t.sleepFrameCount>0)return!1;if(i)return!0;let o=!1;const n=.5*e*e*t.gravityMultiplier,s=[this.options.gravity[0]*n,this.options.gravity[1]*n,this.options.gravity[2]*n];return sweep(this.getVoxel,t.aabb,s,(function(){return o=!0,!0}),!1),o},this.teleport=(t,e,i)=>{const o=1e3,n=t.getPosition(),s=(e[0]-n[0])/o,r=(e[1]-n[1])/o,l=(e[2]-n[2])/o;setInterval((()=>{t.aabb.translate([s,r,l])}),i/o)}}},Engine=_Engine;function raycastAABB(t,e,i,o){void 0===o&&(o=1/0);const[n,s,r]=e,l=(i.minX-t[0])/n,a=(i.maxX-t[0])/n,d=(i.minY-t[1])/s,c=(i.maxY-t[1])/s,h=(i.minZ-t[2])/r,u=(i.maxZ-t[2])/r,p=Math.max(Math.max(Math.min(l,a),Math.min(d,c)),Math.min(h,u)),m=p===l||p===a?0:p===d||p===c?1:2,b=Math.min(Math.min(Math.max(l,a),Math.max(d,c)),Math.max(h,u));return b<0||p>b?null:p<0?b>o?null:{axis:p===l||p===a?0:p===d||p===c?1:2,distance:b}:p>o?null:{axis:m,distance:p}}function raycast(t,e,i,o){let n=+i[0],s=+i[1],r=+i[2];const l=Math.sqrt(n*n+s*s+r*r);if(0===l)throw new Error("Can't raycast along a zero vector");n/=l,s/=l,r/=l;const[a,d,c]=e;let h=0,u=0|Math.floor(a),p=0|Math.floor(d),m=0|Math.floor(c);const b=n>0?1:-1,y=s>0?1:-1,Z=r>0?1:-1,f=Math.abs(1/n),W=Math.abs(1/s),g=Math.abs(1/r);let G=f<1/0?f*(b>0?u+1-a:a-u):1/0,v=W<1/0?W*(y>0?p+1-d:d-p):1/0,X=g<1/0?g*(Z>0?m+1-c:c-m):1/0;for(;h<=o;){let i;if((t(u,p,m)||[]).forEach((t=>{const l=raycastAABB(e,[n,s,r],t.clone().translate([u,p,m]),o);l&&(i=l)})),i)return{point:[a+i.distance*n,d+i.distance*s,c+i.distance*r],normal:[0===i.axis?-b:0,1===i.axis?-y:0,2===i.axis?-Z:0],voxel:[u,p,m]};G<v?G<X?(u+=b,h=G,G+=f):(m+=Z,h=X,X+=g):v<X?(p+=y,h=v,v+=W):(m+=Z,h=X,X+=g)}return null}Engine.EPSILON=1e-10;var WorkerFactory$2=createBase64WorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7dmFyIHQ9Y2xhc3N7Z2V0IHdpZHRoKCl7cmV0dXJuIHRoaXMubWF4WC10aGlzLm1pblh9Z2V0IGhlaWdodCgpe3JldHVybiB0aGlzLm1heFktdGhpcy5taW5ZfWdldCBkZXB0aCgpe3JldHVybiB0aGlzLm1heFotdGhpcy5taW5afWdldCBtYWcoKXtyZXR1cm4gTWF0aC5zcXJ0KCh0aGlzLm1heFgtdGhpcy5taW5YKSoqMisodGhpcy5tYXhZLXRoaXMubWluWSkqKjIrKHRoaXMubWF4Wi10aGlzLm1pblopKioyKX1jb21wdXRlT2Zmc2V0WCh0LGUpe2NvbnN0IG49dGhpcy5pbnRlcnNlY3Rpb24odCk7cmV0dXJuIG4uaGVpZ2h0PD0wfHxuLmRlcHRoPD0wP2U6bi53aWR0aD49MD8wOmU+MCYmdC5taW5YPj10aGlzLm1heFg/TWF0aC5taW4odC5taW5YLXRoaXMubWF4WCxlKTplPDAmJnQubWF4WDw9dGhpcy5taW5YP01hdGgubWF4KHQubWF4WC10aGlzLm1pblgsZSk6ZX1jb21wdXRlT2Zmc2V0WSh0LGUpe2NvbnN0IG49dGhpcy5pbnRlcnNlY3Rpb24odCk7cmV0dXJuIG4ud2lkdGg8PTB8fG4uZGVwdGg8PTA/ZTpuLmhlaWdodD49MD8wOmU+MCYmdC5taW5ZPj10aGlzLm1heFk/TWF0aC5taW4odC5taW5ZLXRoaXMubWF4WSxlKTplPDAmJnQubWF4WTw9dGhpcy5taW5ZP01hdGgubWF4KHQubWF4WS10aGlzLm1pblksZSk6ZX1jb21wdXRlT2Zmc2V0Wih0LGUpe2NvbnN0IG49dGhpcy5pbnRlcnNlY3Rpb24odCk7cmV0dXJuIG4ud2lkdGg8PTB8fG4uaGVpZ2h0PD0wP2U6bi5kZXB0aD49MD8wOmU+MCYmdC5taW5aPj10aGlzLm1heFo/TWF0aC5taW4odC5taW5aLXRoaXMubWF4WixlKTplPDAmJnQubWF4Wjw9dGhpcy5taW5aP01hdGgubWF4KHQubWF4Wi10aGlzLm1pblosZSk6ZX1jb25zdHJ1Y3RvcihlLG4saSxyLHMsYSl7dGhpcy5taW5YPWUsdGhpcy5taW5ZPW4sdGhpcy5taW5aPWksdGhpcy5tYXhYPXIsdGhpcy5tYXhZPXMsdGhpcy5tYXhaPWEsdGhpcy5nZXRNaW49dD0+e2lmKDA9PT10KXJldHVybiB0aGlzLm1pblg7aWYoMT09PXQpcmV0dXJuIHRoaXMubWluWTtpZigyPT09dClyZXR1cm4gdGhpcy5taW5aO3Rocm93IG5ldyBFcnJvcigiR2V0TWluRXJyb3I6IFVua25vd24gYXhpcy4iKX0sdGhpcy5zZXRNaW49KHQsZSk9PntpZigwPT09dCl0aGlzLm1pblg9ZTtlbHNlIGlmKDE9PT10KXRoaXMubWluWT1lO2Vsc2V7aWYoMiE9PXQpdGhyb3cgbmV3IEVycm9yKCJTZXRNaW5FcnJvcjogVW5rbm93biBheGlzLiIpO3RoaXMubWluWj1lfX0sdGhpcy5nZXRNYXg9dD0+e2lmKDA9PT10KXJldHVybiB0aGlzLm1heFg7aWYoMT09PXQpcmV0dXJuIHRoaXMubWF4WTtpZigyPT09dClyZXR1cm4gdGhpcy5tYXhaO3Rocm93IG5ldyBFcnJvcigiR2V0TWF4RXJyb3I6IFVua25vd24gYXhpcy4iKX0sdGhpcy5zZXRNYXg9KHQsZSk9PntpZigwPT09dCl0aGlzLm1heFg9ZTtlbHNlIGlmKDE9PT10KXRoaXMubWF4WT1lO2Vsc2V7aWYoMiE9PXQpdGhyb3cgbmV3IEVycm9yKCJTZXRNYXhFcnJvcjogVW5rbm93biBheGlzLiIpO3RoaXMubWF4Wj1lfX0sdGhpcy50cmFuc2xhdGU9KFt0LGUsbl0pPT4odGhpcy5taW5YKz10LHRoaXMubWluWSs9ZSx0aGlzLm1pblorPW4sdGhpcy5tYXhYKz10LHRoaXMubWF4WSs9ZSx0aGlzLm1heForPW4sdGhpcyksdGhpcy50cmFuc2xhdGVBeGlzPSh0LGUpPT57aWYoMD09PXQpdGhpcy5taW5YKz1lLHRoaXMubWF4WCs9ZTtlbHNlIGlmKDE9PT10KXRoaXMubWluWSs9ZSx0aGlzLm1heFkrPWU7ZWxzZXtpZigyIT09dCl0aHJvdyBuZXcgRXJyb3IoIlRyYW5zbGF0ZUF4aXNFcnJvcjogVW5rbm93biBheGlzLiIpO3RoaXMubWluWis9ZSx0aGlzLm1heForPWV9cmV0dXJuIHRoaXN9LHRoaXMuc2V0UG9zaXRpb249KFt0LGUsbl0pPT4odGhpcy5tYXhYPXQrdGhpcy53aWR0aCx0aGlzLm1heFk9ZSt0aGlzLmhlaWdodCx0aGlzLm1heFo9bit0aGlzLmRlcHRoLHRoaXMubWluWD10LHRoaXMubWluWT1lLHRoaXMubWluWj1uLHRoaXMpLHRoaXMuaW50ZXJzZWN0cz10PT4hKHQubWluWD49dGhpcy5tYXhYKSYmKCEodC5taW5ZPj10aGlzLm1heFkpJiYoISh0Lm1pblo+PXRoaXMubWF4WikmJighKHQubWF4WDw9dGhpcy5taW5YKSYmKCEodC5tYXhZPD10aGlzLm1pblkpJiYhKHQubWF4Wjw9dGhpcy5taW5aKSkpKSksdGhpcy50b3VjaGVzPXQ9Pntjb25zdCBlPXRoaXMuaW50ZXJzZWN0aW9uKHQpO3JldHVybiBudWxsIT09ZSYmKDA9PT1lLndpZHRofHwwPT09ZS5oZWlnaHR8fDA9PT1lLmRlcHRoKX0sdGhpcy51bmlvbj1lPT5uZXcgdChNYXRoLm1pbih0aGlzLm1pblgsZS5taW5YKSxNYXRoLm1pbih0aGlzLm1pblksZS5taW5ZKSxNYXRoLm1pbih0aGlzLm1pblosZS5taW5aKSxNYXRoLm1heCh0aGlzLm1heFgsZS5tYXhYKSxNYXRoLm1heCh0aGlzLm1heFksZS5tYXhZKSxNYXRoLm1heCh0aGlzLm1heFosZS5tYXhaKSksdGhpcy5pbnRlcnNlY3Rpb249ZT0+bmV3IHQoTWF0aC5tYXgodGhpcy5taW5YLGUubWluWCksTWF0aC5tYXgodGhpcy5taW5ZLGUubWluWSksTWF0aC5tYXgodGhpcy5taW5aLGUubWluWiksTWF0aC5taW4odGhpcy5tYXhYLGUubWF4WCksTWF0aC5taW4odGhpcy5tYXhZLGUubWF4WSksTWF0aC5taW4odGhpcy5tYXhaLGUubWF4WikpLHRoaXMuY2xvbmU9KCk9Pm5ldyB0KHRoaXMubWluWCx0aGlzLm1pblksdGhpcy5taW5aLHRoaXMubWF4WCx0aGlzLm1heFksdGhpcy5tYXhaKX19LGU9dDtlLnVuaW9uPWU9PntsZXQgbj1lWzBdLm1pblgsaT1lWzBdLm1pblkscj1lWzBdLm1pbloscz1lWzBdLm1heFgsYT1lWzBdLm1heFksbz1lWzBdLm1heFo7Zm9yKGNvbnN0IHQgb2YgZSluPU1hdGgubWluKG4sdC5taW5YKSxpPU1hdGgubWluKGksdC5taW5ZKSxyPU1hdGgubWluKHIsdC5taW5aKSxzPU1hdGgubWF4KHMsdC5tYXhYKSxhPU1hdGgubWF4KGEsdC5tYXhZKSxvPU1hdGgubWF4KG8sdC5tYXhaKTtyZXR1cm4gbmV3IHQobixpLHIscyxhLG8pfTt2YXIgbj0xZS02LGk9ZnVuY3Rpb24oKXt2YXIgdD1uZXcgRmxvYXQzMkFycmF5KDMpO3JldHVybiB0WzBdPTAsdFsxXT0wLHRbMl09MCx0fTt2YXIgcj1mdW5jdGlvbih0KXt2YXIgZT1uZXcgRmxvYXQzMkFycmF5KDMpO3JldHVybiBlWzBdPXRbMF0sZVsxXT10WzFdLGVbMl09dFsyXSxlfTt2YXIgcz1mdW5jdGlvbih0LGUsbil7dmFyIGk9bmV3IEZsb2F0MzJBcnJheSgzKTtyZXR1cm4gaVswXT10LGlbMV09ZSxpWzJdPW4saX07dmFyIGE9ZnVuY3Rpb24odCxlKXt2YXIgbj1lWzBdLGk9ZVsxXSxyPWVbMl0scz1uKm4raSppK3IqcjtzPjAmJihzPTEvTWF0aC5zcXJ0KHMpLHRbMF09ZVswXSpzLHRbMV09ZVsxXSpzLHRbMl09ZVsyXSpzKTtyZXR1cm4gdH07dmFyIG89ZnVuY3Rpb24odCxlKXtyZXR1cm4gdFswXSplWzBdK3RbMV0qZVsxXSt0WzJdKmVbMl19O3ZhciBoPWZ1bmN0aW9uKHQsZSl7dmFyIG49dSh0WzBdLHRbMV0sdFsyXSksaT11KGVbMF0sZVsxXSxlWzJdKTtjKG4sbiksYyhpLGkpO3ZhciByPWwobixpKTtyZXR1cm4gcj4xPzA6TWF0aC5hY29zKHIpfSx1PXMsYz1hLGw9bzt2YXIgZj1mdW5jdGlvbih0LGUpe3JldHVybiB0WzBdPWVbMF0sdFsxXT1lWzFdLHRbMl09ZVsyXSx0fTt2YXIgbT1mdW5jdGlvbih0LGUsbixpKXtyZXR1cm4gdFswXT1lLHRbMV09bix0WzJdPWksdH07dmFyIHA9ZnVuY3Rpb24odCxlKXt2YXIgbj10WzBdLGk9dFsxXSxyPXRbMl0scz1lWzBdLGE9ZVsxXSxvPWVbMl07cmV0dXJuIE1hdGguYWJzKG4tcyk8PWQqTWF0aC5tYXgoMSxNYXRoLmFicyhuKSxNYXRoLmFicyhzKSkmJk1hdGguYWJzKGktYSk8PWQqTWF0aC5tYXgoMSxNYXRoLmFicyhpKSxNYXRoLmFicyhhKSkmJk1hdGguYWJzKHItbyk8PWQqTWF0aC5tYXgoMSxNYXRoLmFicyhyKSxNYXRoLmFicyhvKSl9LGQ9bjt2YXIgZz1mdW5jdGlvbih0LGUpe3JldHVybiB0WzBdPT09ZVswXSYmdFsxXT09PWVbMV0mJnRbMl09PT1lWzJdfTt2YXIgeD1mdW5jdGlvbih0LGUsbil7cmV0dXJuIHRbMF09ZVswXStuWzBdLHRbMV09ZVsxXStuWzFdLHRbMl09ZVsyXStuWzJdLHR9O3ZhciB2PWZ1bmN0aW9uKHQsZSxuKXtyZXR1cm4gdFswXT1lWzBdLW5bMF0sdFsxXT1lWzFdLW5bMV0sdFsyXT1lWzJdLW5bMl0sdH07dmFyIGI9dixNPWZ1bmN0aW9uKHQsZSxuKXtyZXR1cm4gdFswXT1lWzBdKm5bMF0sdFsxXT1lWzFdKm5bMV0sdFsyXT1lWzJdKm5bMl0sdH07dmFyIHc9TSx5PWZ1bmN0aW9uKHQsZSxuKXtyZXR1cm4gdFswXT1lWzBdL25bMF0sdFsxXT1lWzFdL25bMV0sdFsyXT1lWzJdL25bMl0sdH07dmFyIEw9eSxSPWZ1bmN0aW9uKHQsZSxuKXtyZXR1cm4gdFswXT1NYXRoLm1pbihlWzBdLG5bMF0pLHRbMV09TWF0aC5taW4oZVsxXSxuWzFdKSx0WzJdPU1hdGgubWluKGVbMl0sblsyXSksdH07dmFyIFg9ZnVuY3Rpb24odCxlLG4pe3JldHVybiB0WzBdPU1hdGgubWF4KGVbMF0sblswXSksdFsxXT1NYXRoLm1heChlWzFdLG5bMV0pLHRbMl09TWF0aC5tYXgoZVsyXSxuWzJdKSx0fTt2YXIgWj1mdW5jdGlvbih0LGUpe3JldHVybiB0WzBdPU1hdGguZmxvb3IoZVswXSksdFsxXT1NYXRoLmZsb29yKGVbMV0pLHRbMl09TWF0aC5mbG9vcihlWzJdKSx0fTt2YXIgaz1mdW5jdGlvbih0LGUpe3JldHVybiB0WzBdPU1hdGguY2VpbChlWzBdKSx0WzFdPU1hdGguY2VpbChlWzFdKSx0WzJdPU1hdGguY2VpbChlWzJdKSx0fTt2YXIgWT1mdW5jdGlvbih0LGUpe3JldHVybiB0WzBdPU1hdGgucm91bmQoZVswXSksdFsxXT1NYXRoLnJvdW5kKGVbMV0pLHRbMl09TWF0aC5yb3VuZChlWzJdKSx0fTt2YXIgRT1mdW5jdGlvbih0LGUsbil7cmV0dXJuIHRbMF09ZVswXSpuLHRbMV09ZVsxXSpuLHRbMl09ZVsyXSpuLHR9O3ZhciBqPWZ1bmN0aW9uKHQsZSxuLGkpe3JldHVybiB0WzBdPWVbMF0rblswXSppLHRbMV09ZVsxXStuWzFdKmksdFsyXT1lWzJdK25bMl0qaSx0fTt2YXIgTz1mdW5jdGlvbih0LGUpe3ZhciBuPWVbMF0tdFswXSxpPWVbMV0tdFsxXSxyPWVbMl0tdFsyXTtyZXR1cm4gTWF0aC5zcXJ0KG4qbitpKmkrcipyKX07dmFyIEE9TyxCPWZ1bmN0aW9uKHQsZSl7dmFyIG49ZVswXS10WzBdLGk9ZVsxXS10WzFdLHI9ZVsyXS10WzJdO3JldHVybiBuKm4raSppK3Iqcn07dmFyIHE9QixWPWZ1bmN0aW9uKHQpe3ZhciBlPXRbMF0sbj10WzFdLGk9dFsyXTtyZXR1cm4gTWF0aC5zcXJ0KGUqZStuKm4raSppKX07dmFyIE49VixTPWZ1bmN0aW9uKHQpe3ZhciBlPXRbMF0sbj10WzFdLGk9dFsyXTtyZXR1cm4gZSplK24qbitpKml9O3ZhciBJPVMsVD1mdW5jdGlvbih0LGUpe3JldHVybiB0WzBdPS1lWzBdLHRbMV09LWVbMV0sdFsyXT0tZVsyXSx0fTt2YXIgQz1mdW5jdGlvbih0LGUpe3JldHVybiB0WzBdPTEvZVswXSx0WzFdPTEvZVsxXSx0WzJdPTEvZVsyXSx0fTt2YXIgVT1mdW5jdGlvbih0LGUsbil7dmFyIGk9ZVswXSxyPWVbMV0scz1lWzJdLGE9blswXSxvPW5bMV0saD1uWzJdO3JldHVybiB0WzBdPXIqaC1zKm8sdFsxXT1zKmEtaSpoLHRbMl09aSpvLXIqYSx0fTt2YXIgXz1mdW5jdGlvbih0LGUsbixpKXt2YXIgcj1lWzBdLHM9ZVsxXSxhPWVbMl07cmV0dXJuIHRbMF09citpKihuWzBdLXIpLHRbMV09cytpKihuWzFdLXMpLHRbMl09YStpKihuWzJdLWEpLHR9O3ZhciBHPWZ1bmN0aW9uKHQsZSl7ZT1lfHwxO3ZhciBuPTIqTWF0aC5yYW5kb20oKSpNYXRoLlBJLGk9MipNYXRoLnJhbmRvbSgpLTEscj1NYXRoLnNxcnQoMS1pKmkpKmU7cmV0dXJuIHRbMF09TWF0aC5jb3Mobikqcix0WzFdPU1hdGguc2luKG4pKnIsdFsyXT1pKmUsdH07dmFyIEQ9ZnVuY3Rpb24odCxlLG4pe3ZhciBpPWVbMF0scj1lWzFdLHM9ZVsyXSxhPW5bM10qaStuWzddKnIrblsxMV0qcytuWzE1XTtyZXR1cm4gYT1hfHwxLHRbMF09KG5bMF0qaStuWzRdKnIrbls4XSpzK25bMTJdKS9hLHRbMV09KG5bMV0qaStuWzVdKnIrbls5XSpzK25bMTNdKS9hLHRbMl09KG5bMl0qaStuWzZdKnIrblsxMF0qcytuWzE0XSkvYSx0fTt2YXIgej1mdW5jdGlvbih0LGUsbil7dmFyIGk9ZVswXSxyPWVbMV0scz1lWzJdO3JldHVybiB0WzBdPWkqblswXStyKm5bM10rcypuWzZdLHRbMV09aSpuWzFdK3Iqbls0XStzKm5bN10sdFsyXT1pKm5bMl0rcipuWzVdK3Mqbls4XSx0fTt2YXIgUD1mdW5jdGlvbih0LGUsbil7dmFyIGk9ZVswXSxyPWVbMV0scz1lWzJdLGE9blswXSxvPW5bMV0saD1uWzJdLHU9blszXSxjPXUqaStvKnMtaCpyLGw9dSpyK2gqaS1hKnMsZj11KnMrYSpyLW8qaSxtPS1hKmktbypyLWgqcztyZXR1cm4gdFswXT1jKnUrbSotYStsKi1oLWYqLW8sdFsxXT1sKnUrbSotbytmKi1hLWMqLWgsdFsyXT1mKnUrbSotaCtjKi1vLWwqLWEsdH07dmFyIEY9ZnVuY3Rpb24odCxlLG4saSl7dmFyIHI9blsxXSxzPW5bMl0sYT1lWzFdLXIsbz1lWzJdLXMsaD1NYXRoLnNpbihpKSx1PU1hdGguY29zKGkpO3JldHVybiB0WzBdPWVbMF0sdFsxXT1yK2EqdS1vKmgsdFsyXT1zK2EqaCtvKnUsdH07dmFyICQ9ZnVuY3Rpb24odCxlLG4saSl7dmFyIHI9blswXSxzPW5bMl0sYT1lWzBdLXIsbz1lWzJdLXMsaD1NYXRoLnNpbihpKSx1PU1hdGguY29zKGkpO3JldHVybiB0WzBdPXIrbypoK2EqdSx0WzFdPWVbMV0sdFsyXT1zK28qdS1hKmgsdH07dmFyIEg9ZnVuY3Rpb24odCxlLG4saSl7dmFyIHI9blswXSxzPW5bMV0sYT1lWzBdLXIsbz1lWzFdLXMsaD1NYXRoLnNpbihpKSx1PU1hdGguY29zKGkpO3JldHVybiB0WzBdPXIrYSp1LW8qaCx0WzFdPXMrYSpoK28qdSx0WzJdPWVbMl0sdH07dmFyIEo9ZnVuY3Rpb24odCxlLG4saSxyLHMpe3ZhciBhLG87ZXx8KGU9Myk7bnx8KG49MCk7bz1pP01hdGgubWluKGkqZStuLHQubGVuZ3RoKTp0Lmxlbmd0aDtmb3IoYT1uO2E8bzthKz1lKVFbMF09dFthXSxRWzFdPXRbYSsxXSxRWzJdPXRbYSsyXSxyKFEsUSxzKSx0W2FdPVFbMF0sdFthKzFdPVFbMV0sdFthKzJdPVFbMl07cmV0dXJuIHR9LFE9aSgpO3ZhciBXPXtFUFNJTE9OOm4sY3JlYXRlOmksY2xvbmU6cixhbmdsZTpoLGZyb21WYWx1ZXM6cyxjb3B5OmYsc2V0Om0sZXF1YWxzOnAsZXhhY3RFcXVhbHM6ZyxhZGQ6eCxzdWJ0cmFjdDp2LHN1YjpiLG11bHRpcGx5Ok0sbXVsOncsZGl2aWRlOnksZGl2OkwsbWluOlIsbWF4OlgsZmxvb3I6WixjZWlsOmsscm91bmQ6WSxzY2FsZTpFLHNjYWxlQW5kQWRkOmosZGlzdGFuY2U6TyxkaXN0OkEsc3F1YXJlZERpc3RhbmNlOkIsc3FyRGlzdDpxLGxlbmd0aDpWLGxlbjpOLHNxdWFyZWRMZW5ndGg6UyxzcXJMZW46SSxuZWdhdGU6VCxpbnZlcnNlOkMsbm9ybWFsaXplOmEsZG90Om8sY3Jvc3M6VSxsZXJwOl8scmFuZG9tOkcsdHJhbnNmb3JtTWF0NDpELHRyYW5zZm9ybU1hdDM6eix0cmFuc2Zvcm1RdWF0OlAscm90YXRlWDpGLHJvdGF0ZVk6JCxyb3RhdGVaOkgsZm9yRWFjaDpKfTtmdW5jdGlvbiBLKHQsZSxuKXtyZXR1cm4gZSBpbiB0P09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LGUse3ZhbHVlOm4sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITB9KTp0W2VdPW4sdH1jbGFzcyB0dHtjb25zdHJ1Y3Rvcigpe319ZnVuY3Rpb24gZXQodCxlLG4pe3JldHVybiBlIGluIHQ/T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsZSx7dmFsdWU6bixlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pOnRbZV09bix0fUsodHQsImdldENodW5rTmFtZSIsKCh0LGU9InwiKT0+dFswXStlK3RbMV0pKSxLKHR0LCJnZXRWb3hlbE5hbWUiLCgodCxlPSJ8Iik9PigwfHRbMF0pK2UrKDB8dFsxXSkrZSsoMHx0WzJdKSkpLEsodHQsInBhcnNlQ2h1bmtOYW1lIiwoKHQsZT0ifCIpPT50LnNwbGl0KGUpLm1hcCgodD0+cGFyc2VJbnQodCwxMCkpKSkpLEsodHQsInNjYWxlQ29vcmRzRiIsKCh0LGUpPT57Y29uc3Qgbj1XLnNjYWxlKFswLDAsMF0sdCxlKTtyZXR1cm4gVy5mbG9vcihuLG4pfSkpLEsodHQsIm1hcFZveGVsVG9DaHVua0xvY2FsIiwoKHQsZSk9Pntjb25zdFtuLGldPXR0Lm1hcFZveGVsVG9DaHVuayh0LGUpLFtyLHMsYV09dDtyZXR1cm5bci1uKmUscyxhLWkqZV19KSksSyh0dCwibWFwVm94ZWxUb0NodW5rIiwoKHQsZSk9Pntjb25zdCBuPXR0LnNjYWxlQ29vcmRzRih0LDEvZSk7cmV0dXJuW25bMF0sblsyXV19KSksSyh0dCwibWFwQ2h1bmtUb1ZveGVsIiwoKHQsZSk9Pntjb25zdCBuPVswLDAsMF07cmV0dXJuIFcuY29weShuLFt0WzBdLDAsdFsxXV0pLFcuc2NhbGUobixuLGUpLG59KSksSyh0dCwibWFwV29ybGRUb1ZveGVsIiwodD0+dHQuc2NhbGVDb29yZHNGKHQsMSkpKTtjbGFzcyBudHtjb25zdHJ1Y3Rvcigpe319ZnVuY3Rpb24gaXQodCxlLG4pe3JldHVybiBlIGluIHQ/T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsZSx7dmFsdWU6bixlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pOnRbZV09bix0fWV0KG50LCJleHRyYWN0U3VubGlnaHQiLCh0PT50Pj4xMiYxNSkpLGV0KG50LCJpbnNlcnRTdW5saWdodCIsKCh0LGUpPT40MDk1JnR8ZTw8MTIpKSxldChudCwiZXh0cmFjdFJlZExpZ2h0IiwodD0+dD4+OCYxNSkpLGV0KG50LCJpbnNlcnRSZWRMaWdodCIsKCh0LGUpPT42MTY5NSZ0fGU8PDgpKSxldChudCwiZXh0cmFjdEdyZWVuTGlnaHQiLCh0PT50Pj40JjE1KSksZXQobnQsImluc2VydEdyZWVuTGlnaHQiLCgodCxlKT0+NjUyOTUmdHxlPDw0KSksZXQobnQsImV4dHJhY3RCbHVlTGlnaHQiLCh0PT4xNSZ0KSksZXQobnQsImluc2VydEJsdWVMaWdodCIsKCh0LGUpPT42NTUyMCZ0fGUpKSxldChudCwiY2FuRW50ZXJJbnRvIiwoKHQsZSxuLGkpPT57aWYoMSE9PU1hdGguYWJzKGUrbitpKSl0aHJvdyBuZXcgRXJyb3IoIlRoaXMgaXNuJ3Qgc3VwcG9zZWQgdG8gaGFwcGVuLiBMaWdodCBuZWlnaGJvcmluZyBkaXJlY3Rpb24gc2hvdWxkIGJlIG9uIDEgYXhpcyBvbmx5LiIpO2NvbnN0W3IscyxhLG8saCx1XT10O3JldHVybiAxPT09ZT9vOi0xPT09ZT9yOjE9PT1uP2g6LTE9PT1uP3M6MT09PWk/dTphfSkpLGV0KG50LCJjYW5FbnRlciIsKCh0LGUsbixpLHIpPT57aWYoMSE9PU1hdGguYWJzKG4raStyKSl0aHJvdyBuZXcgRXJyb3IoIlRoaXMgaXNuJ3Qgc3VwcG9zZWQgdG8gaGFwcGVuLiBMaWdodCBuZWlnaGJvcmluZyBkaXJlY3Rpb24gc2hvdWxkIGJlIG9uIDEgYXhpcyBvbmx5LiIpO2NvbnN0W3MsYSxvLGgsdSxjXT10LFtsLGYsbSxwLGQsZ109ZTtyZXR1cm4gMT09PW4/cyYmcDotMT09PW4/aCYmbDoxPT09aT9hJiZkOi0xPT09aT91JiZmOjE9PT1yP28mJmc6YyYmbX0pKTtjb25zdCBydD1NYXRoLlBJLHN0PU1hdGguUEkvMjtjbGFzcyBhdHtyb3RhdGVUcmFuc3BhcmVuY3koW3QsZSxuLGkscixzXSl7Y29uc3QgYT10aGlzLnZhbHVlO2lmKE1hdGguYWJzKGEpPE51bWJlci5FUFNJTE9OKXJldHVyblt0LGUsbixpLHIsc107Y29uc3Qgbz1bMSwyLDNdLGg9WzQsNSw2XTt0aGlzLnJvdGF0ZU5vZGUobywhMCwhMSksdGhpcy5yb3RhdGVOb2RlKGgsITAsITEpO2NvbnN0IHU9by5tYXAoKGE9PjE9PT1hP3Q6Mj09PWE/ZTozPT09YT9uOjQ9PT1hP2k6NT09PWE/cjpzKSksYz1oLm1hcCgoYT0+MT09PWE/dDoyPT09YT9lOjM9PT1hP246ND09PWE/aTo1PT09YT9yOnMpKTtyZXR1cm5bdVswXSx1WzFdLHVbMl0sY1swXSxjWzFdLGNbMl1dfWNvbnN0cnVjdG9yKHQ9MCxuPTApe2l0KHRoaXMsInZhbHVlIix2b2lkIDApLGl0KHRoaXMsInlSb3RhdGlvbiIsdm9pZCAwKSxpdCh0aGlzLCJyb3RhdGVOb2RlIiwoKHQsZT0hMCxuPSEwKT0+e3N3aXRjaChlJiYwIT09dGhpcy55Um90YXRpb24mJih0WzBdLT0uNSx0WzJdLT0uNSxhdC5yb3RhdGVZKHQsdGhpcy55Um90YXRpb24pLHRbMF0rPS41LHRbMl0rPS41KSx0aGlzLnZhbHVlKXtjYXNlIDI6YXQucm90YXRlWih0LC1zdCksbiYmKHRbMV0rPTEpO2JyZWFrO2Nhc2UgMzphdC5yb3RhdGVaKHQsc3QpLG4mJih0WzBdKz0xKTticmVhaztjYXNlIDA6YnJlYWs7Y2FzZSAxOmF0LnJvdGF0ZVgodCxydCksbiYmKHRbMV0rPTEsdFsyXSs9MSk7YnJlYWs7Y2FzZSA0OmF0LnJvdGF0ZVgodCxzdCksbiYmKHRbMV0rPTEpO2JyZWFrO2Nhc2UgNTphdC5yb3RhdGVYKHQsLXN0KSxuJiYodFsyXSs9MSl9fSkpLGl0KHRoaXMsInJvdGF0ZUFBQkIiLCgodCxuPSEwLGk9ITApPT57Y29uc3Qgcj1bdC5taW5YLHQubWluWSx0Lm1pblpdLHM9W3QubWF4WCx0Lm1heFksdC5tYXhaXTtsZXQgYT1udWxsLG89bnVsbCxoPW51bGwsdT1udWxsO2lmKG4mJjAhPT10aGlzLnlSb3RhdGlvbil7W1t0Lm1pblgsdC5taW5ZLHQubWluWl0sW3QubWluWCx0Lm1pblksdC5tYXhaXSxbdC5tYXhYLHQubWluWSx0Lm1pblpdLFt0Lm1heFgsdC5taW5ZLHQubWF4Wl1dLmZvckVhY2goKHQ9Pnt0aGlzLnJvdGF0ZU5vZGUodCwhMCwhMCksYT1udWxsPT09YT90WzBdOk1hdGgubWluKGEsdFswXSksbz1udWxsPT09bz90WzJdOk1hdGgubWluKG8sdFsyXSl9KSk7W1t0Lm1pblgsdC5tYXhZLHQubWluWl0sW3QubWluWCx0Lm1heFksdC5tYXhaXSxbdC5tYXhYLHQubWF4WSx0Lm1pblpdLFt0Lm1heFgsdC5tYXhZLHQubWF4Wl1dLmZvckVhY2goKHQ9Pnt0aGlzLnJvdGF0ZU5vZGUodCwhMCwhMCksaD1udWxsPT09aD90WzBdOk1hdGgubWF4KGgsdFswXSksdT1udWxsPT09dT90WzJdOk1hdGgubWF4KHUsdFsyXSl9KSl9dGhpcy5yb3RhdGVOb2RlKHIsbixpKSx0aGlzLnJvdGF0ZU5vZGUocyxuLGkpO2NvbnN0IGM9dD0+dDwxZS00PzA6dDtyWzBdPWMoclswXSksclsxXT1jKHJbMV0pLHJbMl09YyhyWzJdKSxzWzBdPWMoc1swXSksc1sxXT1jKHNbMV0pLHNbMl09YyhzWzJdKTtjb25zdCBsPVtudWxsIT09YT9jKGEpOk1hdGgubWluKHJbMF0sc1swXSksTWF0aC5taW4oclsxXSxzWzFdKSxudWxsIT09bz9jKG8pOk1hdGgubWluKHJbMl0sc1syXSldLGY9W251bGwhPT1oP2MoaCk6TWF0aC5tYXgoclswXSxzWzBdKSxNYXRoLm1heChyWzFdLHNbMV0pLG51bGwhPT11P2ModSk6TWF0aC5tYXgoclsyXSxzWzJdKV07cmV0dXJuIG5ldyBlKGxbMF0sbFsxXSxsWzJdLGZbMF0sZlsxXSxmWzJdKX0pKSx0aGlzLnZhbHVlPXQsdGhpcy55Um90YXRpb249bn19aXQoYXQsImVuY29kZSIsKCh0LGU9MCk9Pntjb25zdCBuPWUqTWF0aC5QSSoyLzE2O3JldHVybiBuZXcgYXQodCxuKX0pKSxpdChhdCwiZGVjb2RlIiwodD0+W3QudmFsdWUsTWF0aC5yb3VuZCgxNip0LnlSb3RhdGlvbi8oMipNYXRoLlBJKSklMTZdKSksaXQoYXQsInJvdGF0ZVgiLCgodCxlKT0+e2NvbnN0IG49TWF0aC5zaW4oZSksaT1NYXRoLmNvcyhlKSxbLHIsc109dDt0WzFdPXIqaS1zKm4sdFsyXT1zKmkrcipufSkpLGl0KGF0LCJyb3RhdGVZIiwoKHQsZSk9Pntjb25zdCBuPU1hdGguc2luKGUpLGk9TWF0aC5jb3MoZSksW3IsLHNdPXQ7dFswXT1yKmkrcypuLHRbMl09cyppLXIqbn0pKSxpdChhdCwicm90YXRlWiIsKCh0LGUpPT57Y29uc3Qgbj1NYXRoLnNpbihlKSxpPU1hdGguY29zKGUpLFtyLHNdPXQ7dFswXT1yKmktcypuLHRbMV09cyppK3Iqbn0pKTtmdW5jdGlvbiBvdCh0KXtyZXR1cm4hIXQuY29uc3RydWN0b3ImJiJmdW5jdGlvbiI9PXR5cGVvZiB0LmNvbnN0cnVjdG9yLmlzQnVmZmVyJiZ0LmNvbnN0cnVjdG9yLmlzQnVmZmVyKHQpfXZhciBodD1mdW5jdGlvbih0KXtmb3IodmFyIGU9bmV3IEFycmF5KHQpLG49MDtuPHQ7KytuKWVbbl09bjtyZXR1cm4gZX0sdXQ9ZnVuY3Rpb24odCl7cmV0dXJuIG51bGwhPXQmJihvdCh0KXx8ZnVuY3Rpb24odCl7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIHQucmVhZEZsb2F0TEUmJiJmdW5jdGlvbiI9PXR5cGVvZiB0LnNsaWNlJiZvdCh0LnNsaWNlKDAsMCkpfSh0KXx8ISF0Ll9pc0J1ZmZlcil9LGN0PSJ1bmRlZmluZWQiIT10eXBlb2YgRmxvYXQ2NEFycmF5O2Z1bmN0aW9uIGx0KHQsZSl7cmV0dXJuIHRbMF0tZVswXX1mdW5jdGlvbiBmdCgpe3ZhciB0LGU9dGhpcy5zdHJpZGUsbj1uZXcgQXJyYXkoZS5sZW5ndGgpO2Zvcih0PTA7dDxuLmxlbmd0aDsrK3Qpblt0XT1bTWF0aC5hYnMoZVt0XSksdF07bi5zb3J0KGx0KTt2YXIgaT1uZXcgQXJyYXkobi5sZW5ndGgpO2Zvcih0PTA7dDxpLmxlbmd0aDsrK3QpaVt0XT1uW3RdWzFdO3JldHVybiBpfWZ1bmN0aW9uIG10KHQsZSl7dmFyIG49WyJWaWV3IixlLCJkIix0XS5qb2luKCIiKTtlPDAmJihuPSJWaWV3X05pbCIrdCk7dmFyIGk9ImdlbmVyaWMiPT09dDtpZigtMT09PWUpe3ZhciByPSJmdW5jdGlvbiAiK24rIihhKXt0aGlzLmRhdGE9YTt9O3ZhciBwcm90bz0iK24rIi5wcm90b3R5cGU7cHJvdG8uZHR5cGU9JyIrdCsiJztwcm90by5pbmRleD1mdW5jdGlvbigpe3JldHVybiAtMX07cHJvdG8uc2l6ZT0wO3Byb3RvLmRpbWVuc2lvbj0tMTtwcm90by5zaGFwZT1wcm90by5zdHJpZGU9cHJvdG8ub3JkZXI9W107cHJvdG8ubG89cHJvdG8uaGk9cHJvdG8udHJhbnNwb3NlPXByb3RvLnN0ZXA9ZnVuY3Rpb24oKXtyZXR1cm4gbmV3ICIrbisiKHRoaXMuZGF0YSk7fTtwcm90by5nZXQ9cHJvdG8uc2V0PWZ1bmN0aW9uKCl7fTtwcm90by5waWNrPWZ1bmN0aW9uKCl7cmV0dXJuIG51bGx9O3JldHVybiBmdW5jdGlvbiBjb25zdHJ1Y3RfIituKyIoYSl7cmV0dXJuIG5ldyAiK24rIihhKTt9IjtyZXR1cm4gbmV3IEZ1bmN0aW9uKHIpKCl9aWYoMD09PWUpe3I9ImZ1bmN0aW9uICIrbisiKGEsZCkge3RoaXMuZGF0YSA9IGE7dGhpcy5vZmZzZXQgPSBkfTt2YXIgcHJvdG89IituKyIucHJvdG90eXBlO3Byb3RvLmR0eXBlPSciK3QrIic7cHJvdG8uaW5kZXg9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vZmZzZXR9O3Byb3RvLmRpbWVuc2lvbj0wO3Byb3RvLnNpemU9MTtwcm90by5zaGFwZT1wcm90by5zdHJpZGU9cHJvdG8ub3JkZXI9W107cHJvdG8ubG89cHJvdG8uaGk9cHJvdG8udHJhbnNwb3NlPXByb3RvLnN0ZXA9ZnVuY3Rpb24gIituKyJfY29weSgpIHtyZXR1cm4gbmV3ICIrbisiKHRoaXMuZGF0YSx0aGlzLm9mZnNldCl9O3Byb3RvLnBpY2s9ZnVuY3Rpb24gIituKyJfcGljaygpe3JldHVybiBUcml2aWFsQXJyYXkodGhpcy5kYXRhKTt9O3Byb3RvLnZhbHVlT2Y9cHJvdG8uZ2V0PWZ1bmN0aW9uICIrbisiX2dldCgpe3JldHVybiAiKyhpPyJ0aGlzLmRhdGEuZ2V0KHRoaXMub2Zmc2V0KSI6InRoaXMuZGF0YVt0aGlzLm9mZnNldF0iKSsifTtwcm90by5zZXQ9ZnVuY3Rpb24gIituKyJfc2V0KHYpe3JldHVybiAiKyhpPyJ0aGlzLmRhdGEuc2V0KHRoaXMub2Zmc2V0LHYpIjoidGhpcy5kYXRhW3RoaXMub2Zmc2V0XT12IikrIn07cmV0dXJuIGZ1bmN0aW9uIGNvbnN0cnVjdF8iK24rIihhLGIsYyxkKXtyZXR1cm4gbmV3ICIrbisiKGEsZCl9IjtyZXR1cm4gbmV3IEZ1bmN0aW9uKCJUcml2aWFsQXJyYXkiLHIpKHB0W3RdWzBdKX1yPVsiJ3VzZSBzdHJpY3QnIl07dmFyIHM9aHQoZSksYT1zLm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuImkiK3R9KSksbz0idGhpcy5vZmZzZXQrIitzLm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuInRoaXMuc3RyaWRlWyIrdCsiXSppIit0fSkpLmpvaW4oIisiKSxoPXMubWFwKChmdW5jdGlvbih0KXtyZXR1cm4iYiIrdH0pKS5qb2luKCIsIiksdT1zLm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuImMiK3R9KSkuam9pbigiLCIpO3IucHVzaCgiZnVuY3Rpb24gIituKyIoYSwiK2grIiwiK3UrIixkKXt0aGlzLmRhdGE9YSIsInRoaXMuc2hhcGU9WyIraCsiXSIsInRoaXMuc3RyaWRlPVsiK3UrIl0iLCJ0aGlzLm9mZnNldD1kfDB9IiwidmFyIHByb3RvPSIrbisiLnByb3RvdHlwZSIsInByb3RvLmR0eXBlPSciK3QrIiciLCJwcm90by5kaW1lbnNpb249IitlKSxyLnB1c2goIk9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90bywnc2l6ZScse2dldDpmdW5jdGlvbiAiK24rIl9zaXplKCl7cmV0dXJuICIrcy5tYXAoKGZ1bmN0aW9uKHQpe3JldHVybiJ0aGlzLnNoYXBlWyIrdCsiXSJ9KSkuam9pbigiKiIpLCJ9fSkiKSwxPT09ZT9yLnB1c2goInByb3RvLm9yZGVyPVswXSIpOihyLnB1c2goIk9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm90bywnb3JkZXInLHtnZXQ6IiksZTw0PyhyLnB1c2goImZ1bmN0aW9uICIrbisiX29yZGVyKCl7IiksMj09PWU/ci5wdXNoKCJyZXR1cm4gKE1hdGguYWJzKHRoaXMuc3RyaWRlWzBdKT5NYXRoLmFicyh0aGlzLnN0cmlkZVsxXSkpP1sxLDBdOlswLDFdfX0pIik6Mz09PWUmJnIucHVzaCgidmFyIHMwPU1hdGguYWJzKHRoaXMuc3RyaWRlWzBdKSxzMT1NYXRoLmFicyh0aGlzLnN0cmlkZVsxXSksczI9TWF0aC5hYnModGhpcy5zdHJpZGVbMl0pO2lmKHMwPnMxKXtpZihzMT5zMil7cmV0dXJuIFsyLDEsMF07fWVsc2UgaWYoczA+czIpe3JldHVybiBbMSwyLDBdO31lbHNle3JldHVybiBbMSwwLDJdO319ZWxzZSBpZihzMD5zMil7cmV0dXJuIFsyLDAsMV07fWVsc2UgaWYoczI+czEpe3JldHVybiBbMCwxLDJdO31lbHNle3JldHVybiBbMCwyLDFdO319fSkiKSk6ci5wdXNoKCJPUkRFUn0pIikpLHIucHVzaCgicHJvdG8uc2V0PWZ1bmN0aW9uICIrbisiX3NldCgiK2Euam9pbigiLCIpKyIsdil7IiksaT9yLnB1c2goInJldHVybiB0aGlzLmRhdGEuc2V0KCIrbysiLHYpfSIpOnIucHVzaCgicmV0dXJuIHRoaXMuZGF0YVsiK28rIl09dn0iKSxyLnB1c2goInByb3RvLmdldD1mdW5jdGlvbiAiK24rIl9nZXQoIithLmpvaW4oIiwiKSsiKXsiKSxpP3IucHVzaCgicmV0dXJuIHRoaXMuZGF0YS5nZXQoIitvKyIpfSIpOnIucHVzaCgicmV0dXJuIHRoaXMuZGF0YVsiK28rIl19Iiksci5wdXNoKCJwcm90by5pbmRleD1mdW5jdGlvbiAiK24rIl9pbmRleCgiLGEuam9pbigpLCIpe3JldHVybiAiK28rIn0iKSxyLnB1c2goInByb3RvLmhpPWZ1bmN0aW9uICIrbisiX2hpKCIrYS5qb2luKCIsIikrIil7cmV0dXJuIG5ldyAiK24rIih0aGlzLmRhdGEsIitzLm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuWyIodHlwZW9mIGkiLHQsIiE9PSdudW1iZXInfHxpIix0LCI8MCk/dGhpcy5zaGFwZVsiLHQsIl06aSIsdCwifDAiXS5qb2luKCIiKX0pKS5qb2luKCIsIikrIiwiK3MubWFwKChmdW5jdGlvbih0KXtyZXR1cm4idGhpcy5zdHJpZGVbIit0KyJdIn0pKS5qb2luKCIsIikrIix0aGlzLm9mZnNldCl9Iik7dmFyIGM9cy5tYXAoKGZ1bmN0aW9uKHQpe3JldHVybiJhIit0KyI9dGhpcy5zaGFwZVsiK3QrIl0ifSkpLGw9cy5tYXAoKGZ1bmN0aW9uKHQpe3JldHVybiJjIit0KyI9dGhpcy5zdHJpZGVbIit0KyJdIn0pKTtyLnB1c2goInByb3RvLmxvPWZ1bmN0aW9uICIrbisiX2xvKCIrYS5qb2luKCIsIikrIil7dmFyIGI9dGhpcy5vZmZzZXQsZD0wLCIrYy5qb2luKCIsIikrIiwiK2wuam9pbigiLCIpKTtmb3IodmFyIGY9MDtmPGU7KytmKXIucHVzaCgiaWYodHlwZW9mIGkiK2YrIj09PSdudW1iZXInJiZpIitmKyI+PTApe2Q9aSIrZisifDA7Yis9YyIrZisiKmQ7YSIrZisiLT1kfSIpO3IucHVzaCgicmV0dXJuIG5ldyAiK24rIih0aGlzLmRhdGEsIitzLm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuImEiK3R9KSkuam9pbigiLCIpKyIsIitzLm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuImMiK3R9KSkuam9pbigiLCIpKyIsYil9Iiksci5wdXNoKCJwcm90by5zdGVwPWZ1bmN0aW9uICIrbisiX3N0ZXAoIithLmpvaW4oIiwiKSsiKXt2YXIgIitzLm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuImEiK3QrIj10aGlzLnNoYXBlWyIrdCsiXSJ9KSkuam9pbigiLCIpKyIsIitzLm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuImIiK3QrIj10aGlzLnN0cmlkZVsiK3QrIl0ifSkpLmpvaW4oIiwiKSsiLGM9dGhpcy5vZmZzZXQsZD0wLGNlaWw9TWF0aC5jZWlsIik7Zm9yKGY9MDtmPGU7KytmKXIucHVzaCgiaWYodHlwZW9mIGkiK2YrIj09PSdudW1iZXInKXtkPWkiK2YrInwwO2lmKGQ8MCl7Yys9YiIrZisiKihhIitmKyItMSk7YSIrZisiPWNlaWwoLWEiK2YrIi9kKX1lbHNle2EiK2YrIj1jZWlsKGEiK2YrIi9kKX1iIitmKyIqPWR9Iik7ci5wdXNoKCJyZXR1cm4gbmV3ICIrbisiKHRoaXMuZGF0YSwiK3MubWFwKChmdW5jdGlvbih0KXtyZXR1cm4iYSIrdH0pKS5qb2luKCIsIikrIiwiK3MubWFwKChmdW5jdGlvbih0KXtyZXR1cm4iYiIrdH0pKS5qb2luKCIsIikrIixjKX0iKTt2YXIgbT1uZXcgQXJyYXkoZSkscD1uZXcgQXJyYXkoZSk7Zm9yKGY9MDtmPGU7KytmKW1bZl09ImFbaSIrZisiXSIscFtmXT0iYltpIitmKyJdIjtyLnB1c2goInByb3RvLnRyYW5zcG9zZT1mdW5jdGlvbiAiK24rIl90cmFuc3Bvc2UoIithKyIpeyIrYS5tYXAoKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIHQrIj0oIit0KyI9PT11bmRlZmluZWQ/IitlKyI6Iit0KyJ8MCkifSkpLmpvaW4oIjsiKSwidmFyIGE9dGhpcy5zaGFwZSxiPXRoaXMuc3RyaWRlO3JldHVybiBuZXcgIituKyIodGhpcy5kYXRhLCIrbS5qb2luKCIsIikrIiwiK3Auam9pbigiLCIpKyIsdGhpcy5vZmZzZXQpfSIpLHIucHVzaCgicHJvdG8ucGljaz1mdW5jdGlvbiAiK24rIl9waWNrKCIrYSsiKXt2YXIgYT1bXSxiPVtdLGM9dGhpcy5vZmZzZXQiKTtmb3IoZj0wO2Y8ZTsrK2Ypci5wdXNoKCJpZih0eXBlb2YgaSIrZisiPT09J251bWJlcicmJmkiK2YrIj49MCl7Yz0oYyt0aGlzLnN0cmlkZVsiK2YrIl0qaSIrZisiKXwwfWVsc2V7YS5wdXNoKHRoaXMuc2hhcGVbIitmKyJdKTtiLnB1c2godGhpcy5zdHJpZGVbIitmKyJdKX0iKTtyZXR1cm4gci5wdXNoKCJ2YXIgY3Rvcj1DVE9SX0xJU1RbYS5sZW5ndGgrMV07cmV0dXJuIGN0b3IodGhpcy5kYXRhLGEsYixjKX0iKSxyLnB1c2goInJldHVybiBmdW5jdGlvbiBjb25zdHJ1Y3RfIituKyIoZGF0YSxzaGFwZSxzdHJpZGUsb2Zmc2V0KXtyZXR1cm4gbmV3ICIrbisiKGRhdGEsIitzLm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuInNoYXBlWyIrdCsiXSJ9KSkuam9pbigiLCIpKyIsIitzLm1hcCgoZnVuY3Rpb24odCl7cmV0dXJuInN0cmlkZVsiK3QrIl0ifSkpLmpvaW4oIiwiKSsiLG9mZnNldCl9IiksbmV3IEZ1bmN0aW9uKCJDVE9SX0xJU1QiLCJPUkRFUiIsci5qb2luKCJcbiIpKShwdFt0XSxmdCl9dmFyIHB0PXtmbG9hdDMyOltdLGZsb2F0NjQ6W10saW50ODpbXSxpbnQxNjpbXSxpbnQzMjpbXSx1aW50ODpbXSx1aW50MTY6W10sdWludDMyOltdLGFycmF5OltdLHVpbnQ4X2NsYW1wZWQ6W10sYmlnaW50NjQ6W10sYmlndWludDY0OltdLGJ1ZmZlcjpbXSxnZW5lcmljOltdfTt2YXIgZHQ9ZnVuY3Rpb24odCxlLG4saSl7aWYodm9pZCAwPT09dClyZXR1cm4oMCxwdC5hcnJheVswXSkoW10pOyJudW1iZXIiPT10eXBlb2YgdCYmKHQ9W3RdKSx2b2lkIDA9PT1lJiYoZT1bdC5sZW5ndGhdKTt2YXIgcj1lLmxlbmd0aDtpZih2b2lkIDA9PT1uKXtuPW5ldyBBcnJheShyKTtmb3IodmFyIHM9ci0xLGE9MTtzPj0wOy0tcyluW3NdPWEsYSo9ZVtzXX1pZih2b2lkIDA9PT1pKXtpPTA7Zm9yKHM9MDtzPHI7KytzKW5bc108MCYmKGktPShlW3NdLTEpKm5bc10pfWZvcih2YXIgbz1mdW5jdGlvbih0KXtpZih1dCh0KSlyZXR1cm4iYnVmZmVyIjtpZihjdClzd2l0Y2goT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHQpKXtjYXNlIltvYmplY3QgRmxvYXQ2NEFycmF5XSI6cmV0dXJuImZsb2F0NjQiO2Nhc2UiW29iamVjdCBGbG9hdDMyQXJyYXldIjpyZXR1cm4iZmxvYXQzMiI7Y2FzZSJbb2JqZWN0IEludDhBcnJheV0iOnJldHVybiJpbnQ4IjtjYXNlIltvYmplY3QgSW50MTZBcnJheV0iOnJldHVybiJpbnQxNiI7Y2FzZSJbb2JqZWN0IEludDMyQXJyYXldIjpyZXR1cm4iaW50MzIiO2Nhc2UiW29iamVjdCBVaW50OEFycmF5XSI6cmV0dXJuInVpbnQ4IjtjYXNlIltvYmplY3QgVWludDE2QXJyYXldIjpyZXR1cm4idWludDE2IjtjYXNlIltvYmplY3QgVWludDMyQXJyYXldIjpyZXR1cm4idWludDMyIjtjYXNlIltvYmplY3QgVWludDhDbGFtcGVkQXJyYXldIjpyZXR1cm4idWludDhfY2xhbXBlZCI7Y2FzZSJbb2JqZWN0IEJpZ0ludDY0QXJyYXldIjpyZXR1cm4iYmlnaW50NjQiO2Nhc2UiW29iamVjdCBCaWdVaW50NjRBcnJheV0iOnJldHVybiJiaWd1aW50NjQifXJldHVybiBBcnJheS5pc0FycmF5KHQpPyJhcnJheSI6ImdlbmVyaWMifSh0KSxoPXB0W29dO2gubGVuZ3RoPD1yKzE7KWgucHVzaChtdChvLGgubGVuZ3RoLTEpKTtyZXR1cm4oMCxoW3IrMV0pKHQsZSxuLGkpfTtmdW5jdGlvbiBndCh0LGUsbil7cmV0dXJuIGUgaW4gdD9PYmplY3QuZGVmaW5lUHJvcGVydHkodCxlLHt2YWx1ZTpuLGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwfSk6dFtlXT1uLHR9Y2xhc3MgeHR7c3RhdGljIGdldEJsb2NrUm90YXRlZFRyYW5zcGFyZW5jeSh0LGUpe3JldHVybiBlLnJvdGF0ZVRyYW5zcGFyZW5jeSh0LmlzVHJhbnNwYXJlbnQpfWNvbnN0cnVjdG9yKCl7fX1mdW5jdGlvbiB2dCh0LGUsbil7cmV0dXJuIGUgaW4gdD9PYmplY3QuZGVmaW5lUHJvcGVydHkodCxlLHt2YWx1ZTpuLGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwfSk6dFtlXT1uLHR9Z3QoeHQsImV4dHJhY3RJRCIsKHQ9PjY1NTM1JnQpKSxndCh4dCwiaW5zZXJ0SUQiLCgodCxlKT0+NDI5NDkwMTc2MCZ0fDY1NTM1JmUpKSxndCh4dCwiZXh0cmFjdFJvdGF0aW9uIiwodD0+e2NvbnN0IGU9dD4+MTYmMTUsbj10Pj4yMCYxNTtyZXR1cm4gYXQuZW5jb2RlKGUsbil9KSksZ3QoeHQsImluc2VydFJvdGF0aW9uIiwoKHQsZSk9Pntjb25zdFtuLGldPWF0LmRlY29kZShlKTtyZXR1cm4gNDI3OTIzODY1NSYoNDI5Mzk4NDI1NSZ0fCgxNSZuKTw8MTYpfCgxNSZpKTw8MjB9KSksZ3QoeHQsImV4dHJhY3RTdGFnZSIsKHQ9PnQ+PjI0JjE1KSksZ3QoeHQsImluc2VydFN0YWdlIiwoKHQsZSk9PjQwNDMzMDkwNTUmdHxlPDwyNCkpLGd0KHh0LCJpbnNlcnRBbGwiLCgodCxlLG4pPT57bGV0IGk9MDtyZXR1cm4gaT14dC5pbnNlcnRJRChpLHQpLGUmJihpPXh0Lmluc2VydFJvdGF0aW9uKGksZSkpLHZvaWQgMCE9PW4mJihpPXh0Lmluc2VydFN0YWdlKGksbikpLGl9KSksZ3QoeHQsImdldEJsb2NrVG9yY2hMaWdodExldmVsIiwoKHQsZSk9Pntzd2l0Y2goZSl7Y2FzZSJSRUQiOnJldHVybiB0LnJlZExpZ2h0TGV2ZWw7Y2FzZSJHUkVFTiI6cmV0dXJuIHQuZ3JlZW5MaWdodExldmVsO2Nhc2UiQkxVRSI6cmV0dXJuIHQuYmx1ZUxpZ2h0TGV2ZWx9cmV0dXJuIDB9KSk7Y2xhc3MgYnR7c2VyaWFsaXplKCl7cmV0dXJuW3tpZDp0aGlzLmlkLHg6dGhpcy5jb29yZHNbMF0sejp0aGlzLmNvb3Jkc1sxXSx2b3hlbHM6dGhpcy52b3hlbHMuZGF0YS5idWZmZXIsbGlnaHRzOnRoaXMubGlnaHRzLmRhdGEuYnVmZmVyLG9wdGlvbnM6dGhpcy5vcHRpb25zfSxbdGhpcy52b3hlbHMuZGF0YS5idWZmZXIuc2xpY2UoMCksdGhpcy5saWdodHMuZGF0YS5idWZmZXIuc2xpY2UoMCldXX1zdGF0aWMgZGVzZXJpYWxpemUodCl7Y29uc3R7aWQ6ZSx4Om4sejppLHZveGVsczpyLGxpZ2h0czpzLG9wdGlvbnM6YX09dCxvPW5ldyBidChlLFtuLGldLGEpO3JldHVybiBzJiZzLmJ5dGVMZW5ndGgmJihvLmxpZ2h0cy5kYXRhPW5ldyBVaW50MzJBcnJheShzKSksciYmci5ieXRlTGVuZ3RoJiYoby52b3hlbHMuZGF0YT1uZXcgVWludDMyQXJyYXkocikpLG99c2V0RGF0YSh0KXtjb25zdHtpZDplLHg6bix6Oml9PXQ7aWYodGhpcy5pZCE9PWUpdGhyb3cgbmV3IEVycm9yKCJDaHVuayBpZCBtaXNtYXRjaCIpO2lmKHRoaXMuY29vcmRzWzBdIT09bnx8dGhpcy5jb29yZHNbMV0hPT1pKXRocm93IG5ldyBFcnJvcigiQ2h1bmsgY29vcmRzIG1pc21hdGNoIik7Y29uc3R7dm94ZWxzOnIsbGlnaHRzOnN9PXQ7cyYmcy5ieXRlTGVuZ3RoJiYodGhpcy5saWdodHMuZGF0YT1uZXcgVWludDMyQXJyYXkocykpLHImJnIuYnl0ZUxlbmd0aCYmKHRoaXMudm94ZWxzLmRhdGE9bmV3IFVpbnQzMkFycmF5KHIpKX1nZXRSYXdWYWx1ZSh0LGUsbil7aWYoIXRoaXMuY29udGFpbnModCxlLG4pKXJldHVybiAwO2NvbnN0W2kscixzXT10aGlzLnRvTG9jYWwodCxlLG4pO3JldHVybiB0aGlzLnZveGVscy5nZXQoaSxyLHMpfXNldFJhd1ZhbHVlKHQsZSxuLGkpe2lmKCF0aGlzLmNvbnRhaW5zKHQsZSxuKSlyZXR1cm4gMDtjb25zdFtyLHMsYV09dGhpcy50b0xvY2FsKHQsZSxuKTtyZXR1cm4gdGhpcy52b3hlbHMuc2V0KHIscyxhLGkpfWdldFJhd0xpZ2h0KHQsZSxuKXtpZighdGhpcy5jb250YWlucyh0LGUsbikpcmV0dXJuIDA7Y29uc3RbaSxyLHNdPXRoaXMudG9Mb2NhbCh0LGUsbik7cmV0dXJuIHRoaXMubGlnaHRzLmdldChpLHIscyl9c2V0UmF3TGlnaHQodCxlLG4saSl7aWYoIXRoaXMuY29udGFpbnModCxlLG4pKXJldHVybiAwO2NvbnN0W3IscyxhXT10aGlzLnRvTG9jYWwodCxlLG4pO3JldHVybiB0aGlzLmxpZ2h0cy5zZXQocixzLGEsaSl9Z2V0Vm94ZWwodCxlLG4pe3JldHVybiB4dC5leHRyYWN0SUQodGhpcy5nZXRSYXdWYWx1ZSgwfHQsMHxlLDB8bikpfXNldFZveGVsKHQsZSxuLGkpe2NvbnN0IHI9eHQuaW5zZXJ0SUQoMCxpKTtyZXR1cm4gdGhpcy5zZXRSYXdWYWx1ZSh0LGUsbixyKSxpfWdldFZveGVsUm90YXRpb24odCxlLG4pe3JldHVybiB0aGlzLmNvbnRhaW5zKHQsZSxuKT94dC5leHRyYWN0Um90YXRpb24odGhpcy5nZXRSYXdWYWx1ZSh0LGUsbikpOm5ldyBhdH1zZXRWb3hlbFJvdGF0aW9uKHQsZSxuLGkpe2NvbnN0IHI9eHQuaW5zZXJ0Um90YXRpb24odGhpcy5nZXRSYXdWYWx1ZSh0LGUsbiksaSk7dGhpcy5zZXRSYXdWYWx1ZSh0LGUsbixyKX1nZXRWb3hlbFN0YWdlKHQsZSxuKXtyZXR1cm4gdGhpcy5jb250YWlucyh0LGUsbik/eHQuZXh0cmFjdFN0YWdlKHRoaXMuZ2V0UmF3VmFsdWUodCxlLG4pKTowfXNldFZveGVsU3RhZ2UodCxlLG4saSl7Y29uc3Qgcj14dC5pbnNlcnRTdGFnZSh0aGlzLmdldFJhd1ZhbHVlKHQsZSxuKSxpKTtyZXR1cm4gdGhpcy5zZXRSYXdWYWx1ZSh0LGUsbixyKSxpfWdldFJlZExpZ2h0KHQsZSxuKXtpZighdGhpcy5jb250YWlucyh0LGUsbikpcmV0dXJuIDA7Y29uc3RbaSxyLHNdPXRoaXMudG9Mb2NhbCh0LGUsbik7cmV0dXJuIHRoaXMuZ2V0TG9jYWxSZWRMaWdodChpLHIscyl9c2V0UmVkTGlnaHQodCxlLG4saSl7aWYoIXRoaXMuY29udGFpbnModCxlLG4pKXJldHVybiAwO2NvbnN0W3IscyxhXT10aGlzLnRvTG9jYWwodCxlLG4pO3JldHVybiB0aGlzLnNldExvY2FsUmVkTGlnaHQocixzLGEsaSl9Z2V0R3JlZW5MaWdodCh0LGUsbil7aWYoIXRoaXMuY29udGFpbnModCxlLG4pKXJldHVybiAwO2NvbnN0W2kscixzXT10aGlzLnRvTG9jYWwodCxlLG4pO3JldHVybiB0aGlzLmdldExvY2FsR3JlZW5MaWdodChpLHIscyl9c2V0R3JlZW5MaWdodCh0LGUsbixpKXtpZighdGhpcy5jb250YWlucyh0LGUsbikpcmV0dXJuIDA7Y29uc3RbcixzLGFdPXRoaXMudG9Mb2NhbCh0LGUsbik7cmV0dXJuIHRoaXMuc2V0TG9jYWxHcmVlbkxpZ2h0KHIscyxhLGkpfWdldEJsdWVMaWdodCh0LGUsbil7aWYoIXRoaXMuY29udGFpbnModCxlLG4pKXJldHVybiAwO2NvbnN0W2kscixzXT10aGlzLnRvTG9jYWwodCxlLG4pO3JldHVybiB0aGlzLmdldExvY2FsQmx1ZUxpZ2h0KGkscixzKX1zZXRCbHVlTGlnaHQodCxlLG4saSl7aWYoIXRoaXMuY29udGFpbnModCxlLG4pKXJldHVybiAwO2NvbnN0W3IscyxhXT10aGlzLnRvTG9jYWwodCxlLG4pO3JldHVybiB0aGlzLnNldExvY2FsQmx1ZUxpZ2h0KHIscyxhLGkpfWdldFRvcmNoTGlnaHQodCxlLG4saSl7c3dpdGNoKGkpe2Nhc2UiUkVEIjpyZXR1cm4gdGhpcy5nZXRSZWRMaWdodCh0LGUsbik7Y2FzZSJHUkVFTiI6cmV0dXJuIHRoaXMuZ2V0R3JlZW5MaWdodCh0LGUsbik7Y2FzZSJCTFVFIjpyZXR1cm4gdGhpcy5nZXRCbHVlTGlnaHQodCxlLG4pO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCJSZWNlaXZlZCB1bmtub3duIGxpZ2h0IGNvbG9yLi4uIil9fXNldFRvcmNoTGlnaHQodCxlLG4saSxyKXtzd2l0Y2gocil7Y2FzZSJSRUQiOnJldHVybiB0aGlzLnNldFJlZExpZ2h0KHQsZSxuLGkpO2Nhc2UiR1JFRU4iOnJldHVybiB0aGlzLnNldEdyZWVuTGlnaHQodCxlLG4saSk7Y2FzZSJCTFVFIjpyZXR1cm4gdGhpcy5zZXRCbHVlTGlnaHQodCxlLG4saSk7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoIlJlY2VpdmVkIHVua25vd24gbGlnaHQgY29sb3IuLi4iKX19Z2V0U3VubGlnaHQodCxlLG4pe2lmKCF0aGlzLmNvbnRhaW5zKHQsZSxuKSlyZXR1cm4gMDtjb25zdFtpLHIsc109dGhpcy50b0xvY2FsKHQsZSxuKTtyZXR1cm4gdGhpcy5nZXRMb2NhbFN1bmxpZ2h0KGkscixzKX1zZXRTdW5saWdodCh0LGUsbixpKXtpZighdGhpcy5jb250YWlucyh0LGUsbikpcmV0dXJuIDA7Y29uc3RbcixzLGFdPXRoaXMudG9Mb2NhbCh0LGUsbik7cmV0dXJuIHRoaXMuc2V0TG9jYWxTdW5saWdodChyLHMsYSxpKX1nZXQgaXNSZWFkeSgpe3JldHVybiAwIT09dGhpcy5saWdodHMuZGF0YS5sZW5ndGgmJjAhPT10aGlzLnZveGVscy5kYXRhLmxlbmd0aH1nZXRMb2NhbFJlZExpZ2h0KHQsZSxuKXtyZXR1cm4gbnQuZXh0cmFjdFJlZExpZ2h0KHRoaXMubGlnaHRzLmdldCh0LGUsbikpfXNldExvY2FsUmVkTGlnaHQodCxlLG4saSl7cmV0dXJuIHRoaXMubGlnaHRzLnNldCh0LGUsbixudC5pbnNlcnRSZWRMaWdodCh0aGlzLmxpZ2h0cy5nZXQodCxlLG4pLGkpKX1nZXRMb2NhbEdyZWVuTGlnaHQodCxlLG4pe3JldHVybiBudC5leHRyYWN0R3JlZW5MaWdodCh0aGlzLmxpZ2h0cy5nZXQodCxlLG4pKX1zZXRMb2NhbEdyZWVuTGlnaHQodCxlLG4saSl7cmV0dXJuIHRoaXMubGlnaHRzLnNldCh0LGUsbixudC5pbnNlcnRHcmVlbkxpZ2h0KHRoaXMubGlnaHRzLmdldCh0LGUsbiksaSkpfWdldExvY2FsQmx1ZUxpZ2h0KHQsZSxuKXtyZXR1cm4gbnQuZXh0cmFjdEJsdWVMaWdodCh0aGlzLmxpZ2h0cy5nZXQodCxlLG4pKX1zZXRMb2NhbEJsdWVMaWdodCh0LGUsbixpKXtyZXR1cm4gdGhpcy5saWdodHMuc2V0KHQsZSxuLG50Lmluc2VydEJsdWVMaWdodCh0aGlzLmxpZ2h0cy5nZXQodCxlLG4pLGkpKX1nZXRMb2NhbFN1bmxpZ2h0KHQsZSxuKXtyZXR1cm4gbnQuZXh0cmFjdFN1bmxpZ2h0KHRoaXMubGlnaHRzLmdldCh0LGUsbikpfXNldExvY2FsU3VubGlnaHQodCxlLG4saSl7cmV0dXJuIHRoaXMubGlnaHRzLnNldCh0LGUsbixudC5pbnNlcnRTdW5saWdodCh0aGlzLmxpZ2h0cy5nZXQodCxlLG4pLGkpKX10b0xvY2FsKHQsZSxuKXtjb25zdFtpLHIsc109dGhpcy5taW47cmV0dXJuWygwfHQpLWksKDB8ZSktciwoMHxuKS1zXX1jb250YWlucyh0LGUsbil7Y29uc3R7c2l6ZTppLG1heEhlaWdodDpyfT10aGlzLm9wdGlvbnMsW3MsYSxvXT10aGlzLnRvTG9jYWwodCxlLG4pO3JldHVybiBzPGkmJmE+PTAmJmE8ciYmbz49MCYmbzxpfWNvbnN0cnVjdG9yKHQsZSxuKXt2dCh0aGlzLCJvcHRpb25zIix2b2lkIDApLHZ0KHRoaXMsImlkIix2b2lkIDApLHZ0KHRoaXMsIm5hbWUiLHZvaWQgMCksdnQodGhpcywiY29vcmRzIix2b2lkIDApLHZ0KHRoaXMsIm1pbiIsdm9pZCAwKSx2dCh0aGlzLCJtYXgiLHZvaWQgMCksdnQodGhpcywidm94ZWxzIix2b2lkIDApLHZ0KHRoaXMsImxpZ2h0cyIsdm9pZCAwKSx0aGlzLmlkPXQsdGhpcy5uYW1lPXR0LmdldENodW5rTmFtZShlKSx0aGlzLmNvb3Jkcz1lLHRoaXMub3B0aW9ucz1uO2NvbnN0e3NpemU6aSxtYXhIZWlnaHQ6cn09bjt0aGlzLnZveGVscz1kdChbXSxbaSxyLGldKSx0aGlzLmxpZ2h0cz1kdChbXSxbaSxyLGldKTtjb25zdFtzLGFdPWU7dGhpcy5taW49W3MqaSwwLGEqaV0sdGhpcy5tYXg9WyhzKzEpKmksciwoYSsxKSppXX19ZnVuY3Rpb24gTXQodCxlLG4pe3JldHVybiBlIGluIHQ/T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsZSx7dmFsdWU6bixlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pOnRbZV09bix0fWNsYXNzIHd0e3NlcmlhbGl6ZSgpe3JldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHtibG9ja3NCeU5hbWU6QXJyYXkuZnJvbSh0aGlzLmJsb2Nrc0J5TmFtZS5lbnRyaWVzKCkpLGJsb2Nrc0J5SWQ6QXJyYXkuZnJvbSh0aGlzLmJsb2Nrc0J5SWQuZW50cmllcygpKSxuYW1lTWFwOkFycmF5LmZyb20odGhpcy5uYW1lTWFwLmVudHJpZXMoKSksaWRNYXA6QXJyYXkuZnJvbSh0aGlzLmlkTWFwLmVudHJpZXMoKSl9KSl9c3RhdGljIGRlc2VyaWFsaXplKHQpe2NvbnN0IGU9bmV3IHd0O3JldHVybiBlLmJsb2Nrc0J5TmFtZT1uZXcgTWFwKHQuYmxvY2tzQnlOYW1lKSxlLmJsb2Nrc0J5SWQ9bmV3IE1hcCh0LmJsb2Nrc0J5SWQpLGUubmFtZU1hcD1uZXcgTWFwKHQubmFtZU1hcCksZS5pZE1hcD1uZXcgTWFwKHQuaWRNYXApLGV9Y29uc3RydWN0b3IoKXtNdCh0aGlzLCJibG9ja3NCeU5hbWUiLG5ldyBNYXApLE10KHRoaXMsImJsb2Nrc0J5SWQiLG5ldyBNYXApLE10KHRoaXMsIm5hbWVNYXAiLG5ldyBNYXApLE10KHRoaXMsImlkTWFwIixuZXcgTWFwKX19bGV0IHl0O29ubWVzc2FnZT1mdW5jdGlvbih0KXtjb25zdHt0eXBlOm59PXQuZGF0YTtpZihuJiYiaW5pdCI9PT1uLnRvTG93ZXJDYXNlKCkpcmV0dXJuIHZvaWQoeXQ9d3QuZGVzZXJpYWxpemUodC5kYXRhLnJlZ2lzdHJ5RGF0YSkpO2Z1bmN0aW9uIGkodCxlLG4pe2NvbnN0IGk9TnVtYmVyKCF0KSxyPU51bWJlcighZSkscz1OdW1iZXIoIW4pO3JldHVybiAxPT09aSYmMT09PXI/MDozLShpK3Ircyl9Y29uc3R7Y2h1bmtzRGF0YTpyLG1pbjpzLG1heDphfT10LmRhdGEse2NodW5rU2l6ZTpvLG1heExpZ2h0TGV2ZWw6aH09dC5kYXRhLm9wdGlvbnMsdT1yLm1hcCgodD0+e2lmKCF0KXJldHVybiBudWxsO3JldHVybiBidC5kZXNlcmlhbGl6ZSh0KX0pKSxjPXQ9Pntjb25zdCBlPXVbNF0uY29vcmRzLG49dFswXS1lWzBdLGk9MyoodFsxXS1lWzFdKzEpKyhuKzEpO2lmKGk8MHx8aT49dS5sZW5ndGgpdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIGNvb3JkaW5hdGVzOiAke3R9YCk7cmV0dXJuIHVbaV19LGw9KHQsZSxuKT0+e2NvbnN0IGk9dHQubWFwVm94ZWxUb0NodW5rKFt0LGUsbl0sbykscj1jKGkpO3ZhciBzO3JldHVybiBudWxsIT09KHM9bnVsbD09cj92b2lkIDA6ci5nZXRWb3hlbCh0LGUsbikpJiZ2b2lkIDAhPT1zP3M6MH0sZj0odCxlLG4pPT57Y29uc3QgaT10dC5tYXBWb3hlbFRvQ2h1bmsoW3QsZSxuXSxvKSxyPWMoaSk7dmFyIHM7cmV0dXJuIG51bGwhPT0ocz1udWxsPT1yP3ZvaWQgMDpyLmdldFN1bmxpZ2h0KHQsZSxuKSkmJnZvaWQgMCE9PXM/czowfSxtPSh0LGUsbixpKT0+e2NvbnN0IHI9dHQubWFwVm94ZWxUb0NodW5rKFt0LGUsbl0sbykscz1jKHIpO3ZhciBhO3JldHVybiBudWxsIT09KGE9bnVsbD09cz92b2lkIDA6cy5nZXRUb3JjaExpZ2h0KHQsZSxuLGkpKSYmdm9pZCAwIT09YT9hOjB9LHA9KHQsZSxuKT0+e2NvbnN0IGk9dHQubWFwVm94ZWxUb0NodW5rKFt0LGUsbl0sbykscj1jKGkpO3ZhciBzO3JldHVybiBudWxsIT09KHM9bnVsbD09cj92b2lkIDA6ci5nZXRWb3hlbFJvdGF0aW9uKHQsZSxuKSkmJnZvaWQgMCE9PXM/czpuZXcgYXR9LGQ9KHQsZSxuKT0+e2NvbnN0IGk9dHQubWFwVm94ZWxUb0NodW5rKFt0LGUsbl0sbykscj1jKGkpO3ZhciBzO3JldHVybiBudWxsIT09KHM9bnVsbD09cj92b2lkIDA6ci5nZXRWb3hlbFN0YWdlKHQsZSxuKSkmJnZvaWQgMCE9PXM/czowfSxnPSh0LGUsbik9Pntjb25zdCBpPWwodCxlLG4pO3JldHVybiB5dC5ibG9ja3NCeUlkLmdldChpKX0sW3gsdixiXT1zLFtNLHcseV09YSxMPXt9O2ZvcihsZXQgdD14O3Q8TTt0KyspZm9yKGxldCBuPWI7bjx5O24rKylmb3IobGV0IHI9djtyPHc7cisrKXtjb25zdCBzPWwodCxyLG4pLGE9cCh0LHIsbiksaD15dC5ibG9ja3NCeUlkLmdldChzKSx7aWQ6dSxpc1NlZVRocm91Z2g6TSxpc0VtcHR5OncsaXNPcGFxdWU6eSxuYW1lOlgscm90YXRhYmxlOloseVJvdGF0YWJsZTprLGlzRHluYW1pYzpZLGR5bmFtaWNQYXR0ZXJuczpFfT1oO2xldCBqPWguYWFiYnMsTz1oLmZhY2VzO2lmKFkmJiFFfHx3fHwwPT09Ty5sZW5ndGgpY29udGludWU7aWYoRSlmb3IoY29uc3QgZSBvZiBFKXtsZXQgaT0hMTtmb3IoY29uc3QgcyBvZiBlLnJ1bGVzKXtjb25zdCBlPXMub2Zmc2V0WzBdK3QsYT1zLm9mZnNldFsxXStyLG89cy5vZmZzZXRbMl0rbjtsZXQgaD0hMTtpZihudWxsIT09cy5pZCl7aWYobChlLGEsbykhPT1zLmlkKXtpPSExO2JyZWFrfWg9ITB9aWYobnVsbCE9PXMucm90YXRpb24pe2NvbnN0IHQ9cChlLGEsbyk7aWYodC52YWx1ZSE9PXMucm90YXRpb24udmFsdWV8fHQueVJvdGF0aW9uIT09cy5yb3RhdGlvbi55Um90YXRpb24pe2k9ITE7YnJlYWt9aD0hMH1pZihudWxsIT09cy5zdGFnZSl7aWYoZCh0LHIsbikhPT1zLnN0YWdlKXtpPSExO2JyZWFrfWg9ITB9aWYoaCl7aT0hMDticmVha319aWYoaSl7Tz1lLmZhY2VzLGo9ZS5hYWJiczticmVha319bGV0IEE9ITA7Zm9yKGNvbnN0W2UsaSxzXW9mW1stMSwwLDBdLFsxLDAsMF0sWzAsLTEsMF0sWzAsMSwwXSxbMCwwLC0xXSxbMCwwLDFdXSl7Y29uc3QgYT1sKHQrZSxyK2ksbitzKSxvPXl0LmJsb2Nrc0J5SWQuZ2V0KGEpO2lmKCEobnVsbD09bz92b2lkIDA6by5pc09wYXF1ZSkpe0E9ITE7YnJlYWt9fWlmKEEpY29udGludWU7Y29uc3QgQj17fTtmb3IoY29uc3QgdCBvZiBPKUJbdC5uYW1lXT10LnJhbmdlO2Zvcihjb25zdCBzIG9mIE8pe2NvbnN0IGg9cy5pbmRlcGVuZGVudD9gJHtYLnRvTG93ZXJDYXNlKCl9Ojoke3MubmFtZS50b0xvd2VyQ2FzZSgpfWA6WC50b0xvd2VyQ2FzZSgpO3ZhciBSO2NvbnN0IHA9bnVsbCE9PShSPUxbaF0pJiZ2b2lkIDAhPT1SP1I6e2xpZ2h0czpbXSx2b3hlbDp1LHBvc2l0aW9uczpbXSx1dnM6W10saW5kaWNlczpbXX07cy5pbmRlcGVuZGVudCYmKHAuZmFjZU5hbWU9cy5uYW1lKTtjb25zdHtkaXI6ZCxjb3JuZXJzOnd9PXMsWT1bLi4uZF07WiYmYS5yb3RhdGVOb2RlKFksaywhMSksWVswXT1NYXRoLnJvdW5kKFlbMF0pLFlbMV09TWF0aC5yb3VuZChZWzFdKSxZWzJdPU1hdGgucm91bmQoWVsyXSk7Y29uc3QgRT10K1lbMF0sTz1yK1lbMV0sQT1uK1lbMl0scT1sKEUsTyxBKSxWPXR0Lm1hcFZveGVsVG9DaHVuayhbRSxPLEFdLG8pLE49IWMoViksUz15dC5ibG9ja3NCeUlkLmdldChxKTtsZXQgST0hMTtpZihNJiYheSYmUy5pc09wYXF1ZSl7Y29uc3QgdD1lLnVuaW9uKGopLG49ZS51bmlvbihTLmFhYmJzKTtuLnRyYW5zbGF0ZShZKSx0LmludGVyc2VjdHMobil8fHQudG91Y2hlcyhuKXx8KEk9ITApfWlmKE4mJlMuaXNFbXB0eXx8TSYmIXkmJiFTLmlzT3BhcXVlJiYoTSYmcT09dSYmUy50cmFuc3BhcmVudFN0YW5kYWxvbmV8fHEhPXUmJihNfHxTLmlzU2VlVGhyb3VnaCl8fEkpfHwhTSYmKCF5fHwhUy5pc09wYXF1ZSkpe2NvbnN0e3N0YXJ0VTplLHN0YXJ0VjpvLGVuZFU6aCxlbmRWOnV9PUJbcy5uYW1lXSxjPU1hdGguZmxvb3IocC5wb3NpdGlvbnMubGVuZ3RoLzMpLGw9W10sZD1bXSxMPVtdLFI9W107Zm9yKGNvbnN0e3BvczpzLHV2OmN9b2Ygdyl7Y29uc3Qgdz1bLi4uc107WiYmYS5yb3RhdGVOb2RlKHcsaywhMCk7Y29uc3QgWD10K3dbMF0sRT1yK3dbMV0saj1uK3dbMl0sTz15PzA6MWUtNDtwLnBvc2l0aW9ucy5wdXNoKFgteC1ZWzBdKk8sRS12LVlbMV0qTyxqLWItWVsyXSpPKSxwLnV2cy5wdXNoKGNbMF0qKGgtZSkrZSxjWzFdKih1LW8pK28pO2NvbnN0IEE9MD09PU1hdGgucm91bmQod1swXSk/LTE6MSxCPTA9PT1NYXRoLnJvdW5kKHdbMV0pPy0xOjEscT0wPT09TWF0aC5yb3VuZCh3WzJdKT8tMToxLFY9W10sTj1bXSxTPVtdLEk9W10sVD0hZyh0KzAscitCLG4rcSkuaXNPcGFxdWUsQz0hZyh0K0EsciswLG4rcSkuaXNPcGFxdWUsVT0hZyh0K0EscitCLG4rMCkuaXNPcGFxdWUsXz0hZyh0K0EscitCLG4rcSkuaXNPcGFxdWUsRz1NPzM6MT09PU1hdGguYWJzKFlbMF0pP2koVSxDLF8pOjE9PT1NYXRoLmFicyhZWzFdKT9pKFUsVCxfKTppKFQsQyxfKTtsZXQgRCx6LFAsRjtpZihNKUQ9Zih0LHIsbiksej1tKHQscixuLCJSRUQiKSxQPW0odCxyLG4sIkdSRUVOIiksRj1tKHQscixuLCJCTFVFIik7ZWxzZXtmb3IobGV0IGU9MDtlPD0xO2UrKylmb3IobGV0IGk9MDtpPD0xO2krKylmb3IobGV0IHM9MDtzPD0xO3MrKyl7Y29uc3QgYT1lKkEsbz1pKkIsaD1zKnEsdT1mKHQrYSxyK28sbitoKSxjPW0odCthLHIrbyxuK2gsIlJFRCIpLGw9bSh0K2EscitvLG4raCwiR1JFRU4iKSxwPW0odCthLHIrbyxuK2gsIkJMVUUiKTtpZigwPT11JiYwPT1jJiYwPT1sJiYwPT1wKWNvbnRpbnVlO2lmKCFnKHQrYSxyK28sbitoKS5pc09wYXF1ZSl7aWYoWVswXSphK1lbMV0qbytZWzJdKmg9PTApe2lmKGcodCthKllbMF0scitvKllbMV0sbitoKllbMl0pLmlzT3BhcXVlKWNvbnRpbnVlfWlmKE1hdGguYWJzKGEpK01hdGguYWJzKG8pK01hdGguYWJzKGgpPT09Myl7Y29uc3QgZT1nKHQscitvLG4raCksaT1nKHQrYSxyLG4raCkscz1nKHQrYSxyK28sbik7aWYoZS5pc09wYXF1ZSYmaS5pc09wYXF1ZSYmcy5pc09wYXF1ZSljb250aW51ZTtpZihzLmlzT3BhcXVlJiZpLmlzT3BhcXVlKXtjb25zdCBlPWcodCxyK28sbiksaT1nKHQscixuK2gpO2lmKGUuaXNPcGFxdWUmJmkuaXNPcGFxdWUpY29udGludWV9aWYocy5pc09wYXF1ZSYmZS5pc09wYXF1ZSl7Y29uc3QgZT1nKHQrYSxyLG4pLGk9Zyh0LHIsbitoKTtpZihlLmlzT3BhcXVlJiZpLmlzT3BhcXVlKWNvbnRpbnVlfWlmKGkuaXNPcGFxdWUmJmUuaXNPcGFxdWUpe2NvbnN0IGU9Zyh0K2EscixuKSxpPWcodCxyK28sbik7aWYoZS5pc09wYXF1ZSYmaS5pc09wYXF1ZSljb250aW51ZX19Vi5wdXNoKHUpLE4ucHVzaChjKSxTLnB1c2gobCksSS5wdXNoKHApfX1EPVYucmVkdWNlKCgodCxlKT0+dCtlKSwwKS9WLmxlbmd0aCx6PU4ucmVkdWNlKCgodCxlKT0+dCtlKSwwKS9OLmxlbmd0aCxQPVMucmVkdWNlKCgodCxlKT0+dCtlKSwwKS9TLmxlbmd0aCxGPUkucmVkdWNlKCgodCxlKT0+dCtlKSwwKS9JLmxlbmd0aH1sZXQgJD0wOyQ9bnQuaW5zZXJ0UmVkTGlnaHQoJCx6KSwkPW50Lmluc2VydEdyZWVuTGlnaHQoJCxQKSwkPW50Lmluc2VydEJsdWVMaWdodCgkLEYpLCQ9bnQuaW5zZXJ0U3VubGlnaHQoJCxEKSxwLmxpZ2h0cy5wdXNoKE1hdGguZmxvb3IoJCl8Rzw8MTYpLGQucHVzaCh6KSxMLnB1c2goUCksUi5wdXNoKEYpLGwucHVzaChHKX1jb25zdCBYPWRbMF0sRT1kWzFdLGo9ZFsyXSxPPWRbM10sQT1MWzBdLHE9TFsxXSxWPUxbMl0sTj1MWzNdLFM9UlswXSxJPVJbMV0sVD1SWzJdLEM9UlszXSxVPTAsXz1YPD1VfHxFPD1VfHxqPD1VfHxPPD1VLEc9QTw9VXx8cTw9VXx8Vjw9VXx8Tjw9VSxEPVM8PVV8fEk8PVV8fFQ8PVV8fEM8PVUsej1sWzBdK2xbM109PWxbMV0rbFsyXSxQPVgrTzxFK2omJnosRj1BK048cStWJiZ6LCQ9UytDPEkrVCYmeixIPV8mJihFPihYK08pLzImJihYK08pLzI+anx8aj4oWCtPKS8yJiYoWCtPKS8yPkUpLEo9RyYmKHE+KEErTikvMiYmKEErTikvMj5WfHxWPihBK04pLzImJihBK04pLzI+cSksUT1EJiYoST4oUytDKS8yJiYoUytDKS8yPlR8fFQ+KFMrQykvMiYmKFMrQykvMj5JKTtwLmluZGljZXMucHVzaChjKSxwLmluZGljZXMucHVzaChjKzEpLGxbMF0rbFszXT5sWzFdK2xbMl18fFB8fEZ8fCR8fEh8fEp8fFE/KHAuaW5kaWNlcy5wdXNoKGMrMykscC5pbmRpY2VzLnB1c2goYyszKSxwLmluZGljZXMucHVzaChjKzIpLHAuaW5kaWNlcy5wdXNoKGMpKToocC5pbmRpY2VzLnB1c2goYysyKSxwLmluZGljZXMucHVzaChjKzIpLHAuaW5kaWNlcy5wdXNoKGMrMSkscC5pbmRpY2VzLnB1c2goYyszKSl9TFtoXT1wfX1jb25zdCBYPVtdLFo9T2JqZWN0LnZhbHVlcyhMKS5tYXAoKHQ9Pntjb25zdCBlPXtpbmRpY2VzOm5ldyBVaW50MTZBcnJheSh0LmluZGljZXMpLGxpZ2h0czpuZXcgVWludDMyQXJyYXkodC5saWdodHMpLHBvc2l0aW9uczpuZXcgRmxvYXQzMkFycmF5KHQucG9zaXRpb25zKSx1dnM6bmV3IEZsb2F0MzJBcnJheSh0LnV2cyksdm94ZWw6dC52b3hlbCxmYWNlTmFtZTp0LmZhY2VOYW1lfTtyZXR1cm4gWC5wdXNoKGUuaW5kaWNlcy5idWZmZXIpLFgucHVzaChlLmxpZ2h0cy5idWZmZXIpLFgucHVzaChlLnBvc2l0aW9ucy5idWZmZXIpLFgucHVzaChlLnV2cy5idWZmZXIpLGV9KSkuZmlsdGVyKCh0PT50LnBvc2l0aW9ucy5sZW5ndGg+MCkpO3Bvc3RNZXNzYWdlKHtnZW9tZXRyaWVzOlp9LFgpfX0oKTsKCg==",null,!1),WorkerFactory$1=createBase64WorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7b25tZXNzYWdlPXQ9Pntjb25zdHtkYXRhOntpbnRlcnZhbDpzLHNpZ25hbDplfX09dDtsZXQgYTsic3RhcnQiPT09ZT9hPXNldEludGVydmFsKCgoKT0+e3Bvc3RNZXNzYWdlKCJ0aWNrIil9KSxzKToic3RvcCI9PT1lJiZjbGVhckludGVydmFsKGEpfX0oKTsKCg==",null,!1);function setWorkerInterval(t,e){const i=new WorkerFactory$1;return console.log(i),i.postMessage({signal:"start",interval:e}),i.onmessage=e=>{"tick"===e.data&&t()},()=>{i.postMessage({signal:"stop"})}}function _defineProperty$b(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class RawChunk{serialize(){return[{id:this.id,x:this.coords[0],z:this.coords[1],voxels:this.voxels.data.buffer,lights:this.lights.data.buffer,options:this.options},[this.voxels.data.buffer.slice(0),this.lights.data.buffer.slice(0)]]}static deserialize(t){const{id:e,x:i,z:o,voxels:n,lights:s,options:r}=t,l=new RawChunk(e,[i,o],r);return s&&s.byteLength&&(l.lights.data=new Uint32Array(s)),n&&n.byteLength&&(l.voxels.data=new Uint32Array(n)),l}setData(t){const{id:e,x:i,z:o}=t;if(this.id!==e)throw new Error("Chunk id mismatch");if(this.coords[0]!==i||this.coords[1]!==o)throw new Error("Chunk coords mismatch");const{voxels:n,lights:s}=t;s&&s.byteLength&&(this.lights.data=new Uint32Array(s)),n&&n.byteLength&&(this.voxels.data=new Uint32Array(n))}getRawValue(t,e,i){if(!this.contains(t,e,i))return 0;const[o,n,s]=this.toLocal(t,e,i);return this.voxels.get(o,n,s)}setRawValue(t,e,i,o){if(!this.contains(t,e,i))return 0;const[n,s,r]=this.toLocal(t,e,i);return this.voxels.set(n,s,r,o)}getRawLight(t,e,i){if(!this.contains(t,e,i))return 0;const[o,n,s]=this.toLocal(t,e,i);return this.lights.get(o,n,s)}setRawLight(t,e,i,o){if(!this.contains(t,e,i))return 0;const[n,s,r]=this.toLocal(t,e,i);return this.lights.set(n,s,r,o)}getVoxel(t,e,i){return BlockUtils.extractID(this.getRawValue(0|t,0|e,0|i))}setVoxel(t,e,i,o){const n=BlockUtils.insertID(0,o);return this.setRawValue(t,e,i,n),o}getVoxelRotation(t,e,i){return this.contains(t,e,i)?BlockUtils.extractRotation(this.getRawValue(t,e,i)):new BlockRotation}setVoxelRotation(t,e,i,o){const n=BlockUtils.insertRotation(this.getRawValue(t,e,i),o);this.setRawValue(t,e,i,n)}getVoxelStage(t,e,i){return this.contains(t,e,i)?BlockUtils.extractStage(this.getRawValue(t,e,i)):0}setVoxelStage(t,e,i,o){const n=BlockUtils.insertStage(this.getRawValue(t,e,i),o);return this.setRawValue(t,e,i,n),o}getRedLight(t,e,i){if(!this.contains(t,e,i))return 0;const[o,n,s]=this.toLocal(t,e,i);return this.getLocalRedLight(o,n,s)}setRedLight(t,e,i,o){if(!this.contains(t,e,i))return 0;const[n,s,r]=this.toLocal(t,e,i);return this.setLocalRedLight(n,s,r,o)}getGreenLight(t,e,i){if(!this.contains(t,e,i))return 0;const[o,n,s]=this.toLocal(t,e,i);return this.getLocalGreenLight(o,n,s)}setGreenLight(t,e,i,o){if(!this.contains(t,e,i))return 0;const[n,s,r]=this.toLocal(t,e,i);return this.setLocalGreenLight(n,s,r,o)}getBlueLight(t,e,i){if(!this.contains(t,e,i))return 0;const[o,n,s]=this.toLocal(t,e,i);return this.getLocalBlueLight(o,n,s)}setBlueLight(t,e,i,o){if(!this.contains(t,e,i))return 0;const[n,s,r]=this.toLocal(t,e,i);return this.setLocalBlueLight(n,s,r,o)}getTorchLight(t,e,i,o){switch(o){case"RED":return this.getRedLight(t,e,i);case"GREEN":return this.getGreenLight(t,e,i);case"BLUE":return this.getBlueLight(t,e,i);default:throw new Error("Received unknown light color...")}}setTorchLight(t,e,i,o,n){switch(n){case"RED":return this.setRedLight(t,e,i,o);case"GREEN":return this.setGreenLight(t,e,i,o);case"BLUE":return this.setBlueLight(t,e,i,o);default:throw new Error("Received unknown light color...")}}getSunlight(t,e,i){if(!this.contains(t,e,i))return 0;const[o,n,s]=this.toLocal(t,e,i);return this.getLocalSunlight(o,n,s)}setSunlight(t,e,i,o){if(!this.contains(t,e,i))return 0;const[n,s,r]=this.toLocal(t,e,i);return this.setLocalSunlight(n,s,r,o)}get isReady(){return 0!==this.lights.data.length&&0!==this.voxels.data.length}getLocalRedLight(t,e,i){return LightUtils.extractRedLight(this.lights.get(t,e,i))}setLocalRedLight(t,e,i,o){return this.lights.set(t,e,i,LightUtils.insertRedLight(this.lights.get(t,e,i),o))}getLocalGreenLight(t,e,i){return LightUtils.extractGreenLight(this.lights.get(t,e,i))}setLocalGreenLight(t,e,i,o){return this.lights.set(t,e,i,LightUtils.insertGreenLight(this.lights.get(t,e,i),o))}getLocalBlueLight(t,e,i){return LightUtils.extractBlueLight(this.lights.get(t,e,i))}setLocalBlueLight(t,e,i,o){return this.lights.set(t,e,i,LightUtils.insertBlueLight(this.lights.get(t,e,i),o))}getLocalSunlight(t,e,i){return LightUtils.extractSunlight(this.lights.get(t,e,i))}setLocalSunlight(t,e,i,o){return this.lights.set(t,e,i,LightUtils.insertSunlight(this.lights.get(t,e,i),o))}toLocal(t,e,i){const[o,n,s]=this.min;return[(0|t)-o,(0|e)-n,(0|i)-s]}contains(t,e,i){const{size:o,maxHeight:n}=this.options,[s,r,l]=this.toLocal(t,e,i);return s<o&&r>=0&&r<n&&l>=0&&l<o}constructor(t,e,i){_defineProperty$b(this,"options",void 0),_defineProperty$b(this,"id",void 0),_defineProperty$b(this,"name",void 0),_defineProperty$b(this,"coords",void 0),_defineProperty$b(this,"min",void 0),_defineProperty$b(this,"max",void 0),_defineProperty$b(this,"voxels",void 0),_defineProperty$b(this,"lights",void 0),this.id=t,this.name=ChunkUtils.getChunkName(e),this.coords=e,this.options=i;const{size:o,maxHeight:n}=i;this.voxels=ndarray([],[o,n,o]),this.lights=ndarray([],[o,n,o]);const[s,r]=e;this.min=[s*o,0,r*o],this.max=[(s+1)*o,n,(r+1)*o]}}function _defineProperty$a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Chunk extends RawChunk{setData(t){const{id:e,x:i,z:o}=t;if(this.id!==e)throw new Error("Chunk id mismatch");if(this.coords[0]!==i||this.coords[1]!==o)throw new Error("Chunk coords mismatch");const{voxels:n,lights:s}=t;s&&s.byteLength&&(this.lights.data=new Uint32Array(s)),n&&n.byteLength&&(this.voxels.data=new Uint32Array(n))}dispose(){this.meshes.forEach((t=>{t.forEach((t=>{var e;t&&(null===(e=t.geometry)||void 0===e||e.dispose(),t.parent&&t.parent.remove(t))}))})),this.lights.data=new Uint32Array,this.voxels.data=new Uint32Array}constructor(t,e,i){super(t,e,i),_defineProperty$a(this,"meshes",new Map),_defineProperty$a(this,"added",!1),_defineProperty$a(this,"isDirty",!1)}}function _defineProperty$9(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Chunks{constructor(){_defineProperty$9(this,"materials",new Map),_defineProperty$9(this,"uniforms",{fogColor:{value:new three__WEBPACK_IMPORTED_MODULE_0__.Ilk("#B1CCFD")},fogNear:{value:100},fogFar:{value:200},ao:{value:new three__WEBPACK_IMPORTED_MODULE_0__.Ltg(100,170,210,255)},minLightLevel:{value:0},sunlightIntensity:{value:1},time:{value:performance.now()}}),_defineProperty$9(this,"requested",new Map),_defineProperty$9(this,"toRequest",[]),_defineProperty$9(this,"loaded",new Map),_defineProperty$9(this,"toProcess",[]),_defineProperty$9(this,"toUpdate",[]),_defineProperty$9(this,"toEmit",[])}}var omggif={},GifReader_1,GifWriter_1;function GifWriter(t,e,i,o){var n=0,s=void 0===(o=void 0===o?{}:o).loop?null:o.loop,r=void 0===o.palette?null:o.palette;if(e<=0||i<=0||e>65535||i>65535)throw new Error("Width/Height invalid.");function l(t){var e=t.length;if(e<2||e>256||e&e-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return e}t[n++]=71,t[n++]=73,t[n++]=70,t[n++]=56,t[n++]=57,t[n++]=97;var a=0,d=0;if(null!==r){for(var c=l(r);c>>=1;)++a;if(c=1<<a,--a,void 0!==o.background){if((d=o.background)>=c)throw new Error("Background index out of range.");if(0===d)throw new Error("Background index explicitly passed as 0.")}}if(t[n++]=255&e,t[n++]=e>>8&255,t[n++]=255&i,t[n++]=i>>8&255,t[n++]=(null!==r?128:0)|a,t[n++]=d,t[n++]=0,null!==r)for(var h=0,u=r.length;h<u;++h){var p=r[h];t[n++]=p>>16&255,t[n++]=p>>8&255,t[n++]=255&p}if(null!==s){if(s<0||s>65535)throw new Error("Loop count invalid.");t[n++]=33,t[n++]=255,t[n++]=11,t[n++]=78,t[n++]=69,t[n++]=84,t[n++]=83,t[n++]=67,t[n++]=65,t[n++]=80,t[n++]=69,t[n++]=50,t[n++]=46,t[n++]=48,t[n++]=3,t[n++]=1,t[n++]=255&s,t[n++]=s>>8&255,t[n++]=0}var m=!1;this.addFrame=function(e,i,o,s,a,d){if(!0===m&&(--n,m=!1),d=void 0===d?{}:d,e<0||i<0||e>65535||i>65535)throw new Error("x/y invalid.");if(o<=0||s<=0||o>65535||s>65535)throw new Error("Width/Height invalid.");if(a.length<o*s)throw new Error("Not enough pixels for the frame size.");var c=!0,h=d.palette;if(null==h&&(c=!1,h=r),null==h)throw new Error("Must supply either a local or global palette.");for(var u=l(h),p=0;u>>=1;)++p;u=1<<p;var b=void 0===d.delay?0:d.delay,y=void 0===d.disposal?0:d.disposal;if(y<0||y>3)throw new Error("Disposal out of range.");var Z=!1,f=0;if(void 0!==d.transparent&&null!==d.transparent&&(Z=!0,(f=d.transparent)<0||f>=u))throw new Error("Transparent color index.");if((0!==y||Z||0!==b)&&(t[n++]=33,t[n++]=249,t[n++]=4,t[n++]=y<<2|(!0===Z?1:0),t[n++]=255&b,t[n++]=b>>8&255,t[n++]=f,t[n++]=0),t[n++]=44,t[n++]=255&e,t[n++]=e>>8&255,t[n++]=255&i,t[n++]=i>>8&255,t[n++]=255&o,t[n++]=o>>8&255,t[n++]=255&s,t[n++]=s>>8&255,t[n++]=!0===c?128|p-1:0,!0===c)for(var W=0,g=h.length;W<g;++W){var G=h[W];t[n++]=G>>16&255,t[n++]=G>>8&255,t[n++]=255&G}return n=GifWriterOutputLZWCodeStream(t,n,p<2?2:p,a)},this.end=function(){return!1===m&&(t[n++]=59,m=!0),n},this.getOutputBuffer=function(){return t},this.setOutputBuffer=function(e){t=e},this.getOutputBufferPosition=function(){return n},this.setOutputBufferPosition=function(t){n=t}}function GifWriterOutputLZWCodeStream(t,e,i,o){t[e++]=i;var n=e++,s=1<<i,r=s-1,l=s+1,a=l+1,d=i+1,c=0,h=0;function u(i){for(;c>=i;)t[e++]=255&h,h>>=8,c-=8,e===n+256&&(t[n]=255,n=e++)}function p(t){h|=t<<c,c+=d,u(8)}var m=o[0]&r,b={};p(s);for(var y=1,Z=o.length;y<Z;++y){var f=o[y]&r,W=m<<8|f,g=b[W];if(void 0===g){for(h|=m<<c,c+=d;c>=8;)t[e++]=255&h,h>>=8,c-=8,e===n+256&&(t[n]=255,n=e++);4096===a?(p(s),a=l+1,d=i+1,b={}):(a>=1<<d&&++d,b[W]=a++),m=f}else m=g}return p(m),p(l),u(1),n+1===e?t[n]=0:(t[n]=e-n-1,t[e++]=0),e}function GifReader(t){var e=0;if(71!==t[e++]||73!==t[e++]||70!==t[e++]||56!==t[e++]||56!=(t[e++]+1&253)||97!==t[e++])throw new Error("Invalid GIF 87a/89a header.");var i=t[e++]|t[e++]<<8,o=t[e++]|t[e++]<<8,n=t[e++],s=n>>7,r=1<<1+(7&n);t[e++],t[e++];var l=null,a=null;s&&(l=e,a=r,e+=3*r);var d=!0,c=[],h=0,u=null,p=0,m=null;for(this.width=i,this.height=o;d&&e<t.length;)switch(t[e++]){case 33:switch(t[e++]){case 255:if(11!==t[e]||78==t[e+1]&&69==t[e+2]&&84==t[e+3]&&83==t[e+4]&&67==t[e+5]&&65==t[e+6]&&80==t[e+7]&&69==t[e+8]&&50==t[e+9]&&46==t[e+10]&&48==t[e+11]&&3==t[e+12]&&1==t[e+13]&&0==t[e+16])e+=14,m=t[e++]|t[e++]<<8,e++;else for(e+=12;;){if(!((x=t[e++])>=0))throw Error("Invalid block size");if(0===x)break;e+=x}break;case 249:if(4!==t[e++]||0!==t[e+4])throw new Error("Invalid graphics extension block.");var b=t[e++];h=t[e++]|t[e++]<<8,u=t[e++],0==(1&b)&&(u=null),p=b>>2&7,e++;break;case 254:for(;;){if(!((x=t[e++])>=0))throw Error("Invalid block size");if(0===x)break;e+=x}break;default:throw new Error("Unknown graphic control label: 0x"+t[e-1].toString(16))}break;case 44:var y=t[e++]|t[e++]<<8,Z=t[e++]|t[e++]<<8,f=t[e++]|t[e++]<<8,W=t[e++]|t[e++]<<8,g=t[e++],G=g>>6&1,v=1<<1+(7&g),X=l,V=a,L=!1;g>>7&&(L=!0,X=e,V=v,e+=3*v);var S=e;for(e++;;){var x;if(!((x=t[e++])>=0))throw Error("Invalid block size");if(0===x)break;e+=x}c.push({x:y,y:Z,width:f,height:W,has_local_palette:L,palette_offset:X,palette_size:V,data_offset:S,data_length:e-S,transparent_index:u,interlaced:!!G,delay:h,disposal:p});break;case 59:d=!1;break;default:throw new Error("Unknown gif block: 0x"+t[e-1].toString(16))}this.numFrames=function(){return c.length},this.loopCount=function(){return m},this.frameInfo=function(t){if(t<0||t>=c.length)throw new Error("Frame index out of range.");return c[t]},this.decodeAndBlitFrameBGRA=function(e,o){var n=this.frameInfo(e),s=n.width*n.height,r=new Uint8Array(s);GifReaderLZWOutputIndexStream(t,n.data_offset,r,s);var l=n.palette_offset,a=n.transparent_index;null===a&&(a=256);var d=n.width,c=i-d,h=d,u=4*(n.y*i+n.x),p=4*((n.y+n.height)*i+n.x),m=u,b=4*c;!0===n.interlaced&&(b+=4*i*7);for(var y=8,Z=0,f=r.length;Z<f;++Z){var W=r[Z];if(0===h&&(h=d,(m+=b)>=p&&(b=4*c+4*i*(y-1),m=u+(d+c)*(y<<1),y>>=1)),W===a)m+=4;else{var g=t[l+3*W],G=t[l+3*W+1],v=t[l+3*W+2];o[m++]=v,o[m++]=G,o[m++]=g,o[m++]=255}--h}},this.decodeAndBlitFrameRGBA=function(e,o){var n=this.frameInfo(e),s=n.width*n.height,r=new Uint8Array(s);GifReaderLZWOutputIndexStream(t,n.data_offset,r,s);var l=n.palette_offset,a=n.transparent_index;null===a&&(a=256);var d=n.width,c=i-d,h=d,u=4*(n.y*i+n.x),p=4*((n.y+n.height)*i+n.x),m=u,b=4*c;!0===n.interlaced&&(b+=4*i*7);for(var y=8,Z=0,f=r.length;Z<f;++Z){var W=r[Z];if(0===h&&(h=d,(m+=b)>=p&&(b=4*c+4*i*(y-1),m=u+(d+c)*(y<<1),y>>=1)),W===a)m+=4;else{var g=t[l+3*W],G=t[l+3*W+1],v=t[l+3*W+2];o[m++]=g,o[m++]=G,o[m++]=v,o[m++]=255}--h}}}function GifReaderLZWOutputIndexStream(t,e,i,o){for(var n=t[e++],s=1<<n,r=s+1,l=r+1,a=n+1,d=(1<<a)-1,c=0,h=0,u=0,p=t[e++],m=new Int32Array(4096),b=null;;){for(;c<16&&0!==p;)h|=t[e++]<<c,c+=8,1===p?p=t[e++]:--p;if(c<a)break;var y=h&d;if(h>>=a,c-=a,y!==s){if(y===r)break;for(var Z=y<l?y:b,f=0,W=Z;W>s;)W=m[W]>>8,++f;var g=W;if(u+f+(Z!==y?1:0)>o)return void console.log("Warning, gif stream longer than expected.");i[u++]=g;var G=u+=f;for(Z!==y&&(i[u++]=g),W=Z;f--;)W=m[W],i[--G]=255&W,W>>=8;null!==b&&l<4096&&(m[l++]=b<<8|g,l>=d+1&&a<12&&(++a,d=d<<1|1)),b=y}else l=r+1,d=(1<<(a=n+1))-1,b=null}return u!==o&&console.log("Warning, gif stream shorter than expected."),i}try{GifWriter_1=omggif.GifWriter=GifWriter,GifReader_1=omggif.GifReader=GifReader}catch(t){}function _defineProperty$8(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Loader{constructor(){_defineProperty$8(this,"textures",new Map),_defineProperty$8(this,"images",new Map),_defineProperty$8(this,"audioBuffers",new Map),_defineProperty$8(this,"progress",0),_defineProperty$8(this,"manager",new three__WEBPACK_IMPORTED_MODULE_0__.lLk),_defineProperty$8(this,"textureLoader",new three__WEBPACK_IMPORTED_MODULE_0__.dpR(this.manager)),_defineProperty$8(this,"audioLoader",new three__WEBPACK_IMPORTED_MODULE_0__.mTL(this.manager)),_defineProperty$8(this,"assetPromises",new Map),_defineProperty$8(this,"audioCallbacks",new Map),_defineProperty$8(this,"loadGifImages",((t,e)=>{const i=new Promise((i=>{(async()=>{const o=await fetch(t),n=await o.blob(),s=await n.arrayBuffer(),r=new Uint8Array(s),l=new GifReader_1(r),a=l.frameInfo(0),d=new Array(l.numFrames()).fill(0).map(((t,e)=>{const i=new ImageData(a.width,a.height);l.decodeAndBlitFrameRGBA(e,i.data);const o=document.createElement("canvas"),n=o.getContext("2d");o.width=i.width,o.height=i.height,n.putImageData(i,0,0);const s=new Image;return s.src=o.toDataURL(),s}));this.images.set(t,d),this.assetPromises.delete(t),null==e||e(d),i(d)})()}));return this.assetPromises.set(t,i),i})),_defineProperty$8(this,"loadTexture",((t,e)=>{const i=new Promise((i=>{this.textureLoader.load(t,(o=>{this.textures.set(t,o),this.assetPromises.delete(t),null==e||e(o),i(o)}))}));return this.assetPromises.set(t,i),i})),_defineProperty$8(this,"loadImage",((t,e)=>{const i=new Promise((i=>{const o=new Image;o.crossOrigin="anonymous",o.src=t,o.onload=()=>{this.assetPromises.delete(t),null==e||e(o),i(o)}}));return this.assetPromises.set(t,i),i})),_defineProperty$8(this,"getTexture",(t=>{const e=this.textures.get(t);if(Array.isArray(e))throw new Error("`getTexture` was called on a gif texture. Use `getGifTexture` instead.");return e})),_defineProperty$8(this,"getGifTexture",(t=>{const e=this.textures.get(t);if(!Array.isArray(e))throw new Error("`getGifTexture` was called on a non-gif texture. Use `getTexture` instead.");return e})),_defineProperty$8(this,"loadAudioBuffer",((t,e)=>new Promise((i=>{this.audioCallbacks.set(t,(async()=>new Promise((o=>{this.audioLoader.load(t,(t=>{null==e||e(t),o(t),i(t)}))}))))})))),_defineProperty$8(this,"load",(async()=>{await Promise.all(Array.from(this.assetPromises.values())),this.assetPromises.clear()})),_defineProperty$8(this,"loadAudios",(async()=>{for(const[t,e]of this.audioCallbacks){const i=await e();this.audioBuffers.set(t,i)}this.audioCallbacks.clear()})),this.manager.onProgress=(t,e,i)=>{this.progress=e/i};const t=()=>{this.loadAudios(),window.removeEventListener("click",t)};window.addEventListener("click",t)}}function _defineProperty$7(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Registry{serialize(){return JSON.parse(JSON.stringify({blocksByName:Array.from(this.blocksByName.entries()),blocksById:Array.from(this.blocksById.entries()),nameMap:Array.from(this.nameMap.entries()),idMap:Array.from(this.idMap.entries())}))}static deserialize(t){const e=new Registry;return e.blocksByName=new Map(t.blocksByName),e.blocksById=new Map(t.blocksById),e.nameMap=new Map(t.nameMap),e.idMap=new Map(t.idMap),e}constructor(){_defineProperty$7(this,"blocksByName",new Map),_defineProperty$7(this,"blocksById",new Map),_defineProperty$7(this,"nameMap",new Map),_defineProperty$7(this,"idMap",new Map)}}function _defineProperty$6(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$2(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$6(t,e,i[e])}))}return t}const DEFAULT_CHUNK_SHADERS={vertex:three__WEBPACK_IMPORTED_MODULE_0__.Vj0.basic.vertexShader.replace("#include <common>","\nattribute int light;\n\nvarying float vAO;\nvarying vec4 vLight;\nvarying vec4 vWorldPosition;\nuniform vec4 uAOTable;\nuniform float uTime;\n\nvec4 unpackLight(int l) {\n  float r = float((l >> 8) & 0xF) / 15.0;\n  float g = float((l >> 4) & 0xF) / 15.0;\n  float b = float(l & 0xF) / 15.0;\n  float s = float((l >> 12) & 0xF) / 15.0;\n  return vec4(r, g, b, s);\n}\n\n#include <common>\n").replace("#include <color_vertex>","\n#include <color_vertex>\n\nint ao = light >> 16;\n\nvAO = ((ao == 0) ? uAOTable.x :\n    (ao == 1) ? uAOTable.y :\n    (ao == 2) ? uAOTable.z : uAOTable.w) / 255.0; \n\nvLight = unpackLight(light & ((1 << 16) - 1));\n").replace("#include <worldpos_vertex>","\nvec4 worldPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n  worldPosition = instanceMatrix * worldPosition;\n#endif\nworldPosition = modelMatrix * worldPosition;\nvWorldPosition = worldPosition;\n"),fragment:three__WEBPACK_IMPORTED_MODULE_0__.Vj0.basic.fragmentShader.replace("#include <common>","\nuniform vec3 uFogColor;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform float uSunlightIntensity;\nuniform float uMinLightLevel;\nuniform float uTime;\nvarying float vAO;\nvarying vec4 vLight; \nvarying vec4 vWorldPosition;\n\n#include <common>\n").replace("#include <envmap_fragment>","\n#include <envmap_fragment>\n\n// Intensity of light is wavelength ** 2 \nfloat s = min(vLight.a * vLight.a * uSunlightIntensity * (1.0 - uMinLightLevel) + uMinLightLevel, 1.0);\ns = s * (1.0 - exp(-s) * 0.02); // Smooth the intensity without clamping to a hard upper limit\nfloat scale = 2.0;\n\noutgoingLight.rgb *= vec3(s + pow(vLight.r, scale), s + pow(vLight.g, scale), s + pow(vLight.b, scale));\noutgoingLight *= vAO;\n").replace("#include <fog_fragment>","\n    vec3 fogOrigin = cameraPosition;\n\n    float depth = sqrt(pow(vWorldPosition.x - fogOrigin.x, 2.0) + pow(vWorldPosition.z - fogOrigin.z, 2.0));\n    float fogFactor = smoothstep(uFogNear, uFogFar, depth);\n\n    gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);\n    ")},customShaders={sway(t){void 0===t&&(t={});const{speed:e,amplitude:i,rooted:o,scale:n,yScale:s}=_objectSpread$2({speed:1,amplitude:.1,rooted:!1,scale:1,yScale:1},t);return{vertexShader:DEFAULT_CHUNK_SHADERS.vertex.replace("#include <common>","\n//\tSimplex 3D Noise \n//\tby Ian McEwan, Ashima Arts\n//\nvec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\nvec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\n\nfloat snoise(vec3 v){ \n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //  x0 = x0 - 0. + 0.0 * C \n  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\n// Permutations\n  i = mod(i, 289.0 ); \n  vec4 p = permute( permute( permute( \n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients\n// ( N*N points uniformly over a square, mapped onto an octahedron.)\n  float n_ = 1.0/7.0; // N=7\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n                                dot(p2,x2), dot(p3,x3) ) );\n}\n").replace("#include <begin_vertex>",`\nvec3 transformed = vec3(position);\nfloat scale = uTime * 0.00002 * ${e.toFixed(2)};\ntransformed.x = position.x \n             + ${o?"(position.y - floor(position.y))":"1.0"} * ${n.toFixed(2)} * snoise(vec3(position.x * scale, position.y * scale * ${s.toFixed(2)}, position.z * scale)) * 2.0 * ${i.toFixed(2)};\n`),fragmentShader:DEFAULT_CHUNK_SHADERS.fragment}}};function _defineProperty$5(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class AtlasTexture extends three__WEBPACK_IMPORTED_MODULE_0__.ROQ{drawImageToRange(t,e,i,o){void 0===i&&(i=!0),void 0===o&&(o=1);const{startU:n,endV:s}=t,r=e instanceof three__WEBPACK_IMPORTED_MODULE_0__.xEZ?e.image:e;if(!r)return;const l=this.canvas.getContext("2d");l.save();const a=this.canvas.width,d=this.canvas.height;if(l.globalAlpha=o,1!==o&&(l.globalCompositeOperation="lighter"),i&&l.clearRect((n-this.atlasOffset)*a,(1-s-this.atlasOffset)*d,this.dimension*this.atlasRatio+2*this.atlasMargin,this.dimension*this.atlasRatio+2*this.atlasMargin),e.isColor)return l.fillStyle=`#${e.getHexString()}`,void l.fillRect((n-this.atlasOffset)*a,(1-s-this.atlasOffset)*d,this.dimension*this.atlasRatio+2*this.atlasMargin,this.dimension*this.atlasRatio+2*this.atlasMargin);i&&(l.drawImage(r,(n-this.atlasOffset)*a,(1-s-this.atlasOffset)*d,this.dimension*this.atlasRatio+2*this.atlasMargin,this.dimension*this.atlasRatio+2*this.atlasMargin),l.clearRect((n-this.atlasOffset)*a+this.atlasMargin,(1-s-this.atlasOffset)*d+this.atlasMargin,this.dimension*this.atlasRatio,this.dimension*this.atlasRatio)),l.drawImage(r,(n-this.atlasOffset)*a+this.atlasMargin,(1-s-this.atlasOffset)*d+this.atlasMargin,this.dimension*this.atlasRatio,this.dimension*this.atlasRatio),l.restore(),this.needsUpdate=!0}registerAnimation(t,e,i){var o=this;void 0===i&&(i=0);const n=new FaceAnimation(t,e,i),s={animation:n,timer:null},r=function(e){void 0===e&&(e=0);const l=n.keyframes[e];o.drawImageToRange(t,l[1],1!==o.countPerSide),s.timer=setTimeout((()=>{clearTimeout(s.timer);const a=(e+1)%n.keyframes.length;if(i>0){const e=n.keyframes[a],s=function(n){void 0===n&&(n=0),n>i?r(a):(requestAnimationFrame((()=>s(n+1))),o.drawImageToRange(t,e[1],!0,n/i),o.drawImageToRange(t,l[1],!1,1-n/i),o.needsUpdate=!0)};s()}else r(a);o.needsUpdate=!0}),l[0])};this.animations.push(s),r()}makeCanvasPowerOfTwo(t){var e;let i=!1;t||(t=this.canvas,i=!0);const o=t.width,n=t.height,s=Math.pow(2,Math.round(Math.log(o)/Math.log(2))),r=Math.pow(2,Math.round(Math.log(n)/Math.log(2))),l=document.createElement("canvas");l.width=s,l.height=r,null===(e=l.getContext("2d"))||void 0===e||e.drawImage(t,0,0,s,r),i&&(this.canvas=l)}static makeUnknownImage(t,e,i){void 0===e&&(e="#0A2647"),void 0===i&&(i="#E1D7C6");const o=document.createElement("canvas"),n=o.getContext("2d");return n.imageSmoothingEnabled=!1,n.canvas.width=t,n.canvas.height=t,n.fillStyle=i,n.fillRect(0,0,t,t),n.fillStyle=e,n.textAlign="center",n.textBaseline="middle",n.fillText("?",t/2,t/2,t),o}static makeUnknownTexture(t){const e=new three__WEBPACK_IMPORTED_MODULE_0__.ROQ(AtlasTexture.makeUnknownImage(t));return e.minFilter=three__WEBPACK_IMPORTED_MODULE_0__.TyD,e.magFilter=three__WEBPACK_IMPORTED_MODULE_0__.TyD,e.generateMipmaps=!1,e.needsUpdate=!0,e.colorSpace=three__WEBPACK_IMPORTED_MODULE_0__.KI_,e}constructor(t,e,i){if(void 0===i&&(i=document.createElement("canvas")),super(i),_defineProperty$5(this,"countPerSide",void 0),_defineProperty$5(this,"dimension",void 0),_defineProperty$5(this,"canvas",void 0),_defineProperty$5(this,"atlasMargin",0),_defineProperty$5(this,"atlasOffset",0),_defineProperty$5(this,"atlasRatio",0),_defineProperty$5(this,"animations",[]),this.canvas=i,this.countPerSide=t,this.dimension=e,1===t)this.atlasOffset=0,this.atlasRatio=1,this.atlasMargin=0;else for(this.atlasOffset=1/(4*t),this.atlasMargin=1,this.atlasRatio=(this.atlasMargin/this.atlasOffset/t-2*this.atlasMargin)/e;this.atlasRatio!==Math.floor(this.atlasRatio);)this.atlasRatio*=2,this.atlasMargin*=2;const o=(e*this.atlasRatio+2*this.atlasMargin)*t,n=(e*this.atlasRatio+2*this.atlasMargin)*t;this.canvas.width=o,this.canvas.height=n;const s=this.canvas.getContext("2d");s.imageSmoothingEnabled=!1,this.makeCanvasPowerOfTwo(this.canvas),this.wrapS=three__WEBPACK_IMPORTED_MODULE_0__.uWy,this.wrapT=three__WEBPACK_IMPORTED_MODULE_0__.uWy,this.minFilter=three__WEBPACK_IMPORTED_MODULE_0__.TyD,this.magFilter=three__WEBPACK_IMPORTED_MODULE_0__.TyD,this.generateMipmaps=!1,this.needsUpdate=!0,this.colorSpace=three__WEBPACK_IMPORTED_MODULE_0__.KI_;const r=AtlasTexture.makeUnknownImage(o/t);for(let l=0;l<t;l++)for(let e=0;e<t;e++)s.drawImage(r,l/t*o,e/t*n,o/t,n/t)}}class FaceAnimation{constructor(t,e,i){if(void 0===i&&(i=0),_defineProperty$5(this,"range",void 0),_defineProperty$5(this,"keyframes",void 0),_defineProperty$5(this,"fadeFrames",void 0),!t)throw new Error("Texture range is required for FaceAnimation.");if(e.length<=1)throw new Error("FaceAnimation must have at least two keyframe.");this.range=t,this.keyframes=e,this.fadeFrames=i}}function _defineProperty$4(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread$1(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$4(t,e,i[e])}))}return t}function ownKeys(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function _objectSpreadProps(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):ownKeys(Object(e)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))})),t}const VOXEL_NEIGHBORS=[[1,0,0],[-1,0,0],[0,0,1],[0,0,-1],[0,1,0],[0,-1,0]],defaultOptions$1={maxChunkRequestsPerUpdate:4,maxProcessesPerUpdate:2,maxUpdatesPerUpdate:1e3,maxMeshesPerUpdate:4,shouldGenerateChunkMeshes:!0,minLightLevel:.04,chunkRerequestInterval:1e4,defaultRenderRadius:8,textureUnitDimension:8,chunkLoadExponent:8,skyOptions:{},cloudsOptions:{},chunkUniformsOverwrite:{},sunlightStartTimeFrac:.25,sunlightEndTimeFrac:.7,sunlightChangeSpan:.15,timeForceThreshold:.1,statsSyncInterval:500};class World extends three__WEBPACK_IMPORTED_MODULE_0__.xsS{async meshChunkLocally(t,e,i){const o=[[-1,-1],[0,-1],[1,-1],[-1,0],[0,0],[1,0],[-1,1],[0,1],[1,1]].map((i=>{let[o,n]=i;return this.getChunkByCoords(t+o,e+n)})),n=o[4],{min:s,max:r}=n,l=Math.floor(this.options.maxHeight/this.options.subChunks),a=[s[0],l*i,s[2]],d=[r[0],l*(i+1),r[2]],c=[],h=[];for(const b of o){if(!b){c.push(null);continue}const[t,e]=b.serialize();c.push(t),h.push(...e)}const u={chunksData:c,options:this.options,min:a,max:d};if(this.chunks.toProcess.find((i=>i.data.x===t&&i.data.z===e)))return;const{geometries:p}=await new Promise((t=>{this.meshWorkerPool.addJob({message:u,buffers:h,resolve:t})}));if(this.chunks.toProcess.find((i=>i.data.x===t&&i.data.z===e)))return;const m={level:i,geometries:p.map((t=>({indices:Array.from(t.indices),positions:Array.from(t.positions),uvs:Array.from(t.uvs),lights:Array.from(t.lights),voxel:t.voxel,faceName:t.faceName})))};this.buildChunkMesh(t,e,m)}async applyBlockTexture(t,e,i){this.checkIsInitialized("apply block texture",!1);const o=this.getBlockOf(t);e=Array.isArray(e)?e:[e];const n="string"==typeof i?await this.loader.loadImage(i):i;e.forEach((t=>{const e=o.faces.find((e=>e.name===t));if(!e)throw new Error(`Face "${t}" does not exist on block "${o.name}"`);const s=this.getBlockFaceMaterial(o.id,t);if(e.independent)if(i instanceof three__WEBPACK_IMPORTED_MODULE_0__.xEZ)s.map=i,s.uniforms.map={value:i},s.needsUpdate=!0;else if(n instanceof HTMLImageElement)s.map.image=n,s.map.needsUpdate=!0,s.needsUpdate=!0;else{if(!(n instanceof three__WEBPACK_IMPORTED_MODULE_0__.Ilk))throw new Error(`Cannot apply texture to face "${t}" on block "${o.name}" because the source is not an image or a color.`);{const t=s.map.image;t.width=1,t.height=1;const e=t.getContext("2d");e.fillStyle=n.getStyle(),e.fillRect(0,0,1,1),s.map.needsUpdate=!0,s.needsUpdate=!0}}else s.map.drawImageToRange(e.range,n),s.map.needsUpdate=!0}))}async applyBlockTextures(t){return Promise.all(t.map((t=>{let{idOrName:e,faceNames:i,source:o}=t;return this.applyBlockTexture(e,i,o)})))}async applyBlockFrames(t,e,i,o){void 0===o&&(o=0),this.checkIsInitialized("apply block animation",!1);const n=this.getBlockOf(t),s=[];for(const[r,l]of i)"string"!=typeof l?s.push([r,l]):s.push([r,await this.loader.loadImage(l)]);(e=Array.isArray(e)?e:[e]).forEach((t=>{const e=n.faces.find((e=>e.name===t));if(!e)throw new Error(`Face "${t}" does not exist on block "${n.name}"`);const i=this.getBlockFaceMaterial(n.id,t);if(!(i.map instanceof AtlasTexture)){const{image:o}=i.map;if(!o||!o.width)throw new Error(`Cannot animate face "${t}" on block "${n.name}" because it does not have a texture.`);{const t=new AtlasTexture(1,o.width);t.drawImageToRange(e.range,o),i.map.dispose(),i.map=t,i.uniforms.map={value:t},i.needsUpdate=!0}}i.map.registerAnimation(e.range,s,o)}))}async applyBlockGif(t,e,i,o){void 0===o&&(o=66.666667),this.checkIsInitialized("apply GIF animation",!1),i.endsWith(".gif")||console.warn("There's a chance that this file isn't a GIF as it doesn't end with .gif");const n=(await this.loader.loadGifImages(i)).map((t=>[o,t]));await this.applyBlockFrames(t,e,n)}async setResolutionOf(t,e,i){this.checkIsInitialized("apply resolution",!1);const o=this.getBlockOf(t);e=Array.isArray(e)?e:[e];for(const s of e){const t=o.faces.find((t=>t.name===s));if(!t)throw new Error(`Face "${s}" does not exist on block "${o.name}"`);if(!t.independent)throw new Error(`Cannot apply resolution to face "${s}" on block "${o.name}" because it is not independent.`);const e=this.getBlockFaceMaterial(o.id,s);if(e.map instanceof AtlasTexture)throw new Error("Cannot apply resolution to a face that is using an atlas texture. Have you accidentally applied keyframes to this face?");var n;const r=null!==(n=e.map.image)&&void 0!==n?n:e.map.source.data;if(r instanceof HTMLImageElement&&await new Promise((t=>{r.complete?t():r.onload=()=>{t()}})),!r)throw new Error(`Cannot apply resolution to face "${s}" on block "${o.name}" because it does not have or has not loaded a texture.`);const{width:l,height:a}=r,d=document.createElement("canvas"),c="number"==typeof i?i:i.x,h="number"==typeof i?i:i.y;d.width=c,d.height=h,d.getContext("2d").drawImage(r,0,0,l,a,0,0,c,h),e.map.image=d,e.map.needsUpdate=!0,e.needsUpdate=!0}}getChunkByName(t){return this.checkIsInitialized("get chunk by name",!1),this.chunks.loaded.get(t)}getChunkByCoords(t,e){this.checkIsInitialized("get chunk by coords",!1);const i=ChunkUtils.getChunkName([t,e]);return this.getChunkByName(i)}getChunkByPosition(t,e,i){this.checkIsInitialized("get chunk by position",!1);const o=ChunkUtils.mapVoxelToChunk([0|t,0|e,0|i],this.options.chunkSize);return this.getChunkByCoords(...o)}getVoxelAt(t,e,i){this.checkIsInitialized("get voxel",!1);const o=this.getChunkByPosition(t,e,i);return void 0===o?0:o.getVoxel(t,e,i)}setVoxelAt(t,e,i,o){this.checkIsInitialized("set voxel",!1);const n=this.getChunkByPosition(t,e,i);void 0!==n&&(n.setVoxel(t,e,i,o),this.trackChunkAt(t,e,i))}getVoxelRotationAt(t,e,i){this.checkIsInitialized("get voxel rotation",!1);const o=this.getChunkByPosition(t,e,i);return void 0===o?new BlockRotation:o.getVoxelRotation(t,e,i)}setVoxelRotationAt(t,e,i,o){this.checkIsInitialized("set voxel rotation",!1);const n=this.getChunkByPosition(t,e,i);void 0!==n&&(n.setVoxelRotation(t,e,i,o),this.trackChunkAt(t,e,i))}getVoxelStageAt(t,e,i){this.checkIsInitialized("get voxel stage",!1);const o=this.getChunkByPosition(t,e,i);return void 0===o?0:o.getVoxelStage(t,e,i)}getSunlightAt(t,e,i){this.checkIsInitialized("get sunlight",!1);const o=this.getChunkByPosition(t,e,i);return void 0===o?0:o.getSunlight(t,e,i)}setSunlightAt(t,e,i,o){this.checkIsInitialized("set sunlight",!1);const n=this.getChunkByPosition(t,e,i);void 0!==n&&(n.setSunlight(t,e,i,o),this.trackChunkAt(t,e,i))}getTorchLightAt(t,e,i,o){this.checkIsInitialized("get torch light",!1);const n=this.getChunkByPosition(t,e,i);return void 0===n?0:n.getTorchLight(t,e,i,o)}setTorchLightAt(t,e,i,o,n){this.checkIsInitialized("set torch light",!1);const s=this.getChunkByPosition(t,e,i);void 0!==s&&(s.setTorchLight(t,e,i,o,n),this.trackChunkAt(t,e,i))}getLightColorAt(t,e,i){this.checkIsInitialized("get light color",!1);const o=this.getSunlightAt(t,e,i),n=this.getTorchLightAt(t,e,i,"RED"),s=this.getTorchLightAt(t,e,i,"GREEN"),r=this.getTorchLightAt(t,e,i,"BLUE"),{sunlightIntensity:l,minLightLevel:a}=this.chunks.uniforms,d=Math.min((o/this.options.maxLightLevel)**2*l.value*(1-a.value)+a.value,1);return new three__WEBPACK_IMPORTED_MODULE_0__.Ilk(d+Math.pow(n/this.options.maxLightLevel,2),d+Math.pow(s/this.options.maxLightLevel,2),d+Math.pow(r/this.options.maxLightLevel,2))}getBlockAt(t,e,i){this.checkIsInitialized("get block",!1);const o=this.getChunkByPosition(t,e,i);if(void 0===o)return null;const n=o.getVoxel(t,e,i);return this.getBlockById(n)}getMaxHeightAt(t,e){this.checkIsInitialized("get max height",!1);const i=0|t,o=0|e;for(let n=this.options.maxHeight-1;n>=0;n--)if(!this.getBlockAt(i,n,o).isEmpty)return n;return 0}getPreviousValueAt(t,e,i,o){void 0===o&&(o=1);const n=ChunkUtils.getVoxelName([0|t,0|e,0|i]),s=this.oldBlocks.get(n)||[];return s[s.length-o]||0}getBlockOf(t){return"number"==typeof t?this.getBlockById(t):this.getBlockByName(t.toLowerCase())}getBlockById(t){const e=this.registry.blocksById.get(t);if(!e)throw new Error(`Block with id ${t} does not exist`);return e}getBlockByName(t){const e=this.registry.blocksByName.get(t.toLowerCase());if(!e)throw new Error(`Block with name ${t} does not exist`);return e}getChunkStatus(t,e){const i=ChunkUtils.getChunkName([t,e]),o=this.chunks.requested.has(i),n=this.chunks.loaded.has(i),s=!!this.chunks.toProcess.find((i=>{let{data:o}=i;return o.x===t&&o.z===e})),r=!!this.chunks.toRequest.find((i=>{let[o,n]=i;return o===t&&n===e}));if(o&&s||o&&r||s&&r)throw new Error(`Chunk ${i} is in more than one state other than the loaded state. This should not happen. These are the states: requested: ${o}, loaded: ${n}, processing: ${s}, to request: ${r}`);return n?"loaded":s?"processing":o?"requested":r?"to request":null}getBlockFaceMaterial(t,e){this.checkIsInitialized("get material",!1);const i=this.getBlockOf(t);return e&&i.independentFaces.has(e)?this.chunks.materials.get(this.makeChunkMaterialKey(i.id,e)):this.chunks.materials.get(this.makeChunkMaterialKey(i.id))}isWithinWorld(t,e){const{minChunk:i,maxChunk:o}=this.options;return t>=i[0]&&t<=o[0]&&e>=i[1]&&e<=o[1]}isChunkInView(t,e,i,o){const[n,s]=t,[r,l]=e;if((n-r)**2+(s-l)**2<Math.floor(this.renderRadius/2)**2)return!0;const a=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(l-s,r-n,0),d=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4(i.z,i.x,0),c=MathUtils.normalizeAngle(a.angleTo(d));return Math.abs(c)<o}floodLight(t,e,i,o){if(!t.length)return;const{maxHeight:n,minChunk:s,maxChunk:r,maxLightLevel:l,chunkSize:a}=this.options,[d,c]=s,[h,u]=r,p="SUNLIGHT"===e;for(;t.length;){const s=t.shift(),{voxel:r,level:m}=s;if(0===m)continue;const[b,y,Z]=r,f=this.getBlockAt(b,y,Z),W=!p&&BlockUtils.getBlockTorchLightLevel(f,e)>0?[!0,!0,!0,!0,!0,!0]:BlockUtils.getBlockRotatedTransparency(f,this.getVoxelRotationAt(b,y,Z));for(const[g,G,v]of VOXEL_NEIGHBORS){const s=y+G;if(s<0||s>=n)continue;const r=b+g,f=Z+v,[X,V]=ChunkUtils.mapVoxelToChunk([r,s,f],a);if(X<d||X>h||V<c||V>u||i&&(r<i[0]||f<i[2])||o&&(r>=o[0]||f>=o[2]))continue;const L=[r,s,f],S=this.getBlockAt(r,s,f),x=BlockUtils.getBlockRotatedTransparency(S,this.getVoxelRotationAt(r,s,f)),R=m-(p&&!S.lightReduce&&-1===G&&m===l?0:1);!LightUtils.canEnter(W,x,g,G,v)||(p?this.getSunlightAt(r,s,f):this.getTorchLightAt(r,s,f,e))>=R||(p?this.setSunlightAt(r,s,f,R):this.setTorchLightAt(r,s,f,R,e),t.push({voxel:L,level:R}))}}}removeLight(t,e){const{maxHeight:i,maxLightLevel:o,chunkSize:n,minChunk:s,maxChunk:r}=this.options,l=[],a=[],d="SUNLIGHT"===e,[c,h,u]=t;for(a.push({voxel:t,level:d?this.getSunlightAt(c,h,u):this.getTorchLightAt(c,h,u,e)}),d?this.setSunlightAt(c,h,u,0):this.setTorchLightAt(c,h,u,0,e);a.length;){const t=a.shift(),{voxel:c,level:h}=t,[u,p,m]=c;for(const[b,y,Z]of VOXEL_NEIGHBORS){const t=p+y;if(t<0||t>=i)continue;const c=u+b,f=m+Z,[W,g]=ChunkUtils.mapVoxelToChunk([c,t,f],n);if(W<s[0]||g<s[1]||W>r[0]||g>r[1])continue;const G=this.getBlockAt(c,t,f),v=this.getVoxelRotationAt(c,t,f),X=BlockUtils.getBlockRotatedTransparency(G,v);if((d||0===BlockUtils.getBlockTorchLightLevel(G,e))&&!LightUtils.canEnterInto(X,b,y,Z))continue;const V=[c,t,f],L=d?this.getSunlightAt(c,t,f):this.getTorchLightAt(c,t,f,e);0!==L&&(L<h||d&&-1===y&&h===o&&L===o?(a.push({voxel:V,level:L}),d?this.setSunlightAt(c,t,f,0):this.setTorchLightAt(c,t,f,0,e)):(d&&-1===y?L>h:L>=h)&&l.push({voxel:V,level:L}))}}this.floodLight(l,e)}async initialize(){if(this.isInitialized)return void console.warn("World has already been isInitialized.");if(null===this.initialData)throw new Error("World has not received any initialization data from the server.");const{blocks:t,options:e,stats:i}=this.initialData;this._time=i.time,Object.keys(t).forEach((e=>{const i=t[e],{id:o,aabbs:n,isDynamic:s}=i,r=e.toLowerCase();i.independentFaces=new Set,i.faces.forEach((t=>{t.independent&&i.independentFaces.add(t.name)})),i.aabbs=n.map((t=>{let{minX:e,minY:i,minZ:o,maxX:n,maxY:s,maxZ:r}=t;return new AABB(e,i,o,n,s,r)})),s&&(i.dynamicFn=()=>({aabbs:i.aabbs,faces:i.faces,isTransparent:i.isTransparent})),this.registry.blocksByName.set(r,i),this.registry.blocksById.set(o,i),this.registry.nameMap.set(r,o),this.registry.idMap.set(o,r)})),this.options=_objectSpread$1({},this.options,e),this.physics.options=this.options,await this.loadMaterials();const o=this.registry.serialize();this.meshWorkerPool.postMessage({type:"init",registryData:o}),this.isInitialized=!0,this.renderRadius=this.options.defaultRenderRadius}update(t,e){if(void 0===t&&(t=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4),void 0===e&&(e=new three__WEBPACK_IMPORTED_MODULE_0__.Pa4),!this.isInitialized)return;const i=this.clock.getDelta(),o=ChunkUtils.mapVoxelToChunk(t.toArray(),this.options.chunkSize);this._time=(this.time+i)%this.options.timePerDay,performance.now(),performance.now(),this.maintainChunks(o,e),performance.now(),performance.now(),this.requestChunks(o,e),performance.now(),performance.now(),this.processChunks(o),performance.now(),performance.now(),this.updatePhysics(i),performance.now(),performance.now(),this.updateUniforms(),performance.now(),performance.now(),this.updateSkyAndClouds(t),performance.now(),performance.now(),this.processClientUpdates(),performance.now(),performance.now(),this.emitServerUpdates(),performance.now(),performance.now()}onMessage(t){const{type:e}=t;switch(e){case"INIT":{const{json:e}=t;this.initialData=e;break}case"STATS":{const{json:e}=t;Math.abs(e.time-this.time)>this.options.timeForceThreshold&&(this._time=e.time);break}case"LOAD":{const{chunks:e}=t;e.forEach((t=>{const{x:e,z:i}=t,o=ChunkUtils.getChunkName([e,i]);this.chunks.requested.delete(o),this.chunks.toProcess.push({source:"load",data:t})}));break}case"UPDATE":{const{updates:e}=t;e.forEach((t=>{const{vx:e,vy:i,vz:o,voxel:n}=t,s=BlockUtils.extractID(n),r=BlockUtils.extractRotation(n),l=this.getVoxelRotationAt(e,i,o);this.getVoxelAt(e,i,o)===s&&l.value===r.value&&l.yRotation===r.yRotation||this.updateVoxel(e,i,o,s,r.value,r.yRotation,"server")}));break}}}get time(){return this._time}set time(t){this._time=t,this.isInitialized&&this.packets.push({type:"METHOD",method:{name:"vox-builtin:set-time",payload:JSON.stringify({time:t})}})}get renderRadius(){return this._renderRadius}set renderRadius(t){this.checkIsInitialized("set render radius",!1),t=Math.floor(t),this._renderRadius=t,this._deleteRadius=1.1*t;const{chunkSize:e}=this.options;this.chunks.uniforms.fogNear.value=.7*t*e,this.chunks.uniforms.fogFar.value=t*e}get deleteRadius(){return this._deleteRadius}requestChunks(t,e){const{renderRadius:i,options:{chunkRerequestInterval:o,chunkLoadExponent:n,maxChunkRequestsPerUpdate:s}}=this,r=this.chunks.loaded.size+this.chunks.requested.size+this.chunks.toRequest.length+this.chunks.toProcess.length,l=this.chunks.loaded.size/r,a=e.length()>0,d=1===l?3*Math.PI/8:Math.max(l**n,.1),[c,h]=t,u=new Set,p=i*i;for(let y=-i;y<=i;y++)for(let n=-i;n<=i;n++){if(y*y+n*n>p)continue;const i=c+y,s=h+n;if(!this.isWithinWorld(i,s))continue;if(a&&!this.isChunkInView(t,[i,s],e,d))continue;const r=this.getChunkStatus(i,s);if(r){if("loaded"!==r)if("requested"!==r);else{const t=ChunkUtils.getChunkName([i,s]),e=this.chunks.requested.get(t)||0;e+1>o?(this.chunks.requested.delete(t),u.add(`${i},${s}`)):this.chunks.requested.set(t,e+1)}}else{const t=`${i},${s}`;this.chunks.requested.has(ChunkUtils.getChunkName([i,s]))||u.add(t)}}if(0===u.size)return;const m=Array.from(u).map((t=>t.split(",").map(Number)));m.sort(((e,i)=>(e[0]-t[0])**2+(e[1]-t[1])**2-((i[0]-t[0])**2+(i[1]-t[1])**2)));const b=m.slice(0,s);this.packets.push({type:"LOAD",json:{center:t,chunks:b}}),b.forEach((t=>{const e=ChunkUtils.getChunkName(t);this.chunks.requested.set(e,0)}))}processChunks(t){if(0===this.chunks.toProcess.length)return;this.chunks.toProcess.sort(((e,i)=>{const{x:o,z:n}=e.data,{x:s,z:r}=i.data;return(o-t[0])**2+(n-t[1])**2-((s-t[0])**2+(r-t[1])**2)}));const{maxProcessesPerUpdate:e,chunkSize:i,maxHeight:o,subChunks:n,shouldGenerateChunkMeshes:s}=this.options,r=t=>{const e=this.chunkInitializeListeners.get(t.name);Array.isArray(e)&&(e.forEach((e=>e(t))),this.chunkInitializeListeners.delete(t.name))};this.chunks.toProcess.splice(0,e).forEach((t=>{const{x:e,z:l,id:a,meshes:d}=t.data,c=ChunkUtils.getChunkName([e,l]);let h=this.getChunkByCoords(e,l);if(h||(h=new Chunk(a,[e,l],{maxHeight:o,subChunks:n,size:i})),h.setData(t.data),h.isDirty=!1,this.chunks.loaded.set(c,h),s){for(const t of d)this.buildChunkMesh(e,l,t);r(h)}else r(h)}))}maintainChunks(t,e){const{deleteRadius:i}=this,[o,n]=t,s=[];this.chunks.loaded.forEach((t=>{const{name:e,coords:[r,l]}=t;if((r-o)**2+(l-n)**2>i**2){const t=this.chunks.loaded.get(e);t.dispose(),this.chunks.loaded.delete(e),s.push(t.coords)}})),this.chunks.requested.forEach(((t,e)=>{const[r,l]=ChunkUtils.parseChunkName(e);(r-o)**2+(l-n)**2>i**2&&(this.chunks.requested.delete(e),s.push([r,l]))}));const r=[...this.chunks.toRequest];this.chunks.toRequest.length=0,this.chunks.toRequest.push(...r.filter((t=>{let[e,s]=t;return(e-o)**2+(s-n)**2<=i**2})));const l=[...this.chunks.toProcess];this.chunks.toProcess.length=0,this.chunks.toProcess.push(...l.filter((t=>{const{x:e,z:s}=t.data;return(e-o)**2+(s-n)**2<=i**2}))),s.forEach((t=>{const e=ChunkUtils.getChunkName(t);this.chunkInitializeListeners.delete(e)})),s.length&&this.packets.push({type:"UNLOAD",json:{chunks:s}})}triggerBlockUpdateListeners(t,e,i,o,n){this.blockUpdateListeners.forEach((s=>s({voxel:[t,e,i],oldValue:o,newValue:n})))}attemptBlockCache(t,e,i,o){const n=this.getChunkByPosition(t,e,i);if(!n)return;const s=n.getRawValue(t,e,i);if(s!==o){const n=ChunkUtils.getVoxelName([t,e,i]),r=this.oldBlocks.get(n)||[];r.push(s),this.oldBlocks.set(n,r),this.triggerBlockUpdateListeners(t,e,i,s,o)}}updateSkyAndClouds(t){var e;const{sunlightStartTimeFrac:i,sunlightEndTimeFrac:o,sunlightChangeSpan:n,timePerDay:s,minLightLevel:r}=this.options;this.sky.update(t,this.time,s),this.clouds.update(t);const l=Math.floor(i*s),a=Math.floor(o*s),d=Math.floor(n*s),c=Math.max(r,this.time<l?0:this.time<l+d?(this.time-l)/d:this.time<=a?1:this.time<=a+d?1-(this.time-a)/d:0);this.chunks.uniforms.sunlightIntensity.value=c;const h=this.clouds.material.uniforms.uCloudColor.value,u=h.getHSL({});h.setHSL(u.h,u.s,three__WEBPACK_IMPORTED_MODULE_0__.M8C.clamp(c,0,1)),null===(e=this.chunks.uniforms.fogColor.value)||void 0===e||e.copy(this.sky.uMiddleColor.value)}buildChunkMesh(t,e,i){var o,n;const s=this.getChunkByCoords(t,e);if(!s)return;const{maxHeight:r,subChunks:l,chunkSize:a}=this.options,{level:d,geometries:c}=i,h=Math.floor(r/l);if(null===(o=s.meshes.get(d))||void 0===o||o.forEach((t=>{t.geometry.dispose(),this.remove(t)})),s.meshes.delete(d),0===c.length)return;const u=c.map((i=>{const{voxel:o,faceName:n,indices:s,lights:r,positions:l,uvs:c}=i,u=new three__WEBPACK_IMPORTED_MODULE_0__.u9r;u.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(l,3)),u.setAttribute("uv",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(c,2)),u.setAttribute("light",new three__WEBPACK_IMPORTED_MODULE_0__.j87(r,1)),u.setIndex(s);const p=this.getBlockFaceMaterial(o,n);if(!p)return;const m=new three__WEBPACK_IMPORTED_MODULE_0__.Kj0(u,p);return m.position.set(t*a,d*h,e*a),m.updateMatrix(),m.matrixAutoUpdate=!1,m.matrixWorldAutoUpdate=!1,m.userData={isChunk:!0,voxel:o},this.add(m),m}));s.meshes.has(d)||s.meshes.set(d,[]),null===(n=s.meshes.get(d))||void 0===n||n.push(...u)}setupComponents(){const{skyOptions:t,cloudsOptions:e}=this.options;this.registry=new Registry,this.loader=new Loader,this.chunks=new Chunks,e.uFogColor||(e.uFogColor=this.chunks.uniforms.fogColor),this.sky=new Sky(t),this.clouds=new Clouds(e),this.add(this.sky,this.clouds),this.physics=new Engine(((t,e,i)=>{if(!this.getChunkByPosition(t,e,i))return[];const o=this.getVoxelAt(t,e,i),n=this.getVoxelRotationAt(t,e,i),{aabbs:s,isPassable:r,isFluid:l}=this.getBlockById(o);return r||l?[]:s.map((o=>n.rotateAABB(o).translate([t,e,i])))}),((t,e,i)=>{if(!this.getChunkByPosition(t,e,i))return!1;const o=this.getVoxelAt(t,e,i),{isFluid:n}=this.getBlockById(o);return n}),this.options)}setupUniforms(){const{minLightLevel:t}=this.options;this.chunks.uniforms.minLightLevel.value=t}async loadMaterials(){const{textureUnitDimension:t}=this.options,e=t=>{let e=1;const i=Math.ceil(Math.sqrt(t));for(;e<i;)e*=2;return e},i=(t,e)=>{const i=this.makeShaderMaterial();return i.side=t?three__WEBPACK_IMPORTED_MODULE_0__.ub3:three__WEBPACK_IMPORTED_MODULE_0__.Wl3,i.transparent=t,i.map=e,i.uniforms.map.value=e,i};for(const o of this.registry.blocksById.values()){let n=o.faces.length;o.faces.forEach((t=>{t.independent&&n--}));const s=e(n),r=new AtlasTexture(s,t),l=i(o.isSeeThrough,r),a=this.makeChunkMaterialKey(o.id);this.chunks.materials.set(a,l);for(const e of o.faces){if(!e.independent)continue;const n=i(o.isSeeThrough,AtlasTexture.makeUnknownTexture(t)),s=this.makeChunkMaterialKey(o.id,e.name);this.chunks.materials.set(s,n)}}}makeChunkMaterialKey(t,e){return e?`${t}-${e}`:`${t}`}trackChunkAt(t,e,i){if(!this.isTrackingChunks)return;const{chunkSize:o,maxHeight:n,subChunks:s}=this.options,r=[0|t,0|e,0|i],[l,a]=ChunkUtils.mapVoxelToChunk(r,o),[d,,c]=ChunkUtils.mapVoxelToChunkLocal(r,o),h=n/s,u=Math.floor(e/h),p=[];p.push([l,a]),0===d&&p.push([l-1,a]),0===c&&p.push([l,a-1]),0===d&&0===c&&p.push([l-1,a-1]),d===o-1&&p.push([l+1,a]),c===o-1&&p.push([l,a+1]),d===o-1&&c===o-1&&p.push([l+1,a+1]);const m=[];e%h==0&&u>0?m.push(u-1):e%h==h-1&&u<s&&m.push(u+1),m.push(u);const b=[];this.chunksTracker.forEach((t=>{b.push(t.join(","))}));for(const[y,Z]of p)for(const t of m)b.includes([y,Z,t].join(","))||this.chunksTracker.push([[y,Z],t])}checkIsInitialized(t,e){if(void 0===e&&(e=!0),e?this.isInitialized:!this.isInitialized)throw new Error(`Cannot ${t} ${e?"after":"before"} the world ${e?"has been":"is"} isInitialized. ${e?"This has to be called before `world.init`.":"Remember to call the asynchronous function `world.init` beforehand."}`)}constructor(t){var e,i;void 0===t&&(t={}),super(),e=this,_defineProperty$4(this,"options",void 0),_defineProperty$4(this,"registry",void 0),_defineProperty$4(this,"loader",void 0),_defineProperty$4(this,"chunks",void 0),_defineProperty$4(this,"physics",void 0),_defineProperty$4(this,"sky",void 0),_defineProperty$4(this,"clouds",void 0),_defineProperty$4(this,"isInitialized",!1),_defineProperty$4(this,"packets",[]),_defineProperty$4(this,"oldBlocks",new Map),_defineProperty$4(this,"clock",new three__WEBPACK_IMPORTED_MODULE_0__.SUY),_defineProperty$4(this,"chunkInitializeListeners",new Map),_defineProperty$4(this,"blockUpdateListeners",new Set),_defineProperty$4(this,"initialData",null),_defineProperty$4(this,"_time",0),_defineProperty$4(this,"_renderRadius",0),_defineProperty$4(this,"_deleteRadius",0),_defineProperty$4(this,"meshWorkerPool",new WorkerPool(WorkerFactory$2,{maxWorker:null!==(i=navigator.hardwareConcurrency)&&void 0!==i?i:4})),_defineProperty$4(this,"chunksTracker",[]),_defineProperty$4(this,"isTrackingChunks",!1),_defineProperty$4(this,"addChunkInitListener",((t,e)=>{const i=ChunkUtils.getChunkName(t);if(this.chunks.loaded.has(i))return void e(this.chunks.loaded.get(i));const o=this.chunkInitializeListeners.get(i)||[];o.push(e),this.chunkInitializeListeners.set(i,o)})),_defineProperty$4(this,"addBlockUpdateListener",(t=>{this.blockUpdateListeners.add(t)})),_defineProperty$4(this,"raycastVoxels",(function(t,i,o,n){void 0===n&&(n={}),e.checkIsInitialized("raycast voxels",!1);const{ignoreFluids:s,ignorePassables:r,ignoreSeeThrough:l}=_objectSpread$1({ignoreFluids:!0,ignorePassables:!1,ignoreSeeThrough:!1},n),a=new Set(n.ignoreList||[]);return raycast(((t,i,o)=>{const n=e.getBlockAt(t,i,o);if(!n)return[];const{id:d,isFluid:c,isPassable:h,isSeeThrough:u,aabbs:p,dynamicFn:m,isDynamic:b}=n;if(a.has(d))return[];if(b&&!m&&console.warn(`Block of ID ${d} is dynamic but has no dynamic function.`),c&&s||h&&r||u&&l)return[];const y=e.getVoxelRotationAt(t,i,o);return(b&&m?m([0|t,0|i,0|o]).aabbs:p).map((t=>y.rotateAABB(t)))}),t,i,o)})),_defineProperty$4(this,"updateVoxel",(function(t,i,o,n,s,r,l){void 0===s&&(s=PY_ROTATION),void 0===r&&(r=0),void 0===l&&(l="client"),e.updateVoxels([{vx:t,vy:i,vz:o,type:n,rotation:s,yRotation:r}],l)})),_defineProperty$4(this,"updateVoxels",(function(t,i){void 0===i&&(i="client"),e.checkIsInitialized("update voxels",!1);const o=t.filter((t=>{if(t.vy<0||t.vy>=e.options.maxHeight)return!1;const{vx:i,vy:o,vz:n,type:s,rotation:r,yRotation:l}=t,a=e.getVoxelAt(i,o,n),d=e.getVoxelRotationAt(i,o,n);return e.getBlockById(s)?a!==s||void 0===r||d.value!==r||void 0===l||d.yRotation!==l:(console.warn(`Block ID ${s} does not exist.`),!1)})).map((t=>(isNaN(t.rotation)&&(t.rotation=0),e.getBlockById(t.type).yRotatable||(t.yRotation=0),t)));e.chunks.toUpdate.push(...o.map((t=>({source:i,update:t}))))})),_defineProperty$4(this,"makeBlockMesh",(function(t,i){if(void 0===i&&(i={}),e.checkIsInitialized("make block mesh",!1),!t)return null;const o=e.getBlockOf(t);if(!o)return null;const{separateFaces:n,crumbs:s,material:r}=_objectSpread$1({separateFaces:!1,crumbs:!1,material:"basic"},i),{faces:l,isSeeThrough:a}=o,d=new Map;l.forEach(((t,i)=>{const l=s&&n?Math.random()+.5:1,{corners:c,name:h,range:u}=t,p=`${o.name}-${h}-${n?i:"all"}`;let m=d.get(p);if(!m){const t=e.getBlockFaceMaterial(o.id,h),i={transparent:a,map:t.map,side:a?three__WEBPACK_IMPORTED_MODULE_0__.ub3:three__WEBPACK_IMPORTED_MODULE_0__.Wl3};m={identifier:p,positions:[],uvs:[],indices:[],material:"basic"===r?new three__WEBPACK_IMPORTED_MODULE_0__.vBJ(i):new three__WEBPACK_IMPORTED_MODULE_0__.Wid(i)}}const{positions:b,uvs:y,indices:Z}=m,f=Math.floor(b.length/3);let{startU:W,endU:g,startV:G,endV:v}=u;s&&(Math.random()<.5?(W+=(g-W)/2*Math.random(),v-=(v-G)/2*Math.random()):(g-=(g-W)/2*Math.random(),G+=(v-G)/2*Math.random())),c.forEach((t=>{let{uv:e,pos:i}=t;b.push(...i.map((t=>t*l))),y.push(e[0]*(g-W)+W,e[1]*(v-G)+G)})),Z.push(f,f+1,f+2,f+2,f+1,f+3),d.set(p,m)}));const c=new three__WEBPACK_IMPORTED_MODULE_0__.ZAu;return d.forEach((t=>{let{identifier:e,positions:i,uvs:o,indices:n,material:s}=t;const r=new three__WEBPACK_IMPORTED_MODULE_0__.u9r;r.setAttribute("position",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(i,3)),r.setAttribute("uv",new three__WEBPACK_IMPORTED_MODULE_0__.a$l(o,2)),r.setIndex(n),r.computeVertexNormals();const l=new three__WEBPACK_IMPORTED_MODULE_0__.Kj0(r,s);l.name=e,c.add(l)})),c.name=o.name,c.position.x-=.5,c.position.y-=.5,c.position.z-=.5,c})),_defineProperty$4(this,"customizeMaterialShaders",(function(t,i,o){void 0===i&&(i=null),void 0===o&&(o={vertexShader:DEFAULT_CHUNK_SHADERS.vertex,fragmentShader:DEFAULT_CHUNK_SHADERS.fragment,uniforms:{}}),e.checkIsInitialized("customize material shaders",!1);const{vertexShader:n=DEFAULT_CHUNK_SHADERS.vertex,fragmentShader:s=DEFAULT_CHUNK_SHADERS.fragment,uniforms:r={}}=o,l=e.getBlockFaceMaterial(t,i);if(!l)throw new Error(`Could not find material for block ${t} and face ${i}`);return l.vertexShader=n,l.fragmentShader=s,l.uniforms=_objectSpread$1({},l.uniforms,r),l.needsUpdate=!0,l})),_defineProperty$4(this,"customizeBlockDynamic",((t,e)=>{this.checkIsInitialized("customize block dynamic",!1);const i=this.getBlockOf(t);if(!i)throw new Error(`Block with ID ${t} does not exist, could not overwrite dynamic function.`);i.dynamicFn=e})),_defineProperty$4(this,"updatePhysics",(t=>{if(!this.physics||!this.options.gravity)return;const e=this.options.gravity[0]**2+this.options.gravity[1]**2+this.options.gravity[2]**2<.01;this.physics.bodies.forEach((i=>{const o=ChunkUtils.mapVoxelToChunk(i.getPosition(),this.options.chunkSize),n=this.getChunkByPosition(...i.getPosition());(n&&n.isReady||!this.isWithinWorld(...o))&&this.physics.iterateBody(i,t,e)}))})),_defineProperty$4(this,"updateUniforms",(()=>{this.chunks.uniforms.time.value=performance.now()})),_defineProperty$4(this,"processClientUpdates",(()=>{if(0===this.chunks.toUpdate.length)return;const t=this.chunks.toUpdate.splice(0,this.options.maxUpdatesPerUpdate);t.sort(((t,e)=>e.update.vy-t.update.vy));const{maxHeight:e,maxLightLevel:i}=this.options,o=[],n=[],s=[],r=[];this.isTrackingChunks=!0;for(const a of t){const{update:{type:t,vx:l,vy:d,vz:c,rotation:h,yRotation:u}}=a,p=this.getBlockAt(l,d,c),m=this.getVoxelRotationAt(l,d,c),b=BlockUtils.getBlockRotatedTransparency(p,m),y=this.getBlockById(t),Z=BlockRotation.encode(h,u),f=BlockUtils.getBlockRotatedTransparency(y,Z),W=BlockUtils.insertAll(y.id,y.rotatable?Z:void 0);if(this.attemptBlockCache(l,d,c,W),this.setVoxelAt(l,d,c,t),y.rotatable&&this.setVoxelRotationAt(l,d,c,Z),y.isOpaque||y.lightReduce)this.getSunlightAt(l,d,c)>0&&this.removeLight([l,d,c],"SUNLIGHT"),[RED_LIGHT,GREEN_LIGHT,BLUE_LIGHT].map((t=>{this.getTorchLightAt(l,d,c,t)>0&&this.removeLight([l,d,c],t)}));else{let t=0;const o=[[SUNLIGHT,this.getSunlightAt(l,d,c)],[RED_LIGHT,this.getTorchLightAt(l,d,c,"RED")],[GREEN_LIGHT,this.getTorchLightAt(l,d,c,"GREEN")],[BLUE_LIGHT,this.getTorchLightAt(l,d,c,"BLUE")]];VOXEL_NEIGHBORS.forEach((n=>{let[s,r,a]=n;const h=d+r;if(h<0||h>=e)return;const u=l+s,p=c+a,y=this.getBlockAt(u,h,p),Z=BlockUtils.getBlockRotatedTransparency(y,m);LightUtils.canEnter(b,Z,s,r,a)&&!LightUtils.canEnter(f,Z,s,r,a)&&o.forEach((e=>{let[o,n]=e;const s=o===SUNLIGHT,l=s?this.getSunlightAt(u,h,p):this.getTorchLightAt(u,h,p,o);(l<n||-1===r&&s&&l===i&&n===i)&&(t+=1,this.removeLight([u,h,p],o))}))})),0===t&&(0!==this.getSunlightAt(l,d,c)&&this.removeLight([l,d,c],"SUNLIGHT"),[RED_LIGHT,GREEN_LIGHT,BLUE_LIGHT].map((t=>{0!==this.getTorchLightAt(l,d,c,t)&&this.removeLight([l,d,c],t)})))}y.isLight?(y.redLightLevel>0&&(this.setTorchLightAt(l,d,c,y.redLightLevel,"RED"),o.push({voxel:[l,d,c],level:y.redLightLevel})),y.greenLightLevel>0&&(this.setTorchLightAt(l,d,c,y.greenLightLevel,"GREEN"),n.push({voxel:[l,d,c],level:y.greenLightLevel})),y.blueLightLevel>0&&(this.setTorchLightAt(l,d,c,y.blueLightLevel,"BLUE"),s.push({voxel:[l,d,c],level:y.blueLightLevel}))):VOXEL_NEIGHBORS.forEach((t=>{let[a,h,u]=t;const p=d+h;if(p<0)return;if(p>=e)return void(LightUtils.canEnter([!0,!0,!0,!0,!0,!0],f,a,-1,u)&&r.push({voxel:[l+a,d,c+u],level:i}));const m=l+a,Z=c+u,W=this.getBlockAt(m,p,Z),g=BlockUtils.getBlockRotatedTransparency(W,this.getVoxelRotationAt(m,p,Z)),G=[m,p,Z];if(LightUtils.canEnter(b,g,a,h,u)||!LightUtils.canEnter(f,g,a,h,u))return;const v=this.getSunlightAt(m,p,Z)-(y.lightReduce?1:0);0!==v&&r.push({voxel:G,level:v});const X=this.getTorchLightAt(m,p,Z,"RED")-(y.lightReduce?1:0);0!==X&&o.push({voxel:G,level:X});const V=this.getTorchLightAt(m,p,Z,"GREEN")-(y.lightReduce?1:0);0!==V&&n.push({voxel:G,level:V});const L=this.getTorchLightAt(m,p,Z,"BLUE")-(y.lightReduce?1:0);0!==L&&s.push({voxel:G,level:L})}))}this.floodLight(r,"SUNLIGHT"),this.floodLight(o,"RED"),this.floodLight(n,"GREEN"),this.floodLight(s,"BLUE"),this.isTrackingChunks=!1;const l=this.chunksTracker.splice(0,this.chunksTracker.length);(async()=>{for(const[t,e]of l){const[i,o]=t;await this.meshChunkLocally(i,o,e)}})().then((()=>{this.chunks.toEmit.push(...t.filter((t=>{let{source:e}=t;return"client"===e})).map((t=>{let{update:e}=t;return e})))}))})),_defineProperty$4(this,"emitServerUpdates",(()=>{if(0===this.chunks.toEmit.length)return;const t=this.chunks.toEmit.splice(0,this.options.maxUpdatesPerUpdate);this.packets.push({type:"UPDATE",updates:t.map((t=>{const{type:e,rotation:i,yRotation:o}=t,n=this.getBlockById(e);let s=0;return s=BlockUtils.insertID(s,e),!n.rotatable||isNaN(i)&&isNaN(o)||(s=BlockUtils.insertRotation(s,BlockRotation.encode(i,o))),_objectSpreadProps(_objectSpread$1({},t),{voxel:s})}))})})),_defineProperty$4(this,"makeShaderMaterial",(function(t,i,o){void 0===t&&(t=DEFAULT_CHUNK_SHADERS.fragment),void 0===i&&(i=DEFAULT_CHUNK_SHADERS.vertex),void 0===o&&(o={});const n=_objectSpread$1({},e.chunks.uniforms,e.options.chunkUniformsOverwrite),s=new three__WEBPACK_IMPORTED_MODULE_0__.jyz({vertexColors:!0,fragmentShader:t,vertexShader:i,uniforms:_objectSpread$1(_objectSpreadProps(_objectSpread$1({},three__WEBPACK_IMPORTED_MODULE_0__.rDY.clone(three__WEBPACK_IMPORTED_MODULE_0__.Vj0.basic.uniforms)),{uSunlightIntensity:n.sunlightIntensity,uAOTable:n.ao,uMinLightLevel:n.minLightLevel,uFogNear:n.fogNear,uFogFar:n.fogFar,uFogColor:n.fogColor,uTime:n.time}),o)});return Object.defineProperty(s,"renderStage",{get:function(){return s.uniforms.renderStage.value},set:function(t){s.uniforms.renderStage.value=parseFloat(t)}}),s.map=AtlasTexture.makeUnknownTexture(),s.uniforms.map={value:s.map},s}));const{statsSyncInterval:o}=this.options=_objectSpread$1({},defaultOptions$1,t);this.setupComponents(),this.setupUniforms(),setWorkerInterval((()=>{this.packets.push({type:"METHOD",method:{name:"vox-builtin:get-stats",payload:{}}})}),o)}}var url_min={exports:{}},module;module=url_min,function(t){var e,i=/^[a-z]+:/,o=/[-a-z0-9]+(\.[-a-z0-9])*:\d+/i,n=/\/\/(.*?)(?::(.*?))?@/,s=/^win/i,r=/:$/,l=/^\?/,a=/^#/,d=/(.*\/)/,c=/^\/{2,}/,h=/(^\/?)/,u=/'/g,p=/%([ef][0-9a-f])%([89ab][0-9a-f])%([89ab][0-9a-f])/gi,m=/%([cd][0-9a-f])%([89ab][0-9a-f])/gi,b=/%([0-7][0-9a-f])/gi,y=/\+/g,Z=/^\w:$/,f=/[^/#?]/,W="undefined"==typeof window&&void 0!==commonjsGlobal&&"function"==typeof commonjsRequire,g=!W&&t.navigator&&t.navigator.userAgent&&~t.navigator.userAgent.indexOf("MSIE"),G=W?t.require:null,v={protocol:"protocol",host:"hostname",port:"port",path:"pathname",query:"search",hash:"hash"},X={ftp:21,gopher:70,http:80,https:443,ws:80,wss:443};function V(){return W?e=e||"file://"+(process.platform.match(s)?"/":"")+G("fs").realpathSync("."):"about:srcdoc"===document.location.href?self.parent.document.location.href:document.location.href}function L(t){return encodeURIComponent(t).replace(u,"%27")}function S(t){return(t=(t=(t=t.replace(y," ")).replace(p,(function(t,e,i,o){var n=parseInt(e,16)-224,s=parseInt(i,16)-128;if(0==n&&s<32)return t;var r=(n<<12)+(s<<6)+(parseInt(o,16)-128);return 65535<r?t:String.fromCharCode(r)}))).replace(m,(function(t,e,i){var o=parseInt(e,16)-192;if(o<2)return t;var n=parseInt(i,16)-128;return String.fromCharCode((o<<6)+n)}))).replace(b,(function(t,e){return String.fromCharCode(parseInt(e,16))}))}function x(t){for(var e=t.split("&"),i=0,o=e.length;i<o;i++){var n=e[i].split("="),s=decodeURIComponent(n[0].replace(y," "));if(s){var r=void 0!==n[1]?S(n[1]):null;void 0===this[s]?this[s]=r:(this[s]instanceof Array||(this[s]=[this[s]]),this[s].push(r))}}}function R(t,e){!function(t,e,s){var u,p,m;e=e||V(),W?u=G("url").parse(e):(u=document.createElement("a")).href=e;var b,y,Z=(y={path:!0,query:!0,hash:!0},(b=e)&&i.test(b)&&(y.protocol=!0,y.host=!0,o.test(b)&&(y.port=!0),n.test(b)&&(y.user=!0,y.pass=!0)),y);for(p in m=e.match(n)||[],v)Z[p]?t[p]=u[v[p]]||"":t[p]="";if(t.protocol=t.protocol.replace(r,""),t.query=t.query.replace(l,""),t.hash=S(t.hash.replace(a,"")),t.user=S(m[1]||""),t.pass=S(m[2]||""),t.port=X[t.protocol]==t.port||0==t.port?"":t.port,!Z.protocol&&f.test(e.charAt(0))&&(t.path=e.split("?")[0].split("#")[0]),!Z.protocol&&s){var L=new R(V().match(d)[0]),P=L.path.split("/"),w=t.path.split("/"),I=["protocol","user","pass","host","port"],k=I.length;for(P.pop(),p=0;p<k;p++)t[I[p]]=L[I[p]];for(;".."===w[0];)P.pop(),w.shift();t.path=("/"!==e.charAt(0)?P.join("/"):"")+"/"+w.join("/")}t.path=t.path.replace(c,"/"),g&&(t.path=t.path.replace(h,"/")),t.paths(t.paths()),t.query=new x(t.query)}(this,t,!e)}x.prototype.toString=function(){var t,e,i="",o=L;for(t in this){var n=this[t];if(!(n instanceof Function||void 0===n))if(n instanceof Array){var s=n.length;if(!s){i+=(i?"&":"")+o(t)+"=";continue}for(e=0;e<s;e++){var r=n[e];void 0!==r&&(i+=i?"&":"",i+=o(t)+(null===r?"":"="+o(r)))}}else i+=i?"&":"",i+=o(t)+(null===n?"":"="+o(n))}return i},R.prototype.clearQuery=function(){for(var t in this.query)this.query[t]instanceof Function||delete this.query[t];return this},R.prototype.queryLength=function(){var t=0;for(var e in this.query)this.query[e]instanceof Function||t++;return t},R.prototype.isEmptyQuery=function(){return 0===this.queryLength()},R.prototype.paths=function(t){var e,i="",o=0;if(t&&t.length&&t+""!==t){for(this.isAbsolute()&&(i="/"),e=t.length;o<e;o++)t[o]=!o&&Z.test(t[o])?t[o]:L(t[o]);this.path=i+t.join("/")}for(o=0,e=(t=("/"===this.path.charAt(0)?this.path.slice(1):this.path).split("/")).length;o<e;o++)t[o]=S(t[o]);return t},R.prototype.encode=L,R.prototype.decode=S,R.prototype.isAbsolute=function(){return this.protocol||"/"===this.path.charAt(0)},R.prototype.toString=function(){return(this.protocol&&this.protocol+"://")+(this.user&&L(this.user)+(this.pass&&":"+L(this.pass))+"@")+(this.host&&this.host)+(this.port&&":"+this.port)+(this.path&&this.path)+(this.query.toString()&&"?"+this.query)+(this.hash&&"#"+L(this.hash))},t[t.exports?"exports":"Url"]=R}(module.exports?module:window);var DOMUrl=url_min.exports;function createBase64SharedWorkerFactory(t,e,i){var o;return function(n){return o=o||createURL(t,e,i),new SharedWorker(o,n)}}var WorkerFactory=createBase64SharedWorkerFactory("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7dmFyIGNvbW1vbmpzR2xvYmFsPSJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsVGhpcz9nbG9iYWxUaGlzOiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93P3dpbmRvdzoidW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbD9nbG9iYWw6InVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmP3NlbGY6e30saW5kZXhNaW5pbWFsPXt9LG1pbmltYWwkMT17fSxhc3Byb21pc2U9YXNQcm9taXNlO2Z1bmN0aW9uIGFzUHJvbWlzZShlLHQpe2Zvcih2YXIgcj1uZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aC0xKSxvPTAsbj0yLGk9ITA7bjxhcmd1bWVudHMubGVuZ3RoOylyW28rK109YXJndW1lbnRzW24rK107cmV0dXJuIG5ldyBQcm9taXNlKChmdW5jdGlvbihuLGwpe3Jbb109ZnVuY3Rpb24oZSl7aWYoaSlpZihpPSExLGUpbChlKTtlbHNle2Zvcih2YXIgdD1uZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aC0xKSxyPTA7cjx0Lmxlbmd0aDspdFtyKytdPWFyZ3VtZW50c1tyXTtuLmFwcGx5KG51bGwsdCl9fTt0cnl7ZS5hcHBseSh0fHxudWxsLHIpfWNhdGNoKGUpe2kmJihpPSExLGwoZSkpfX0pKX12YXIgYmFzZTY0JDE9e307IWZ1bmN0aW9uKGUpe3ZhciB0PWU7dC5sZW5ndGg9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5sZW5ndGg7aWYoIXQpcmV0dXJuIDA7Zm9yKHZhciByPTA7LS10JTQ+MSYmIj0iPT09ZS5jaGFyQXQodCk7KSsrcjtyZXR1cm4gTWF0aC5jZWlsKDMqZS5sZW5ndGgpLzQtcn07Zm9yKHZhciByPW5ldyBBcnJheSg2NCksbz1uZXcgQXJyYXkoMTIzKSxuPTA7bjw2NDspb1tyW25dPW48MjY/bis2NTpuPDUyP24rNzE6bjw2Mj9uLTQ6bi01OXw0M109bisrO3QuZW5jb2RlPWZ1bmN0aW9uKGUsdCxvKXtmb3IodmFyIG4saT1udWxsLGw9W10scz0wLGE9MDt0PG87KXt2YXIgdT1lW3QrK107c3dpdGNoKGEpe2Nhc2UgMDpsW3MrK109clt1Pj4yXSxuPSgzJnUpPDw0LGE9MTticmVhaztjYXNlIDE6bFtzKytdPXJbbnx1Pj40XSxuPSgxNSZ1KTw8MixhPTI7YnJlYWs7Y2FzZSAyOmxbcysrXT1yW258dT4+Nl0sbFtzKytdPXJbNjMmdV0sYT0wfXM+ODE5MSYmKChpfHwoaT1bXSkpLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShTdHJpbmcsbCkpLHM9MCl9cmV0dXJuIGEmJihsW3MrK109cltuXSxsW3MrK109NjEsMT09PWEmJihsW3MrK109NjEpKSxpPyhzJiZpLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShTdHJpbmcsbC5zbGljZSgwLHMpKSksaS5qb2luKCIiKSk6U3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShTdHJpbmcsbC5zbGljZSgwLHMpKX07dmFyIGk9ImludmFsaWQgZW5jb2RpbmciO3QuZGVjb2RlPWZ1bmN0aW9uKGUsdCxyKXtmb3IodmFyIG4sbD1yLHM9MCxhPTA7YTxlLmxlbmd0aDspe3ZhciB1PWUuY2hhckNvZGVBdChhKyspO2lmKDYxPT09dSYmcz4xKWJyZWFrO2lmKHZvaWQgMD09PSh1PW9bdV0pKXRocm93IEVycm9yKGkpO3N3aXRjaChzKXtjYXNlIDA6bj11LHM9MTticmVhaztjYXNlIDE6dFtyKytdPW48PDJ8KDQ4JnUpPj40LG49dSxzPTI7YnJlYWs7Y2FzZSAyOnRbcisrXT0oMTUmbik8PDR8KDYwJnUpPj4yLG49dSxzPTM7YnJlYWs7Y2FzZSAzOnRbcisrXT0oMyZuKTw8Nnx1LHM9MH19aWYoMT09PXMpdGhyb3cgRXJyb3IoaSk7cmV0dXJuIHItbH0sdC50ZXN0PWZ1bmN0aW9uKGUpe3JldHVybi9eKD86W0EtWmEtejAtOSsvXXs0fSkqKD86W0EtWmEtejAtOSsvXXsyfT09fFtBLVphLXowLTkrL117M309KT8kLy50ZXN0KGUpfX0oYmFzZTY0JDEpO3ZhciBldmVudGVtaXR0ZXI9RXZlbnRFbWl0dGVyO2Z1bmN0aW9uIEV2ZW50RW1pdHRlcigpe3RoaXMuX2xpc3RlbmVycz17fX1FdmVudEVtaXR0ZXIucHJvdG90eXBlLm9uPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4odGhpcy5fbGlzdGVuZXJzW2VdfHwodGhpcy5fbGlzdGVuZXJzW2VdPVtdKSkucHVzaCh7Zm46dCxjdHg6cnx8dGhpc30pLHRoaXN9LEV2ZW50RW1pdHRlci5wcm90b3R5cGUub2ZmPWZ1bmN0aW9uKGUsdCl7aWYodm9pZCAwPT09ZSl0aGlzLl9saXN0ZW5lcnM9e307ZWxzZSBpZih2b2lkIDA9PT10KXRoaXMuX2xpc3RlbmVyc1tlXT1bXTtlbHNlIGZvcih2YXIgcj10aGlzLl9saXN0ZW5lcnNbZV0sbz0wO288ci5sZW5ndGg7KXJbb10uZm49PT10P3Iuc3BsaWNlKG8sMSk6KytvO3JldHVybiB0aGlzfSxFdmVudEVtaXR0ZXIucHJvdG90eXBlLmVtaXQ9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5fbGlzdGVuZXJzW2VdO2lmKHQpe2Zvcih2YXIgcj1bXSxvPTE7bzxhcmd1bWVudHMubGVuZ3RoOylyLnB1c2goYXJndW1lbnRzW28rK10pO2ZvcihvPTA7bzx0Lmxlbmd0aDspdFtvXS5mbi5hcHBseSh0W28rK10uY3R4LHIpfXJldHVybiB0aGlzfTt2YXIgZmxvYXQ9ZmFjdG9yeShmYWN0b3J5KTtmdW5jdGlvbiBmYWN0b3J5KGUpe3JldHVybiJ1bmRlZmluZWQiIT10eXBlb2YgRmxvYXQzMkFycmF5P2Z1bmN0aW9uKCl7dmFyIHQ9bmV3IEZsb2F0MzJBcnJheShbLTBdKSxyPW5ldyBVaW50OEFycmF5KHQuYnVmZmVyKSxvPTEyOD09PXJbM107ZnVuY3Rpb24gbihlLG8sbil7dFswXT1lLG9bbl09clswXSxvW24rMV09clsxXSxvW24rMl09clsyXSxvW24rM109clszXX1mdW5jdGlvbiBpKGUsbyxuKXt0WzBdPWUsb1tuXT1yWzNdLG9bbisxXT1yWzJdLG9bbisyXT1yWzFdLG9bbiszXT1yWzBdfWZ1bmN0aW9uIGwoZSxvKXtyZXR1cm4gclswXT1lW29dLHJbMV09ZVtvKzFdLHJbMl09ZVtvKzJdLHJbM109ZVtvKzNdLHRbMF19ZnVuY3Rpb24gcyhlLG8pe3JldHVybiByWzNdPWVbb10sclsyXT1lW28rMV0sclsxXT1lW28rMl0sclswXT1lW28rM10sdFswXX1lLndyaXRlRmxvYXRMRT1vP246aSxlLndyaXRlRmxvYXRCRT1vP2k6bixlLnJlYWRGbG9hdExFPW8/bDpzLGUucmVhZEZsb2F0QkU9bz9zOmx9KCk6ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KGUsdCxyLG8pe3ZhciBuPXQ8MD8xOjA7aWYobiYmKHQ9LXQpLDA9PT10KWUoMS90PjA/MDoyMTQ3NDgzNjQ4LHIsbyk7ZWxzZSBpZihpc05hTih0KSllKDIxNDMyODkzNDQscixvKTtlbHNlIGlmKHQ+MzQwMjgyMzQ2NjM4NTI4ODZlMjIpZSgobjw8MzF8MjEzOTA5NTA0MCk+Pj4wLHIsbyk7ZWxzZSBpZih0PDExNzU0OTQzNTA4MjIyODc1ZS01NCllKChuPDwzMXxNYXRoLnJvdW5kKHQvMTQwMTI5ODQ2NDMyNDgxN2UtNjApKT4+PjAscixvKTtlbHNle3ZhciBpPU1hdGguZmxvb3IoTWF0aC5sb2codCkvTWF0aC5MTjIpO2UoKG48PDMxfGkrMTI3PDwyM3w4Mzg4NjA3Jk1hdGgucm91bmQodCpNYXRoLnBvdygyLC1pKSo4Mzg4NjA4KSk+Pj4wLHIsbyl9fWZ1bmN0aW9uIHIoZSx0LHIpe3ZhciBvPWUodCxyKSxuPTIqKG8+PjMxKSsxLGk9bz4+PjIzJjI1NSxsPTgzODg2MDcmbztyZXR1cm4gMjU1PT09aT9sP05hTjpuKigxLzApOjA9PT1pPzE0MDEyOTg0NjQzMjQ4MTdlLTYwKm4qbDpuKk1hdGgucG93KDIsaS0xNTApKihsKzgzODg2MDgpfWUud3JpdGVGbG9hdExFPXQuYmluZChudWxsLHdyaXRlVWludExFKSxlLndyaXRlRmxvYXRCRT10LmJpbmQobnVsbCx3cml0ZVVpbnRCRSksZS5yZWFkRmxvYXRMRT1yLmJpbmQobnVsbCxyZWFkVWludExFKSxlLnJlYWRGbG9hdEJFPXIuYmluZChudWxsLHJlYWRVaW50QkUpfSgpLCJ1bmRlZmluZWQiIT10eXBlb2YgRmxvYXQ2NEFycmF5P2Z1bmN0aW9uKCl7dmFyIHQ9bmV3IEZsb2F0NjRBcnJheShbLTBdKSxyPW5ldyBVaW50OEFycmF5KHQuYnVmZmVyKSxvPTEyOD09PXJbN107ZnVuY3Rpb24gbihlLG8sbil7dFswXT1lLG9bbl09clswXSxvW24rMV09clsxXSxvW24rMl09clsyXSxvW24rM109clszXSxvW24rNF09cls0XSxvW24rNV09cls1XSxvW24rNl09cls2XSxvW24rN109cls3XX1mdW5jdGlvbiBpKGUsbyxuKXt0WzBdPWUsb1tuXT1yWzddLG9bbisxXT1yWzZdLG9bbisyXT1yWzVdLG9bbiszXT1yWzRdLG9bbis0XT1yWzNdLG9bbis1XT1yWzJdLG9bbis2XT1yWzFdLG9bbis3XT1yWzBdfWZ1bmN0aW9uIGwoZSxvKXtyZXR1cm4gclswXT1lW29dLHJbMV09ZVtvKzFdLHJbMl09ZVtvKzJdLHJbM109ZVtvKzNdLHJbNF09ZVtvKzRdLHJbNV09ZVtvKzVdLHJbNl09ZVtvKzZdLHJbN109ZVtvKzddLHRbMF19ZnVuY3Rpb24gcyhlLG8pe3JldHVybiByWzddPWVbb10scls2XT1lW28rMV0scls1XT1lW28rMl0scls0XT1lW28rM10sclszXT1lW28rNF0sclsyXT1lW28rNV0sclsxXT1lW28rNl0sclswXT1lW28rN10sdFswXX1lLndyaXRlRG91YmxlTEU9bz9uOmksZS53cml0ZURvdWJsZUJFPW8/aTpuLGUucmVhZERvdWJsZUxFPW8/bDpzLGUucmVhZERvdWJsZUJFPW8/czpsfSgpOmZ1bmN0aW9uKCl7ZnVuY3Rpb24gdChlLHQscixvLG4saSl7dmFyIGw9bzwwPzE6MDtpZihsJiYobz0tbyksMD09PW8pZSgwLG4saSt0KSxlKDEvbz4wPzA6MjE0NzQ4MzY0OCxuLGkrcik7ZWxzZSBpZihpc05hTihvKSllKDAsbixpK3QpLGUoMjE0Njk1OTM2MCxuLGkrcik7ZWxzZSBpZihvPjE3OTc2OTMxMzQ4NjIzMTU3ZTI5MillKDAsbixpK3QpLGUoKGw8PDMxfDIxNDY0MzUwNzIpPj4+MCxuLGkrcik7ZWxzZXt2YXIgcztpZihvPDIyMjUwNzM4NTg1MDcyMDE0ZS0zMjQpZSgocz1vLzVlLTMyNCk+Pj4wLG4saSt0KSxlKChsPDwzMXxzLzQyOTQ5NjcyOTYpPj4+MCxuLGkrcik7ZWxzZXt2YXIgYT1NYXRoLmZsb29yKE1hdGgubG9nKG8pL01hdGguTE4yKTsxMDI0PT09YSYmKGE9MTAyMyksZSg0NTAzNTk5NjI3MzcwNDk2KihzPW8qTWF0aC5wb3coMiwtYSkpPj4+MCxuLGkrdCksZSgobDw8MzF8YSsxMDIzPDwyMHwxMDQ4NTc2KnMmMTA0ODU3NSk+Pj4wLG4saStyKX19fWZ1bmN0aW9uIHIoZSx0LHIsbyxuKXt2YXIgaT1lKG8sbit0KSxsPWUobyxuK3IpLHM9MioobD4+MzEpKzEsYT1sPj4+MjAmMjA0Nyx1PTQyOTQ5NjcyOTYqKDEwNDg1NzUmbCkraTtyZXR1cm4gMjA0Nz09PWE/dT9OYU46cyooMS8wKTowPT09YT81ZS0zMjQqcyp1OnMqTWF0aC5wb3coMixhLTEwNzUpKih1KzQ1MDM1OTk2MjczNzA0OTYpfWUud3JpdGVEb3VibGVMRT10LmJpbmQobnVsbCx3cml0ZVVpbnRMRSwwLDQpLGUud3JpdGVEb3VibGVCRT10LmJpbmQobnVsbCx3cml0ZVVpbnRCRSw0LDApLGUucmVhZERvdWJsZUxFPXIuYmluZChudWxsLHJlYWRVaW50TEUsMCw0KSxlLnJlYWREb3VibGVCRT1yLmJpbmQobnVsbCxyZWFkVWludEJFLDQsMCl9KCksZX1mdW5jdGlvbiB3cml0ZVVpbnRMRShlLHQscil7dFtyXT0yNTUmZSx0W3IrMV09ZT4+PjgmMjU1LHRbcisyXT1lPj4+MTYmMjU1LHRbciszXT1lPj4+MjR9ZnVuY3Rpb24gd3JpdGVVaW50QkUoZSx0LHIpe3Rbcl09ZT4+PjI0LHRbcisxXT1lPj4+MTYmMjU1LHRbcisyXT1lPj4+OCYyNTUsdFtyKzNdPTI1NSZlfWZ1bmN0aW9uIHJlYWRVaW50TEUoZSx0KXtyZXR1cm4oZVt0XXxlW3QrMV08PDh8ZVt0KzJdPDwxNnxlW3QrM108PDI0KT4+PjB9ZnVuY3Rpb24gcmVhZFVpbnRCRShlLHQpe3JldHVybihlW3RdPDwyNHxlW3QrMV08PDE2fGVbdCsyXTw8OHxlW3QrM10pPj4+MH12YXIgaW5xdWlyZV8xPWlucXVpcmU7ZnVuY3Rpb24gaW5xdWlyZShtb2R1bGVOYW1lKXt0cnl7dmFyIG1vZD1ldmFsKCJxdWlyZSIucmVwbGFjZSgvXi8sInJlIikpKG1vZHVsZU5hbWUpO2lmKG1vZCYmKG1vZC5sZW5ndGh8fE9iamVjdC5rZXlzKG1vZCkubGVuZ3RoKSlyZXR1cm4gbW9kfWNhdGNoKGUpe31yZXR1cm4gbnVsbH12YXIgdXRmOCQyPXt9OyFmdW5jdGlvbihlKXt2YXIgdD1lO3QubGVuZ3RoPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0wLHI9MCxvPTA7bzxlLmxlbmd0aDsrK28pKHI9ZS5jaGFyQ29kZUF0KG8pKTwxMjg/dCs9MTpyPDIwNDg/dCs9Mjo1NTI5Nj09KDY0NTEyJnIpJiY1NjMyMD09KDY0NTEyJmUuY2hhckNvZGVBdChvKzEpKT8oKytvLHQrPTQpOnQrPTM7cmV0dXJuIHR9LHQucmVhZD1mdW5jdGlvbihlLHQscil7aWYoci10PDEpcmV0dXJuIiI7Zm9yKHZhciBvLG49bnVsbCxpPVtdLGw9MDt0PHI7KShvPWVbdCsrXSk8MTI4P2lbbCsrXT1vOm8+MTkxJiZvPDIyND9pW2wrK109KDMxJm8pPDw2fDYzJmVbdCsrXTpvPjIzOSYmbzwzNjU/KG89KCg3Jm8pPDwxOHwoNjMmZVt0KytdKTw8MTJ8KDYzJmVbdCsrXSk8PDZ8NjMmZVt0KytdKS02NTUzNixpW2wrK109NTUyOTYrKG8+PjEwKSxpW2wrK109NTYzMjArKDEwMjMmbykpOmlbbCsrXT0oMTUmbyk8PDEyfCg2MyZlW3QrK10pPDw2fDYzJmVbdCsrXSxsPjgxOTEmJigobnx8KG49W10pKS5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkoU3RyaW5nLGkpKSxsPTApO3JldHVybiBuPyhsJiZuLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShTdHJpbmcsaS5zbGljZSgwLGwpKSksbi5qb2luKCIiKSk6U3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShTdHJpbmcsaS5zbGljZSgwLGwpKX0sdC53cml0ZT1mdW5jdGlvbihlLHQscil7Zm9yKHZhciBvLG4saT1yLGw9MDtsPGUubGVuZ3RoOysrbCkobz1lLmNoYXJDb2RlQXQobCkpPDEyOD90W3IrK109bzpvPDIwNDg/KHRbcisrXT1vPj42fDE5Mix0W3IrK109NjMmb3wxMjgpOjU1Mjk2PT0oNjQ1MTImbykmJjU2MzIwPT0oNjQ1MTImKG49ZS5jaGFyQ29kZUF0KGwrMSkpKT8obz02NTUzNisoKDEwMjMmbyk8PDEwKSsoMTAyMyZuKSwrK2wsdFtyKytdPW8+PjE4fDI0MCx0W3IrK109bz4+MTImNjN8MTI4LHRbcisrXT1vPj42JjYzfDEyOCx0W3IrK109NjMmb3wxMjgpOih0W3IrK109bz4+MTJ8MjI0LHRbcisrXT1vPj42JjYzfDEyOCx0W3IrK109NjMmb3wxMjgpO3JldHVybiByLWl9fSh1dGY4JDIpO3ZhciBwb29sXzE9cG9vbDtmdW5jdGlvbiBwb29sKGUsdCxyKXt2YXIgbz1yfHw4MTkyLG49bz4+PjEsaT1udWxsLGw9bztyZXR1cm4gZnVuY3Rpb24ocil7aWYocjwxfHxyPm4pcmV0dXJuIGUocik7bCtyPm8mJihpPWUobyksbD0wKTt2YXIgcz10LmNhbGwoaSxsLGwrPXIpO3JldHVybiA3JmwmJihsPTErKDd8bCkpLHN9fXZhciBsb25nYml0cz1Mb25nQml0cyQyLHV0aWwkNT1taW5pbWFsJDE7ZnVuY3Rpb24gTG9uZ0JpdHMkMihlLHQpe3RoaXMubG89ZT4+PjAsdGhpcy5oaT10Pj4+MH12YXIgemVybz1Mb25nQml0cyQyLnplcm89bmV3IExvbmdCaXRzJDIoMCwwKTt6ZXJvLnRvTnVtYmVyPWZ1bmN0aW9uKCl7cmV0dXJuIDB9LHplcm8uenpFbmNvZGU9emVyby56ekRlY29kZT1mdW5jdGlvbigpe3JldHVybiB0aGlzfSx6ZXJvLmxlbmd0aD1mdW5jdGlvbigpe3JldHVybiAxfTt2YXIgemVyb0hhc2g9TG9uZ0JpdHMkMi56ZXJvSGFzaD0iXDBcMFwwXDBcMFwwXDBcMCI7TG9uZ0JpdHMkMi5mcm9tTnVtYmVyPWZ1bmN0aW9uKGUpe2lmKDA9PT1lKXJldHVybiB6ZXJvO3ZhciB0PWU8MDt0JiYoZT0tZSk7dmFyIHI9ZT4+PjAsbz0oZS1yKS80Mjk0OTY3Mjk2Pj4+MDtyZXR1cm4gdCYmKG89fm8+Pj4wLHI9fnI+Pj4wLCsrcj40Mjk0OTY3Mjk1JiYocj0wLCsrbz40Mjk0OTY3Mjk1JiYobz0wKSkpLG5ldyBMb25nQml0cyQyKHIsbyl9LExvbmdCaXRzJDIuZnJvbT1mdW5jdGlvbihlKXtpZigibnVtYmVyIj09dHlwZW9mIGUpcmV0dXJuIExvbmdCaXRzJDIuZnJvbU51bWJlcihlKTtpZih1dGlsJDUuaXNTdHJpbmcoZSkpe2lmKCF1dGlsJDUuTG9uZylyZXR1cm4gTG9uZ0JpdHMkMi5mcm9tTnVtYmVyKHBhcnNlSW50KGUsMTApKTtlPXV0aWwkNS5Mb25nLmZyb21TdHJpbmcoZSl9cmV0dXJuIGUubG93fHxlLmhpZ2g/bmV3IExvbmdCaXRzJDIoZS5sb3c+Pj4wLGUuaGlnaD4+PjApOnplcm99LExvbmdCaXRzJDIucHJvdG90eXBlLnRvTnVtYmVyPWZ1bmN0aW9uKGUpe2lmKCFlJiZ0aGlzLmhpPj4+MzEpe3ZhciB0PTErfnRoaXMubG8+Pj4wLHI9fnRoaXMuaGk+Pj4wO3JldHVybiB0fHwocj1yKzE+Pj4wKSwtKHQrNDI5NDk2NzI5NipyKX1yZXR1cm4gdGhpcy5sbys0Mjk0OTY3Mjk2KnRoaXMuaGl9LExvbmdCaXRzJDIucHJvdG90eXBlLnRvTG9uZz1mdW5jdGlvbihlKXtyZXR1cm4gdXRpbCQ1Lkxvbmc/bmV3IHV0aWwkNS5Mb25nKDB8dGhpcy5sbywwfHRoaXMuaGksQm9vbGVhbihlKSk6e2xvdzowfHRoaXMubG8saGlnaDowfHRoaXMuaGksdW5zaWduZWQ6Qm9vbGVhbihlKX19O3ZhciBjaGFyQ29kZUF0PVN0cmluZy5wcm90b3R5cGUuY2hhckNvZGVBdDtMb25nQml0cyQyLmZyb21IYXNoPWZ1bmN0aW9uKGUpe3JldHVybiBlPT09emVyb0hhc2g/emVybzpuZXcgTG9uZ0JpdHMkMigoY2hhckNvZGVBdC5jYWxsKGUsMCl8Y2hhckNvZGVBdC5jYWxsKGUsMSk8PDh8Y2hhckNvZGVBdC5jYWxsKGUsMik8PDE2fGNoYXJDb2RlQXQuY2FsbChlLDMpPDwyNCk+Pj4wLChjaGFyQ29kZUF0LmNhbGwoZSw0KXxjaGFyQ29kZUF0LmNhbGwoZSw1KTw8OHxjaGFyQ29kZUF0LmNhbGwoZSw2KTw8MTZ8Y2hhckNvZGVBdC5jYWxsKGUsNyk8PDI0KT4+PjApfSxMb25nQml0cyQyLnByb3RvdHlwZS50b0hhc2g9ZnVuY3Rpb24oKXtyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSgyNTUmdGhpcy5sbyx0aGlzLmxvPj4+OCYyNTUsdGhpcy5sbz4+PjE2JjI1NSx0aGlzLmxvPj4+MjQsMjU1JnRoaXMuaGksdGhpcy5oaT4+PjgmMjU1LHRoaXMuaGk+Pj4xNiYyNTUsdGhpcy5oaT4+PjI0KX0sTG9uZ0JpdHMkMi5wcm90b3R5cGUuenpFbmNvZGU9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmhpPj4zMTtyZXR1cm4gdGhpcy5oaT0oKHRoaXMuaGk8PDF8dGhpcy5sbz4+PjMxKV5lKT4+PjAsdGhpcy5sbz0odGhpcy5sbzw8MV5lKT4+PjAsdGhpc30sTG9uZ0JpdHMkMi5wcm90b3R5cGUuenpEZWNvZGU9ZnVuY3Rpb24oKXt2YXIgZT0tKDEmdGhpcy5sbyk7cmV0dXJuIHRoaXMubG89KCh0aGlzLmxvPj4+MXx0aGlzLmhpPDwzMSleZSk+Pj4wLHRoaXMuaGk9KHRoaXMuaGk+Pj4xXmUpPj4+MCx0aGlzfSxMb25nQml0cyQyLnByb3RvdHlwZS5sZW5ndGg9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmxvLHQ9KHRoaXMubG8+Pj4yOHx0aGlzLmhpPDw0KT4+PjAscj10aGlzLmhpPj4+MjQ7cmV0dXJuIDA9PT1yPzA9PT10P2U8MTYzODQ/ZTwxMjg/MToyOmU8MjA5NzE1Mj8zOjQ6dDwxNjM4ND90PDEyOD81OjY6dDwyMDk3MTUyPzc6ODpyPDEyOD85OjEwfSxmdW5jdGlvbihlKXt2YXIgdD1lO2Z1bmN0aW9uIHIoZSx0LHIpe2Zvcih2YXIgbz1PYmplY3Qua2V5cyh0KSxuPTA7bjxvLmxlbmd0aDsrK24pdm9pZCAwIT09ZVtvW25dXSYmcnx8KGVbb1tuXV09dFtvW25dXSk7cmV0dXJuIGV9ZnVuY3Rpb24gbyhlKXtmdW5jdGlvbiB0KGUsbyl7aWYoISh0aGlzIGluc3RhbmNlb2YgdCkpcmV0dXJuIG5ldyB0KGUsbyk7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIm1lc3NhZ2UiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gZX19KSxFcnJvci5jYXB0dXJlU3RhY2tUcmFjZT9FcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLHQpOk9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCJzdGFjayIse3ZhbHVlOihuZXcgRXJyb3IpLnN0YWNrfHwiIn0pLG8mJnIodGhpcyxvKX1yZXR1cm4gdC5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShFcnJvci5wcm90b3R5cGUse2NvbnN0cnVjdG9yOnt2YWx1ZTp0LHdyaXRhYmxlOiEwLGVudW1lcmFibGU6ITEsY29uZmlndXJhYmxlOiEwfSxuYW1lOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gZX0sc2V0OnZvaWQgMCxlbnVtZXJhYmxlOiExLGNvbmZpZ3VyYWJsZTohMH0sdG9TdHJpbmc6e3ZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubmFtZSsiOiAiK3RoaXMubWVzc2FnZX0sd3JpdGFibGU6ITAsZW51bWVyYWJsZTohMSxjb25maWd1cmFibGU6ITB9fSksdH10LmFzUHJvbWlzZT1hc3Byb21pc2UsdC5iYXNlNjQ9YmFzZTY0JDEsdC5FdmVudEVtaXR0ZXI9ZXZlbnRlbWl0dGVyLHQuZmxvYXQ9ZmxvYXQsdC5pbnF1aXJlPWlucXVpcmVfMSx0LnV0Zjg9dXRmOCQyLHQucG9vbD1wb29sXzEsdC5Mb25nQml0cz1sb25nYml0cyx0LmlzTm9kZT1Cb29sZWFuKHZvaWQgMCE9PWNvbW1vbmpzR2xvYmFsJiZjb21tb25qc0dsb2JhbCYmY29tbW9uanNHbG9iYWwucHJvY2VzcyYmY29tbW9uanNHbG9iYWwucHJvY2Vzcy52ZXJzaW9ucyYmY29tbW9uanNHbG9iYWwucHJvY2Vzcy52ZXJzaW9ucy5ub2RlKSx0Lmdsb2JhbD10LmlzTm9kZSYmY29tbW9uanNHbG9iYWx8fCJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93JiZ3aW5kb3d8fCJ1bmRlZmluZWQiIT10eXBlb2Ygc2VsZiYmc2VsZnx8Y29tbW9uanNHbG9iYWwsdC5lbXB0eUFycmF5PU9iamVjdC5mcmVlemU/T2JqZWN0LmZyZWV6ZShbXSk6W10sdC5lbXB0eU9iamVjdD1PYmplY3QuZnJlZXplP09iamVjdC5mcmVlemUoe30pOnt9LHQuaXNJbnRlZ2VyPU51bWJlci5pc0ludGVnZXJ8fGZ1bmN0aW9uKGUpe3JldHVybiJudW1iZXIiPT10eXBlb2YgZSYmaXNGaW5pdGUoZSkmJk1hdGguZmxvb3IoZSk9PT1lfSx0LmlzU3RyaW5nPWZ1bmN0aW9uKGUpe3JldHVybiJzdHJpbmciPT10eXBlb2YgZXx8ZSBpbnN0YW5jZW9mIFN0cmluZ30sdC5pc09iamVjdD1mdW5jdGlvbihlKXtyZXR1cm4gZSYmIm9iamVjdCI9PXR5cGVvZiBlfSx0Lmlzc2V0PXQuaXNTZXQ9ZnVuY3Rpb24oZSx0KXt2YXIgcj1lW3RdO3JldHVybiEobnVsbD09cnx8IWUuaGFzT3duUHJvcGVydHkodCkpJiYoIm9iamVjdCIhPXR5cGVvZiByfHwoQXJyYXkuaXNBcnJheShyKT9yLmxlbmd0aDpPYmplY3Qua2V5cyhyKS5sZW5ndGgpPjApfSx0LkJ1ZmZlcj1mdW5jdGlvbigpe3RyeXt2YXIgZT10LmlucXVpcmUoImJ1ZmZlciIpLkJ1ZmZlcjtyZXR1cm4gZS5wcm90b3R5cGUudXRmOFdyaXRlP2U6bnVsbH1jYXRjaChlKXtyZXR1cm4gbnVsbH19KCksdC5fQnVmZmVyX2Zyb209bnVsbCx0Ll9CdWZmZXJfYWxsb2NVbnNhZmU9bnVsbCx0Lm5ld0J1ZmZlcj1mdW5jdGlvbihlKXtyZXR1cm4ibnVtYmVyIj09dHlwZW9mIGU/dC5CdWZmZXI/dC5fQnVmZmVyX2FsbG9jVW5zYWZlKGUpOm5ldyB0LkFycmF5KGUpOnQuQnVmZmVyP3QuX0J1ZmZlcl9mcm9tKGUpOiJ1bmRlZmluZWQiPT10eXBlb2YgVWludDhBcnJheT9lOm5ldyBVaW50OEFycmF5KGUpfSx0LkFycmF5PSJ1bmRlZmluZWQiIT10eXBlb2YgVWludDhBcnJheT9VaW50OEFycmF5OkFycmF5LHQuTG9uZz10Lmdsb2JhbC5kY29kZUlPJiZ0Lmdsb2JhbC5kY29kZUlPLkxvbmd8fHQuZ2xvYmFsLkxvbmd8fHQuaW5xdWlyZSgibG9uZyIpLHQua2V5MlJlPS9edHJ1ZXxmYWxzZXwwfDEkLyx0LmtleTMyUmU9L14tPyg/OjB8WzEtOV1bMC05XSopJC8sdC5rZXk2NFJlPS9eKD86W1xceDAwLVxceGZmXXs4fXwtPyg/OjB8WzEtOV1bMC05XSopKSQvLHQubG9uZ1RvSGFzaD1mdW5jdGlvbihlKXtyZXR1cm4gZT90LkxvbmdCaXRzLmZyb20oZSkudG9IYXNoKCk6dC5Mb25nQml0cy56ZXJvSGFzaH0sdC5sb25nRnJvbUhhc2g9ZnVuY3Rpb24oZSxyKXt2YXIgbz10LkxvbmdCaXRzLmZyb21IYXNoKGUpO3JldHVybiB0Lkxvbmc/dC5Mb25nLmZyb21CaXRzKG8ubG8sby5oaSxyKTpvLnRvTnVtYmVyKEJvb2xlYW4ocikpfSx0Lm1lcmdlPXIsdC5sY0ZpcnN0PWZ1bmN0aW9uKGUpe3JldHVybiBlLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpK2Uuc3Vic3RyaW5nKDEpfSx0Lm5ld0Vycm9yPW8sdC5Qcm90b2NvbEVycm9yPW8oIlByb3RvY29sRXJyb3IiKSx0Lm9uZU9mR2V0dGVyPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD17fSxyPTA7cjxlLmxlbmd0aDsrK3IpdFtlW3JdXT0xO3JldHVybiBmdW5jdGlvbigpe2Zvcih2YXIgZT1PYmplY3Qua2V5cyh0aGlzKSxyPWUubGVuZ3RoLTE7cj4tMTstLXIpaWYoMT09PXRbZVtyXV0mJnZvaWQgMCE9PXRoaXNbZVtyXV0mJm51bGwhPT10aGlzW2Vbcl1dKXJldHVybiBlW3JdfX0sdC5vbmVPZlNldHRlcj1mdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCl7Zm9yKHZhciByPTA7cjxlLmxlbmd0aDsrK3IpZVtyXSE9PXQmJmRlbGV0ZSB0aGlzW2Vbcl1dfX0sdC50b0pTT05PcHRpb25zPXtsb25nczpTdHJpbmcsZW51bXM6U3RyaW5nLGJ5dGVzOlN0cmluZyxqc29uOiEwfSx0Ll9jb25maWd1cmU9ZnVuY3Rpb24oKXt2YXIgZT10LkJ1ZmZlcjtlPyh0Ll9CdWZmZXJfZnJvbT1lLmZyb20hPT1VaW50OEFycmF5LmZyb20mJmUuZnJvbXx8ZnVuY3Rpb24odCxyKXtyZXR1cm4gbmV3IGUodCxyKX0sdC5fQnVmZmVyX2FsbG9jVW5zYWZlPWUuYWxsb2NVbnNhZmV8fGZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KX0pOnQuX0J1ZmZlcl9mcm9tPXQuX0J1ZmZlcl9hbGxvY1Vuc2FmZT1udWxsfX0obWluaW1hbCQxKTt2YXIgd3JpdGVyPVdyaXRlciQxLHV0aWwkND1taW5pbWFsJDEsQnVmZmVyV3JpdGVyJDEsTG9uZ0JpdHMkMT11dGlsJDQuTG9uZ0JpdHMsYmFzZTY0PXV0aWwkNC5iYXNlNjQsdXRmOCQxPXV0aWwkNC51dGY4O2Z1bmN0aW9uIE9wKGUsdCxyKXt0aGlzLmZuPWUsdGhpcy5sZW49dCx0aGlzLm5leHQ9dm9pZCAwLHRoaXMudmFsPXJ9ZnVuY3Rpb24gbm9vcCgpe31mdW5jdGlvbiBTdGF0ZShlKXt0aGlzLmhlYWQ9ZS5oZWFkLHRoaXMudGFpbD1lLnRhaWwsdGhpcy5sZW49ZS5sZW4sdGhpcy5uZXh0PWUuc3RhdGVzfWZ1bmN0aW9uIFdyaXRlciQxKCl7dGhpcy5sZW49MCx0aGlzLmhlYWQ9bmV3IE9wKG5vb3AsMCwwKSx0aGlzLnRhaWw9dGhpcy5oZWFkLHRoaXMuc3RhdGVzPW51bGx9dmFyIGNyZWF0ZSQxPWZ1bmN0aW9uKCl7cmV0dXJuIHV0aWwkNC5CdWZmZXI/ZnVuY3Rpb24oKXtyZXR1cm4oV3JpdGVyJDEuY3JlYXRlPWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBCdWZmZXJXcml0ZXIkMX0pKCl9OmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBXcml0ZXIkMX19O2Z1bmN0aW9uIHdyaXRlQnl0ZShlLHQscil7dFtyXT0yNTUmZX1mdW5jdGlvbiB3cml0ZVZhcmludDMyKGUsdCxyKXtmb3IoO2U+MTI3Oyl0W3IrK109MTI3JmV8MTI4LGU+Pj49Nzt0W3JdPWV9ZnVuY3Rpb24gVmFyaW50T3AoZSx0KXt0aGlzLmxlbj1lLHRoaXMubmV4dD12b2lkIDAsdGhpcy52YWw9dH1mdW5jdGlvbiB3cml0ZVZhcmludDY0KGUsdCxyKXtmb3IoO2UuaGk7KXRbcisrXT0xMjcmZS5sb3wxMjgsZS5sbz0oZS5sbz4+Pjd8ZS5oaTw8MjUpPj4+MCxlLmhpPj4+PTc7Zm9yKDtlLmxvPjEyNzspdFtyKytdPTEyNyZlLmxvfDEyOCxlLmxvPWUubG8+Pj43O3RbcisrXT1lLmxvfWZ1bmN0aW9uIHdyaXRlRml4ZWQzMihlLHQscil7dFtyXT0yNTUmZSx0W3IrMV09ZT4+PjgmMjU1LHRbcisyXT1lPj4+MTYmMjU1LHRbciszXT1lPj4+MjR9V3JpdGVyJDEuY3JlYXRlPWNyZWF0ZSQxKCksV3JpdGVyJDEuYWxsb2M9ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyB1dGlsJDQuQXJyYXkoZSl9LHV0aWwkNC5BcnJheSE9PUFycmF5JiYoV3JpdGVyJDEuYWxsb2M9dXRpbCQ0LnBvb2woV3JpdGVyJDEuYWxsb2MsdXRpbCQ0LkFycmF5LnByb3RvdHlwZS5zdWJhcnJheSkpLFdyaXRlciQxLnByb3RvdHlwZS5fcHVzaD1mdW5jdGlvbihlLHQscil7cmV0dXJuIHRoaXMudGFpbD10aGlzLnRhaWwubmV4dD1uZXcgT3AoZSx0LHIpLHRoaXMubGVuKz10LHRoaXN9LFZhcmludE9wLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKE9wLnByb3RvdHlwZSksVmFyaW50T3AucHJvdG90eXBlLmZuPXdyaXRlVmFyaW50MzIsV3JpdGVyJDEucHJvdG90eXBlLnVpbnQzMj1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5sZW4rPSh0aGlzLnRhaWw9dGhpcy50YWlsLm5leHQ9bmV3IFZhcmludE9wKChlPj4+PTApPDEyOD8xOmU8MTYzODQ/MjplPDIwOTcxNTI/MzplPDI2ODQzNTQ1Nj80OjUsZSkpLmxlbix0aGlzfSxXcml0ZXIkMS5wcm90b3R5cGUuaW50MzI9ZnVuY3Rpb24oZSl7cmV0dXJuIGU8MD90aGlzLl9wdXNoKHdyaXRlVmFyaW50NjQsMTAsTG9uZ0JpdHMkMS5mcm9tTnVtYmVyKGUpKTp0aGlzLnVpbnQzMihlKX0sV3JpdGVyJDEucHJvdG90eXBlLnNpbnQzMj1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy51aW50MzIoKGU8PDFeZT4+MzEpPj4+MCl9LFdyaXRlciQxLnByb3RvdHlwZS51aW50NjQ9ZnVuY3Rpb24oZSl7dmFyIHQ9TG9uZ0JpdHMkMS5mcm9tKGUpO3JldHVybiB0aGlzLl9wdXNoKHdyaXRlVmFyaW50NjQsdC5sZW5ndGgoKSx0KX0sV3JpdGVyJDEucHJvdG90eXBlLmludDY0PVdyaXRlciQxLnByb3RvdHlwZS51aW50NjQsV3JpdGVyJDEucHJvdG90eXBlLnNpbnQ2ND1mdW5jdGlvbihlKXt2YXIgdD1Mb25nQml0cyQxLmZyb20oZSkuenpFbmNvZGUoKTtyZXR1cm4gdGhpcy5fcHVzaCh3cml0ZVZhcmludDY0LHQubGVuZ3RoKCksdCl9LFdyaXRlciQxLnByb3RvdHlwZS5ib29sPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLl9wdXNoKHdyaXRlQnl0ZSwxLGU/MTowKX0sV3JpdGVyJDEucHJvdG90eXBlLmZpeGVkMzI9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuX3B1c2god3JpdGVGaXhlZDMyLDQsZT4+PjApfSxXcml0ZXIkMS5wcm90b3R5cGUuc2ZpeGVkMzI9V3JpdGVyJDEucHJvdG90eXBlLmZpeGVkMzIsV3JpdGVyJDEucHJvdG90eXBlLmZpeGVkNjQ9ZnVuY3Rpb24oZSl7dmFyIHQ9TG9uZ0JpdHMkMS5mcm9tKGUpO3JldHVybiB0aGlzLl9wdXNoKHdyaXRlRml4ZWQzMiw0LHQubG8pLl9wdXNoKHdyaXRlRml4ZWQzMiw0LHQuaGkpfSxXcml0ZXIkMS5wcm90b3R5cGUuc2ZpeGVkNjQ9V3JpdGVyJDEucHJvdG90eXBlLmZpeGVkNjQsV3JpdGVyJDEucHJvdG90eXBlLmZsb2F0PWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLl9wdXNoKHV0aWwkNC5mbG9hdC53cml0ZUZsb2F0TEUsNCxlKX0sV3JpdGVyJDEucHJvdG90eXBlLmRvdWJsZT1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5fcHVzaCh1dGlsJDQuZmxvYXQud3JpdGVEb3VibGVMRSw4LGUpfTt2YXIgd3JpdGVCeXRlcz11dGlsJDQuQXJyYXkucHJvdG90eXBlLnNldD9mdW5jdGlvbihlLHQscil7dC5zZXQoZSxyKX06ZnVuY3Rpb24oZSx0LHIpe2Zvcih2YXIgbz0wO288ZS5sZW5ndGg7KytvKXRbcitvXT1lW29dfTtXcml0ZXIkMS5wcm90b3R5cGUuYnl0ZXM9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5sZW5ndGg+Pj4wO2lmKCF0KXJldHVybiB0aGlzLl9wdXNoKHdyaXRlQnl0ZSwxLDApO2lmKHV0aWwkNC5pc1N0cmluZyhlKSl7dmFyIHI9V3JpdGVyJDEuYWxsb2ModD1iYXNlNjQubGVuZ3RoKGUpKTtiYXNlNjQuZGVjb2RlKGUsciwwKSxlPXJ9cmV0dXJuIHRoaXMudWludDMyKHQpLl9wdXNoKHdyaXRlQnl0ZXMsdCxlKX0sV3JpdGVyJDEucHJvdG90eXBlLnN0cmluZz1mdW5jdGlvbihlKXt2YXIgdD11dGY4JDEubGVuZ3RoKGUpO3JldHVybiB0P3RoaXMudWludDMyKHQpLl9wdXNoKHV0ZjgkMS53cml0ZSx0LGUpOnRoaXMuX3B1c2god3JpdGVCeXRlLDEsMCl9LFdyaXRlciQxLnByb3RvdHlwZS5mb3JrPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc3RhdGVzPW5ldyBTdGF0ZSh0aGlzKSx0aGlzLmhlYWQ9dGhpcy50YWlsPW5ldyBPcChub29wLDAsMCksdGhpcy5sZW49MCx0aGlzfSxXcml0ZXIkMS5wcm90b3R5cGUucmVzZXQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zdGF0ZXM/KHRoaXMuaGVhZD10aGlzLnN0YXRlcy5oZWFkLHRoaXMudGFpbD10aGlzLnN0YXRlcy50YWlsLHRoaXMubGVuPXRoaXMuc3RhdGVzLmxlbix0aGlzLnN0YXRlcz10aGlzLnN0YXRlcy5uZXh0KToodGhpcy5oZWFkPXRoaXMudGFpbD1uZXcgT3Aobm9vcCwwLDApLHRoaXMubGVuPTApLHRoaXN9LFdyaXRlciQxLnByb3RvdHlwZS5sZGVsaW09ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmhlYWQsdD10aGlzLnRhaWwscj10aGlzLmxlbjtyZXR1cm4gdGhpcy5yZXNldCgpLnVpbnQzMihyKSxyJiYodGhpcy50YWlsLm5leHQ9ZS5uZXh0LHRoaXMudGFpbD10LHRoaXMubGVuKz1yKSx0aGlzfSxXcml0ZXIkMS5wcm90b3R5cGUuZmluaXNoPWZ1bmN0aW9uKCl7Zm9yKHZhciBlPXRoaXMuaGVhZC5uZXh0LHQ9dGhpcy5jb25zdHJ1Y3Rvci5hbGxvYyh0aGlzLmxlbikscj0wO2U7KWUuZm4oZS52YWwsdCxyKSxyKz1lLmxlbixlPWUubmV4dDtyZXR1cm4gdH0sV3JpdGVyJDEuX2NvbmZpZ3VyZT1mdW5jdGlvbihlKXtCdWZmZXJXcml0ZXIkMT1lLFdyaXRlciQxLmNyZWF0ZT1jcmVhdGUkMSgpLEJ1ZmZlcldyaXRlciQxLl9jb25maWd1cmUoKX07dmFyIHdyaXRlcl9idWZmZXI9QnVmZmVyV3JpdGVyLFdyaXRlcj13cml0ZXI7KEJ1ZmZlcldyaXRlci5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShXcml0ZXIucHJvdG90eXBlKSkuY29uc3RydWN0b3I9QnVmZmVyV3JpdGVyO3ZhciB1dGlsJDM9bWluaW1hbCQxO2Z1bmN0aW9uIEJ1ZmZlcldyaXRlcigpe1dyaXRlci5jYWxsKHRoaXMpfWZ1bmN0aW9uIHdyaXRlU3RyaW5nQnVmZmVyKGUsdCxyKXtlLmxlbmd0aDw0MD91dGlsJDMudXRmOC53cml0ZShlLHQscik6dC51dGY4V3JpdGU/dC51dGY4V3JpdGUoZSxyKTp0LndyaXRlKGUscil9QnVmZmVyV3JpdGVyLl9jb25maWd1cmU9ZnVuY3Rpb24oKXtCdWZmZXJXcml0ZXIuYWxsb2M9dXRpbCQzLl9CdWZmZXJfYWxsb2NVbnNhZmUsQnVmZmVyV3JpdGVyLndyaXRlQnl0ZXNCdWZmZXI9dXRpbCQzLkJ1ZmZlciYmdXRpbCQzLkJ1ZmZlci5wcm90b3R5cGUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiYic2V0Ij09PXV0aWwkMy5CdWZmZXIucHJvdG90eXBlLnNldC5uYW1lP2Z1bmN0aW9uKGUsdCxyKXt0LnNldChlLHIpfTpmdW5jdGlvbihlLHQscil7aWYoZS5jb3B5KWUuY29weSh0LHIsMCxlLmxlbmd0aCk7ZWxzZSBmb3IodmFyIG89MDtvPGUubGVuZ3RoOyl0W3IrK109ZVtvKytdfX0sQnVmZmVyV3JpdGVyLnByb3RvdHlwZS5ieXRlcz1mdW5jdGlvbihlKXt1dGlsJDMuaXNTdHJpbmcoZSkmJihlPXV0aWwkMy5fQnVmZmVyX2Zyb20oZSwiYmFzZTY0IikpO3ZhciB0PWUubGVuZ3RoPj4+MDtyZXR1cm4gdGhpcy51aW50MzIodCksdCYmdGhpcy5fcHVzaChCdWZmZXJXcml0ZXIud3JpdGVCeXRlc0J1ZmZlcix0LGUpLHRoaXN9LEJ1ZmZlcldyaXRlci5wcm90b3R5cGUuc3RyaW5nPWZ1bmN0aW9uKGUpe3ZhciB0PXV0aWwkMy5CdWZmZXIuYnl0ZUxlbmd0aChlKTtyZXR1cm4gdGhpcy51aW50MzIodCksdCYmdGhpcy5fcHVzaCh3cml0ZVN0cmluZ0J1ZmZlcix0LGUpLHRoaXN9LEJ1ZmZlcldyaXRlci5fY29uZmlndXJlKCk7dmFyIHJlYWRlcj1SZWFkZXIkMSx1dGlsJDI9bWluaW1hbCQxLEJ1ZmZlclJlYWRlciQxLExvbmdCaXRzPXV0aWwkMi5Mb25nQml0cyx1dGY4PXV0aWwkMi51dGY4O2Z1bmN0aW9uIGluZGV4T3V0T2ZSYW5nZShlLHQpe3JldHVybiBSYW5nZUVycm9yKCJpbmRleCBvdXQgb2YgcmFuZ2U6ICIrZS5wb3MrIiArICIrKHR8fDEpKyIgPiAiK2UubGVuKX1mdW5jdGlvbiBSZWFkZXIkMShlKXt0aGlzLmJ1Zj1lLHRoaXMucG9zPTAsdGhpcy5sZW49ZS5sZW5ndGh9dmFyIGNyZWF0ZV9hcnJheT0idW5kZWZpbmVkIiE9dHlwZW9mIFVpbnQ4QXJyYXk/ZnVuY3Rpb24oZSl7aWYoZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXl8fEFycmF5LmlzQXJyYXkoZSkpcmV0dXJuIG5ldyBSZWFkZXIkMShlKTt0aHJvdyBFcnJvcigiaWxsZWdhbCBidWZmZXIiKX06ZnVuY3Rpb24oZSl7aWYoQXJyYXkuaXNBcnJheShlKSlyZXR1cm4gbmV3IFJlYWRlciQxKGUpO3Rocm93IEVycm9yKCJpbGxlZ2FsIGJ1ZmZlciIpfSxjcmVhdGU9ZnVuY3Rpb24oKXtyZXR1cm4gdXRpbCQyLkJ1ZmZlcj9mdW5jdGlvbihlKXtyZXR1cm4oUmVhZGVyJDEuY3JlYXRlPWZ1bmN0aW9uKGUpe3JldHVybiB1dGlsJDIuQnVmZmVyLmlzQnVmZmVyKGUpP25ldyBCdWZmZXJSZWFkZXIkMShlKTpjcmVhdGVfYXJyYXkoZSl9KShlKX06Y3JlYXRlX2FycmF5fSx2YWx1ZTtmdW5jdGlvbiByZWFkTG9uZ1ZhcmludCgpe3ZhciBlPW5ldyBMb25nQml0cygwLDApLHQ9MDtpZighKHRoaXMubGVuLXRoaXMucG9zPjQpKXtmb3IoO3Q8MzsrK3Qpe2lmKHRoaXMucG9zPj10aGlzLmxlbil0aHJvdyBpbmRleE91dE9mUmFuZ2UodGhpcyk7aWYoZS5sbz0oZS5sb3woMTI3JnRoaXMuYnVmW3RoaXMucG9zXSk8PDcqdCk+Pj4wLHRoaXMuYnVmW3RoaXMucG9zKytdPDEyOClyZXR1cm4gZX1yZXR1cm4gZS5sbz0oZS5sb3woMTI3JnRoaXMuYnVmW3RoaXMucG9zKytdKTw8Nyp0KT4+PjAsZX1mb3IoO3Q8NDsrK3QpaWYoZS5sbz0oZS5sb3woMTI3JnRoaXMuYnVmW3RoaXMucG9zXSk8PDcqdCk+Pj4wLHRoaXMuYnVmW3RoaXMucG9zKytdPDEyOClyZXR1cm4gZTtpZihlLmxvPShlLmxvfCgxMjcmdGhpcy5idWZbdGhpcy5wb3NdKTw8MjgpPj4+MCxlLmhpPShlLmhpfCgxMjcmdGhpcy5idWZbdGhpcy5wb3NdKT4+NCk+Pj4wLHRoaXMuYnVmW3RoaXMucG9zKytdPDEyOClyZXR1cm4gZTtpZih0PTAsdGhpcy5sZW4tdGhpcy5wb3M+NCl7Zm9yKDt0PDU7Kyt0KWlmKGUuaGk9KGUuaGl8KDEyNyZ0aGlzLmJ1Zlt0aGlzLnBvc10pPDw3KnQrMyk+Pj4wLHRoaXMuYnVmW3RoaXMucG9zKytdPDEyOClyZXR1cm4gZX1lbHNlIGZvcig7dDw1OysrdCl7aWYodGhpcy5wb3M+PXRoaXMubGVuKXRocm93IGluZGV4T3V0T2ZSYW5nZSh0aGlzKTtpZihlLmhpPShlLmhpfCgxMjcmdGhpcy5idWZbdGhpcy5wb3NdKTw8Nyp0KzMpPj4+MCx0aGlzLmJ1Zlt0aGlzLnBvcysrXTwxMjgpcmV0dXJuIGV9dGhyb3cgRXJyb3IoImludmFsaWQgdmFyaW50IGVuY29kaW5nIil9ZnVuY3Rpb24gcmVhZEZpeGVkMzJfZW5kKGUsdCl7cmV0dXJuKGVbdC00XXxlW3QtM108PDh8ZVt0LTJdPDwxNnxlW3QtMV08PDI0KT4+PjB9ZnVuY3Rpb24gcmVhZEZpeGVkNjQoKXtpZih0aGlzLnBvcys4PnRoaXMubGVuKXRocm93IGluZGV4T3V0T2ZSYW5nZSh0aGlzLDgpO3JldHVybiBuZXcgTG9uZ0JpdHMocmVhZEZpeGVkMzJfZW5kKHRoaXMuYnVmLHRoaXMucG9zKz00KSxyZWFkRml4ZWQzMl9lbmQodGhpcy5idWYsdGhpcy5wb3MrPTQpKX1SZWFkZXIkMS5jcmVhdGU9Y3JlYXRlKCksUmVhZGVyJDEucHJvdG90eXBlLl9zbGljZT11dGlsJDIuQXJyYXkucHJvdG90eXBlLnN1YmFycmF5fHx1dGlsJDIuQXJyYXkucHJvdG90eXBlLnNsaWNlLFJlYWRlciQxLnByb3RvdHlwZS51aW50MzI9KHZhbHVlPTQyOTQ5NjcyOTUsZnVuY3Rpb24oKXtpZih2YWx1ZT0oMTI3JnRoaXMuYnVmW3RoaXMucG9zXSk+Pj4wLHRoaXMuYnVmW3RoaXMucG9zKytdPDEyOClyZXR1cm4gdmFsdWU7aWYodmFsdWU9KHZhbHVlfCgxMjcmdGhpcy5idWZbdGhpcy5wb3NdKTw8Nyk+Pj4wLHRoaXMuYnVmW3RoaXMucG9zKytdPDEyOClyZXR1cm4gdmFsdWU7aWYodmFsdWU9KHZhbHVlfCgxMjcmdGhpcy5idWZbdGhpcy5wb3NdKTw8MTQpPj4+MCx0aGlzLmJ1Zlt0aGlzLnBvcysrXTwxMjgpcmV0dXJuIHZhbHVlO2lmKHZhbHVlPSh2YWx1ZXwoMTI3JnRoaXMuYnVmW3RoaXMucG9zXSk8PDIxKT4+PjAsdGhpcy5idWZbdGhpcy5wb3MrK108MTI4KXJldHVybiB2YWx1ZTtpZih2YWx1ZT0odmFsdWV8KDE1JnRoaXMuYnVmW3RoaXMucG9zXSk8PDI4KT4+PjAsdGhpcy5idWZbdGhpcy5wb3MrK108MTI4KXJldHVybiB2YWx1ZTtpZigodGhpcy5wb3MrPTUpPnRoaXMubGVuKXRocm93IHRoaXMucG9zPXRoaXMubGVuLGluZGV4T3V0T2ZSYW5nZSh0aGlzLDEwKTtyZXR1cm4gdmFsdWV9KSxSZWFkZXIkMS5wcm90b3R5cGUuaW50MzI9ZnVuY3Rpb24oKXtyZXR1cm4gMHx0aGlzLnVpbnQzMigpfSxSZWFkZXIkMS5wcm90b3R5cGUuc2ludDMyPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy51aW50MzIoKTtyZXR1cm4gZT4+PjFeLSgxJmUpfDB9LFJlYWRlciQxLnByb3RvdHlwZS5ib29sPWZ1bmN0aW9uKCl7cmV0dXJuIDAhPT10aGlzLnVpbnQzMigpfSxSZWFkZXIkMS5wcm90b3R5cGUuZml4ZWQzMj1mdW5jdGlvbigpe2lmKHRoaXMucG9zKzQ+dGhpcy5sZW4pdGhyb3cgaW5kZXhPdXRPZlJhbmdlKHRoaXMsNCk7cmV0dXJuIHJlYWRGaXhlZDMyX2VuZCh0aGlzLmJ1Zix0aGlzLnBvcys9NCl9LFJlYWRlciQxLnByb3RvdHlwZS5zZml4ZWQzMj1mdW5jdGlvbigpe2lmKHRoaXMucG9zKzQ+dGhpcy5sZW4pdGhyb3cgaW5kZXhPdXRPZlJhbmdlKHRoaXMsNCk7cmV0dXJuIDB8cmVhZEZpeGVkMzJfZW5kKHRoaXMuYnVmLHRoaXMucG9zKz00KX0sUmVhZGVyJDEucHJvdG90eXBlLmZsb2F0PWZ1bmN0aW9uKCl7aWYodGhpcy5wb3MrND50aGlzLmxlbil0aHJvdyBpbmRleE91dE9mUmFuZ2UodGhpcyw0KTt2YXIgZT11dGlsJDIuZmxvYXQucmVhZEZsb2F0TEUodGhpcy5idWYsdGhpcy5wb3MpO3JldHVybiB0aGlzLnBvcys9NCxlfSxSZWFkZXIkMS5wcm90b3R5cGUuZG91YmxlPWZ1bmN0aW9uKCl7aWYodGhpcy5wb3MrOD50aGlzLmxlbil0aHJvdyBpbmRleE91dE9mUmFuZ2UodGhpcyw0KTt2YXIgZT11dGlsJDIuZmxvYXQucmVhZERvdWJsZUxFKHRoaXMuYnVmLHRoaXMucG9zKTtyZXR1cm4gdGhpcy5wb3MrPTgsZX0sUmVhZGVyJDEucHJvdG90eXBlLmJ5dGVzPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy51aW50MzIoKSx0PXRoaXMucG9zLHI9dGhpcy5wb3MrZTtpZihyPnRoaXMubGVuKXRocm93IGluZGV4T3V0T2ZSYW5nZSh0aGlzLGUpO3JldHVybiB0aGlzLnBvcys9ZSxBcnJheS5pc0FycmF5KHRoaXMuYnVmKT90aGlzLmJ1Zi5zbGljZSh0LHIpOnQ9PT1yP25ldyB0aGlzLmJ1Zi5jb25zdHJ1Y3RvcigwKTp0aGlzLl9zbGljZS5jYWxsKHRoaXMuYnVmLHQscil9LFJlYWRlciQxLnByb3RvdHlwZS5zdHJpbmc9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmJ5dGVzKCk7cmV0dXJuIHV0ZjgucmVhZChlLDAsZS5sZW5ndGgpfSxSZWFkZXIkMS5wcm90b3R5cGUuc2tpcD1mdW5jdGlvbihlKXtpZigibnVtYmVyIj09dHlwZW9mIGUpe2lmKHRoaXMucG9zK2U+dGhpcy5sZW4pdGhyb3cgaW5kZXhPdXRPZlJhbmdlKHRoaXMsZSk7dGhpcy5wb3MrPWV9ZWxzZSBkb3tpZih0aGlzLnBvcz49dGhpcy5sZW4pdGhyb3cgaW5kZXhPdXRPZlJhbmdlKHRoaXMpfXdoaWxlKDEyOCZ0aGlzLmJ1Zlt0aGlzLnBvcysrXSk7cmV0dXJuIHRoaXN9LFJlYWRlciQxLnByb3RvdHlwZS5za2lwVHlwZT1mdW5jdGlvbihlKXtzd2l0Y2goZSl7Y2FzZSAwOnRoaXMuc2tpcCgpO2JyZWFrO2Nhc2UgMTp0aGlzLnNraXAoOCk7YnJlYWs7Y2FzZSAyOnRoaXMuc2tpcCh0aGlzLnVpbnQzMigpKTticmVhaztjYXNlIDM6Zm9yKDs0IT0oZT03JnRoaXMudWludDMyKCkpOyl0aGlzLnNraXBUeXBlKGUpO2JyZWFrO2Nhc2UgNTp0aGlzLnNraXAoNCk7YnJlYWs7ZGVmYXVsdDp0aHJvdyBFcnJvcigiaW52YWxpZCB3aXJlIHR5cGUgIitlKyIgYXQgb2Zmc2V0ICIrdGhpcy5wb3MpfXJldHVybiB0aGlzfSxSZWFkZXIkMS5fY29uZmlndXJlPWZ1bmN0aW9uKGUpe0J1ZmZlclJlYWRlciQxPWUsUmVhZGVyJDEuY3JlYXRlPWNyZWF0ZSgpLEJ1ZmZlclJlYWRlciQxLl9jb25maWd1cmUoKTt2YXIgdD11dGlsJDIuTG9uZz8idG9Mb25nIjoidG9OdW1iZXIiO3V0aWwkMi5tZXJnZShSZWFkZXIkMS5wcm90b3R5cGUse2ludDY0OmZ1bmN0aW9uKCl7cmV0dXJuIHJlYWRMb25nVmFyaW50LmNhbGwodGhpcylbdF0oITEpfSx1aW50NjQ6ZnVuY3Rpb24oKXtyZXR1cm4gcmVhZExvbmdWYXJpbnQuY2FsbCh0aGlzKVt0XSghMCl9LHNpbnQ2NDpmdW5jdGlvbigpe3JldHVybiByZWFkTG9uZ1ZhcmludC5jYWxsKHRoaXMpLnp6RGVjb2RlKClbdF0oITEpfSxmaXhlZDY0OmZ1bmN0aW9uKCl7cmV0dXJuIHJlYWRGaXhlZDY0LmNhbGwodGhpcylbdF0oITApfSxzZml4ZWQ2NDpmdW5jdGlvbigpe3JldHVybiByZWFkRml4ZWQ2NC5jYWxsKHRoaXMpW3RdKCExKX19KX07dmFyIHJlYWRlcl9idWZmZXI9QnVmZmVyUmVhZGVyLFJlYWRlcj1yZWFkZXI7KEJ1ZmZlclJlYWRlci5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShSZWFkZXIucHJvdG90eXBlKSkuY29uc3RydWN0b3I9QnVmZmVyUmVhZGVyO3ZhciB1dGlsJDE9bWluaW1hbCQxO2Z1bmN0aW9uIEJ1ZmZlclJlYWRlcihlKXtSZWFkZXIuY2FsbCh0aGlzLGUpfUJ1ZmZlclJlYWRlci5fY29uZmlndXJlPWZ1bmN0aW9uKCl7dXRpbCQxLkJ1ZmZlciYmKEJ1ZmZlclJlYWRlci5wcm90b3R5cGUuX3NsaWNlPXV0aWwkMS5CdWZmZXIucHJvdG90eXBlLnNsaWNlKX0sQnVmZmVyUmVhZGVyLnByb3RvdHlwZS5zdHJpbmc9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLnVpbnQzMigpO3JldHVybiB0aGlzLmJ1Zi51dGY4U2xpY2U/dGhpcy5idWYudXRmOFNsaWNlKHRoaXMucG9zLHRoaXMucG9zPU1hdGgubWluKHRoaXMucG9zK2UsdGhpcy5sZW4pKTp0aGlzLmJ1Zi50b1N0cmluZygidXRmLTgiLHRoaXMucG9zLHRoaXMucG9zPU1hdGgubWluKHRoaXMucG9zK2UsdGhpcy5sZW4pKX0sQnVmZmVyUmVhZGVyLl9jb25maWd1cmUoKTt2YXIgcnBjPXt9LHNlcnZpY2U9U2VydmljZSx1dGlsPW1pbmltYWwkMSxleHBvcnRzO2Z1bmN0aW9uIFNlcnZpY2UoZSx0LHIpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlKXRocm93IFR5cGVFcnJvcigicnBjSW1wbCBtdXN0IGJlIGEgZnVuY3Rpb24iKTt1dGlsLkV2ZW50RW1pdHRlci5jYWxsKHRoaXMpLHRoaXMucnBjSW1wbD1lLHRoaXMucmVxdWVzdERlbGltaXRlZD1Cb29sZWFuKHQpLHRoaXMucmVzcG9uc2VEZWxpbWl0ZWQ9Qm9vbGVhbihyKX0oU2VydmljZS5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZSh1dGlsLkV2ZW50RW1pdHRlci5wcm90b3R5cGUpKS5jb25zdHJ1Y3Rvcj1TZXJ2aWNlLFNlcnZpY2UucHJvdG90eXBlLnJwY0NhbGw9ZnVuY3Rpb24gZSh0LHIsbyxuLGkpe2lmKCFuKXRocm93IFR5cGVFcnJvcigicmVxdWVzdCBtdXN0IGJlIHNwZWNpZmllZCIpO3ZhciBsPXRoaXM7aWYoIWkpcmV0dXJuIHV0aWwuYXNQcm9taXNlKGUsbCx0LHIsbyxuKTtpZihsLnJwY0ltcGwpdHJ5e3JldHVybiBsLnJwY0ltcGwodCxyW2wucmVxdWVzdERlbGltaXRlZD8iZW5jb2RlRGVsaW1pdGVkIjoiZW5jb2RlIl0obikuZmluaXNoKCksKGZ1bmN0aW9uKGUscil7aWYoZSlyZXR1cm4gbC5lbWl0KCJlcnJvciIsZSx0KSxpKGUpO2lmKG51bGwhPT1yKXtpZighKHIgaW5zdGFuY2VvZiBvKSl0cnl7cj1vW2wucmVzcG9uc2VEZWxpbWl0ZWQ/ImRlY29kZURlbGltaXRlZCI6ImRlY29kZSJdKHIpfWNhdGNoKGUpe3JldHVybiBsLmVtaXQoImVycm9yIixlLHQpLGkoZSl9cmV0dXJuIGwuZW1pdCgiZGF0YSIscix0KSxpKG51bGwscil9bC5lbmQoITApfSkpfWNhdGNoKGUpe3JldHVybiBsLmVtaXQoImVycm9yIixlLHQpLHZvaWQgc2V0VGltZW91dCgoZnVuY3Rpb24oKXtpKGUpfSksMCl9ZWxzZSBzZXRUaW1lb3V0KChmdW5jdGlvbigpe2koRXJyb3IoImFscmVhZHkgZW5kZWQiKSl9KSwwKX0sU2VydmljZS5wcm90b3R5cGUuZW5kPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnJwY0ltcGwmJihlfHx0aGlzLnJwY0ltcGwobnVsbCxudWxsLG51bGwpLHRoaXMucnBjSW1wbD1udWxsLHRoaXMuZW1pdCgiZW5kIikub2ZmKCkpLHRoaXN9LGV4cG9ydHM9cnBjLGV4cG9ydHMuU2VydmljZT1zZXJ2aWNlO3ZhciByb290cz17fTshZnVuY3Rpb24oZSl7dmFyIHQ9ZTtmdW5jdGlvbiByKCl7dC51dGlsLl9jb25maWd1cmUoKSx0LldyaXRlci5fY29uZmlndXJlKHQuQnVmZmVyV3JpdGVyKSx0LlJlYWRlci5fY29uZmlndXJlKHQuQnVmZmVyUmVhZGVyKX10LmJ1aWxkPSJtaW5pbWFsIix0LldyaXRlcj13cml0ZXIsdC5CdWZmZXJXcml0ZXI9d3JpdGVyX2J1ZmZlcix0LlJlYWRlcj1yZWFkZXIsdC5CdWZmZXJSZWFkZXI9cmVhZGVyX2J1ZmZlcix0LnV0aWw9bWluaW1hbCQxLHQucnBjPXJwYyx0LnJvb3RzPXJvb3RzLHQuY29uZmlndXJlPXIscigpfShpbmRleE1pbmltYWwpO3ZhciBtaW5pbWFsPWluZGV4TWluaW1hbCwkcHJvdG9idWY9bWluaW1hbCwkUmVhZGVyPSRwcm90b2J1Zi5SZWFkZXIsJFdyaXRlcj0kcHJvdG9idWYuV3JpdGVyLCR1dGlsPSRwcm90b2J1Zi51dGlsLCRyb290PSRwcm90b2J1Zi5yb290cy5kZWZhdWx0fHwoJHByb3RvYnVmLnJvb3RzLmRlZmF1bHQ9e30pLHZhbHVlc0J5SWQsdmFsdWVzLHByb3RvYnVmLGdvb2dsZTskcm9vdC5wcm90b2NvbD1mdW5jdGlvbigpe3ZhciBlPXt9O3JldHVybiBlLkdlb21ldHJ5PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShlKXtpZih0aGlzLnBvc2l0aW9ucz1bXSx0aGlzLnV2cz1bXSx0aGlzLmluZGljZXM9W10sdGhpcy5saWdodHM9W10sZSlmb3IodmFyIHQ9T2JqZWN0LmtleXMoZSkscj0wO3I8dC5sZW5ndGg7KytyKW51bGwhPWVbdFtyXV0mJih0aGlzW3Rbcl1dPWVbdFtyXV0pfXZhciB0O3JldHVybiBlLnByb3RvdHlwZS52b3hlbD0wLGUucHJvdG90eXBlLmZhY2VOYW1lPW51bGwsZS5wcm90b3R5cGUucG9zaXRpb25zPSR1dGlsLmVtcHR5QXJyYXksZS5wcm90b3R5cGUudXZzPSR1dGlsLmVtcHR5QXJyYXksZS5wcm90b3R5cGUuaW5kaWNlcz0kdXRpbC5lbXB0eUFycmF5LGUucHJvdG90eXBlLmxpZ2h0cz0kdXRpbC5lbXB0eUFycmF5LE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLnByb3RvdHlwZSwiX2ZhY2VOYW1lIix7Z2V0OiR1dGlsLm9uZU9mR2V0dGVyKHQ9WyJmYWNlTmFtZSJdKSxzZXQ6JHV0aWwub25lT2ZTZXR0ZXIodCl9KSxlLmNyZWF0ZT1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCl9LGUuZW5jb2RlPWZ1bmN0aW9uKGUsdCl7aWYodHx8KHQ9JFdyaXRlci5jcmVhdGUoKSksbnVsbCE9ZS52b3hlbCYmT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoZSwidm94ZWwiKSYmdC51aW50MzIoOCkudWludDMyKGUudm94ZWwpLG51bGwhPWUuZmFjZU5hbWUmJk9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsImZhY2VOYW1lIikmJnQudWludDMyKDE4KS5zdHJpbmcoZS5mYWNlTmFtZSksbnVsbCE9ZS5wb3NpdGlvbnMmJmUucG9zaXRpb25zLmxlbmd0aCl7dC51aW50MzIoMjYpLmZvcmsoKTtmb3IodmFyIHI9MDtyPGUucG9zaXRpb25zLmxlbmd0aDsrK3IpdC5mbG9hdChlLnBvc2l0aW9uc1tyXSk7dC5sZGVsaW0oKX1pZihudWxsIT1lLnV2cyYmZS51dnMubGVuZ3RoKXt0LnVpbnQzMigzNCkuZm9yaygpO2ZvcihyPTA7cjxlLnV2cy5sZW5ndGg7KytyKXQuZmxvYXQoZS51dnNbcl0pO3QubGRlbGltKCl9aWYobnVsbCE9ZS5pbmRpY2VzJiZlLmluZGljZXMubGVuZ3RoKXt0LnVpbnQzMig0MikuZm9yaygpO2ZvcihyPTA7cjxlLmluZGljZXMubGVuZ3RoOysrcil0LmludDMyKGUuaW5kaWNlc1tyXSk7dC5sZGVsaW0oKX1pZihudWxsIT1lLmxpZ2h0cyYmZS5saWdodHMubGVuZ3RoKXt0LnVpbnQzMig1MCkuZm9yaygpO2ZvcihyPTA7cjxlLmxpZ2h0cy5sZW5ndGg7KytyKXQuaW50MzIoZS5saWdodHNbcl0pO3QubGRlbGltKCl9cmV0dXJuIHR9LGUuZW5jb2RlRGVsaW1pdGVkPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuZW5jb2RlKGUsdCkubGRlbGltKCl9LGUuZGVjb2RlPWZ1bmN0aW9uKGUsdCl7ZSBpbnN0YW5jZW9mICRSZWFkZXJ8fChlPSRSZWFkZXIuY3JlYXRlKGUpKTtmb3IodmFyIHI9dm9pZCAwPT09dD9lLmxlbjplLnBvcyt0LG89bmV3ICRyb290LnByb3RvY29sLkdlb21ldHJ5O2UucG9zPHI7KXt2YXIgbj1lLnVpbnQzMigpO3N3aXRjaChuPj4+Myl7Y2FzZSAxOm8udm94ZWw9ZS51aW50MzIoKTticmVhaztjYXNlIDI6by5mYWNlTmFtZT1lLnN0cmluZygpO2JyZWFrO2Nhc2UgMzppZihvLnBvc2l0aW9ucyYmby5wb3NpdGlvbnMubGVuZ3RofHwoby5wb3NpdGlvbnM9W10pLDI9PSg3Jm4pKWZvcih2YXIgaT1lLnVpbnQzMigpK2UucG9zO2UucG9zPGk7KW8ucG9zaXRpb25zLnB1c2goZS5mbG9hdCgpKTtlbHNlIG8ucG9zaXRpb25zLnB1c2goZS5mbG9hdCgpKTticmVhaztjYXNlIDQ6aWYoby51dnMmJm8udXZzLmxlbmd0aHx8KG8udXZzPVtdKSwyPT0oNyZuKSlmb3IoaT1lLnVpbnQzMigpK2UucG9zO2UucG9zPGk7KW8udXZzLnB1c2goZS5mbG9hdCgpKTtlbHNlIG8udXZzLnB1c2goZS5mbG9hdCgpKTticmVhaztjYXNlIDU6aWYoby5pbmRpY2VzJiZvLmluZGljZXMubGVuZ3RofHwoby5pbmRpY2VzPVtdKSwyPT0oNyZuKSlmb3IoaT1lLnVpbnQzMigpK2UucG9zO2UucG9zPGk7KW8uaW5kaWNlcy5wdXNoKGUuaW50MzIoKSk7ZWxzZSBvLmluZGljZXMucHVzaChlLmludDMyKCkpO2JyZWFrO2Nhc2UgNjppZihvLmxpZ2h0cyYmby5saWdodHMubGVuZ3RofHwoby5saWdodHM9W10pLDI9PSg3Jm4pKWZvcihpPWUudWludDMyKCkrZS5wb3M7ZS5wb3M8aTspby5saWdodHMucHVzaChlLmludDMyKCkpO2Vsc2Ugby5saWdodHMucHVzaChlLmludDMyKCkpO2JyZWFrO2RlZmF1bHQ6ZS5za2lwVHlwZSg3Jm4pfX1yZXR1cm4gb30sZS5kZWNvZGVEZWxpbWl0ZWQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGUgaW5zdGFuY2VvZiAkUmVhZGVyfHwoZT1uZXcgJFJlYWRlcihlKSksdGhpcy5kZWNvZGUoZSxlLnVpbnQzMigpKX0sZS52ZXJpZnk9ZnVuY3Rpb24oZSl7aWYoIm9iamVjdCIhPXR5cGVvZiBlfHxudWxsPT09ZSlyZXR1cm4ib2JqZWN0IGV4cGVjdGVkIjtpZihudWxsIT1lLnZveGVsJiZlLmhhc093blByb3BlcnR5KCJ2b3hlbCIpJiYhJHV0aWwuaXNJbnRlZ2VyKGUudm94ZWwpKXJldHVybiJ2b3hlbDogaW50ZWdlciBleHBlY3RlZCI7aWYobnVsbCE9ZS5mYWNlTmFtZSYmZS5oYXNPd25Qcm9wZXJ0eSgiZmFjZU5hbWUiKSYmISR1dGlsLmlzU3RyaW5nKGUuZmFjZU5hbWUpKXJldHVybiJmYWNlTmFtZTogc3RyaW5nIGV4cGVjdGVkIjtpZihudWxsIT1lLnBvc2l0aW9ucyYmZS5oYXNPd25Qcm9wZXJ0eSgicG9zaXRpb25zIikpe2lmKCFBcnJheS5pc0FycmF5KGUucG9zaXRpb25zKSlyZXR1cm4icG9zaXRpb25zOiBhcnJheSBleHBlY3RlZCI7Zm9yKHZhciB0PTA7dDxlLnBvc2l0aW9ucy5sZW5ndGg7Kyt0KWlmKCJudW1iZXIiIT10eXBlb2YgZS5wb3NpdGlvbnNbdF0pcmV0dXJuInBvc2l0aW9uczogbnVtYmVyW10gZXhwZWN0ZWQifWlmKG51bGwhPWUudXZzJiZlLmhhc093blByb3BlcnR5KCJ1dnMiKSl7aWYoIUFycmF5LmlzQXJyYXkoZS51dnMpKXJldHVybiJ1dnM6IGFycmF5IGV4cGVjdGVkIjtmb3IodD0wO3Q8ZS51dnMubGVuZ3RoOysrdClpZigibnVtYmVyIiE9dHlwZW9mIGUudXZzW3RdKXJldHVybiJ1dnM6IG51bWJlcltdIGV4cGVjdGVkIn1pZihudWxsIT1lLmluZGljZXMmJmUuaGFzT3duUHJvcGVydHkoImluZGljZXMiKSl7aWYoIUFycmF5LmlzQXJyYXkoZS5pbmRpY2VzKSlyZXR1cm4iaW5kaWNlczogYXJyYXkgZXhwZWN0ZWQiO2Zvcih0PTA7dDxlLmluZGljZXMubGVuZ3RoOysrdClpZighJHV0aWwuaXNJbnRlZ2VyKGUuaW5kaWNlc1t0XSkpcmV0dXJuImluZGljZXM6IGludGVnZXJbXSBleHBlY3RlZCJ9aWYobnVsbCE9ZS5saWdodHMmJmUuaGFzT3duUHJvcGVydHkoImxpZ2h0cyIpKXtpZighQXJyYXkuaXNBcnJheShlLmxpZ2h0cykpcmV0dXJuImxpZ2h0czogYXJyYXkgZXhwZWN0ZWQiO2Zvcih0PTA7dDxlLmxpZ2h0cy5sZW5ndGg7Kyt0KWlmKCEkdXRpbC5pc0ludGVnZXIoZS5saWdodHNbdF0pKXJldHVybiJsaWdodHM6IGludGVnZXJbXSBleHBlY3RlZCJ9cmV0dXJuIG51bGx9LGUuZnJvbU9iamVjdD1mdW5jdGlvbihlKXtpZihlIGluc3RhbmNlb2YgJHJvb3QucHJvdG9jb2wuR2VvbWV0cnkpcmV0dXJuIGU7dmFyIHQ9bmV3ICRyb290LnByb3RvY29sLkdlb21ldHJ5O2lmKG51bGwhPWUudm94ZWwmJih0LnZveGVsPWUudm94ZWw+Pj4wKSxudWxsIT1lLmZhY2VOYW1lJiYodC5mYWNlTmFtZT1TdHJpbmcoZS5mYWNlTmFtZSkpLGUucG9zaXRpb25zKXtpZighQXJyYXkuaXNBcnJheShlLnBvc2l0aW9ucykpdGhyb3cgVHlwZUVycm9yKCIucHJvdG9jb2wuR2VvbWV0cnkucG9zaXRpb25zOiBhcnJheSBleHBlY3RlZCIpO3QucG9zaXRpb25zPVtdO2Zvcih2YXIgcj0wO3I8ZS5wb3NpdGlvbnMubGVuZ3RoOysrcil0LnBvc2l0aW9uc1tyXT1OdW1iZXIoZS5wb3NpdGlvbnNbcl0pfWlmKGUudXZzKXtpZighQXJyYXkuaXNBcnJheShlLnV2cykpdGhyb3cgVHlwZUVycm9yKCIucHJvdG9jb2wuR2VvbWV0cnkudXZzOiBhcnJheSBleHBlY3RlZCIpO3QudXZzPVtdO2ZvcihyPTA7cjxlLnV2cy5sZW5ndGg7KytyKXQudXZzW3JdPU51bWJlcihlLnV2c1tyXSl9aWYoZS5pbmRpY2VzKXtpZighQXJyYXkuaXNBcnJheShlLmluZGljZXMpKXRocm93IFR5cGVFcnJvcigiLnByb3RvY29sLkdlb21ldHJ5LmluZGljZXM6IGFycmF5IGV4cGVjdGVkIik7dC5pbmRpY2VzPVtdO2ZvcihyPTA7cjxlLmluZGljZXMubGVuZ3RoOysrcil0LmluZGljZXNbcl09MHxlLmluZGljZXNbcl19aWYoZS5saWdodHMpe2lmKCFBcnJheS5pc0FycmF5KGUubGlnaHRzKSl0aHJvdyBUeXBlRXJyb3IoIi5wcm90b2NvbC5HZW9tZXRyeS5saWdodHM6IGFycmF5IGV4cGVjdGVkIik7dC5saWdodHM9W107Zm9yKHI9MDtyPGUubGlnaHRzLmxlbmd0aDsrK3IpdC5saWdodHNbcl09MHxlLmxpZ2h0c1tyXX1yZXR1cm4gdH0sZS50b09iamVjdD1mdW5jdGlvbihlLHQpe3R8fCh0PXt9KTt2YXIgcj17fTtpZigodC5hcnJheXN8fHQuZGVmYXVsdHMpJiYoci5wb3NpdGlvbnM9W10sci51dnM9W10sci5pbmRpY2VzPVtdLHIubGlnaHRzPVtdKSx0LmRlZmF1bHRzJiYoci52b3hlbD0wKSxudWxsIT1lLnZveGVsJiZlLmhhc093blByb3BlcnR5KCJ2b3hlbCIpJiYoci52b3hlbD1lLnZveGVsKSxudWxsIT1lLmZhY2VOYW1lJiZlLmhhc093blByb3BlcnR5KCJmYWNlTmFtZSIpJiYoci5mYWNlTmFtZT1lLmZhY2VOYW1lLHQub25lb2ZzJiYoci5fZmFjZU5hbWU9ImZhY2VOYW1lIikpLGUucG9zaXRpb25zJiZlLnBvc2l0aW9ucy5sZW5ndGgpe3IucG9zaXRpb25zPVtdO2Zvcih2YXIgbz0wO288ZS5wb3NpdGlvbnMubGVuZ3RoOysrbylyLnBvc2l0aW9uc1tvXT10Lmpzb24mJiFpc0Zpbml0ZShlLnBvc2l0aW9uc1tvXSk/U3RyaW5nKGUucG9zaXRpb25zW29dKTplLnBvc2l0aW9uc1tvXX1pZihlLnV2cyYmZS51dnMubGVuZ3RoKXtyLnV2cz1bXTtmb3Iobz0wO288ZS51dnMubGVuZ3RoOysrbylyLnV2c1tvXT10Lmpzb24mJiFpc0Zpbml0ZShlLnV2c1tvXSk/U3RyaW5nKGUudXZzW29dKTplLnV2c1tvXX1pZihlLmluZGljZXMmJmUuaW5kaWNlcy5sZW5ndGgpe3IuaW5kaWNlcz1bXTtmb3Iobz0wO288ZS5pbmRpY2VzLmxlbmd0aDsrK28pci5pbmRpY2VzW29dPWUuaW5kaWNlc1tvXX1pZihlLmxpZ2h0cyYmZS5saWdodHMubGVuZ3RoKXtyLmxpZ2h0cz1bXTtmb3Iobz0wO288ZS5saWdodHMubGVuZ3RoOysrbylyLmxpZ2h0c1tvXT1lLmxpZ2h0c1tvXX1yZXR1cm4gcn0sZS5wcm90b3R5cGUudG9KU09OPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29uc3RydWN0b3IudG9PYmplY3QodGhpcywkcHJvdG9idWYudXRpbC50b0pTT05PcHRpb25zKX0sZS5nZXRUeXBlVXJsPWZ1bmN0aW9uKGUpe3JldHVybiB2b2lkIDA9PT1lJiYoZT0idHlwZS5nb29nbGVhcGlzLmNvbSIpLGUrIi9wcm90b2NvbC5HZW9tZXRyeSJ9LGV9KCksZS5NZXNoPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShlKXtpZih0aGlzLmdlb21ldHJpZXM9W10sZSlmb3IodmFyIHQ9T2JqZWN0LmtleXMoZSkscj0wO3I8dC5sZW5ndGg7KytyKW51bGwhPWVbdFtyXV0mJih0aGlzW3Rbcl1dPWVbdFtyXV0pfXJldHVybiBlLnByb3RvdHlwZS5sZXZlbD0wLGUucHJvdG90eXBlLmdlb21ldHJpZXM9JHV0aWwuZW1wdHlBcnJheSxlLmNyZWF0ZT1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCl9LGUuZW5jb2RlPWZ1bmN0aW9uKGUsdCl7aWYodHx8KHQ9JFdyaXRlci5jcmVhdGUoKSksbnVsbCE9ZS5sZXZlbCYmT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoZSwibGV2ZWwiKSYmdC51aW50MzIoOCkuaW50MzIoZS5sZXZlbCksbnVsbCE9ZS5nZW9tZXRyaWVzJiZlLmdlb21ldHJpZXMubGVuZ3RoKWZvcih2YXIgcj0wO3I8ZS5nZW9tZXRyaWVzLmxlbmd0aDsrK3IpJHJvb3QucHJvdG9jb2wuR2VvbWV0cnkuZW5jb2RlKGUuZ2VvbWV0cmllc1tyXSx0LnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKTtyZXR1cm4gdH0sZS5lbmNvZGVEZWxpbWl0ZWQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5lbmNvZGUoZSx0KS5sZGVsaW0oKX0sZS5kZWNvZGU9ZnVuY3Rpb24oZSx0KXtlIGluc3RhbmNlb2YgJFJlYWRlcnx8KGU9JFJlYWRlci5jcmVhdGUoZSkpO2Zvcih2YXIgcj12b2lkIDA9PT10P2UubGVuOmUucG9zK3Qsbz1uZXcgJHJvb3QucHJvdG9jb2wuTWVzaDtlLnBvczxyOyl7dmFyIG49ZS51aW50MzIoKTtzd2l0Y2gobj4+PjMpe2Nhc2UgMTpvLmxldmVsPWUuaW50MzIoKTticmVhaztjYXNlIDI6by5nZW9tZXRyaWVzJiZvLmdlb21ldHJpZXMubGVuZ3RofHwoby5nZW9tZXRyaWVzPVtdKSxvLmdlb21ldHJpZXMucHVzaCgkcm9vdC5wcm90b2NvbC5HZW9tZXRyeS5kZWNvZGUoZSxlLnVpbnQzMigpKSk7YnJlYWs7ZGVmYXVsdDplLnNraXBUeXBlKDcmbil9fXJldHVybiBvfSxlLmRlY29kZURlbGltaXRlZD1mdW5jdGlvbihlKXtyZXR1cm4gZSBpbnN0YW5jZW9mICRSZWFkZXJ8fChlPW5ldyAkUmVhZGVyKGUpKSx0aGlzLmRlY29kZShlLGUudWludDMyKCkpfSxlLnZlcmlmeT1mdW5jdGlvbihlKXtpZigib2JqZWN0IiE9dHlwZW9mIGV8fG51bGw9PT1lKXJldHVybiJvYmplY3QgZXhwZWN0ZWQiO2lmKG51bGwhPWUubGV2ZWwmJmUuaGFzT3duUHJvcGVydHkoImxldmVsIikmJiEkdXRpbC5pc0ludGVnZXIoZS5sZXZlbCkpcmV0dXJuImxldmVsOiBpbnRlZ2VyIGV4cGVjdGVkIjtpZihudWxsIT1lLmdlb21ldHJpZXMmJmUuaGFzT3duUHJvcGVydHkoImdlb21ldHJpZXMiKSl7aWYoIUFycmF5LmlzQXJyYXkoZS5nZW9tZXRyaWVzKSlyZXR1cm4iZ2VvbWV0cmllczogYXJyYXkgZXhwZWN0ZWQiO2Zvcih2YXIgdD0wO3Q8ZS5nZW9tZXRyaWVzLmxlbmd0aDsrK3Qpe3ZhciByPSRyb290LnByb3RvY29sLkdlb21ldHJ5LnZlcmlmeShlLmdlb21ldHJpZXNbdF0pO2lmKHIpcmV0dXJuImdlb21ldHJpZXMuIityfX1yZXR1cm4gbnVsbH0sZS5mcm9tT2JqZWN0PWZ1bmN0aW9uKGUpe2lmKGUgaW5zdGFuY2VvZiAkcm9vdC5wcm90b2NvbC5NZXNoKXJldHVybiBlO3ZhciB0PW5ldyAkcm9vdC5wcm90b2NvbC5NZXNoO2lmKG51bGwhPWUubGV2ZWwmJih0LmxldmVsPTB8ZS5sZXZlbCksZS5nZW9tZXRyaWVzKXtpZighQXJyYXkuaXNBcnJheShlLmdlb21ldHJpZXMpKXRocm93IFR5cGVFcnJvcigiLnByb3RvY29sLk1lc2guZ2VvbWV0cmllczogYXJyYXkgZXhwZWN0ZWQiKTt0Lmdlb21ldHJpZXM9W107Zm9yKHZhciByPTA7cjxlLmdlb21ldHJpZXMubGVuZ3RoOysrcil7aWYoIm9iamVjdCIhPXR5cGVvZiBlLmdlb21ldHJpZXNbcl0pdGhyb3cgVHlwZUVycm9yKCIucHJvdG9jb2wuTWVzaC5nZW9tZXRyaWVzOiBvYmplY3QgZXhwZWN0ZWQiKTt0Lmdlb21ldHJpZXNbcl09JHJvb3QucHJvdG9jb2wuR2VvbWV0cnkuZnJvbU9iamVjdChlLmdlb21ldHJpZXNbcl0pfX1yZXR1cm4gdH0sZS50b09iamVjdD1mdW5jdGlvbihlLHQpe3R8fCh0PXt9KTt2YXIgcj17fTtpZigodC5hcnJheXN8fHQuZGVmYXVsdHMpJiYoci5nZW9tZXRyaWVzPVtdKSx0LmRlZmF1bHRzJiYoci5sZXZlbD0wKSxudWxsIT1lLmxldmVsJiZlLmhhc093blByb3BlcnR5KCJsZXZlbCIpJiYoci5sZXZlbD1lLmxldmVsKSxlLmdlb21ldHJpZXMmJmUuZ2VvbWV0cmllcy5sZW5ndGgpe3IuZ2VvbWV0cmllcz1bXTtmb3IodmFyIG89MDtvPGUuZ2VvbWV0cmllcy5sZW5ndGg7KytvKXIuZ2VvbWV0cmllc1tvXT0kcm9vdC5wcm90b2NvbC5HZW9tZXRyeS50b09iamVjdChlLmdlb21ldHJpZXNbb10sdCl9cmV0dXJuIHJ9LGUucHJvdG90eXBlLnRvSlNPTj1mdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbnN0cnVjdG9yLnRvT2JqZWN0KHRoaXMsJHByb3RvYnVmLnV0aWwudG9KU09OT3B0aW9ucyl9LGUuZ2V0VHlwZVVybD1mdW5jdGlvbihlKXtyZXR1cm4gdm9pZCAwPT09ZSYmKGU9InR5cGUuZ29vZ2xlYXBpcy5jb20iKSxlKyIvcHJvdG9jb2wuTWVzaCJ9LGV9KCksZS5DaHVuaz1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSl7aWYodGhpcy5tZXNoZXM9W10sdGhpcy52b3hlbHM9W10sdGhpcy5saWdodHM9W10sZSlmb3IodmFyIHQ9T2JqZWN0LmtleXMoZSkscj0wO3I8dC5sZW5ndGg7KytyKW51bGwhPWVbdFtyXV0mJih0aGlzW3Rbcl1dPWVbdFtyXV0pfXJldHVybiBlLnByb3RvdHlwZS54PTAsZS5wcm90b3R5cGUuej0wLGUucHJvdG90eXBlLmlkPSIiLGUucHJvdG90eXBlLm1lc2hlcz0kdXRpbC5lbXB0eUFycmF5LGUucHJvdG90eXBlLnZveGVscz0kdXRpbC5lbXB0eUFycmF5LGUucHJvdG90eXBlLmxpZ2h0cz0kdXRpbC5lbXB0eUFycmF5LGUuY3JlYXRlPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KX0sZS5lbmNvZGU9ZnVuY3Rpb24oZSx0KXtpZih0fHwodD0kV3JpdGVyLmNyZWF0ZSgpKSxudWxsIT1lLngmJk9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIngiKSYmdC51aW50MzIoOCkuaW50MzIoZS54KSxudWxsIT1lLnomJk9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsInoiKSYmdC51aW50MzIoMTYpLmludDMyKGUueiksbnVsbCE9ZS5pZCYmT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoZSwiaWQiKSYmdC51aW50MzIoMjYpLnN0cmluZyhlLmlkKSxudWxsIT1lLm1lc2hlcyYmZS5tZXNoZXMubGVuZ3RoKWZvcih2YXIgcj0wO3I8ZS5tZXNoZXMubGVuZ3RoOysrcikkcm9vdC5wcm90b2NvbC5NZXNoLmVuY29kZShlLm1lc2hlc1tyXSx0LnVpbnQzMigzNCkuZm9yaygpKS5sZGVsaW0oKTtpZihudWxsIT1lLnZveGVscyYmZS52b3hlbHMubGVuZ3RoKXt0LnVpbnQzMig0MikuZm9yaygpO2ZvcihyPTA7cjxlLnZveGVscy5sZW5ndGg7KytyKXQudWludDMyKGUudm94ZWxzW3JdKTt0LmxkZWxpbSgpfWlmKG51bGwhPWUubGlnaHRzJiZlLmxpZ2h0cy5sZW5ndGgpe3QudWludDMyKDUwKS5mb3JrKCk7Zm9yKHI9MDtyPGUubGlnaHRzLmxlbmd0aDsrK3IpdC51aW50MzIoZS5saWdodHNbcl0pO3QubGRlbGltKCl9cmV0dXJuIHR9LGUuZW5jb2RlRGVsaW1pdGVkPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuZW5jb2RlKGUsdCkubGRlbGltKCl9LGUuZGVjb2RlPWZ1bmN0aW9uKGUsdCl7ZSBpbnN0YW5jZW9mICRSZWFkZXJ8fChlPSRSZWFkZXIuY3JlYXRlKGUpKTtmb3IodmFyIHI9dm9pZCAwPT09dD9lLmxlbjplLnBvcyt0LG89bmV3ICRyb290LnByb3RvY29sLkNodW5rO2UucG9zPHI7KXt2YXIgbj1lLnVpbnQzMigpO3N3aXRjaChuPj4+Myl7Y2FzZSAxOm8ueD1lLmludDMyKCk7YnJlYWs7Y2FzZSAyOm8uej1lLmludDMyKCk7YnJlYWs7Y2FzZSAzOm8uaWQ9ZS5zdHJpbmcoKTticmVhaztjYXNlIDQ6by5tZXNoZXMmJm8ubWVzaGVzLmxlbmd0aHx8KG8ubWVzaGVzPVtdKSxvLm1lc2hlcy5wdXNoKCRyb290LnByb3RvY29sLk1lc2guZGVjb2RlKGUsZS51aW50MzIoKSkpO2JyZWFrO2Nhc2UgNTppZihvLnZveGVscyYmby52b3hlbHMubGVuZ3RofHwoby52b3hlbHM9W10pLDI9PSg3Jm4pKWZvcih2YXIgaT1lLnVpbnQzMigpK2UucG9zO2UucG9zPGk7KW8udm94ZWxzLnB1c2goZS51aW50MzIoKSk7ZWxzZSBvLnZveGVscy5wdXNoKGUudWludDMyKCkpO2JyZWFrO2Nhc2UgNjppZihvLmxpZ2h0cyYmby5saWdodHMubGVuZ3RofHwoby5saWdodHM9W10pLDI9PSg3Jm4pKWZvcihpPWUudWludDMyKCkrZS5wb3M7ZS5wb3M8aTspby5saWdodHMucHVzaChlLnVpbnQzMigpKTtlbHNlIG8ubGlnaHRzLnB1c2goZS51aW50MzIoKSk7YnJlYWs7ZGVmYXVsdDplLnNraXBUeXBlKDcmbil9fXJldHVybiBvfSxlLmRlY29kZURlbGltaXRlZD1mdW5jdGlvbihlKXtyZXR1cm4gZSBpbnN0YW5jZW9mICRSZWFkZXJ8fChlPW5ldyAkUmVhZGVyKGUpKSx0aGlzLmRlY29kZShlLGUudWludDMyKCkpfSxlLnZlcmlmeT1mdW5jdGlvbihlKXtpZigib2JqZWN0IiE9dHlwZW9mIGV8fG51bGw9PT1lKXJldHVybiJvYmplY3QgZXhwZWN0ZWQiO2lmKG51bGwhPWUueCYmZS5oYXNPd25Qcm9wZXJ0eSgieCIpJiYhJHV0aWwuaXNJbnRlZ2VyKGUueCkpcmV0dXJuIng6IGludGVnZXIgZXhwZWN0ZWQiO2lmKG51bGwhPWUueiYmZS5oYXNPd25Qcm9wZXJ0eSgieiIpJiYhJHV0aWwuaXNJbnRlZ2VyKGUueikpcmV0dXJuIno6IGludGVnZXIgZXhwZWN0ZWQiO2lmKG51bGwhPWUuaWQmJmUuaGFzT3duUHJvcGVydHkoImlkIikmJiEkdXRpbC5pc1N0cmluZyhlLmlkKSlyZXR1cm4iaWQ6IHN0cmluZyBleHBlY3RlZCI7aWYobnVsbCE9ZS5tZXNoZXMmJmUuaGFzT3duUHJvcGVydHkoIm1lc2hlcyIpKXtpZighQXJyYXkuaXNBcnJheShlLm1lc2hlcykpcmV0dXJuIm1lc2hlczogYXJyYXkgZXhwZWN0ZWQiO2Zvcih2YXIgdD0wO3Q8ZS5tZXNoZXMubGVuZ3RoOysrdCl7dmFyIHI9JHJvb3QucHJvdG9jb2wuTWVzaC52ZXJpZnkoZS5tZXNoZXNbdF0pO2lmKHIpcmV0dXJuIm1lc2hlcy4iK3J9fWlmKG51bGwhPWUudm94ZWxzJiZlLmhhc093blByb3BlcnR5KCJ2b3hlbHMiKSl7aWYoIUFycmF5LmlzQXJyYXkoZS52b3hlbHMpKXJldHVybiJ2b3hlbHM6IGFycmF5IGV4cGVjdGVkIjtmb3IodD0wO3Q8ZS52b3hlbHMubGVuZ3RoOysrdClpZighJHV0aWwuaXNJbnRlZ2VyKGUudm94ZWxzW3RdKSlyZXR1cm4idm94ZWxzOiBpbnRlZ2VyW10gZXhwZWN0ZWQifWlmKG51bGwhPWUubGlnaHRzJiZlLmhhc093blByb3BlcnR5KCJsaWdodHMiKSl7aWYoIUFycmF5LmlzQXJyYXkoZS5saWdodHMpKXJldHVybiJsaWdodHM6IGFycmF5IGV4cGVjdGVkIjtmb3IodD0wO3Q8ZS5saWdodHMubGVuZ3RoOysrdClpZighJHV0aWwuaXNJbnRlZ2VyKGUubGlnaHRzW3RdKSlyZXR1cm4ibGlnaHRzOiBpbnRlZ2VyW10gZXhwZWN0ZWQifXJldHVybiBudWxsfSxlLmZyb21PYmplY3Q9ZnVuY3Rpb24oZSl7aWYoZSBpbnN0YW5jZW9mICRyb290LnByb3RvY29sLkNodW5rKXJldHVybiBlO3ZhciB0PW5ldyAkcm9vdC5wcm90b2NvbC5DaHVuaztpZihudWxsIT1lLngmJih0Lng9MHxlLngpLG51bGwhPWUueiYmKHQuej0wfGUueiksbnVsbCE9ZS5pZCYmKHQuaWQ9U3RyaW5nKGUuaWQpKSxlLm1lc2hlcyl7aWYoIUFycmF5LmlzQXJyYXkoZS5tZXNoZXMpKXRocm93IFR5cGVFcnJvcigiLnByb3RvY29sLkNodW5rLm1lc2hlczogYXJyYXkgZXhwZWN0ZWQiKTt0Lm1lc2hlcz1bXTtmb3IodmFyIHI9MDtyPGUubWVzaGVzLmxlbmd0aDsrK3Ipe2lmKCJvYmplY3QiIT10eXBlb2YgZS5tZXNoZXNbcl0pdGhyb3cgVHlwZUVycm9yKCIucHJvdG9jb2wuQ2h1bmsubWVzaGVzOiBvYmplY3QgZXhwZWN0ZWQiKTt0Lm1lc2hlc1tyXT0kcm9vdC5wcm90b2NvbC5NZXNoLmZyb21PYmplY3QoZS5tZXNoZXNbcl0pfX1pZihlLnZveGVscyl7aWYoIUFycmF5LmlzQXJyYXkoZS52b3hlbHMpKXRocm93IFR5cGVFcnJvcigiLnByb3RvY29sLkNodW5rLnZveGVsczogYXJyYXkgZXhwZWN0ZWQiKTt0LnZveGVscz1bXTtmb3Iocj0wO3I8ZS52b3hlbHMubGVuZ3RoOysrcil0LnZveGVsc1tyXT1lLnZveGVsc1tyXT4+PjB9aWYoZS5saWdodHMpe2lmKCFBcnJheS5pc0FycmF5KGUubGlnaHRzKSl0aHJvdyBUeXBlRXJyb3IoIi5wcm90b2NvbC5DaHVuay5saWdodHM6IGFycmF5IGV4cGVjdGVkIik7dC5saWdodHM9W107Zm9yKHI9MDtyPGUubGlnaHRzLmxlbmd0aDsrK3IpdC5saWdodHNbcl09ZS5saWdodHNbcl0+Pj4wfXJldHVybiB0fSxlLnRvT2JqZWN0PWZ1bmN0aW9uKGUsdCl7dHx8KHQ9e30pO3ZhciByPXt9O2lmKCh0LmFycmF5c3x8dC5kZWZhdWx0cykmJihyLm1lc2hlcz1bXSxyLnZveGVscz1bXSxyLmxpZ2h0cz1bXSksdC5kZWZhdWx0cyYmKHIueD0wLHIuej0wLHIuaWQ9IiIpLG51bGwhPWUueCYmZS5oYXNPd25Qcm9wZXJ0eSgieCIpJiYoci54PWUueCksbnVsbCE9ZS56JiZlLmhhc093blByb3BlcnR5KCJ6IikmJihyLno9ZS56KSxudWxsIT1lLmlkJiZlLmhhc093blByb3BlcnR5KCJpZCIpJiYoci5pZD1lLmlkKSxlLm1lc2hlcyYmZS5tZXNoZXMubGVuZ3RoKXtyLm1lc2hlcz1bXTtmb3IodmFyIG89MDtvPGUubWVzaGVzLmxlbmd0aDsrK28pci5tZXNoZXNbb109JHJvb3QucHJvdG9jb2wuTWVzaC50b09iamVjdChlLm1lc2hlc1tvXSx0KX1pZihlLnZveGVscyYmZS52b3hlbHMubGVuZ3RoKXtyLnZveGVscz1bXTtmb3Iobz0wO288ZS52b3hlbHMubGVuZ3RoOysrbylyLnZveGVsc1tvXT1lLnZveGVsc1tvXX1pZihlLmxpZ2h0cyYmZS5saWdodHMubGVuZ3RoKXtyLmxpZ2h0cz1bXTtmb3Iobz0wO288ZS5saWdodHMubGVuZ3RoOysrbylyLmxpZ2h0c1tvXT1lLmxpZ2h0c1tvXX1yZXR1cm4gcn0sZS5wcm90b3R5cGUudG9KU09OPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29uc3RydWN0b3IudG9PYmplY3QodGhpcywkcHJvdG9idWYudXRpbC50b0pTT05PcHRpb25zKX0sZS5nZXRUeXBlVXJsPWZ1bmN0aW9uKGUpe3JldHVybiB2b2lkIDA9PT1lJiYoZT0idHlwZS5nb29nbGVhcGlzLmNvbSIpLGUrIi9wcm90b2NvbC5DaHVuayJ9LGV9KCksZS5QZWVyPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShlKXtpZihlKWZvcih2YXIgdD1PYmplY3Qua2V5cyhlKSxyPTA7cjx0Lmxlbmd0aDsrK3IpbnVsbCE9ZVt0W3JdXSYmKHRoaXNbdFtyXV09ZVt0W3JdXSl9cmV0dXJuIGUucHJvdG90eXBlLmlkPSIiLGUucHJvdG90eXBlLnVzZXJuYW1lPSIiLGUucHJvdG90eXBlLm1ldGFkYXRhPSIiLGUuY3JlYXRlPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KX0sZS5lbmNvZGU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdHx8KHQ9JFdyaXRlci5jcmVhdGUoKSksbnVsbCE9ZS5pZCYmT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoZSwiaWQiKSYmdC51aW50MzIoMTApLnN0cmluZyhlLmlkKSxudWxsIT1lLnVzZXJuYW1lJiZPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChlLCJ1c2VybmFtZSIpJiZ0LnVpbnQzMigxOCkuc3RyaW5nKGUudXNlcm5hbWUpLG51bGwhPWUubWV0YWRhdGEmJk9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIm1ldGFkYXRhIikmJnQudWludDMyKDI2KS5zdHJpbmcoZS5tZXRhZGF0YSksdH0sZS5lbmNvZGVEZWxpbWl0ZWQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5lbmNvZGUoZSx0KS5sZGVsaW0oKX0sZS5kZWNvZGU9ZnVuY3Rpb24oZSx0KXtlIGluc3RhbmNlb2YgJFJlYWRlcnx8KGU9JFJlYWRlci5jcmVhdGUoZSkpO2Zvcih2YXIgcj12b2lkIDA9PT10P2UubGVuOmUucG9zK3Qsbz1uZXcgJHJvb3QucHJvdG9jb2wuUGVlcjtlLnBvczxyOyl7dmFyIG49ZS51aW50MzIoKTtzd2l0Y2gobj4+PjMpe2Nhc2UgMTpvLmlkPWUuc3RyaW5nKCk7YnJlYWs7Y2FzZSAyOm8udXNlcm5hbWU9ZS5zdHJpbmcoKTticmVhaztjYXNlIDM6by5tZXRhZGF0YT1lLnN0cmluZygpO2JyZWFrO2RlZmF1bHQ6ZS5za2lwVHlwZSg3Jm4pfX1yZXR1cm4gb30sZS5kZWNvZGVEZWxpbWl0ZWQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGUgaW5zdGFuY2VvZiAkUmVhZGVyfHwoZT1uZXcgJFJlYWRlcihlKSksdGhpcy5kZWNvZGUoZSxlLnVpbnQzMigpKX0sZS52ZXJpZnk9ZnVuY3Rpb24oZSl7cmV0dXJuIm9iamVjdCIhPXR5cGVvZiBlfHxudWxsPT09ZT8ib2JqZWN0IGV4cGVjdGVkIjpudWxsIT1lLmlkJiZlLmhhc093blByb3BlcnR5KCJpZCIpJiYhJHV0aWwuaXNTdHJpbmcoZS5pZCk/ImlkOiBzdHJpbmcgZXhwZWN0ZWQiOm51bGwhPWUudXNlcm5hbWUmJmUuaGFzT3duUHJvcGVydHkoInVzZXJuYW1lIikmJiEkdXRpbC5pc1N0cmluZyhlLnVzZXJuYW1lKT8idXNlcm5hbWU6IHN0cmluZyBleHBlY3RlZCI6bnVsbCE9ZS5tZXRhZGF0YSYmZS5oYXNPd25Qcm9wZXJ0eSgibWV0YWRhdGEiKSYmISR1dGlsLmlzU3RyaW5nKGUubWV0YWRhdGEpPyJtZXRhZGF0YTogc3RyaW5nIGV4cGVjdGVkIjpudWxsfSxlLmZyb21PYmplY3Q9ZnVuY3Rpb24oZSl7aWYoZSBpbnN0YW5jZW9mICRyb290LnByb3RvY29sLlBlZXIpcmV0dXJuIGU7dmFyIHQ9bmV3ICRyb290LnByb3RvY29sLlBlZXI7cmV0dXJuIG51bGwhPWUuaWQmJih0LmlkPVN0cmluZyhlLmlkKSksbnVsbCE9ZS51c2VybmFtZSYmKHQudXNlcm5hbWU9U3RyaW5nKGUudXNlcm5hbWUpKSxudWxsIT1lLm1ldGFkYXRhJiYodC5tZXRhZGF0YT1TdHJpbmcoZS5tZXRhZGF0YSkpLHR9LGUudG9PYmplY3Q9ZnVuY3Rpb24oZSx0KXt0fHwodD17fSk7dmFyIHI9e307cmV0dXJuIHQuZGVmYXVsdHMmJihyLmlkPSIiLHIudXNlcm5hbWU9IiIsci5tZXRhZGF0YT0iIiksbnVsbCE9ZS5pZCYmZS5oYXNPd25Qcm9wZXJ0eSgiaWQiKSYmKHIuaWQ9ZS5pZCksbnVsbCE9ZS51c2VybmFtZSYmZS5oYXNPd25Qcm9wZXJ0eSgidXNlcm5hbWUiKSYmKHIudXNlcm5hbWU9ZS51c2VybmFtZSksbnVsbCE9ZS5tZXRhZGF0YSYmZS5oYXNPd25Qcm9wZXJ0eSgibWV0YWRhdGEiKSYmKHIubWV0YWRhdGE9ZS5tZXRhZGF0YSkscn0sZS5wcm90b3R5cGUudG9KU09OPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29uc3RydWN0b3IudG9PYmplY3QodGhpcywkcHJvdG9idWYudXRpbC50b0pTT05PcHRpb25zKX0sZS5nZXRUeXBlVXJsPWZ1bmN0aW9uKGUpe3JldHVybiB2b2lkIDA9PT1lJiYoZT0idHlwZS5nb29nbGVhcGlzLmNvbSIpLGUrIi9wcm90b2NvbC5QZWVyIn0sZX0oKSxlLkVudGl0eT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSl7aWYoZSlmb3IodmFyIHQ9T2JqZWN0LmtleXMoZSkscj0wO3I8dC5sZW5ndGg7KytyKW51bGwhPWVbdFtyXV0mJih0aGlzW3Rbcl1dPWVbdFtyXV0pfXZhciB0LHI7cmV0dXJuIGUucHJvdG90eXBlLm9wZXJhdGlvbj0wLGUucHJvdG90eXBlLmlkPSIiLGUucHJvdG90eXBlLnR5cGU9IiIsZS5wcm90b3R5cGUubWV0YWRhdGE9IiIsZS5jcmVhdGU9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpfSxlLmVuY29kZT1mdW5jdGlvbihlLHQpe3JldHVybiB0fHwodD0kV3JpdGVyLmNyZWF0ZSgpKSxudWxsIT1lLm9wZXJhdGlvbiYmT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoZSwib3BlcmF0aW9uIikmJnQudWludDMyKDgpLmludDMyKGUub3BlcmF0aW9uKSxudWxsIT1lLmlkJiZPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChlLCJpZCIpJiZ0LnVpbnQzMigxOCkuc3RyaW5nKGUuaWQpLG51bGwhPWUudHlwZSYmT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoZSwidHlwZSIpJiZ0LnVpbnQzMigyNikuc3RyaW5nKGUudHlwZSksbnVsbCE9ZS5tZXRhZGF0YSYmT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoZSwibWV0YWRhdGEiKSYmdC51aW50MzIoMzQpLnN0cmluZyhlLm1ldGFkYXRhKSx0fSxlLmVuY29kZURlbGltaXRlZD1mdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLmVuY29kZShlLHQpLmxkZWxpbSgpfSxlLmRlY29kZT1mdW5jdGlvbihlLHQpe2UgaW5zdGFuY2VvZiAkUmVhZGVyfHwoZT0kUmVhZGVyLmNyZWF0ZShlKSk7Zm9yKHZhciByPXZvaWQgMD09PXQ/ZS5sZW46ZS5wb3MrdCxvPW5ldyAkcm9vdC5wcm90b2NvbC5FbnRpdHk7ZS5wb3M8cjspe3ZhciBuPWUudWludDMyKCk7c3dpdGNoKG4+Pj4zKXtjYXNlIDE6by5vcGVyYXRpb249ZS5pbnQzMigpO2JyZWFrO2Nhc2UgMjpvLmlkPWUuc3RyaW5nKCk7YnJlYWs7Y2FzZSAzOm8udHlwZT1lLnN0cmluZygpO2JyZWFrO2Nhc2UgNDpvLm1ldGFkYXRhPWUuc3RyaW5nKCk7YnJlYWs7ZGVmYXVsdDplLnNraXBUeXBlKDcmbil9fXJldHVybiBvfSxlLmRlY29kZURlbGltaXRlZD1mdW5jdGlvbihlKXtyZXR1cm4gZSBpbnN0YW5jZW9mICRSZWFkZXJ8fChlPW5ldyAkUmVhZGVyKGUpKSx0aGlzLmRlY29kZShlLGUudWludDMyKCkpfSxlLnZlcmlmeT1mdW5jdGlvbihlKXtpZigib2JqZWN0IiE9dHlwZW9mIGV8fG51bGw9PT1lKXJldHVybiJvYmplY3QgZXhwZWN0ZWQiO2lmKG51bGwhPWUub3BlcmF0aW9uJiZlLmhhc093blByb3BlcnR5KCJvcGVyYXRpb24iKSlzd2l0Y2goZS5vcGVyYXRpb24pe2RlZmF1bHQ6cmV0dXJuIm9wZXJhdGlvbjogZW51bSB2YWx1ZSBleHBlY3RlZCI7Y2FzZSAwOmNhc2UgMTpjYXNlIDI6fXJldHVybiBudWxsIT1lLmlkJiZlLmhhc093blByb3BlcnR5KCJpZCIpJiYhJHV0aWwuaXNTdHJpbmcoZS5pZCk/ImlkOiBzdHJpbmcgZXhwZWN0ZWQiOm51bGwhPWUudHlwZSYmZS5oYXNPd25Qcm9wZXJ0eSgidHlwZSIpJiYhJHV0aWwuaXNTdHJpbmcoZS50eXBlKT8idHlwZTogc3RyaW5nIGV4cGVjdGVkIjpudWxsIT1lLm1ldGFkYXRhJiZlLmhhc093blByb3BlcnR5KCJtZXRhZGF0YSIpJiYhJHV0aWwuaXNTdHJpbmcoZS5tZXRhZGF0YSk/Im1ldGFkYXRhOiBzdHJpbmcgZXhwZWN0ZWQiOm51bGx9LGUuZnJvbU9iamVjdD1mdW5jdGlvbihlKXtpZihlIGluc3RhbmNlb2YgJHJvb3QucHJvdG9jb2wuRW50aXR5KXJldHVybiBlO3ZhciB0PW5ldyAkcm9vdC5wcm90b2NvbC5FbnRpdHk7c3dpdGNoKGUub3BlcmF0aW9uKXtkZWZhdWx0OmlmKCJudW1iZXIiPT10eXBlb2YgZS5vcGVyYXRpb24pe3Qub3BlcmF0aW9uPWUub3BlcmF0aW9uO2JyZWFrfWJyZWFrO2Nhc2UiQ1JFQVRFIjpjYXNlIDA6dC5vcGVyYXRpb249MDticmVhaztjYXNlIkRFTEVURSI6Y2FzZSAxOnQub3BlcmF0aW9uPTE7YnJlYWs7Y2FzZSJVUERBVEUiOmNhc2UgMjp0Lm9wZXJhdGlvbj0yfXJldHVybiBudWxsIT1lLmlkJiYodC5pZD1TdHJpbmcoZS5pZCkpLG51bGwhPWUudHlwZSYmKHQudHlwZT1TdHJpbmcoZS50eXBlKSksbnVsbCE9ZS5tZXRhZGF0YSYmKHQubWV0YWRhdGE9U3RyaW5nKGUubWV0YWRhdGEpKSx0fSxlLnRvT2JqZWN0PWZ1bmN0aW9uKGUsdCl7dHx8KHQ9e30pO3ZhciByPXt9O3JldHVybiB0LmRlZmF1bHRzJiYoci5vcGVyYXRpb249dC5lbnVtcz09PVN0cmluZz8iQ1JFQVRFIjowLHIuaWQ9IiIsci50eXBlPSIiLHIubWV0YWRhdGE9IiIpLG51bGwhPWUub3BlcmF0aW9uJiZlLmhhc093blByb3BlcnR5KCJvcGVyYXRpb24iKSYmKHIub3BlcmF0aW9uPXQuZW51bXM9PT1TdHJpbmc/dm9pZCAwPT09JHJvb3QucHJvdG9jb2wuRW50aXR5Lk9wZXJhdGlvbltlLm9wZXJhdGlvbl0/ZS5vcGVyYXRpb246JHJvb3QucHJvdG9jb2wuRW50aXR5Lk9wZXJhdGlvbltlLm9wZXJhdGlvbl06ZS5vcGVyYXRpb24pLG51bGwhPWUuaWQmJmUuaGFzT3duUHJvcGVydHkoImlkIikmJihyLmlkPWUuaWQpLG51bGwhPWUudHlwZSYmZS5oYXNPd25Qcm9wZXJ0eSgidHlwZSIpJiYoci50eXBlPWUudHlwZSksbnVsbCE9ZS5tZXRhZGF0YSYmZS5oYXNPd25Qcm9wZXJ0eSgibWV0YWRhdGEiKSYmKHIubWV0YWRhdGE9ZS5tZXRhZGF0YSkscn0sZS5wcm90b3R5cGUudG9KU09OPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29uc3RydWN0b3IudG9PYmplY3QodGhpcywkcHJvdG9idWYudXRpbC50b0pTT05PcHRpb25zKX0sZS5nZXRUeXBlVXJsPWZ1bmN0aW9uKGUpe3JldHVybiB2b2lkIDA9PT1lJiYoZT0idHlwZS5nb29nbGVhcGlzLmNvbSIpLGUrIi9wcm90b2NvbC5FbnRpdHkifSxlLk9wZXJhdGlvbj0odD17fSwocj1PYmplY3QuY3JlYXRlKHQpKVt0WzBdPSJDUkVBVEUiXT0wLHJbdFsxXT0iREVMRVRFIl09MSxyW3RbMl09IlVQREFURSJdPTIsciksZX0oKSxlLkV2ZW50PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShlKXtpZihlKWZvcih2YXIgdD1PYmplY3Qua2V5cyhlKSxyPTA7cjx0Lmxlbmd0aDsrK3IpbnVsbCE9ZVt0W3JdXSYmKHRoaXNbdFtyXV09ZVt0W3JdXSl9cmV0dXJuIGUucHJvdG90eXBlLm5hbWU9IiIsZS5wcm90b3R5cGUucGF5bG9hZD1udWxsLGUuY3JlYXRlPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KX0sZS5lbmNvZGU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdHx8KHQ9JFdyaXRlci5jcmVhdGUoKSksbnVsbCE9ZS5uYW1lJiZPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChlLCJuYW1lIikmJnQudWludDMyKDEwKS5zdHJpbmcoZS5uYW1lKSxudWxsIT1lLnBheWxvYWQmJk9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsInBheWxvYWQiKSYmJHJvb3QuZ29vZ2xlLnByb3RvYnVmLlN0cnVjdC5lbmNvZGUoZS5wYXlsb2FkLHQudWludDMyKDE4KS5mb3JrKCkpLmxkZWxpbSgpLHR9LGUuZW5jb2RlRGVsaW1pdGVkPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuZW5jb2RlKGUsdCkubGRlbGltKCl9LGUuZGVjb2RlPWZ1bmN0aW9uKGUsdCl7ZSBpbnN0YW5jZW9mICRSZWFkZXJ8fChlPSRSZWFkZXIuY3JlYXRlKGUpKTtmb3IodmFyIHI9dm9pZCAwPT09dD9lLmxlbjplLnBvcyt0LG89bmV3ICRyb290LnByb3RvY29sLkV2ZW50O2UucG9zPHI7KXt2YXIgbj1lLnVpbnQzMigpO3N3aXRjaChuPj4+Myl7Y2FzZSAxOm8ubmFtZT1lLnN0cmluZygpO2JyZWFrO2Nhc2UgMjpvLnBheWxvYWQ9JHJvb3QuZ29vZ2xlLnByb3RvYnVmLlN0cnVjdC5kZWNvZGUoZSxlLnVpbnQzMigpKTticmVhaztkZWZhdWx0OmUuc2tpcFR5cGUoNyZuKX19cmV0dXJuIG99LGUuZGVjb2RlRGVsaW1pdGVkPWZ1bmN0aW9uKGUpe3JldHVybiBlIGluc3RhbmNlb2YgJFJlYWRlcnx8KGU9bmV3ICRSZWFkZXIoZSkpLHRoaXMuZGVjb2RlKGUsZS51aW50MzIoKSl9LGUudmVyaWZ5PWZ1bmN0aW9uKGUpe2lmKCJvYmplY3QiIT10eXBlb2YgZXx8bnVsbD09PWUpcmV0dXJuIm9iamVjdCBleHBlY3RlZCI7aWYobnVsbCE9ZS5uYW1lJiZlLmhhc093blByb3BlcnR5KCJuYW1lIikmJiEkdXRpbC5pc1N0cmluZyhlLm5hbWUpKXJldHVybiJuYW1lOiBzdHJpbmcgZXhwZWN0ZWQiO2lmKG51bGwhPWUucGF5bG9hZCYmZS5oYXNPd25Qcm9wZXJ0eSgicGF5bG9hZCIpKXt2YXIgdD0kcm9vdC5nb29nbGUucHJvdG9idWYuU3RydWN0LnZlcmlmeShlLnBheWxvYWQpO2lmKHQpcmV0dXJuInBheWxvYWQuIit0fXJldHVybiBudWxsfSxlLmZyb21PYmplY3Q9ZnVuY3Rpb24oZSl7aWYoZSBpbnN0YW5jZW9mICRyb290LnByb3RvY29sLkV2ZW50KXJldHVybiBlO3ZhciB0PW5ldyAkcm9vdC5wcm90b2NvbC5FdmVudDtpZihudWxsIT1lLm5hbWUmJih0Lm5hbWU9U3RyaW5nKGUubmFtZSkpLG51bGwhPWUucGF5bG9hZCl7aWYoIm9iamVjdCIhPXR5cGVvZiBlLnBheWxvYWQpdGhyb3cgVHlwZUVycm9yKCIucHJvdG9jb2wuRXZlbnQucGF5bG9hZDogb2JqZWN0IGV4cGVjdGVkIik7dC5wYXlsb2FkPSRyb290Lmdvb2dsZS5wcm90b2J1Zi5TdHJ1Y3QuZnJvbU9iamVjdChlLnBheWxvYWQpfXJldHVybiB0fSxlLnRvT2JqZWN0PWZ1bmN0aW9uKGUsdCl7dHx8KHQ9e30pO3ZhciByPXt9O3JldHVybiB0LmRlZmF1bHRzJiYoci5uYW1lPSIiLHIucGF5bG9hZD1udWxsKSxudWxsIT1lLm5hbWUmJmUuaGFzT3duUHJvcGVydHkoIm5hbWUiKSYmKHIubmFtZT1lLm5hbWUpLG51bGwhPWUucGF5bG9hZCYmZS5oYXNPd25Qcm9wZXJ0eSgicGF5bG9hZCIpJiYoci5wYXlsb2FkPSRyb290Lmdvb2dsZS5wcm90b2J1Zi5TdHJ1Y3QudG9PYmplY3QoZS5wYXlsb2FkLHQpKSxyfSxlLnByb3RvdHlwZS50b0pTT049ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci50b09iamVjdCh0aGlzLCRwcm90b2J1Zi51dGlsLnRvSlNPTk9wdGlvbnMpfSxlLmdldFR5cGVVcmw9ZnVuY3Rpb24oZSl7cmV0dXJuIHZvaWQgMD09PWUmJihlPSJ0eXBlLmdvb2dsZWFwaXMuY29tIiksZSsiL3Byb3RvY29sLkV2ZW50In0sZX0oKSxlLk1ldGhvZD1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSl7aWYoZSlmb3IodmFyIHQ9T2JqZWN0LmtleXMoZSkscj0wO3I8dC5sZW5ndGg7KytyKW51bGwhPWVbdFtyXV0mJih0aGlzW3Rbcl1dPWVbdFtyXV0pfXJldHVybiBlLnByb3RvdHlwZS5uYW1lPSIiLGUucHJvdG90eXBlLnBheWxvYWQ9IiIsZS5jcmVhdGU9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpfSxlLmVuY29kZT1mdW5jdGlvbihlLHQpe3JldHVybiB0fHwodD0kV3JpdGVyLmNyZWF0ZSgpKSxudWxsIT1lLm5hbWUmJk9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIm5hbWUiKSYmdC51aW50MzIoMTApLnN0cmluZyhlLm5hbWUpLG51bGwhPWUucGF5bG9hZCYmT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoZSwicGF5bG9hZCIpJiZ0LnVpbnQzMigxOCkuc3RyaW5nKGUucGF5bG9hZCksdH0sZS5lbmNvZGVEZWxpbWl0ZWQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5lbmNvZGUoZSx0KS5sZGVsaW0oKX0sZS5kZWNvZGU9ZnVuY3Rpb24oZSx0KXtlIGluc3RhbmNlb2YgJFJlYWRlcnx8KGU9JFJlYWRlci5jcmVhdGUoZSkpO2Zvcih2YXIgcj12b2lkIDA9PT10P2UubGVuOmUucG9zK3Qsbz1uZXcgJHJvb3QucHJvdG9jb2wuTWV0aG9kO2UucG9zPHI7KXt2YXIgbj1lLnVpbnQzMigpO3N3aXRjaChuPj4+Myl7Y2FzZSAxOm8ubmFtZT1lLnN0cmluZygpO2JyZWFrO2Nhc2UgMjpvLnBheWxvYWQ9ZS5zdHJpbmcoKTticmVhaztkZWZhdWx0OmUuc2tpcFR5cGUoNyZuKX19cmV0dXJuIG99LGUuZGVjb2RlRGVsaW1pdGVkPWZ1bmN0aW9uKGUpe3JldHVybiBlIGluc3RhbmNlb2YgJFJlYWRlcnx8KGU9bmV3ICRSZWFkZXIoZSkpLHRoaXMuZGVjb2RlKGUsZS51aW50MzIoKSl9LGUudmVyaWZ5PWZ1bmN0aW9uKGUpe3JldHVybiJvYmplY3QiIT10eXBlb2YgZXx8bnVsbD09PWU/Im9iamVjdCBleHBlY3RlZCI6bnVsbCE9ZS5uYW1lJiZlLmhhc093blByb3BlcnR5KCJuYW1lIikmJiEkdXRpbC5pc1N0cmluZyhlLm5hbWUpPyJuYW1lOiBzdHJpbmcgZXhwZWN0ZWQiOm51bGwhPWUucGF5bG9hZCYmZS5oYXNPd25Qcm9wZXJ0eSgicGF5bG9hZCIpJiYhJHV0aWwuaXNTdHJpbmcoZS5wYXlsb2FkKT8icGF5bG9hZDogc3RyaW5nIGV4cGVjdGVkIjpudWxsfSxlLmZyb21PYmplY3Q9ZnVuY3Rpb24oZSl7aWYoZSBpbnN0YW5jZW9mICRyb290LnByb3RvY29sLk1ldGhvZClyZXR1cm4gZTt2YXIgdD1uZXcgJHJvb3QucHJvdG9jb2wuTWV0aG9kO3JldHVybiBudWxsIT1lLm5hbWUmJih0Lm5hbWU9U3RyaW5nKGUubmFtZSkpLG51bGwhPWUucGF5bG9hZCYmKHQucGF5bG9hZD1TdHJpbmcoZS5wYXlsb2FkKSksdH0sZS50b09iamVjdD1mdW5jdGlvbihlLHQpe3R8fCh0PXt9KTt2YXIgcj17fTtyZXR1cm4gdC5kZWZhdWx0cyYmKHIubmFtZT0iIixyLnBheWxvYWQ9IiIpLG51bGwhPWUubmFtZSYmZS5oYXNPd25Qcm9wZXJ0eSgibmFtZSIpJiYoci5uYW1lPWUubmFtZSksbnVsbCE9ZS5wYXlsb2FkJiZlLmhhc093blByb3BlcnR5KCJwYXlsb2FkIikmJihyLnBheWxvYWQ9ZS5wYXlsb2FkKSxyfSxlLnByb3RvdHlwZS50b0pTT049ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci50b09iamVjdCh0aGlzLCRwcm90b2J1Zi51dGlsLnRvSlNPTk9wdGlvbnMpfSxlLmdldFR5cGVVcmw9ZnVuY3Rpb24oZSl7cmV0dXJuIHZvaWQgMD09PWUmJihlPSJ0eXBlLmdvb2dsZWFwaXMuY29tIiksZSsiL3Byb3RvY29sLk1ldGhvZCJ9LGV9KCksZS5VcGRhdGU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKGUpe2lmKGUpZm9yKHZhciB0PU9iamVjdC5rZXlzKGUpLHI9MDtyPHQubGVuZ3RoOysrciludWxsIT1lW3Rbcl1dJiYodGhpc1t0W3JdXT1lW3Rbcl1dKX1yZXR1cm4gZS5wcm90b3R5cGUudng9MCxlLnByb3RvdHlwZS52eT0wLGUucHJvdG90eXBlLnZ6PTAsZS5wcm90b3R5cGUudm94ZWw9MCxlLnByb3RvdHlwZS5saWdodD0wLGUuY3JlYXRlPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KX0sZS5lbmNvZGU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdHx8KHQ9JFdyaXRlci5jcmVhdGUoKSksbnVsbCE9ZS52eCYmT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoZSwidngiKSYmdC51aW50MzIoOCkuaW50MzIoZS52eCksbnVsbCE9ZS52eSYmT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoZSwidnkiKSYmdC51aW50MzIoMTYpLmludDMyKGUudnkpLG51bGwhPWUudnomJk9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsInZ6IikmJnQudWludDMyKDI0KS5pbnQzMihlLnZ6KSxudWxsIT1lLnZveGVsJiZPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChlLCJ2b3hlbCIpJiZ0LnVpbnQzMigzMikudWludDMyKGUudm94ZWwpLG51bGwhPWUubGlnaHQmJk9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsImxpZ2h0IikmJnQudWludDMyKDQwKS51aW50MzIoZS5saWdodCksdH0sZS5lbmNvZGVEZWxpbWl0ZWQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5lbmNvZGUoZSx0KS5sZGVsaW0oKX0sZS5kZWNvZGU9ZnVuY3Rpb24oZSx0KXtlIGluc3RhbmNlb2YgJFJlYWRlcnx8KGU9JFJlYWRlci5jcmVhdGUoZSkpO2Zvcih2YXIgcj12b2lkIDA9PT10P2UubGVuOmUucG9zK3Qsbz1uZXcgJHJvb3QucHJvdG9jb2wuVXBkYXRlO2UucG9zPHI7KXt2YXIgbj1lLnVpbnQzMigpO3N3aXRjaChuPj4+Myl7Y2FzZSAxOm8udng9ZS5pbnQzMigpO2JyZWFrO2Nhc2UgMjpvLnZ5PWUuaW50MzIoKTticmVhaztjYXNlIDM6by52ej1lLmludDMyKCk7YnJlYWs7Y2FzZSA0Om8udm94ZWw9ZS51aW50MzIoKTticmVhaztjYXNlIDU6by5saWdodD1lLnVpbnQzMigpO2JyZWFrO2RlZmF1bHQ6ZS5za2lwVHlwZSg3Jm4pfX1yZXR1cm4gb30sZS5kZWNvZGVEZWxpbWl0ZWQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGUgaW5zdGFuY2VvZiAkUmVhZGVyfHwoZT1uZXcgJFJlYWRlcihlKSksdGhpcy5kZWNvZGUoZSxlLnVpbnQzMigpKX0sZS52ZXJpZnk9ZnVuY3Rpb24oZSl7cmV0dXJuIm9iamVjdCIhPXR5cGVvZiBlfHxudWxsPT09ZT8ib2JqZWN0IGV4cGVjdGVkIjpudWxsIT1lLnZ4JiZlLmhhc093blByb3BlcnR5KCJ2eCIpJiYhJHV0aWwuaXNJbnRlZ2VyKGUudngpPyJ2eDogaW50ZWdlciBleHBlY3RlZCI6bnVsbCE9ZS52eSYmZS5oYXNPd25Qcm9wZXJ0eSgidnkiKSYmISR1dGlsLmlzSW50ZWdlcihlLnZ5KT8idnk6IGludGVnZXIgZXhwZWN0ZWQiOm51bGwhPWUudnomJmUuaGFzT3duUHJvcGVydHkoInZ6IikmJiEkdXRpbC5pc0ludGVnZXIoZS52eik/InZ6OiBpbnRlZ2VyIGV4cGVjdGVkIjpudWxsIT1lLnZveGVsJiZlLmhhc093blByb3BlcnR5KCJ2b3hlbCIpJiYhJHV0aWwuaXNJbnRlZ2VyKGUudm94ZWwpPyJ2b3hlbDogaW50ZWdlciBleHBlY3RlZCI6bnVsbCE9ZS5saWdodCYmZS5oYXNPd25Qcm9wZXJ0eSgibGlnaHQiKSYmISR1dGlsLmlzSW50ZWdlcihlLmxpZ2h0KT8ibGlnaHQ6IGludGVnZXIgZXhwZWN0ZWQiOm51bGx9LGUuZnJvbU9iamVjdD1mdW5jdGlvbihlKXtpZihlIGluc3RhbmNlb2YgJHJvb3QucHJvdG9jb2wuVXBkYXRlKXJldHVybiBlO3ZhciB0PW5ldyAkcm9vdC5wcm90b2NvbC5VcGRhdGU7cmV0dXJuIG51bGwhPWUudngmJih0LnZ4PTB8ZS52eCksbnVsbCE9ZS52eSYmKHQudnk9MHxlLnZ5KSxudWxsIT1lLnZ6JiYodC52ej0wfGUudnopLG51bGwhPWUudm94ZWwmJih0LnZveGVsPWUudm94ZWw+Pj4wKSxudWxsIT1lLmxpZ2h0JiYodC5saWdodD1lLmxpZ2h0Pj4+MCksdH0sZS50b09iamVjdD1mdW5jdGlvbihlLHQpe3R8fCh0PXt9KTt2YXIgcj17fTtyZXR1cm4gdC5kZWZhdWx0cyYmKHIudng9MCxyLnZ5PTAsci52ej0wLHIudm94ZWw9MCxyLmxpZ2h0PTApLG51bGwhPWUudngmJmUuaGFzT3duUHJvcGVydHkoInZ4IikmJihyLnZ4PWUudngpLG51bGwhPWUudnkmJmUuaGFzT3duUHJvcGVydHkoInZ5IikmJihyLnZ5PWUudnkpLG51bGwhPWUudnomJmUuaGFzT3duUHJvcGVydHkoInZ6IikmJihyLnZ6PWUudnopLG51bGwhPWUudm94ZWwmJmUuaGFzT3duUHJvcGVydHkoInZveGVsIikmJihyLnZveGVsPWUudm94ZWwpLG51bGwhPWUubGlnaHQmJmUuaGFzT3duUHJvcGVydHkoImxpZ2h0IikmJihyLmxpZ2h0PWUubGlnaHQpLHJ9LGUucHJvdG90eXBlLnRvSlNPTj1mdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbnN0cnVjdG9yLnRvT2JqZWN0KHRoaXMsJHByb3RvYnVmLnV0aWwudG9KU09OT3B0aW9ucyl9LGUuZ2V0VHlwZVVybD1mdW5jdGlvbihlKXtyZXR1cm4gdm9pZCAwPT09ZSYmKGU9InR5cGUuZ29vZ2xlYXBpcy5jb20iKSxlKyIvcHJvdG9jb2wuVXBkYXRlIn0sZX0oKSxlLkNoYXRNZXNzYWdlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShlKXtpZihlKWZvcih2YXIgdD1PYmplY3Qua2V5cyhlKSxyPTA7cjx0Lmxlbmd0aDsrK3IpbnVsbCE9ZVt0W3JdXSYmKHRoaXNbdFtyXV09ZVt0W3JdXSl9cmV0dXJuIGUucHJvdG90eXBlLnR5cGU9IiIsZS5wcm90b3R5cGUuc2VuZGVyPSIiLGUucHJvdG90eXBlLmJvZHk9IiIsZS5jcmVhdGU9ZnVuY3Rpb24odCl7cmV0dXJuIG5ldyBlKHQpfSxlLmVuY29kZT1mdW5jdGlvbihlLHQpe3JldHVybiB0fHwodD0kV3JpdGVyLmNyZWF0ZSgpKSxudWxsIT1lLnR5cGUmJk9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsInR5cGUiKSYmdC51aW50MzIoMTApLnN0cmluZyhlLnR5cGUpLG51bGwhPWUuc2VuZGVyJiZPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChlLCJzZW5kZXIiKSYmdC51aW50MzIoMTgpLnN0cmluZyhlLnNlbmRlciksbnVsbCE9ZS5ib2R5JiZPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChlLCJib2R5IikmJnQudWludDMyKDI2KS5zdHJpbmcoZS5ib2R5KSx0fSxlLmVuY29kZURlbGltaXRlZD1mdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLmVuY29kZShlLHQpLmxkZWxpbSgpfSxlLmRlY29kZT1mdW5jdGlvbihlLHQpe2UgaW5zdGFuY2VvZiAkUmVhZGVyfHwoZT0kUmVhZGVyLmNyZWF0ZShlKSk7Zm9yKHZhciByPXZvaWQgMD09PXQ/ZS5sZW46ZS5wb3MrdCxvPW5ldyAkcm9vdC5wcm90b2NvbC5DaGF0TWVzc2FnZTtlLnBvczxyOyl7dmFyIG49ZS51aW50MzIoKTtzd2l0Y2gobj4+PjMpe2Nhc2UgMTpvLnR5cGU9ZS5zdHJpbmcoKTticmVhaztjYXNlIDI6by5zZW5kZXI9ZS5zdHJpbmcoKTticmVhaztjYXNlIDM6by5ib2R5PWUuc3RyaW5nKCk7YnJlYWs7ZGVmYXVsdDplLnNraXBUeXBlKDcmbil9fXJldHVybiBvfSxlLmRlY29kZURlbGltaXRlZD1mdW5jdGlvbihlKXtyZXR1cm4gZSBpbnN0YW5jZW9mICRSZWFkZXJ8fChlPW5ldyAkUmVhZGVyKGUpKSx0aGlzLmRlY29kZShlLGUudWludDMyKCkpfSxlLnZlcmlmeT1mdW5jdGlvbihlKXtyZXR1cm4ib2JqZWN0IiE9dHlwZW9mIGV8fG51bGw9PT1lPyJvYmplY3QgZXhwZWN0ZWQiOm51bGwhPWUudHlwZSYmZS5oYXNPd25Qcm9wZXJ0eSgidHlwZSIpJiYhJHV0aWwuaXNTdHJpbmcoZS50eXBlKT8idHlwZTogc3RyaW5nIGV4cGVjdGVkIjpudWxsIT1lLnNlbmRlciYmZS5oYXNPd25Qcm9wZXJ0eSgic2VuZGVyIikmJiEkdXRpbC5pc1N0cmluZyhlLnNlbmRlcik/InNlbmRlcjogc3RyaW5nIGV4cGVjdGVkIjpudWxsIT1lLmJvZHkmJmUuaGFzT3duUHJvcGVydHkoImJvZHkiKSYmISR1dGlsLmlzU3RyaW5nKGUuYm9keSk/ImJvZHk6IHN0cmluZyBleHBlY3RlZCI6bnVsbH0sZS5mcm9tT2JqZWN0PWZ1bmN0aW9uKGUpe2lmKGUgaW5zdGFuY2VvZiAkcm9vdC5wcm90b2NvbC5DaGF0TWVzc2FnZSlyZXR1cm4gZTt2YXIgdD1uZXcgJHJvb3QucHJvdG9jb2wuQ2hhdE1lc3NhZ2U7cmV0dXJuIG51bGwhPWUudHlwZSYmKHQudHlwZT1TdHJpbmcoZS50eXBlKSksbnVsbCE9ZS5zZW5kZXImJih0LnNlbmRlcj1TdHJpbmcoZS5zZW5kZXIpKSxudWxsIT1lLmJvZHkmJih0LmJvZHk9U3RyaW5nKGUuYm9keSkpLHR9LGUudG9PYmplY3Q9ZnVuY3Rpb24oZSx0KXt0fHwodD17fSk7dmFyIHI9e307cmV0dXJuIHQuZGVmYXVsdHMmJihyLnR5cGU9IiIsci5zZW5kZXI9IiIsci5ib2R5PSIiKSxudWxsIT1lLnR5cGUmJmUuaGFzT3duUHJvcGVydHkoInR5cGUiKSYmKHIudHlwZT1lLnR5cGUpLG51bGwhPWUuc2VuZGVyJiZlLmhhc093blByb3BlcnR5KCJzZW5kZXIiKSYmKHIuc2VuZGVyPWUuc2VuZGVyKSxudWxsIT1lLmJvZHkmJmUuaGFzT3duUHJvcGVydHkoImJvZHkiKSYmKHIuYm9keT1lLmJvZHkpLHJ9LGUucHJvdG90eXBlLnRvSlNPTj1mdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbnN0cnVjdG9yLnRvT2JqZWN0KHRoaXMsJHByb3RvYnVmLnV0aWwudG9KU09OT3B0aW9ucyl9LGUuZ2V0VHlwZVVybD1mdW5jdGlvbihlKXtyZXR1cm4gdm9pZCAwPT09ZSYmKGU9InR5cGUuZ29vZ2xlYXBpcy5jb20iKSxlKyIvcHJvdG9jb2wuQ2hhdE1lc3NhZ2UifSxlfSgpLGUuTWVzc2FnZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSl7aWYodGhpcy5wZWVycz1bXSx0aGlzLmVudGl0aWVzPVtdLHRoaXMuY2h1bmtzPVtdLHRoaXMuZXZlbnRzPVtdLHRoaXMudXBkYXRlcz1bXSxlKWZvcih2YXIgdD1PYmplY3Qua2V5cyhlKSxyPTA7cjx0Lmxlbmd0aDsrK3IpbnVsbCE9ZVt0W3JdXSYmKHRoaXNbdFtyXV09ZVt0W3JdXSl9dmFyIHQscjtyZXR1cm4gZS5wcm90b3R5cGUudHlwZT0wLGUucHJvdG90eXBlLmpzb249IiIsZS5wcm90b3R5cGUudGV4dD0iIixlLnByb3RvdHlwZS5tZXRob2Q9bnVsbCxlLnByb3RvdHlwZS5jaGF0PW51bGwsZS5wcm90b3R5cGUucGVlcnM9JHV0aWwuZW1wdHlBcnJheSxlLnByb3RvdHlwZS5lbnRpdGllcz0kdXRpbC5lbXB0eUFycmF5LGUucHJvdG90eXBlLmNodW5rcz0kdXRpbC5lbXB0eUFycmF5LGUucHJvdG90eXBlLmV2ZW50cz0kdXRpbC5lbXB0eUFycmF5LGUucHJvdG90eXBlLnVwZGF0ZXM9JHV0aWwuZW1wdHlBcnJheSxlLmNyZWF0ZT1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCl9LGUuZW5jb2RlPWZ1bmN0aW9uKGUsdCl7aWYodHx8KHQ9JFdyaXRlci5jcmVhdGUoKSksbnVsbCE9ZS50eXBlJiZPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChlLCJ0eXBlIikmJnQudWludDMyKDgpLmludDMyKGUudHlwZSksbnVsbCE9ZS5qc29uJiZPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChlLCJqc29uIikmJnQudWludDMyKDE4KS5zdHJpbmcoZS5qc29uKSxudWxsIT1lLnRleHQmJk9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsInRleHQiKSYmdC51aW50MzIoMjYpLnN0cmluZyhlLnRleHQpLG51bGwhPWUubWV0aG9kJiZPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChlLCJtZXRob2QiKSYmJHJvb3QucHJvdG9jb2wuTWV0aG9kLmVuY29kZShlLm1ldGhvZCx0LnVpbnQzMigzNCkuZm9yaygpKS5sZGVsaW0oKSxudWxsIT1lLmNoYXQmJk9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsImNoYXQiKSYmJHJvb3QucHJvdG9jb2wuQ2hhdE1lc3NhZ2UuZW5jb2RlKGUuY2hhdCx0LnVpbnQzMig0MikuZm9yaygpKS5sZGVsaW0oKSxudWxsIT1lLnBlZXJzJiZlLnBlZXJzLmxlbmd0aClmb3IodmFyIHI9MDtyPGUucGVlcnMubGVuZ3RoOysrcikkcm9vdC5wcm90b2NvbC5QZWVyLmVuY29kZShlLnBlZXJzW3JdLHQudWludDMyKDUwKS5mb3JrKCkpLmxkZWxpbSgpO2lmKG51bGwhPWUuZW50aXRpZXMmJmUuZW50aXRpZXMubGVuZ3RoKWZvcihyPTA7cjxlLmVudGl0aWVzLmxlbmd0aDsrK3IpJHJvb3QucHJvdG9jb2wuRW50aXR5LmVuY29kZShlLmVudGl0aWVzW3JdLHQudWludDMyKDU4KS5mb3JrKCkpLmxkZWxpbSgpO2lmKG51bGwhPWUuY2h1bmtzJiZlLmNodW5rcy5sZW5ndGgpZm9yKHI9MDtyPGUuY2h1bmtzLmxlbmd0aDsrK3IpJHJvb3QucHJvdG9jb2wuQ2h1bmsuZW5jb2RlKGUuY2h1bmtzW3JdLHQudWludDMyKDY2KS5mb3JrKCkpLmxkZWxpbSgpO2lmKG51bGwhPWUuZXZlbnRzJiZlLmV2ZW50cy5sZW5ndGgpZm9yKHI9MDtyPGUuZXZlbnRzLmxlbmd0aDsrK3IpJHJvb3QucHJvdG9jb2wuRXZlbnQuZW5jb2RlKGUuZXZlbnRzW3JdLHQudWludDMyKDc0KS5mb3JrKCkpLmxkZWxpbSgpO2lmKG51bGwhPWUudXBkYXRlcyYmZS51cGRhdGVzLmxlbmd0aClmb3Iocj0wO3I8ZS51cGRhdGVzLmxlbmd0aDsrK3IpJHJvb3QucHJvdG9jb2wuVXBkYXRlLmVuY29kZShlLnVwZGF0ZXNbcl0sdC51aW50MzIoODIpLmZvcmsoKSkubGRlbGltKCk7cmV0dXJuIHR9LGUuZW5jb2RlRGVsaW1pdGVkPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuZW5jb2RlKGUsdCkubGRlbGltKCl9LGUuZGVjb2RlPWZ1bmN0aW9uKGUsdCl7ZSBpbnN0YW5jZW9mICRSZWFkZXJ8fChlPSRSZWFkZXIuY3JlYXRlKGUpKTtmb3IodmFyIHI9dm9pZCAwPT09dD9lLmxlbjplLnBvcyt0LG89bmV3ICRyb290LnByb3RvY29sLk1lc3NhZ2U7ZS5wb3M8cjspe3ZhciBuPWUudWludDMyKCk7c3dpdGNoKG4+Pj4zKXtjYXNlIDE6by50eXBlPWUuaW50MzIoKTticmVhaztjYXNlIDI6by5qc29uPWUuc3RyaW5nKCk7YnJlYWs7Y2FzZSAzOm8udGV4dD1lLnN0cmluZygpO2JyZWFrO2Nhc2UgNDpvLm1ldGhvZD0kcm9vdC5wcm90b2NvbC5NZXRob2QuZGVjb2RlKGUsZS51aW50MzIoKSk7YnJlYWs7Y2FzZSA1Om8uY2hhdD0kcm9vdC5wcm90b2NvbC5DaGF0TWVzc2FnZS5kZWNvZGUoZSxlLnVpbnQzMigpKTticmVhaztjYXNlIDY6by5wZWVycyYmby5wZWVycy5sZW5ndGh8fChvLnBlZXJzPVtdKSxvLnBlZXJzLnB1c2goJHJvb3QucHJvdG9jb2wuUGVlci5kZWNvZGUoZSxlLnVpbnQzMigpKSk7YnJlYWs7Y2FzZSA3Om8uZW50aXRpZXMmJm8uZW50aXRpZXMubGVuZ3RofHwoby5lbnRpdGllcz1bXSksby5lbnRpdGllcy5wdXNoKCRyb290LnByb3RvY29sLkVudGl0eS5kZWNvZGUoZSxlLnVpbnQzMigpKSk7YnJlYWs7Y2FzZSA4Om8uY2h1bmtzJiZvLmNodW5rcy5sZW5ndGh8fChvLmNodW5rcz1bXSksby5jaHVua3MucHVzaCgkcm9vdC5wcm90b2NvbC5DaHVuay5kZWNvZGUoZSxlLnVpbnQzMigpKSk7YnJlYWs7Y2FzZSA5Om8uZXZlbnRzJiZvLmV2ZW50cy5sZW5ndGh8fChvLmV2ZW50cz1bXSksby5ldmVudHMucHVzaCgkcm9vdC5wcm90b2NvbC5FdmVudC5kZWNvZGUoZSxlLnVpbnQzMigpKSk7YnJlYWs7Y2FzZSAxMDpvLnVwZGF0ZXMmJm8udXBkYXRlcy5sZW5ndGh8fChvLnVwZGF0ZXM9W10pLG8udXBkYXRlcy5wdXNoKCRyb290LnByb3RvY29sLlVwZGF0ZS5kZWNvZGUoZSxlLnVpbnQzMigpKSk7YnJlYWs7ZGVmYXVsdDplLnNraXBUeXBlKDcmbil9fXJldHVybiBvfSxlLmRlY29kZURlbGltaXRlZD1mdW5jdGlvbihlKXtyZXR1cm4gZSBpbnN0YW5jZW9mICRSZWFkZXJ8fChlPW5ldyAkUmVhZGVyKGUpKSx0aGlzLmRlY29kZShlLGUudWludDMyKCkpfSxlLnZlcmlmeT1mdW5jdGlvbihlKXtpZigib2JqZWN0IiE9dHlwZW9mIGV8fG51bGw9PT1lKXJldHVybiJvYmplY3QgZXhwZWN0ZWQiO2lmKG51bGwhPWUudHlwZSYmZS5oYXNPd25Qcm9wZXJ0eSgidHlwZSIpKXN3aXRjaChlLnR5cGUpe2RlZmF1bHQ6cmV0dXJuInR5cGU6IGVudW0gdmFsdWUgZXhwZWN0ZWQiO2Nhc2UgMDpjYXNlIDE6Y2FzZSAyOmNhc2UgMzpjYXNlIDQ6Y2FzZSA1OmNhc2UgNjpjYXNlIDc6Y2FzZSA4OmNhc2UgOTpjYXNlIDEwOmNhc2UgMTE6Y2FzZSAxMjpjYXNlIDEzOmNhc2UgMTQ6fWlmKG51bGwhPWUuanNvbiYmZS5oYXNPd25Qcm9wZXJ0eSgianNvbiIpJiYhJHV0aWwuaXNTdHJpbmcoZS5qc29uKSlyZXR1cm4ianNvbjogc3RyaW5nIGV4cGVjdGVkIjtpZihudWxsIT1lLnRleHQmJmUuaGFzT3duUHJvcGVydHkoInRleHQiKSYmISR1dGlsLmlzU3RyaW5nKGUudGV4dCkpcmV0dXJuInRleHQ6IHN0cmluZyBleHBlY3RlZCI7aWYobnVsbCE9ZS5tZXRob2QmJmUuaGFzT3duUHJvcGVydHkoIm1ldGhvZCIpJiYocj0kcm9vdC5wcm90b2NvbC5NZXRob2QudmVyaWZ5KGUubWV0aG9kKSkpcmV0dXJuIm1ldGhvZC4iK3I7aWYobnVsbCE9ZS5jaGF0JiZlLmhhc093blByb3BlcnR5KCJjaGF0IikmJihyPSRyb290LnByb3RvY29sLkNoYXRNZXNzYWdlLnZlcmlmeShlLmNoYXQpKSlyZXR1cm4iY2hhdC4iK3I7aWYobnVsbCE9ZS5wZWVycyYmZS5oYXNPd25Qcm9wZXJ0eSgicGVlcnMiKSl7aWYoIUFycmF5LmlzQXJyYXkoZS5wZWVycykpcmV0dXJuInBlZXJzOiBhcnJheSBleHBlY3RlZCI7Zm9yKHZhciB0PTA7dDxlLnBlZXJzLmxlbmd0aDsrK3Qpe2lmKHI9JHJvb3QucHJvdG9jb2wuUGVlci52ZXJpZnkoZS5wZWVyc1t0XSkpcmV0dXJuInBlZXJzLiIrcn19aWYobnVsbCE9ZS5lbnRpdGllcyYmZS5oYXNPd25Qcm9wZXJ0eSgiZW50aXRpZXMiKSl7aWYoIUFycmF5LmlzQXJyYXkoZS5lbnRpdGllcykpcmV0dXJuImVudGl0aWVzOiBhcnJheSBleHBlY3RlZCI7Zm9yKHQ9MDt0PGUuZW50aXRpZXMubGVuZ3RoOysrdCl7aWYocj0kcm9vdC5wcm90b2NvbC5FbnRpdHkudmVyaWZ5KGUuZW50aXRpZXNbdF0pKXJldHVybiJlbnRpdGllcy4iK3J9fWlmKG51bGwhPWUuY2h1bmtzJiZlLmhhc093blByb3BlcnR5KCJjaHVua3MiKSl7aWYoIUFycmF5LmlzQXJyYXkoZS5jaHVua3MpKXJldHVybiJjaHVua3M6IGFycmF5IGV4cGVjdGVkIjtmb3IodD0wO3Q8ZS5jaHVua3MubGVuZ3RoOysrdCl7aWYocj0kcm9vdC5wcm90b2NvbC5DaHVuay52ZXJpZnkoZS5jaHVua3NbdF0pKXJldHVybiJjaHVua3MuIityfX1pZihudWxsIT1lLmV2ZW50cyYmZS5oYXNPd25Qcm9wZXJ0eSgiZXZlbnRzIikpe2lmKCFBcnJheS5pc0FycmF5KGUuZXZlbnRzKSlyZXR1cm4iZXZlbnRzOiBhcnJheSBleHBlY3RlZCI7Zm9yKHQ9MDt0PGUuZXZlbnRzLmxlbmd0aDsrK3Qpe2lmKHI9JHJvb3QucHJvdG9jb2wuRXZlbnQudmVyaWZ5KGUuZXZlbnRzW3RdKSlyZXR1cm4iZXZlbnRzLiIrcn19aWYobnVsbCE9ZS51cGRhdGVzJiZlLmhhc093blByb3BlcnR5KCJ1cGRhdGVzIikpe2lmKCFBcnJheS5pc0FycmF5KGUudXBkYXRlcykpcmV0dXJuInVwZGF0ZXM6IGFycmF5IGV4cGVjdGVkIjtmb3IodD0wO3Q8ZS51cGRhdGVzLmxlbmd0aDsrK3Qpe3ZhciByO2lmKHI9JHJvb3QucHJvdG9jb2wuVXBkYXRlLnZlcmlmeShlLnVwZGF0ZXNbdF0pKXJldHVybiJ1cGRhdGVzLiIrcn19cmV0dXJuIG51bGx9LGUuZnJvbU9iamVjdD1mdW5jdGlvbihlKXtpZihlIGluc3RhbmNlb2YgJHJvb3QucHJvdG9jb2wuTWVzc2FnZSlyZXR1cm4gZTt2YXIgdD1uZXcgJHJvb3QucHJvdG9jb2wuTWVzc2FnZTtzd2l0Y2goZS50eXBlKXtkZWZhdWx0OmlmKCJudW1iZXIiPT10eXBlb2YgZS50eXBlKXt0LnR5cGU9ZS50eXBlO2JyZWFrfWJyZWFrO2Nhc2UiSU5JVCI6Y2FzZSAwOnQudHlwZT0wO2JyZWFrO2Nhc2UiSk9JTiI6Y2FzZSAxOnQudHlwZT0xO2JyZWFrO2Nhc2UiTEVBVkUiOmNhc2UgMjp0LnR5cGU9MjticmVhaztjYXNlIkVSUk9SIjpjYXNlIDM6dC50eXBlPTM7YnJlYWs7Y2FzZSJQRUVSIjpjYXNlIDQ6dC50eXBlPTQ7YnJlYWs7Y2FzZSJFTlRJVFkiOmNhc2UgNTp0LnR5cGU9NTticmVhaztjYXNlIkxPQUQiOmNhc2UgNjp0LnR5cGU9NjticmVhaztjYXNlIlVOTE9BRCI6Y2FzZSA3OnQudHlwZT03O2JyZWFrO2Nhc2UiVVBEQVRFIjpjYXNlIDg6dC50eXBlPTg7YnJlYWs7Y2FzZSJNRVRIT0QiOmNhc2UgOTp0LnR5cGU9OTticmVhaztjYXNlIkNIQVQiOmNhc2UgMTA6dC50eXBlPTEwO2JyZWFrO2Nhc2UiVFJBTlNQT1JUIjpjYXNlIDExOnQudHlwZT0xMTticmVhaztjYXNlIkVWRU5UIjpjYXNlIDEyOnQudHlwZT0xMjticmVhaztjYXNlIkFDVElPTiI6Y2FzZSAxMzp0LnR5cGU9MTM7YnJlYWs7Y2FzZSJTVEFUUyI6Y2FzZSAxNDp0LnR5cGU9MTR9aWYobnVsbCE9ZS5qc29uJiYodC5qc29uPVN0cmluZyhlLmpzb24pKSxudWxsIT1lLnRleHQmJih0LnRleHQ9U3RyaW5nKGUudGV4dCkpLG51bGwhPWUubWV0aG9kKXtpZigib2JqZWN0IiE9dHlwZW9mIGUubWV0aG9kKXRocm93IFR5cGVFcnJvcigiLnByb3RvY29sLk1lc3NhZ2UubWV0aG9kOiBvYmplY3QgZXhwZWN0ZWQiKTt0Lm1ldGhvZD0kcm9vdC5wcm90b2NvbC5NZXRob2QuZnJvbU9iamVjdChlLm1ldGhvZCl9aWYobnVsbCE9ZS5jaGF0KXtpZigib2JqZWN0IiE9dHlwZW9mIGUuY2hhdCl0aHJvdyBUeXBlRXJyb3IoIi5wcm90b2NvbC5NZXNzYWdlLmNoYXQ6IG9iamVjdCBleHBlY3RlZCIpO3QuY2hhdD0kcm9vdC5wcm90b2NvbC5DaGF0TWVzc2FnZS5mcm9tT2JqZWN0KGUuY2hhdCl9aWYoZS5wZWVycyl7aWYoIUFycmF5LmlzQXJyYXkoZS5wZWVycykpdGhyb3cgVHlwZUVycm9yKCIucHJvdG9jb2wuTWVzc2FnZS5wZWVyczogYXJyYXkgZXhwZWN0ZWQiKTt0LnBlZXJzPVtdO2Zvcih2YXIgcj0wO3I8ZS5wZWVycy5sZW5ndGg7KytyKXtpZigib2JqZWN0IiE9dHlwZW9mIGUucGVlcnNbcl0pdGhyb3cgVHlwZUVycm9yKCIucHJvdG9jb2wuTWVzc2FnZS5wZWVyczogb2JqZWN0IGV4cGVjdGVkIik7dC5wZWVyc1tyXT0kcm9vdC5wcm90b2NvbC5QZWVyLmZyb21PYmplY3QoZS5wZWVyc1tyXSl9fWlmKGUuZW50aXRpZXMpe2lmKCFBcnJheS5pc0FycmF5KGUuZW50aXRpZXMpKXRocm93IFR5cGVFcnJvcigiLnByb3RvY29sLk1lc3NhZ2UuZW50aXRpZXM6IGFycmF5IGV4cGVjdGVkIik7dC5lbnRpdGllcz1bXTtmb3Iocj0wO3I8ZS5lbnRpdGllcy5sZW5ndGg7KytyKXtpZigib2JqZWN0IiE9dHlwZW9mIGUuZW50aXRpZXNbcl0pdGhyb3cgVHlwZUVycm9yKCIucHJvdG9jb2wuTWVzc2FnZS5lbnRpdGllczogb2JqZWN0IGV4cGVjdGVkIik7dC5lbnRpdGllc1tyXT0kcm9vdC5wcm90b2NvbC5FbnRpdHkuZnJvbU9iamVjdChlLmVudGl0aWVzW3JdKX19aWYoZS5jaHVua3Mpe2lmKCFBcnJheS5pc0FycmF5KGUuY2h1bmtzKSl0aHJvdyBUeXBlRXJyb3IoIi5wcm90b2NvbC5NZXNzYWdlLmNodW5rczogYXJyYXkgZXhwZWN0ZWQiKTt0LmNodW5rcz1bXTtmb3Iocj0wO3I8ZS5jaHVua3MubGVuZ3RoOysrcil7aWYoIm9iamVjdCIhPXR5cGVvZiBlLmNodW5rc1tyXSl0aHJvdyBUeXBlRXJyb3IoIi5wcm90b2NvbC5NZXNzYWdlLmNodW5rczogb2JqZWN0IGV4cGVjdGVkIik7dC5jaHVua3Nbcl09JHJvb3QucHJvdG9jb2wuQ2h1bmsuZnJvbU9iamVjdChlLmNodW5rc1tyXSl9fWlmKGUuZXZlbnRzKXtpZighQXJyYXkuaXNBcnJheShlLmV2ZW50cykpdGhyb3cgVHlwZUVycm9yKCIucHJvdG9jb2wuTWVzc2FnZS5ldmVudHM6IGFycmF5IGV4cGVjdGVkIik7dC5ldmVudHM9W107Zm9yKHI9MDtyPGUuZXZlbnRzLmxlbmd0aDsrK3Ipe2lmKCJvYmplY3QiIT10eXBlb2YgZS5ldmVudHNbcl0pdGhyb3cgVHlwZUVycm9yKCIucHJvdG9jb2wuTWVzc2FnZS5ldmVudHM6IG9iamVjdCBleHBlY3RlZCIpO3QuZXZlbnRzW3JdPSRyb290LnByb3RvY29sLkV2ZW50LmZyb21PYmplY3QoZS5ldmVudHNbcl0pfX1pZihlLnVwZGF0ZXMpe2lmKCFBcnJheS5pc0FycmF5KGUudXBkYXRlcykpdGhyb3cgVHlwZUVycm9yKCIucHJvdG9jb2wuTWVzc2FnZS51cGRhdGVzOiBhcnJheSBleHBlY3RlZCIpO3QudXBkYXRlcz1bXTtmb3Iocj0wO3I8ZS51cGRhdGVzLmxlbmd0aDsrK3Ipe2lmKCJvYmplY3QiIT10eXBlb2YgZS51cGRhdGVzW3JdKXRocm93IFR5cGVFcnJvcigiLnByb3RvY29sLk1lc3NhZ2UudXBkYXRlczogb2JqZWN0IGV4cGVjdGVkIik7dC51cGRhdGVzW3JdPSRyb290LnByb3RvY29sLlVwZGF0ZS5mcm9tT2JqZWN0KGUudXBkYXRlc1tyXSl9fXJldHVybiB0fSxlLnRvT2JqZWN0PWZ1bmN0aW9uKGUsdCl7dHx8KHQ9e30pO3ZhciByPXt9O2lmKCh0LmFycmF5c3x8dC5kZWZhdWx0cykmJihyLnBlZXJzPVtdLHIuZW50aXRpZXM9W10sci5jaHVua3M9W10sci5ldmVudHM9W10sci51cGRhdGVzPVtdKSx0LmRlZmF1bHRzJiYoci50eXBlPXQuZW51bXM9PT1TdHJpbmc/IklOSVQiOjAsci5qc29uPSIiLHIudGV4dD0iIixyLm1ldGhvZD1udWxsLHIuY2hhdD1udWxsKSxudWxsIT1lLnR5cGUmJmUuaGFzT3duUHJvcGVydHkoInR5cGUiKSYmKHIudHlwZT10LmVudW1zPT09U3RyaW5nP3ZvaWQgMD09PSRyb290LnByb3RvY29sLk1lc3NhZ2UuVHlwZVtlLnR5cGVdP2UudHlwZTokcm9vdC5wcm90b2NvbC5NZXNzYWdlLlR5cGVbZS50eXBlXTplLnR5cGUpLG51bGwhPWUuanNvbiYmZS5oYXNPd25Qcm9wZXJ0eSgianNvbiIpJiYoci5qc29uPWUuanNvbiksbnVsbCE9ZS50ZXh0JiZlLmhhc093blByb3BlcnR5KCJ0ZXh0IikmJihyLnRleHQ9ZS50ZXh0KSxudWxsIT1lLm1ldGhvZCYmZS5oYXNPd25Qcm9wZXJ0eSgibWV0aG9kIikmJihyLm1ldGhvZD0kcm9vdC5wcm90b2NvbC5NZXRob2QudG9PYmplY3QoZS5tZXRob2QsdCkpLG51bGwhPWUuY2hhdCYmZS5oYXNPd25Qcm9wZXJ0eSgiY2hhdCIpJiYoci5jaGF0PSRyb290LnByb3RvY29sLkNoYXRNZXNzYWdlLnRvT2JqZWN0KGUuY2hhdCx0KSksZS5wZWVycyYmZS5wZWVycy5sZW5ndGgpe3IucGVlcnM9W107Zm9yKHZhciBvPTA7bzxlLnBlZXJzLmxlbmd0aDsrK28pci5wZWVyc1tvXT0kcm9vdC5wcm90b2NvbC5QZWVyLnRvT2JqZWN0KGUucGVlcnNbb10sdCl9aWYoZS5lbnRpdGllcyYmZS5lbnRpdGllcy5sZW5ndGgpe3IuZW50aXRpZXM9W107Zm9yKG89MDtvPGUuZW50aXRpZXMubGVuZ3RoOysrbylyLmVudGl0aWVzW29dPSRyb290LnByb3RvY29sLkVudGl0eS50b09iamVjdChlLmVudGl0aWVzW29dLHQpfWlmKGUuY2h1bmtzJiZlLmNodW5rcy5sZW5ndGgpe3IuY2h1bmtzPVtdO2ZvcihvPTA7bzxlLmNodW5rcy5sZW5ndGg7KytvKXIuY2h1bmtzW29dPSRyb290LnByb3RvY29sLkNodW5rLnRvT2JqZWN0KGUuY2h1bmtzW29dLHQpfWlmKGUuZXZlbnRzJiZlLmV2ZW50cy5sZW5ndGgpe3IuZXZlbnRzPVtdO2ZvcihvPTA7bzxlLmV2ZW50cy5sZW5ndGg7KytvKXIuZXZlbnRzW29dPSRyb290LnByb3RvY29sLkV2ZW50LnRvT2JqZWN0KGUuZXZlbnRzW29dLHQpfWlmKGUudXBkYXRlcyYmZS51cGRhdGVzLmxlbmd0aCl7ci51cGRhdGVzPVtdO2ZvcihvPTA7bzxlLnVwZGF0ZXMubGVuZ3RoOysrbylyLnVwZGF0ZXNbb109JHJvb3QucHJvdG9jb2wuVXBkYXRlLnRvT2JqZWN0KGUudXBkYXRlc1tvXSx0KX1yZXR1cm4gcn0sZS5wcm90b3R5cGUudG9KU09OPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29uc3RydWN0b3IudG9PYmplY3QodGhpcywkcHJvdG9idWYudXRpbC50b0pTT05PcHRpb25zKX0sZS5nZXRUeXBlVXJsPWZ1bmN0aW9uKGUpe3JldHVybiB2b2lkIDA9PT1lJiYoZT0idHlwZS5nb29nbGVhcGlzLmNvbSIpLGUrIi9wcm90b2NvbC5NZXNzYWdlIn0sZS5UeXBlPSh0PXt9LChyPU9iamVjdC5jcmVhdGUodCkpW3RbMF09IklOSVQiXT0wLHJbdFsxXT0iSk9JTiJdPTEsclt0WzJdPSJMRUFWRSJdPTIsclt0WzNdPSJFUlJPUiJdPTMsclt0WzRdPSJQRUVSIl09NCxyW3RbNV09IkVOVElUWSJdPTUsclt0WzZdPSJMT0FEIl09NixyW3RbN109IlVOTE9BRCJdPTcsclt0WzhdPSJVUERBVEUiXT04LHJbdFs5XT0iTUVUSE9EIl09OSxyW3RbMTBdPSJDSEFUIl09MTAsclt0WzExXT0iVFJBTlNQT1JUIl09MTEsclt0WzEyXT0iRVZFTlQiXT0xMixyW3RbMTNdPSJBQ1RJT04iXT0xMyxyW3RbMTRdPSJTVEFUUyJdPTE0LHIpLGV9KCksZX0oKSwkcm9vdC5nb29nbGU9KGdvb2dsZT17fSxnb29nbGUucHJvdG9idWY9KChwcm90b2J1Zj17fSkuU3RydWN0PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShlKXtpZih0aGlzLmZpZWxkcz17fSxlKWZvcih2YXIgdD1PYmplY3Qua2V5cyhlKSxyPTA7cjx0Lmxlbmd0aDsrK3IpbnVsbCE9ZVt0W3JdXSYmKHRoaXNbdFtyXV09ZVt0W3JdXSl9cmV0dXJuIGUucHJvdG90eXBlLmZpZWxkcz0kdXRpbC5lbXB0eU9iamVjdCxlLmNyZWF0ZT1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCl9LGUuZW5jb2RlPWZ1bmN0aW9uKGUsdCl7aWYodHx8KHQ9JFdyaXRlci5jcmVhdGUoKSksbnVsbCE9ZS5maWVsZHMmJk9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsImZpZWxkcyIpKWZvcih2YXIgcj1PYmplY3Qua2V5cyhlLmZpZWxkcyksbz0wO288ci5sZW5ndGg7KytvKXQudWludDMyKDEwKS5mb3JrKCkudWludDMyKDEwKS5zdHJpbmcocltvXSksJHJvb3QuZ29vZ2xlLnByb3RvYnVmLlZhbHVlLmVuY29kZShlLmZpZWxkc1tyW29dXSx0LnVpbnQzMigxOCkuZm9yaygpKS5sZGVsaW0oKS5sZGVsaW0oKTtyZXR1cm4gdH0sZS5lbmNvZGVEZWxpbWl0ZWQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5lbmNvZGUoZSx0KS5sZGVsaW0oKX0sZS5kZWNvZGU9ZnVuY3Rpb24oZSx0KXtlIGluc3RhbmNlb2YgJFJlYWRlcnx8KGU9JFJlYWRlci5jcmVhdGUoZSkpO2Zvcih2YXIgcixvLG49dm9pZCAwPT09dD9lLmxlbjplLnBvcyt0LGk9bmV3ICRyb290Lmdvb2dsZS5wcm90b2J1Zi5TdHJ1Y3Q7ZS5wb3M8bjspe3ZhciBsPWUudWludDMyKCk7aWYobD4+PjM9PTEpe2kuZmllbGRzPT09JHV0aWwuZW1wdHlPYmplY3QmJihpLmZpZWxkcz17fSk7dmFyIHM9ZS51aW50MzIoKStlLnBvcztmb3Iocj0iIixvPW51bGw7ZS5wb3M8czspe3ZhciBhPWUudWludDMyKCk7c3dpdGNoKGE+Pj4zKXtjYXNlIDE6cj1lLnN0cmluZygpO2JyZWFrO2Nhc2UgMjpvPSRyb290Lmdvb2dsZS5wcm90b2J1Zi5WYWx1ZS5kZWNvZGUoZSxlLnVpbnQzMigpKTticmVhaztkZWZhdWx0OmUuc2tpcFR5cGUoNyZhKX19aS5maWVsZHNbcl09b31lbHNlIGUuc2tpcFR5cGUoNyZsKX1yZXR1cm4gaX0sZS5kZWNvZGVEZWxpbWl0ZWQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGUgaW5zdGFuY2VvZiAkUmVhZGVyfHwoZT1uZXcgJFJlYWRlcihlKSksdGhpcy5kZWNvZGUoZSxlLnVpbnQzMigpKX0sZS52ZXJpZnk9ZnVuY3Rpb24oZSl7aWYoIm9iamVjdCIhPXR5cGVvZiBlfHxudWxsPT09ZSlyZXR1cm4ib2JqZWN0IGV4cGVjdGVkIjtpZihudWxsIT1lLmZpZWxkcyYmZS5oYXNPd25Qcm9wZXJ0eSgiZmllbGRzIikpe2lmKCEkdXRpbC5pc09iamVjdChlLmZpZWxkcykpcmV0dXJuImZpZWxkczogb2JqZWN0IGV4cGVjdGVkIjtmb3IodmFyIHQ9T2JqZWN0LmtleXMoZS5maWVsZHMpLHI9MDtyPHQubGVuZ3RoOysrcil7dmFyIG89JHJvb3QuZ29vZ2xlLnByb3RvYnVmLlZhbHVlLnZlcmlmeShlLmZpZWxkc1t0W3JdXSk7aWYobylyZXR1cm4iZmllbGRzLiIrb319cmV0dXJuIG51bGx9LGUuZnJvbU9iamVjdD1mdW5jdGlvbihlKXtpZihlIGluc3RhbmNlb2YgJHJvb3QuZ29vZ2xlLnByb3RvYnVmLlN0cnVjdClyZXR1cm4gZTt2YXIgdD1uZXcgJHJvb3QuZ29vZ2xlLnByb3RvYnVmLlN0cnVjdDtpZihlLmZpZWxkcyl7aWYoIm9iamVjdCIhPXR5cGVvZiBlLmZpZWxkcyl0aHJvdyBUeXBlRXJyb3IoIi5nb29nbGUucHJvdG9idWYuU3RydWN0LmZpZWxkczogb2JqZWN0IGV4cGVjdGVkIik7dC5maWVsZHM9e307Zm9yKHZhciByPU9iamVjdC5rZXlzKGUuZmllbGRzKSxvPTA7bzxyLmxlbmd0aDsrK28pe2lmKCJvYmplY3QiIT10eXBlb2YgZS5maWVsZHNbcltvXV0pdGhyb3cgVHlwZUVycm9yKCIuZ29vZ2xlLnByb3RvYnVmLlN0cnVjdC5maWVsZHM6IG9iamVjdCBleHBlY3RlZCIpO3QuZmllbGRzW3Jbb11dPSRyb290Lmdvb2dsZS5wcm90b2J1Zi5WYWx1ZS5mcm9tT2JqZWN0KGUuZmllbGRzW3Jbb11dKX19cmV0dXJuIHR9LGUudG9PYmplY3Q9ZnVuY3Rpb24oZSx0KXt0fHwodD17fSk7dmFyIHIsbz17fTtpZigodC5vYmplY3RzfHx0LmRlZmF1bHRzKSYmKG8uZmllbGRzPXt9KSxlLmZpZWxkcyYmKHI9T2JqZWN0LmtleXMoZS5maWVsZHMpKS5sZW5ndGgpe28uZmllbGRzPXt9O2Zvcih2YXIgbj0wO248ci5sZW5ndGg7KytuKW8uZmllbGRzW3Jbbl1dPSRyb290Lmdvb2dsZS5wcm90b2J1Zi5WYWx1ZS50b09iamVjdChlLmZpZWxkc1tyW25dXSx0KX1yZXR1cm4gb30sZS5wcm90b3R5cGUudG9KU09OPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29uc3RydWN0b3IudG9PYmplY3QodGhpcywkcHJvdG9idWYudXRpbC50b0pTT05PcHRpb25zKX0sZS5nZXRUeXBlVXJsPWZ1bmN0aW9uKGUpe3JldHVybiB2b2lkIDA9PT1lJiYoZT0idHlwZS5nb29nbGVhcGlzLmNvbSIpLGUrIi9nb29nbGUucHJvdG9idWYuU3RydWN0In0sZX0oKSxwcm90b2J1Zi5WYWx1ZT1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSl7aWYoZSlmb3IodmFyIHQ9T2JqZWN0LmtleXMoZSkscj0wO3I8dC5sZW5ndGg7KytyKW51bGwhPWVbdFtyXV0mJih0aGlzW3Rbcl1dPWVbdFtyXV0pfXZhciB0O3JldHVybiBlLnByb3RvdHlwZS5udWxsVmFsdWU9bnVsbCxlLnByb3RvdHlwZS5udW1iZXJWYWx1ZT1udWxsLGUucHJvdG90eXBlLnN0cmluZ1ZhbHVlPW51bGwsZS5wcm90b3R5cGUuYm9vbFZhbHVlPW51bGwsZS5wcm90b3R5cGUuc3RydWN0VmFsdWU9bnVsbCxlLnByb3RvdHlwZS5saXN0VmFsdWU9bnVsbCxPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsImtpbmQiLHtnZXQ6JHV0aWwub25lT2ZHZXR0ZXIodD1bIm51bGxWYWx1ZSIsIm51bWJlclZhbHVlIiwic3RyaW5nVmFsdWUiLCJib29sVmFsdWUiLCJzdHJ1Y3RWYWx1ZSIsImxpc3RWYWx1ZSJdKSxzZXQ6JHV0aWwub25lT2ZTZXR0ZXIodCl9KSxlLmNyZWF0ZT1mdW5jdGlvbih0KXtyZXR1cm4gbmV3IGUodCl9LGUuZW5jb2RlPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHR8fCh0PSRXcml0ZXIuY3JlYXRlKCkpLG51bGwhPWUubnVsbFZhbHVlJiZPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChlLCJudWxsVmFsdWUiKSYmdC51aW50MzIoOCkuaW50MzIoZS5udWxsVmFsdWUpLG51bGwhPWUubnVtYmVyVmFsdWUmJk9iamVjdC5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIm51bWJlclZhbHVlIikmJnQudWludDMyKDE3KS5kb3VibGUoZS5udW1iZXJWYWx1ZSksbnVsbCE9ZS5zdHJpbmdWYWx1ZSYmT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoZSwic3RyaW5nVmFsdWUiKSYmdC51aW50MzIoMjYpLnN0cmluZyhlLnN0cmluZ1ZhbHVlKSxudWxsIT1lLmJvb2xWYWx1ZSYmT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwoZSwiYm9vbFZhbHVlIikmJnQudWludDMyKDMyKS5ib29sKGUuYm9vbFZhbHVlKSxudWxsIT1lLnN0cnVjdFZhbHVlJiZPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChlLCJzdHJ1Y3RWYWx1ZSIpJiYkcm9vdC5nb29nbGUucHJvdG9idWYuU3RydWN0LmVuY29kZShlLnN0cnVjdFZhbHVlLHQudWludDMyKDQyKS5mb3JrKCkpLmxkZWxpbSgpLG51bGwhPWUubGlzdFZhbHVlJiZPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChlLCJsaXN0VmFsdWUiKSYmJHJvb3QuZ29vZ2xlLnByb3RvYnVmLkxpc3RWYWx1ZS5lbmNvZGUoZS5saXN0VmFsdWUsdC51aW50MzIoNTApLmZvcmsoKSkubGRlbGltKCksdH0sZS5lbmNvZGVEZWxpbWl0ZWQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5lbmNvZGUoZSx0KS5sZGVsaW0oKX0sZS5kZWNvZGU9ZnVuY3Rpb24oZSx0KXtlIGluc3RhbmNlb2YgJFJlYWRlcnx8KGU9JFJlYWRlci5jcmVhdGUoZSkpO2Zvcih2YXIgcj12b2lkIDA9PT10P2UubGVuOmUucG9zK3Qsbz1uZXcgJHJvb3QuZ29vZ2xlLnByb3RvYnVmLlZhbHVlO2UucG9zPHI7KXt2YXIgbj1lLnVpbnQzMigpO3N3aXRjaChuPj4+Myl7Y2FzZSAxOm8ubnVsbFZhbHVlPWUuaW50MzIoKTticmVhaztjYXNlIDI6by5udW1iZXJWYWx1ZT1lLmRvdWJsZSgpO2JyZWFrO2Nhc2UgMzpvLnN0cmluZ1ZhbHVlPWUuc3RyaW5nKCk7YnJlYWs7Y2FzZSA0Om8uYm9vbFZhbHVlPWUuYm9vbCgpO2JyZWFrO2Nhc2UgNTpvLnN0cnVjdFZhbHVlPSRyb290Lmdvb2dsZS5wcm90b2J1Zi5TdHJ1Y3QuZGVjb2RlKGUsZS51aW50MzIoKSk7YnJlYWs7Y2FzZSA2Om8ubGlzdFZhbHVlPSRyb290Lmdvb2dsZS5wcm90b2J1Zi5MaXN0VmFsdWUuZGVjb2RlKGUsZS51aW50MzIoKSk7YnJlYWs7ZGVmYXVsdDplLnNraXBUeXBlKDcmbil9fXJldHVybiBvfSxlLmRlY29kZURlbGltaXRlZD1mdW5jdGlvbihlKXtyZXR1cm4gZSBpbnN0YW5jZW9mICRSZWFkZXJ8fChlPW5ldyAkUmVhZGVyKGUpKSx0aGlzLmRlY29kZShlLGUudWludDMyKCkpfSxlLnZlcmlmeT1mdW5jdGlvbihlKXtpZigib2JqZWN0IiE9dHlwZW9mIGV8fG51bGw9PT1lKXJldHVybiJvYmplY3QgZXhwZWN0ZWQiO3ZhciB0PXt9O2lmKG51bGwhPWUubnVsbFZhbHVlJiZlLmhhc093blByb3BlcnR5KCJudWxsVmFsdWUiKSYmKHQua2luZD0xLDAhPT1lLm51bGxWYWx1ZSkpcmV0dXJuIm51bGxWYWx1ZTogZW51bSB2YWx1ZSBleHBlY3RlZCI7aWYobnVsbCE9ZS5udW1iZXJWYWx1ZSYmZS5oYXNPd25Qcm9wZXJ0eSgibnVtYmVyVmFsdWUiKSl7aWYoMT09PXQua2luZClyZXR1cm4ia2luZDogbXVsdGlwbGUgdmFsdWVzIjtpZih0LmtpbmQ9MSwibnVtYmVyIiE9dHlwZW9mIGUubnVtYmVyVmFsdWUpcmV0dXJuIm51bWJlclZhbHVlOiBudW1iZXIgZXhwZWN0ZWQifWlmKG51bGwhPWUuc3RyaW5nVmFsdWUmJmUuaGFzT3duUHJvcGVydHkoInN0cmluZ1ZhbHVlIikpe2lmKDE9PT10LmtpbmQpcmV0dXJuImtpbmQ6IG11bHRpcGxlIHZhbHVlcyI7aWYodC5raW5kPTEsISR1dGlsLmlzU3RyaW5nKGUuc3RyaW5nVmFsdWUpKXJldHVybiJzdHJpbmdWYWx1ZTogc3RyaW5nIGV4cGVjdGVkIn1pZihudWxsIT1lLmJvb2xWYWx1ZSYmZS5oYXNPd25Qcm9wZXJ0eSgiYm9vbFZhbHVlIikpe2lmKDE9PT10LmtpbmQpcmV0dXJuImtpbmQ6IG11bHRpcGxlIHZhbHVlcyI7aWYodC5raW5kPTEsImJvb2xlYW4iIT10eXBlb2YgZS5ib29sVmFsdWUpcmV0dXJuImJvb2xWYWx1ZTogYm9vbGVhbiBleHBlY3RlZCJ9aWYobnVsbCE9ZS5zdHJ1Y3RWYWx1ZSYmZS5oYXNPd25Qcm9wZXJ0eSgic3RydWN0VmFsdWUiKSl7aWYoMT09PXQua2luZClyZXR1cm4ia2luZDogbXVsdGlwbGUgdmFsdWVzIjtpZih0LmtpbmQ9MSxyPSRyb290Lmdvb2dsZS5wcm90b2J1Zi5TdHJ1Y3QudmVyaWZ5KGUuc3RydWN0VmFsdWUpKXJldHVybiJzdHJ1Y3RWYWx1ZS4iK3J9aWYobnVsbCE9ZS5saXN0VmFsdWUmJmUuaGFzT3duUHJvcGVydHkoImxpc3RWYWx1ZSIpKXtpZigxPT09dC5raW5kKXJldHVybiJraW5kOiBtdWx0aXBsZSB2YWx1ZXMiO3ZhciByO2lmKHQua2luZD0xLHI9JHJvb3QuZ29vZ2xlLnByb3RvYnVmLkxpc3RWYWx1ZS52ZXJpZnkoZS5saXN0VmFsdWUpKXJldHVybiJsaXN0VmFsdWUuIityfXJldHVybiBudWxsfSxlLmZyb21PYmplY3Q9ZnVuY3Rpb24oZSl7aWYoZSBpbnN0YW5jZW9mICRyb290Lmdvb2dsZS5wcm90b2J1Zi5WYWx1ZSlyZXR1cm4gZTt2YXIgdD1uZXcgJHJvb3QuZ29vZ2xlLnByb3RvYnVmLlZhbHVlO3N3aXRjaChlLm51bGxWYWx1ZSl7ZGVmYXVsdDppZigibnVtYmVyIj09dHlwZW9mIGUubnVsbFZhbHVlKXt0Lm51bGxWYWx1ZT1lLm51bGxWYWx1ZTticmVha31icmVhaztjYXNlIk5VTExfVkFMVUUiOmNhc2UgMDp0Lm51bGxWYWx1ZT0wfWlmKG51bGwhPWUubnVtYmVyVmFsdWUmJih0Lm51bWJlclZhbHVlPU51bWJlcihlLm51bWJlclZhbHVlKSksbnVsbCE9ZS5zdHJpbmdWYWx1ZSYmKHQuc3RyaW5nVmFsdWU9U3RyaW5nKGUuc3RyaW5nVmFsdWUpKSxudWxsIT1lLmJvb2xWYWx1ZSYmKHQuYm9vbFZhbHVlPUJvb2xlYW4oZS5ib29sVmFsdWUpKSxudWxsIT1lLnN0cnVjdFZhbHVlKXtpZigib2JqZWN0IiE9dHlwZW9mIGUuc3RydWN0VmFsdWUpdGhyb3cgVHlwZUVycm9yKCIuZ29vZ2xlLnByb3RvYnVmLlZhbHVlLnN0cnVjdFZhbHVlOiBvYmplY3QgZXhwZWN0ZWQiKTt0LnN0cnVjdFZhbHVlPSRyb290Lmdvb2dsZS5wcm90b2J1Zi5TdHJ1Y3QuZnJvbU9iamVjdChlLnN0cnVjdFZhbHVlKX1pZihudWxsIT1lLmxpc3RWYWx1ZSl7aWYoIm9iamVjdCIhPXR5cGVvZiBlLmxpc3RWYWx1ZSl0aHJvdyBUeXBlRXJyb3IoIi5nb29nbGUucHJvdG9idWYuVmFsdWUubGlzdFZhbHVlOiBvYmplY3QgZXhwZWN0ZWQiKTt0Lmxpc3RWYWx1ZT0kcm9vdC5nb29nbGUucHJvdG9idWYuTGlzdFZhbHVlLmZyb21PYmplY3QoZS5saXN0VmFsdWUpfXJldHVybiB0fSxlLnRvT2JqZWN0PWZ1bmN0aW9uKGUsdCl7dHx8KHQ9e30pO3ZhciByPXt9O3JldHVybiBudWxsIT1lLm51bGxWYWx1ZSYmZS5oYXNPd25Qcm9wZXJ0eSgibnVsbFZhbHVlIikmJihyLm51bGxWYWx1ZT10LmVudW1zPT09U3RyaW5nP3ZvaWQgMD09PSRyb290Lmdvb2dsZS5wcm90b2J1Zi5OdWxsVmFsdWVbZS5udWxsVmFsdWVdP2UubnVsbFZhbHVlOiRyb290Lmdvb2dsZS5wcm90b2J1Zi5OdWxsVmFsdWVbZS5udWxsVmFsdWVdOmUubnVsbFZhbHVlLHQub25lb2ZzJiYoci5raW5kPSJudWxsVmFsdWUiKSksbnVsbCE9ZS5udW1iZXJWYWx1ZSYmZS5oYXNPd25Qcm9wZXJ0eSgibnVtYmVyVmFsdWUiKSYmKHIubnVtYmVyVmFsdWU9dC5qc29uJiYhaXNGaW5pdGUoZS5udW1iZXJWYWx1ZSk/U3RyaW5nKGUubnVtYmVyVmFsdWUpOmUubnVtYmVyVmFsdWUsdC5vbmVvZnMmJihyLmtpbmQ9Im51bWJlclZhbHVlIikpLG51bGwhPWUuc3RyaW5nVmFsdWUmJmUuaGFzT3duUHJvcGVydHkoInN0cmluZ1ZhbHVlIikmJihyLnN0cmluZ1ZhbHVlPWUuc3RyaW5nVmFsdWUsdC5vbmVvZnMmJihyLmtpbmQ9InN0cmluZ1ZhbHVlIikpLG51bGwhPWUuYm9vbFZhbHVlJiZlLmhhc093blByb3BlcnR5KCJib29sVmFsdWUiKSYmKHIuYm9vbFZhbHVlPWUuYm9vbFZhbHVlLHQub25lb2ZzJiYoci5raW5kPSJib29sVmFsdWUiKSksbnVsbCE9ZS5zdHJ1Y3RWYWx1ZSYmZS5oYXNPd25Qcm9wZXJ0eSgic3RydWN0VmFsdWUiKSYmKHIuc3RydWN0VmFsdWU9JHJvb3QuZ29vZ2xlLnByb3RvYnVmLlN0cnVjdC50b09iamVjdChlLnN0cnVjdFZhbHVlLHQpLHQub25lb2ZzJiYoci5raW5kPSJzdHJ1Y3RWYWx1ZSIpKSxudWxsIT1lLmxpc3RWYWx1ZSYmZS5oYXNPd25Qcm9wZXJ0eSgibGlzdFZhbHVlIikmJihyLmxpc3RWYWx1ZT0kcm9vdC5nb29nbGUucHJvdG9idWYuTGlzdFZhbHVlLnRvT2JqZWN0KGUubGlzdFZhbHVlLHQpLHQub25lb2ZzJiYoci5raW5kPSJsaXN0VmFsdWUiKSkscn0sZS5wcm90b3R5cGUudG9KU09OPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29uc3RydWN0b3IudG9PYmplY3QodGhpcywkcHJvdG9idWYudXRpbC50b0pTT05PcHRpb25zKX0sZS5nZXRUeXBlVXJsPWZ1bmN0aW9uKGUpe3JldHVybiB2b2lkIDA9PT1lJiYoZT0idHlwZS5nb29nbGVhcGlzLmNvbSIpLGUrIi9nb29nbGUucHJvdG9idWYuVmFsdWUifSxlfSgpLHByb3RvYnVmLk51bGxWYWx1ZT0odmFsdWVzQnlJZD17fSwodmFsdWVzPU9iamVjdC5jcmVhdGUodmFsdWVzQnlJZCkpW3ZhbHVlc0J5SWRbMF09Ik5VTExfVkFMVUUiXT0wLHZhbHVlcykscHJvdG9idWYuTGlzdFZhbHVlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShlKXtpZih0aGlzLnZhbHVlcz1bXSxlKWZvcih2YXIgdD1PYmplY3Qua2V5cyhlKSxyPTA7cjx0Lmxlbmd0aDsrK3IpbnVsbCE9ZVt0W3JdXSYmKHRoaXNbdFtyXV09ZVt0W3JdXSl9cmV0dXJuIGUucHJvdG90eXBlLnZhbHVlcz0kdXRpbC5lbXB0eUFycmF5LGUuY3JlYXRlPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgZSh0KX0sZS5lbmNvZGU9ZnVuY3Rpb24oZSx0KXtpZih0fHwodD0kV3JpdGVyLmNyZWF0ZSgpKSxudWxsIT1lLnZhbHVlcyYmZS52YWx1ZXMubGVuZ3RoKWZvcih2YXIgcj0wO3I8ZS52YWx1ZXMubGVuZ3RoOysrcikkcm9vdC5nb29nbGUucHJvdG9idWYuVmFsdWUuZW5jb2RlKGUudmFsdWVzW3JdLHQudWludDMyKDEwKS5mb3JrKCkpLmxkZWxpbSgpO3JldHVybiB0fSxlLmVuY29kZURlbGltaXRlZD1mdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLmVuY29kZShlLHQpLmxkZWxpbSgpfSxlLmRlY29kZT1mdW5jdGlvbihlLHQpe2UgaW5zdGFuY2VvZiAkUmVhZGVyfHwoZT0kUmVhZGVyLmNyZWF0ZShlKSk7Zm9yKHZhciByPXZvaWQgMD09PXQ/ZS5sZW46ZS5wb3MrdCxvPW5ldyAkcm9vdC5nb29nbGUucHJvdG9idWYuTGlzdFZhbHVlO2UucG9zPHI7KXt2YXIgbj1lLnVpbnQzMigpO24+Pj4zPT0xPyhvLnZhbHVlcyYmby52YWx1ZXMubGVuZ3RofHwoby52YWx1ZXM9W10pLG8udmFsdWVzLnB1c2goJHJvb3QuZ29vZ2xlLnByb3RvYnVmLlZhbHVlLmRlY29kZShlLGUudWludDMyKCkpKSk6ZS5za2lwVHlwZSg3Jm4pfXJldHVybiBvfSxlLmRlY29kZURlbGltaXRlZD1mdW5jdGlvbihlKXtyZXR1cm4gZSBpbnN0YW5jZW9mICRSZWFkZXJ8fChlPW5ldyAkUmVhZGVyKGUpKSx0aGlzLmRlY29kZShlLGUudWludDMyKCkpfSxlLnZlcmlmeT1mdW5jdGlvbihlKXtpZigib2JqZWN0IiE9dHlwZW9mIGV8fG51bGw9PT1lKXJldHVybiJvYmplY3QgZXhwZWN0ZWQiO2lmKG51bGwhPWUudmFsdWVzJiZlLmhhc093blByb3BlcnR5KCJ2YWx1ZXMiKSl7aWYoIUFycmF5LmlzQXJyYXkoZS52YWx1ZXMpKXJldHVybiJ2YWx1ZXM6IGFycmF5IGV4cGVjdGVkIjtmb3IodmFyIHQ9MDt0PGUudmFsdWVzLmxlbmd0aDsrK3Qpe3ZhciByPSRyb290Lmdvb2dsZS5wcm90b2J1Zi5WYWx1ZS52ZXJpZnkoZS52YWx1ZXNbdF0pO2lmKHIpcmV0dXJuInZhbHVlcy4iK3J9fXJldHVybiBudWxsfSxlLmZyb21PYmplY3Q9ZnVuY3Rpb24oZSl7aWYoZSBpbnN0YW5jZW9mICRyb290Lmdvb2dsZS5wcm90b2J1Zi5MaXN0VmFsdWUpcmV0dXJuIGU7dmFyIHQ9bmV3ICRyb290Lmdvb2dsZS5wcm90b2J1Zi5MaXN0VmFsdWU7aWYoZS52YWx1ZXMpe2lmKCFBcnJheS5pc0FycmF5KGUudmFsdWVzKSl0aHJvdyBUeXBlRXJyb3IoIi5nb29nbGUucHJvdG9idWYuTGlzdFZhbHVlLnZhbHVlczogYXJyYXkgZXhwZWN0ZWQiKTt0LnZhbHVlcz1bXTtmb3IodmFyIHI9MDtyPGUudmFsdWVzLmxlbmd0aDsrK3Ipe2lmKCJvYmplY3QiIT10eXBlb2YgZS52YWx1ZXNbcl0pdGhyb3cgVHlwZUVycm9yKCIuZ29vZ2xlLnByb3RvYnVmLkxpc3RWYWx1ZS52YWx1ZXM6IG9iamVjdCBleHBlY3RlZCIpO3QudmFsdWVzW3JdPSRyb290Lmdvb2dsZS5wcm90b2J1Zi5WYWx1ZS5mcm9tT2JqZWN0KGUudmFsdWVzW3JdKX19cmV0dXJuIHR9LGUudG9PYmplY3Q9ZnVuY3Rpb24oZSx0KXt0fHwodD17fSk7dmFyIHI9e307aWYoKHQuYXJyYXlzfHx0LmRlZmF1bHRzKSYmKHIudmFsdWVzPVtdKSxlLnZhbHVlcyYmZS52YWx1ZXMubGVuZ3RoKXtyLnZhbHVlcz1bXTtmb3IodmFyIG89MDtvPGUudmFsdWVzLmxlbmd0aDsrK28pci52YWx1ZXNbb109JHJvb3QuZ29vZ2xlLnByb3RvYnVmLlZhbHVlLnRvT2JqZWN0KGUudmFsdWVzW29dLHQpfXJldHVybiByfSxlLnByb3RvdHlwZS50b0pTT049ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci50b09iamVjdCh0aGlzLCRwcm90b2J1Zi51dGlsLnRvSlNPTk9wdGlvbnMpfSxlLmdldFR5cGVVcmw9ZnVuY3Rpb24oZSl7cmV0dXJuIHZvaWQgMD09PWUmJihlPSJ0eXBlLmdvb2dsZWFwaXMuY29tIiksZSsiL2dvb2dsZS5wcm90b2J1Zi5MaXN0VmFsdWUifSxlfSgpLHByb3RvYnVmKSxnb29nbGUpO3ZhciBwcm90b2NvbD0kcm9vdCx1OD1VaW50OEFycmF5LHUxNj1VaW50MTZBcnJheSx1MzI9VWludDMyQXJyYXksZmxlYj1uZXcgdTgoWzAsMCwwLDAsMCwwLDAsMCwxLDEsMSwxLDIsMiwyLDIsMywzLDMsMyw0LDQsNCw0LDUsNSw1LDUsMCwwLDAsMF0pLGZkZWI9bmV3IHU4KFswLDAsMCwwLDEsMSwyLDIsMywzLDQsNCw1LDUsNiw2LDcsNyw4LDgsOSw5LDEwLDEwLDExLDExLDEyLDEyLDEzLDEzLDAsMF0pLGNsaW09bmV3IHU4KFsxNiwxNywxOCwwLDgsNyw5LDYsMTAsNSwxMSw0LDEyLDMsMTMsMiwxNCwxLDE1XSksZnJlYj1mdW5jdGlvbihlLHQpe2Zvcih2YXIgcj1uZXcgdTE2KDMxKSxvPTA7bzwzMTsrK28pcltvXT10Kz0xPDxlW28tMV07dmFyIG49bmV3IHUzMihyWzMwXSk7Zm9yKG89MTtvPDMwOysrbylmb3IodmFyIGk9cltvXTtpPHJbbysxXTsrK2kpbltpXT1pLXJbb108PDV8bztyZXR1cm5bcixuXX0sX2E9ZnJlYihmbGViLDIpLGZsPV9hWzBdLHJldmZsPV9hWzFdO2ZsWzI4XT0yNTgscmV2ZmxbMjU4XT0yODtmb3IodmFyIF9iPWZyZWIoZmRlYiwwKSxmZD1fYlswXSxyZXY9bmV3IHUxNigzMjc2OCksaT0wO2k8MzI3Njg7KytpKXt2YXIgeD0oNDM2OTAmaSk+Pj4xfCgyMTg0NSZpKTw8MTt4PSg1MjQyOCZ4KT4+PjJ8KDEzMTA3JngpPDwyLHg9KDYxNjgwJngpPj4+NHwoMzg1NSZ4KTw8NCxyZXZbaV09KCg2NTI4MCZ4KT4+Pjh8KDI1NSZ4KTw8OCk+Pj4xfWZvcih2YXIgaE1hcD1mdW5jdGlvbihlLHQscil7Zm9yKHZhciBvPWUubGVuZ3RoLG49MCxpPW5ldyB1MTYodCk7bjxvOysrbillW25dJiYrK2lbZVtuXS0xXTt2YXIgbCxzPW5ldyB1MTYodCk7Zm9yKG49MDtuPHQ7KytuKXNbbl09c1tuLTFdK2lbbi0xXTw8MTtpZihyKXtsPW5ldyB1MTYoMTw8dCk7dmFyIGE9MTUtdDtmb3Iobj0wO248bzsrK24paWYoZVtuXSlmb3IodmFyIHU9bjw8NHxlW25dLGM9dC1lW25dLGY9c1tlW25dLTFdKys8PGMscD1mfCgxPDxjKS0xO2Y8PXA7KytmKWxbcmV2W2ZdPj4+YV09dX1lbHNlIGZvcihsPW5ldyB1MTYobyksbj0wO248bzsrK24pZVtuXSYmKGxbbl09cmV2W3NbZVtuXS0xXSsrXT4+PjE1LWVbbl0pO3JldHVybiBsfSxmbHQ9bmV3IHU4KDI4OCksaT0wO2k8MTQ0OysraSlmbHRbaV09ODtmb3IodmFyIGk9MTQ0O2k8MjU2OysraSlmbHRbaV09OTtmb3IodmFyIGk9MjU2O2k8MjgwOysraSlmbHRbaV09Nztmb3IodmFyIGk9MjgwO2k8Mjg4OysraSlmbHRbaV09ODtmb3IodmFyIGZkdD1uZXcgdTgoMzIpLGk9MDtpPDMyOysraSlmZHRbaV09NTt2YXIgZmxybT1oTWFwKGZsdCw5LDEpLGZkcm09aE1hcChmZHQsNSwxKSxtYXg9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PWVbMF0scj0xO3I8ZS5sZW5ndGg7KytyKWVbcl0+dCYmKHQ9ZVtyXSk7cmV0dXJuIHR9LGJpdHM9ZnVuY3Rpb24oZSx0LHIpe3ZhciBvPXQvOHwwO3JldHVybihlW29dfGVbbysxXTw8OCk+Pig3JnQpJnJ9LGJpdHMxNj1mdW5jdGlvbihlLHQpe3ZhciByPXQvOHwwO3JldHVybihlW3JdfGVbcisxXTw8OHxlW3IrMl08PDE2KT4+KDcmdCl9LHNoZnQ9ZnVuY3Rpb24oZSl7cmV0dXJuKGUrNykvOHwwfSxzbGM9ZnVuY3Rpb24oZSx0LHIpeyhudWxsPT10fHx0PDApJiYodD0wKSwobnVsbD09cnx8cj5lLmxlbmd0aCkmJihyPWUubGVuZ3RoKTt2YXIgbz1uZXcoMj09ZS5CWVRFU19QRVJfRUxFTUVOVD91MTY6ND09ZS5CWVRFU19QRVJfRUxFTUVOVD91MzI6dTgpKHItdCk7cmV0dXJuIG8uc2V0KGUuc3ViYXJyYXkodCxyKSksb30sZWM9WyJ1bmV4cGVjdGVkIEVPRiIsImludmFsaWQgYmxvY2sgdHlwZSIsImludmFsaWQgbGVuZ3RoL2xpdGVyYWwiLCJpbnZhbGlkIGRpc3RhbmNlIiwic3RyZWFtIGZpbmlzaGVkIiwibm8gc3RyZWFtIGhhbmRsZXIiLCwibm8gY2FsbGJhY2siLCJpbnZhbGlkIFVURi04IGRhdGEiLCJleHRyYSBmaWVsZCB0b28gbG9uZyIsImRhdGUgbm90IGluIHJhbmdlIDE5ODAtMjA5OSIsImZpbGVuYW1lIHRvbyBsb25nIiwic3RyZWFtIGZpbmlzaGluZyIsImludmFsaWQgemlwIGRhdGEiXSxlcnI9ZnVuY3Rpb24oZSx0LHIpe3ZhciBvPW5ldyBFcnJvcih0fHxlY1tlXSk7aWYoby5jb2RlPWUsRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UmJkVycm9yLmNhcHR1cmVTdGFja1RyYWNlKG8sZXJyKSwhcil0aHJvdyBvO3JldHVybiBvfSxpbmZsdD1mdW5jdGlvbihlLHQscil7dmFyIG89ZS5sZW5ndGg7aWYoIW98fHImJnIuZiYmIXIubClyZXR1cm4gdHx8bmV3IHU4KDApO3ZhciBuPSF0fHxyLGk9IXJ8fHIuaTtyfHwocj17fSksdHx8KHQ9bmV3IHU4KDMqbykpO3ZhciBsPWZ1bmN0aW9uKGUpe3ZhciByPXQubGVuZ3RoO2lmKGU+cil7dmFyIG89bmV3IHU4KE1hdGgubWF4KDIqcixlKSk7by5zZXQodCksdD1vfX0scz1yLmZ8fDAsYT1yLnB8fDAsdT1yLmJ8fDAsYz1yLmwsZj1yLmQscD1yLm0saD1yLm4sZD04Km87ZG97aWYoIWMpe3M9Yml0cyhlLGEsMSk7dmFyIHk9Yml0cyhlLGErMSwzKTtpZihhKz0zLCF5KXt2YXIgZz1lWyhWPXNoZnQoYSkrNCktNF18ZVtWLTNdPDw4LHY9VitnO2lmKHY+byl7aSYmZXJyKDApO2JyZWFrfW4mJmwodStnKSx0LnNldChlLnN1YmFycmF5KFYsdiksdSksci5iPXUrPWcsci5wPWE9OCp2LHIuZj1zO2NvbnRpbnVlfWlmKDE9PXkpYz1mbHJtLGY9ZmRybSxwPTksaD01O2Vsc2UgaWYoMj09eSl7dmFyIGI9Yml0cyhlLGEsMzEpKzI1NyxtPWJpdHMoZSxhKzEwLDE1KSs0LCQ9YitiaXRzKGUsYSs1LDMxKSsxO2ErPTE0O2Zvcih2YXIgTz1uZXcgdTgoJCksdz1uZXcgdTgoMTkpLHg9MDt4PG07Kyt4KXdbY2xpbVt4XV09Yml0cyhlLGErMyp4LDcpO2ErPTMqbTt2YXIgaj1tYXgodyksaz0oMTw8aiktMSxFPWhNYXAodyxqLDEpO2Zvcih4PTA7eDwkOyl7dmFyIFYsQT1FW2JpdHMoZSxhLGspXTtpZihhKz0xNSZBLChWPUE+Pj40KTwxNilPW3grK109VjtlbHNle3ZhciBQPTAsUz0wO2ZvcigxNj09Vj8oUz0zK2JpdHMoZSxhLDMpLGErPTIsUD1PW3gtMV0pOjE3PT1WPyhTPTMrYml0cyhlLGEsNyksYSs9Myk6MTg9PVYmJihTPTExK2JpdHMoZSxhLDEyNyksYSs9Nyk7Uy0tOylPW3grK109UH19dmFyIEI9Ty5zdWJhcnJheSgwLGIpLFI9Ty5zdWJhcnJheShiKTtwPW1heChCKSxoPW1heChSKSxjPWhNYXAoQixwLDEpLGY9aE1hcChSLGgsMSl9ZWxzZSBlcnIoMSk7aWYoYT5kKXtpJiZlcnIoMCk7YnJlYWt9fW4mJmwodSsxMzEwNzIpO2Zvcih2YXIgVD0oMTw8cCktMSxMPSgxPDxoKS0xLE49YTs7Tj1hKXt2YXIgTT0oUD1jW2JpdHMxNihlLGEpJlRdKT4+PjQ7aWYoKGErPTE1JlApPmQpe2kmJmVycigwKTticmVha31pZihQfHxlcnIoMiksTTwyNTYpdFt1KytdPU07ZWxzZXtpZigyNTY9PU0pe049YSxjPW51bGw7YnJlYWt9dmFyIF89TS0yNTQ7aWYoTT4yNjQpe3ZhciBXPWZsZWJbeD1NLTI1N107Xz1iaXRzKGUsYSwoMTw8VyktMSkrZmxbeF0sYSs9V312YXIgej1mW2JpdHMxNihlLGEpJkxdLFU9ej4+PjQ7enx8ZXJyKDMpLGErPTE1Jno7Uj1mZFtVXTtpZihVPjMpe1c9ZmRlYltVXTtSKz1iaXRzMTYoZSxhKSYoMTw8VyktMSxhKz1XfWlmKGE+ZCl7aSYmZXJyKDApO2JyZWFrfW4mJmwodSsxMzEwNzIpO2Zvcih2YXIgQz11K187dTxDO3UrPTQpdFt1XT10W3UtUl0sdFt1KzFdPXRbdSsxLVJdLHRbdSsyXT10W3UrMi1SXSx0W3UrM109dFt1KzMtUl07dT1DfX1yLmw9YyxyLnA9TixyLmI9dSxyLmY9cyxjJiYocz0xLHIubT1wLHIuZD1mLHIubj1oKX13aGlsZSghcyk7cmV0dXJuIHU9PXQubGVuZ3RoP3Q6c2xjKHQsMCx1KX0sZXQ9bmV3IHU4KDApLHpsdj1mdW5jdGlvbihlKXsoOCE9KDE1JmVbMF0pfHxlWzBdPj4+ND43fHwoZVswXTw8OHxlWzFdKSUzMSkmJmVycig2LCJpbnZhbGlkIHpsaWIgZGF0YSIpLDMyJmVbMV0mJmVycig2LCJpbnZhbGlkIHpsaWIgZGF0YTogcHJlc2V0IGRpY3Rpb25hcmllcyBub3Qgc3VwcG9ydGVkIil9O2Z1bmN0aW9uIHVuemxpYlN5bmMoZSx0KXtyZXR1cm4gaW5mbHQoKHpsdihlKSxlLnN1YmFycmF5KDIsLTQpKSx0KX12YXIgdGQ9InVuZGVmaW5lZCIhPXR5cGVvZiBUZXh0RGVjb2RlciYmbmV3IFRleHREZWNvZGVyLHRkcz0wO3RyeXt0ZC5kZWNvZGUoZXQse3N0cmVhbTohMH0pLHRkcz0xfWNhdGNoKGUpe31jb25zdHtNZXNzYWdlOk1lc3NhZ2UsRW50aXR5OkVudGl0eX09cHJvdG9jb2wucHJvdG9jb2w7b25jb25uZWN0PWU9Pntjb25zdCB0PWUucG9ydHNbMF07dC5vbm1lc3NhZ2U9ZT0+e2xldHtkYXRhOnJ9PWU7QXJyYXkuaXNBcnJheShyKXx8KHI9W3JdKTtjb25zdCBvPVtdLG49ci5tYXAoKGU9PnsxMjA9PT1lWzBdJiYxNTY9PT1lWzFdJiYoZT11bnpsaWJTeW5jKGUpKTtjb25zdCB0PU1lc3NhZ2UudG9PYmplY3QoTWVzc2FnZS5kZWNvZGUoZSkse2RlZmF1bHRzOiEwfSk7cmV0dXJuIHQudHlwZT1NZXNzYWdlLlR5cGVbdC50eXBlXSx0Lmpzb24mJih0Lmpzb249SlNPTi5wYXJzZSh0Lmpzb24pKSx0LmVudGl0aWVzJiZ0LmVudGl0aWVzLmZvckVhY2goKGU9PntlLm1ldGFkYXRhJiYoZS5tZXRhZGF0YT1KU09OLnBhcnNlKGUubWV0YWRhdGEpKSxlLm9wZXJhdGlvbj1FbnRpdHkuT3BlcmF0aW9uW2Uub3BlcmF0aW9uXX0pKSx0LnBlZXJzJiZ0LnBlZXJzLmZvckVhY2goKGU9PntlLm1ldGFkYXRhJiYoZS5tZXRhZGF0YT1KU09OLnBhcnNlKGUubWV0YWRhdGEpKX0pKSx0LmV2ZW50cyYmdC5ldmVudHMuZm9yRWFjaCgoZT0+e2UucGF5bG9hZD1KU09OLnBhcnNlKGUucGF5bG9hZCl9KSksdC5jaHVua3MmJnQuY2h1bmtzLmZvckVhY2goKGU9PntbImxpZ2h0cyIsInZveGVscyJdLmZvckVhY2goKHQ9PntlW3RdJiYoZVt0XT1uZXcgVWludDMyQXJyYXkoZVt0XSkuYnVmZmVyLG8ucHVzaChlW3RdKSl9KSksZS5tZXNoJiYoWyJpbmRpY2VzIiwibGlnaHRzIl0uZm9yRWFjaCgodD0+e2NvbnN0e29wYXF1ZTpyLHRyYW5zcGFyZW50Om59PWUubWVzaDtbcixuXS5mb3JFYWNoKChlPT57ZSYmZVt0XSYmKGVbdF09bmV3IEludDMyQXJyYXkoZVt0XSkuYnVmZmVyLG8ucHVzaChlW3RdKSl9KSl9KSksWyJwb3NpdGlvbnMiLCJ1dnMiXS5mb3JFYWNoKCh0PT57Y29uc3R7b3BhcXVlOnIsdHJhbnNwYXJlbnQ6bn09ZS5tZXNoO1tyLG5dLmZvckVhY2goKGU9PntlJiZlW3RdJiYoZVt0XT1uZXcgRmxvYXQzMkFycmF5KGVbdF0pLmJ1ZmZlcixvLnB1c2goZVt0XSkpfSkpfSkpKX0pKSx0fSkpO3QucG9zdE1lc3NhZ2UobixvKX19fSkoKTsKCg==",null,!1);function _defineProperty$3(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},o=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(i).filter((function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable})))),o.forEach((function(e){_defineProperty$3(t,e,i[e])}))}return t}const{Message:Message}=protocol.protocol,defaultOptions={maxPacketsPerTick:8};class Network{get concurrentWorkers(){return this.pool.workingCount}get packetQueueLength(){return this.packetQueue.length}static encodeSync(t){return t.json&&(t.json=JSON.stringify(t.json)),t.type=Message.Type[t.type],t.entities&&t.entities.forEach((t=>t.metadata=JSON.stringify(t.metadata))),t.peers&&t.peers.forEach((t=>t.metadata=JSON.stringify(t.metadata))),protocol.protocol.Message.encode(protocol.protocol.Message.create(t)).finish()}constructor(t){var e=this;void 0===t&&(t={}),_defineProperty$3(this,"options",void 0),_defineProperty$3(this,"clientInfo",{id:"",username:""}),_defineProperty$3(this,"intercepts",[]),_defineProperty$3(this,"ws",void 0),_defineProperty$3(this,"url",void 0),_defineProperty$3(this,"world",void 0),_defineProperty$3(this,"socket",void 0),_defineProperty$3(this,"connected",!1),_defineProperty$3(this,"joined",!1),_defineProperty$3(this,"onJoin",void 0),_defineProperty$3(this,"onLeave",void 0),_defineProperty$3(this,"onConnect",void 0),_defineProperty$3(this,"onDisconnect",void 0),_defineProperty$3(this,"pool",new SharedWorkerPool(WorkerFactory,{maxWorker:window.navigator.hardwareConcurrency||4})),_defineProperty$3(this,"reconnection",void 0),_defineProperty$3(this,"joinResolve",null),_defineProperty$3(this,"joinReject",null),_defineProperty$3(this,"packetQueue",[]),_defineProperty$3(this,"connect",(async function(t,i){if(void 0===i&&(i={}),!t)throw new Error("No server URL provided.");if("string"!=typeof t)throw new Error("Server URL must be a string.");e.url=new DOMUrl(t),e.url.protocol=e.url.protocol.replace(/ws/,"http"),e.url.hash="";const o=new DOMUrl(t);o.path="/ws/",e.socket=new URL(o.toString()),e.socket.protocol=e.socket.protocol.replace(/http/,"ws"),e.socket.hash="",e.socket.searchParams.set("secret",i.secret||""),e.socket.searchParams.set("client_id",e.clientInfo.id||"");let n=Math.floor(1e4*Math.random()).toString();return n=new Array(1e4.toString().length-n.length).fill("0").join("")+n,e.clientInfo.username=`Guest ${n}`,e.ws&&(e.ws.onclose=null,e.ws.onmessage=null,e.ws.close(),e.reconnection&&clearTimeout(e.reconnection)),new Promise((o=>{const n=new WebSocket(e.socket.toString());n.binaryType="arraybuffer",n.sendEvent=t=>{n.send(Network.encodeSync(t))},n.onopen=()=>{var t;e.connected=!0,null===(t=e.onConnect)||void 0===t||t.call(e),clearTimeout(e.reconnection),o(e)},n.onerror=console.error,n.onmessage=t=>{let{data:i}=t;e.packetQueue.push(i)},n.onclose=()=>{var o;e.connected=!1,null===(o=e.onDisconnect)||void 0===o||o.call(e),i.reconnectTimeout&&(e.reconnection=setTimeout((()=>{e.connect(t,i)}),i.reconnectTimeout))},e.ws=n}))})),_defineProperty$3(this,"join",(async t=>(this.joined&&this.leave(),this.joined=!0,this.world=t,this.send({type:"JOIN",json:{world:t,username:this.clientInfo.username}}),new Promise(((t,e)=>{this.joinResolve=t,this.joinReject=e}))))),_defineProperty$3(this,"leave",(()=>{this.joined&&(this.joined=!1,this.send({type:"LEAVE",text:this.world}))})),_defineProperty$3(this,"action",(async(t,e)=>{this.send({type:"ACTION",json:{action:t,data:e}})})),_defineProperty$3(this,"sync",(()=>{this.connected&&this.packetQueue.length&&!this.pool.isBusy&&this.decode(this.packetQueue.splice(0,Math.min(this.options.maxPacketsPerTick,this.packetQueue.length)).map((t=>new Uint8Array(t)))).then((async t=>{t.forEach((t=>{this.onMessage(t)}))}))})),_defineProperty$3(this,"flush",(()=>{this.intercepts.forEach((t=>{t.packets&&t.packets.length&&t.packets.splice(0,t.packets.length).forEach((t=>{this.send(t)}))}))})),_defineProperty$3(this,"register",(function(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return i.forEach((t=>{e.intercepts.push(t)})),e})),_defineProperty$3(this,"unregister",(function(){for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return i.forEach((t=>{const i=e.intercepts.indexOf(t);-1!==i&&e.intercepts.splice(i,1)})),e})),_defineProperty$3(this,"disconnect",(()=>{this.connected&&(this.ws&&(this.ws.onclose=null,this.ws.onmessage=null,this.ws.close()),this.reconnection&&clearTimeout(this.reconnection))})),_defineProperty$3(this,"send",(t=>{this.ws.sendEvent(t)})),_defineProperty$3(this,"setID",(t=>{this.clientInfo.id=t||""})),_defineProperty$3(this,"setUsername",(t=>{this.clientInfo.username=t||" "})),_defineProperty$3(this,"onMessage",(async t=>{const{type:e}=t;if("ERROR"===e){const{text:e}=t;return this.disconnect(),void this.joinReject(e)}if("INIT"===e){const{id:e}=t.json;if(e){if(this.clientInfo.id&&this.clientInfo.id!==e)throw new Error("Something went wrong with IDs! Better check if you're passing two same ID's to the same Voxelize server.");this.clientInfo.id=e}}if(this.intercepts.forEach((e=>{var i;null===(i=e.onMessage)||void 0===i||i.call(e,t,this.clientInfo)})),"INIT"===e){var i;if(!this.joinResolve)throw new Error("Something went wrong with joining worlds...");this.joinResolve(this),null===(i=this.onJoin)||void 0===i||i.call(this,this.world)}})),_defineProperty$3(this,"decode",(async t=>new Promise((e=>{this.pool.addJob({message:t,buffers:t.map((t=>t.buffer)),resolve:e})})))),this.options=_objectSpread({},defaultOptions,t),setWorkerInterval((()=>{this.flush(),this.sync()}),1e3/60)}}function _defineProperty$2(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Chat{send(t){if(t.body.startsWith(this._commandSymbol)){const e=t.body.substring(this._commandSymbol.length).split(" ").filter(Boolean),i=e.shift(),o=e.join(" "),n=this.commands.get(i);if(n)return void n(o.trim())}this.packets.push({type:"CHAT",chat:t})}addCommand(t,e,i){if(void 0===i&&(i=[]),this.commands.has(t))throw new Error(`Command trigger already taken: ${t}`);if(t.split(" ").length>1)throw new Error("Command trigger must be one word.");this.commands.set(t,e);for(const o of i)this.commands.has(o)?console.warn(`Command alias for "${t}", "${o}" ignored as already taken.`):this.commands.set(o,e)}removeCommand(t){return!!this.commands.delete(t)}get commandSymbol(){return this._commandSymbol}constructor(){_defineProperty$2(this,"commands",new Map),_defineProperty$2(this,"packets",[]),_defineProperty$2(this,"_commandSymbol",void 0),_defineProperty$2(this,"onChat",void 0),_defineProperty$2(this,"onMessage",(t=>{switch(t.type){case"INIT":{const{commandSymbol:e}=t.json.options;this._commandSymbol=e;break}case"CHAT":{var e;const{chat:i}=t;null===(e=this.onChat)||void 0===e||e.call(this,i);break}}}))}}var getRandomValues,rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&!(getRandomValues="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}var REGEX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate(t){return"string"==typeof t&&REGEX.test(t)}for(var byteToHex=[],i=0;i<256;++i)byteToHex.push((i+256).toString(16).substr(1));function stringify(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(byteToHex[t[e+0]]+byteToHex[t[e+1]]+byteToHex[t[e+2]]+byteToHex[t[e+3]]+"-"+byteToHex[t[e+4]]+byteToHex[t[e+5]]+"-"+byteToHex[t[e+6]]+byteToHex[t[e+7]]+"-"+byteToHex[t[e+8]]+byteToHex[t[e+9]]+"-"+byteToHex[t[e+10]]+byteToHex[t[e+11]]+byteToHex[t[e+12]]+byteToHex[t[e+13]]+byteToHex[t[e+14]]+byteToHex[t[e+15]]).toLowerCase();if(!validate(i))throw TypeError("Stringified UUID is invalid");return i}function v4(t,e,i){var o=(t=t||{}).random||(t.rng||rng)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e){i=i||0;for(var n=0;n<16;++n)e[i+n]=o[n];return e}return stringify(o)}function _defineProperty$1(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Inputs extends events.exports.EventEmitter{on(t,e){return super.on(t,e),this}constructor(){var t;super(),t=this,_defineProperty$1(this,"namespace",void 0),_defineProperty$1(this,"clickCallbacks",new Map),_defineProperty$1(this,"scrollCallbacks",new Map),_defineProperty$1(this,"keyDownCallbacks",new Map),_defineProperty$1(this,"keyUpCallbacks",new Map),_defineProperty$1(this,"keyPressCallbacks",new Map),_defineProperty$1(this,"keyBounds",new Map),_defineProperty$1(this,"unbinds",[]),_defineProperty$1(this,"click",(function(e,i,o){var n;void 0===o&&(o="*");const s=v4();return null===(n=t.clickCallbacks.get(e))||void 0===n||n.set(s,{namespace:o,callback:i}),()=>t.clickCallbacks.get(e).delete(s)})),_defineProperty$1(this,"scroll",(function(e,i,o){void 0===o&&(o="*");const n=v4();return t.scrollCallbacks.set(n,{up:e,down:i,namespace:o}),()=>t.scrollCallbacks.delete(n)})),_defineProperty$1(this,"bind",(function(e,i,o,n){void 0===o&&(o="*"),void 0===n&&(n={}),e=t.modifyKey(e);const{occasion:s="keydown",identifier:r="default"}=n,l=e+s,a=t.keyBounds.get(l);if(a&&a[r])throw new Error(`Error registering input, key ${e}: already bound.`);switch(s){case"keydown":t.keyDownCallbacks.set(l,[...t.keyDownCallbacks.get(l)||[],i]);break;case"keyup":t.keyUpCallbacks.set(l,[...t.keyUpCallbacks.get(l)||[],i]);break;case"keypress":t.keyPressCallbacks.set(l,[...t.keyPressCallbacks.get(l)||[],i])}const d=t.keyBounds.get(l)||{},c=()=>{[["keydown",t.keyDownCallbacks],["keyup",t.keyUpCallbacks],["keypress",t.keyPressCallbacks]].forEach((t=>{let[e,o]=t;var n;if(e!==s)return;const r=o.get(l);if(r){const t=r.indexOf(i);-1!==t&&r.splice(t,1)}0===(null===(n=o.get(l))||void 0===n?void 0:n.length)&&o.delete(l)})),delete d[r]};return d[r]={unbind:c,callback:i,namespace:o},t.keyBounds.set(l,d),c})),_defineProperty$1(this,"unbind",(function(e,i){void 0===i&&(i={}),e=t.modifyKey(e);const{occasion:o="keydown",identifier:n="default"}=i,s=e+o,r=(t.keyBounds.get(s)||{})[n];if(r){const{unbind:t}=r;return t(),!0}return!1})),_defineProperty$1(this,"swap",(function(e,i,o){void 0===o&&(o={}),e=t.modifyKey(e),i=t.modifyKey(i);const{occasion:n="keydown",identifier:s="default"}=o,r=e+n,l=i+n,a=(t.keyBounds.get(r)||{})[s],d=(t.keyBounds.get(l)||{})[s];if(!a)throw new Error(`Key ${r} is not bound.`);if(!d)throw new Error(`Key ${l} is not bound.`);const{unbind:c,callback:h,namespace:u}=a,{unbind:p,callback:m,namespace:b}=d;c(),p(),t.bind(i,h,u,o),t.bind(e,m,b,o)})),_defineProperty$1(this,"remap",(function(e,i,o){void 0===o&&(o={}),e=t.modifyKey(e);const{occasion:n="keydown",identifier:s="default"}=o,r=e+n,l=(t.keyBounds.get(r)||{})[s];if(!l)throw new Error(`Key ${r} is not bound.`);const{unbind:a,callback:d,namespace:c}=l;a(),t.bind(i,d,c,o)})),_defineProperty$1(this,"setNamespace",(t=>{this.namespace=t,this.emit("namespace",t)})),_defineProperty$1(this,"reset",(()=>{this.keyBounds.forEach((t=>Object.values(t).forEach((t=>t.unbind())))),this.unbinds.forEach((t=>t()))})),_defineProperty$1(this,"modifyKey",(t=>(t.length>1?t.charAt(0).toUpperCase()+t.slice(1):t).toLowerCase())),_defineProperty$1(this,"initializeKeyListeners",(()=>{const t=t=>e=>{const{key:i,code:o}=e,n=(i||o).toLowerCase()+t,s=this.keyBounds.get(n);s&&Object.values(s).forEach((t=>{const{callback:e,namespace:i}=t;"*"!==i&&i!==this.namespace||e()}))};document.addEventListener("keydown",t("keydown")),document.addEventListener("keyup",t("keyup")),document.addEventListener("keypress",t("keypress"))})),_defineProperty$1(this,"initializeClickListeners",(()=>{["left","middle","right"].forEach((t=>this.clickCallbacks.set(t,new Map)));const t=t=>{let e,{button:i}=t;0===i?e=this.clickCallbacks.get("left"):1===i?e=this.clickCallbacks.get("middle"):2===i&&(e=this.clickCallbacks.get("right")),e.forEach((t=>{let{namespace:e,callback:i}=t;this.namespace!==e&&"*"!==e||i()}))};document.addEventListener("mousedown",t,!1),this.unbinds.push((()=>document.removeEventListener("mousedown",t,!1)))})),_defineProperty$1(this,"initializeScrollListeners",(()=>{const t=t=>{let{deltaY:e}=t;this.scrollCallbacks.forEach((t=>{let{up:i,down:o,namespace:n}=t;this.namespace!==n&&"*"!==n||(e>0?i(e):e<0&&o(e))}))};document.addEventListener("wheel",t),this.unbinds.push((()=>document.removeEventListener("wheel",t)))})),this.initializeKeyListeners(),this.initializeClickListeners(),this.initializeScrollListeners()}}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Method{constructor(){var t=this;_defineProperty(this,"packets",[]),_defineProperty(this,"call",(function(e,i){void 0===i&&(i={}),t.packets.push({type:"METHOD",method:{name:e,payload:JSON.stringify(i)}})}))}}}}]);