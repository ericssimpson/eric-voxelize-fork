"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4424],{8926:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var s=t(4246),i=t(1670);const o={sidebar_position:8},r="Initialize the World",a={id:"basics/initialize-the-world",title:"Initialize the World",description:"Upon connecting to the server, the voxelize world receives a INIT packet since it's registered onto the network. We need to use that packet and initialize the world so that world.isInitialized would be true.",source:"@site/docs/tutorials/basics/8-initialize-the-world.md",sourceDirName:"basics",slug:"/basics/initialize-the-world",permalink:"/voxelize/tutorials/basics/initialize-the-world",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"Voxelize Networking",permalink:"/voxelize/tutorials/basics/handle-the-network"},next:{title:"Apply Textures",permalink:"/voxelize/tutorials/basics/texturing-blocks"}},l={},d=[{value:"Update the World",id:"update-the-world",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",img:"img",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"initialize-the-world",children:"Initialize the World"}),"\n",(0,s.jsxs)(n.p,{children:["Upon connecting to the server, the voxelize world receives a ",(0,s.jsx)(n.code,{children:"INIT"})," packet since it's registered onto the network. We need to use that packet and initialize the world so that ",(0,s.jsx)(n.code,{children:"world.isInitialized"})," would be true."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:"function animate() {\n    // ...\n\n    network.sync();\n\n    if (world.isInitialized) {\n        // Do in-game updates here\n    }\n\n    // ...\n\n    network.flush();\n}\n\nasync function start() {\n    // ...\n    await network.join('tutorial');\n\n    await world.initialize(); // Process the `INIT` packet\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"The world initialization retrieves the server-side chunking options (such as chunk size, registry blocks, etc), loads in the chunk materials, sets up the render radius, and starts the client-side meshing workers. If everything goes correctly, you should see something like below, where only the clouds are rendered:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(7244).Z+"",width:"2560",height:"1440"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Note that ",(0,s.jsx)(n.code,{children:"network.sync"})," and ",(0,s.jsx)(n.code,{children:"network.flush"})," are being called immediately within the animate function. This ensures that the ",(0,s.jsx)(n.code,{children:"world"})," can receive the ",(0,s.jsx)(n.code,{children:"INIT"})," packet to run ",(0,s.jsx)(n.code,{children:"world.initialize()"}),"."]})}),"\n",(0,s.jsx)(n.h2,{id:"update-the-world",children:"Update the World"}),"\n",(0,s.jsx)(n.p,{children:"Once the world is initialized, we can now update the world in our game loop. This process requests and meshes the chunks."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:"function animate() {\n    // ...\n\n    if (world.isInitialized) {\n        world.update(\n            camera.getWorldPosition(new THREE.Vector3()), \n            camera.getWorldDirection(new THREE.Vector3()),\n        );\n    }\n\n    // ...\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The first argument to ",(0,s.jsx)(n.code,{children:"update"})," is the center position to request chunks from. For instance, say the player is at ",(0,s.jsx)(n.code,{children:"(0, 0, 0)"})," and has a render radius of 8 chunks, the world would request all the chunks within 8 chunks from the origin. Here, we pass in the camera's position."]}),"\n",(0,s.jsx)(n.p,{children:'The second argument is for the direction of where the player is looking at. The world then uses it to frustum cull the chunks within the radius. This culls out the chunks that are "behind" the player, so we can prioritize on loading the chunks that can actually be seen.'}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(9615).Z+"",width:"1920",height:"1080"})}),"\n",(0,s.jsx)(n.p,{children:"As can be seen in the screenshot above, purple cells in the bottom right represents the chunks loaded, and red represents chunks within radius. The Voxelize world only loads in the chunks that the player is facing."}),"\n",(0,s.jsx)(n.h1,{id:"draw-the-sky",children:"Draw the Sky"}),"\n",(0,s.jsx)(n.p,{children:"Currently, the sky is plain black. Let's add some arts and colors to the sky."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-javascript",metastring:'title="main.js"',children:'world.sky.setShadingPhases([\n    // start of sunrise\n    {\n        name: "sunrise",\n        color: {\n            top: new THREE.Color("#7694CF"),\n            middle: new THREE.Color("#B0483A"),\n            bottom: new THREE.Color("#222"),\n        },\n        skyOffset: 0.05,\n        voidOffset: 0.6,\n        start: 0.2,\n    },\n    // end of sunrise\n    {\n        name: "daylight",\n        color: {\n            top: new THREE.Color("#73A3FB"),\n            middle: new THREE.Color("#B1CCFD"),\n            bottom: new THREE.Color("#222"),\n        },\n        skyOffset: 0,\n        voidOffset: 0.6,\n        start: 0.25,\n    },\n    // start of sunset\n    {\n        name: "sunset",\n        color: {\n            top: new THREE.Color("#A57A59"),\n            middle: new THREE.Color("#FC5935"),\n            bottom: new THREE.Color("#222"),\n        },\n        skyOffset: 0.05,\n        voidOffset: 0.6,\n        start: 0.7,\n    },\n    // end of sunset\n    {\n        name: "night",\n        color: {\n            top: new THREE.Color("#000"),\n            middle: new THREE.Color("#000"),\n            bottom: new THREE.Color("#000"),\n        },\n        skyOffset: 0.1,\n        voidOffset: 0.6,\n        start: 0.75,\n    },\n]);\n\nworld.sky.paint("bottom", VOXELIZE.artFunctions.drawSun());\nworld.sky.paint("top", VOXELIZE.artFunctions.drawStars());\nworld.sky.paint("top", VOXELIZE.artFunctions.drawMoon());\nworld.sky.paint("sides", VOXELIZE.artFunctions.drawStars());\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"setShadingPhases"})," defines the different phases that the sky interpolates to throughout the day. The Voxelize world's sky interpolates naturally between these phases as time progresses."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"world.sky.paint"})," works as the sky is actually a inwards ",(0,s.jsx)(n.a,{href:"/api/client/classes/CanvasBox",children:(0,s.jsx)(n.code,{children:"CanvasBox"})}),", and the preset art functions draws simple shapes onto the sky box."]}),"\n",(0,s.jsx)(n.p,{children:"In an upcoming tutorial, I will teach how to change the time of the day, so you can experience different shades of the sky."})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},7244:(e,n,t)=>{t.d(n,{Z:()=>s});const s=t.p+"assets/images/empty-sky-aed5e0ace016a546b9bf3d53d8516263.png"},9615:(e,n,t)=>{t.d(n,{Z:()=>s});const s=t.p+"assets/images/frustum-cull-7939bb6a034528ed0fa0bf5da2ccfdf2.png"},1670:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>r});var s=t(7378);const i={},o=s.createContext(i);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);